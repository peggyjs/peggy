// peggy 2.0.1
//
// https://peggyjs.org/
//
// Copyright (c) 2022- the Peggy authors
// Licensed under the MIT License.

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("chai"),require("whatwg-url")):"function"==typeof define&&define.amd?define(["exports","chai","whatwg-url"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).browser={},e.chai,e.whatwgURL)}(this,(function(exports,require$$0,require$$0$1){function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var require$$0__default=_interopDefaultLegacy(require$$0),require$$0__default$1=_interopDefaultLegacy(require$$0$1),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},GrammarLocation$5=function(){function e(e,t){this.source=e,this.start=t}return e.prototype.toString=function(){return String(this.source)},e.prototype.offset=function(e){return{line:e.line+this.start.line-1,column:1===e.line?e.column+this.start.column-1:e.column,offset:e.offset+this.start.offset}},e.offsetStart=function(e){return e.source&&"function"==typeof e.source.offset?e.source.offset(e.start):e.start},e.offsetEnd=function(e){return e.source&&"function"==typeof e.source.offset?e.source.offset(e.end):e.end},e}(),grammarLocation=GrammarLocation$5,__extends=commonjsGlobal&&commonjsGlobal.__extends||(extendStatics=function(e,t){return extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},extendStatics(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),extendStatics,GrammarLocation$4=grammarLocation,setProtoOf=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},GrammarError$5=function(e){function t(r,n,a){var o=e.call(this,r)||this;return setProtoOf(o,t.prototype),o.name="GrammarError",o.location=n,void 0===a&&(a=[]),o.diagnostics=a,o.stage=null,o.problems=[["error",r,n,a]],o}return __extends(t,e),t.prototype.toString=function(){var t=e.prototype.toString.call(this);this.location&&(t+="\n at ",void 0!==this.location.source&&null!==this.location.source&&(t+="".concat(this.location.source,":")),t+="".concat(this.location.start.line,":").concat(this.location.start.column));for(var r=0,n=this.diagnostics;r<n.length;r++){var a=n[r];t+="\n from ",void 0!==a.location.source&&null!==a.location.source&&(t+="".concat(a.location.source,":")),t+="".concat(a.location.start.line,":").concat(a.location.start.column,": ").concat(a.message)}return t},t.prototype.format=function(e){var t=e.map((function(e){return{source:e.source,text:e.text.split(/\r\n|\n|\r/g)}}));function r(e,r,n){void 0===n&&(n="");var a="",o=t.find((function(t){return t.source===e.source})),s=e.start,u=GrammarLocation$4.offsetStart(e);if(o){var i=e.end,c=o.text[s.line-1],l=(s.line===i.line?i.column:c.length+1)-s.column||1;n&&(a+="\nnote: ".concat(n)),a+="\n --\x3e ".concat(e.source,":").concat(u.line,":").concat(u.column,"\n").concat("".padEnd(r)," |\n").concat(u.line.toString().padStart(r)," | ").concat(c,"\n").concat("".padEnd(r)," | ").concat("".padEnd(s.column-1)).concat("".padEnd(l,"^"))}else a+="\n at ".concat(e.source,":").concat(u.line,":").concat(u.column),n&&(a+=": ".concat(n));return a}function n(e,t,n,a){var o;void 0===a&&(a=[]),o=n?a.reduce((function(e,t){var r=t.location;return Math.max(e,GrammarLocation$4.offsetStart(r).line)}),n.start.line):Math.max.apply(null,a.map((function(e){return e.location.start.line}))),o=o.toString().length;var s="".concat(e,": ").concat(t);n&&(s+=r(n,o));for(var u=0,i=a;u<i.length;u++){var c=i[u];s+=r(c.location,o,c.message)}return s}return this.problems.filter((function(e){return"info"!==e[0]})).map((function(e){return n.apply(void 0,e)})).join("\n\n")},t}(Error),grammarError=GrammarError$5,__spreadArray$5=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},visitor$b={build:function(e){function t(t){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return e[t.type].apply(e,__spreadArray$5([t],r,!1))}function r(){}function n(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];return t.apply(void 0,__spreadArray$5([e.expression],r,!1))}function a(e){return function(r){for(var n=[],a=1;a<arguments.length;a++)n[a-1]=arguments[a];r[e].forEach((function(e){return t.apply(void 0,__spreadArray$5([e],n,!1))}))}}var o={grammar:function(e){for(var r=[],n=1;n<arguments.length;n++)r[n-1]=arguments[n];e.topLevelInitializer&&t.apply(void 0,__spreadArray$5([e.topLevelInitializer],r,!1)),e.initializer&&t.apply(void 0,__spreadArray$5([e.initializer],r,!1)),e.rules.forEach((function(e){return t.apply(void 0,__spreadArray$5([e],r,!1))}))},top_level_initializer:r,initializer:r,rule:n,named:n,choice:a("alternatives"),action:n,sequence:a("elements"),labeled:n,text:n,simple_and:n,simple_not:n,optional:n,zero_or_more:n,one_or_more:n,group:n,semantic_and:r,semantic_not:r,rule_ref:r,literal:r,class:r,any:r};return Object.keys(o).forEach((function(t){Object.prototype.hasOwnProperty.call(e,t)||(e[t]=o[t])})),t}},visitor_1=visitor$b,visitor$a=visitor_1,asts$7={findRule:function(e,t){for(var r=0;r<e.rules.length;r++)if(e.rules[r].name===t)return e.rules[r]},indexOfRule:function(e,t){for(var r=0;r<e.rules.length;r++)if(e.rules[r].name===t)return r;return-1},alwaysConsumesOnSuccess:function(e,t){function r(){return!0}function n(){return!1}var a=visitor$a.build({choice:function(e){return e.alternatives.every(a)},sequence:function(e){return e.elements.some(a)},simple_and:n,simple_not:n,optional:n,zero_or_more:n,semantic_and:n,semantic_not:n,rule_ref:function(t){var r=asts$7.findRule(e,t.name);return r?a(r):void 0},literal:function(e){return""!==e.value},class:r,any:r});return a(t)}},asts_1=asts$7,opcodes={PUSH:0,PUSH_EMPTY_STRING:35,PUSH_UNDEFINED:1,PUSH_NULL:2,PUSH_FAILED:3,PUSH_EMPTY_ARRAY:4,PUSH_CURR_POS:5,POP:6,POP_CURR_POS:7,POP_N:8,NIP:9,APPEND:10,WRAP:11,TEXT:12,PLUCK:36,IF:13,IF_ERROR:14,IF_NOT_ERROR:15,WHILE_NOT_ERROR:16,MATCH_ANY:17,MATCH_STRING:18,MATCH_STRING_IC:19,MATCH_CHAR_CLASS:20,MATCH_REGEXP:20,ACCEPT_N:21,ACCEPT_STRING:22,FAIL:23,LOAD_SAVED_POS:24,UPDATE_SAVED_POS:25,CALL:26,RULE:27,SILENT_FAILS_ON:28,SILENT_FAILS_OFF:29,SOURCE_MAP_PUSH:37,SOURCE_MAP_POP:38,SOURCE_MAP_LABEL_PUSH:39,SOURCE_MAP_LABEL_POP:40},opcodes_1=opcodes,visitor$9=visitor_1,asts$6=asts_1,GrammarError$4=grammarError,ALWAYS_MATCH$1=1,SOMETIMES_MATCH$1=0,NEVER_MATCH$1=-1;function inferenceMatchResult$1(e){function t(e){return e.match=SOMETIMES_MATCH$1}function r(e){return o(e.expression),e.match=ALWAYS_MATCH$1}function n(e){return e.match=o(e.expression)}function a(e,t){for(var r=e.length,n=0,a=0,s=0;s<r;++s){var u=o(e[s]);u===ALWAYS_MATCH$1&&++n,u===NEVER_MATCH$1&&++a}return n===r?ALWAYS_MATCH$1:t?a===r?NEVER_MATCH$1:SOMETIMES_MATCH$1:a>0?NEVER_MATCH$1:SOMETIMES_MATCH$1}var o=visitor$9.build({rule:function(e){var t,r=0;if(void 0===e.match){e.match=SOMETIMES_MATCH$1;do{if(t=e.match,e.match=o(e.expression),++r>6)throw new GrammarError$4("Infinity cycle detected when trying to evaluate node match result",e.location)}while(t!==e.match)}return e.match},named:n,choice:function(e){return e.match=a(e.alternatives,!0)},action:n,sequence:function(e){return e.match=a(e.elements,!1)},labeled:n,text:n,simple_and:n,simple_not:function(e){return e.match=-o(e.expression)},optional:r,zero_or_more:r,one_or_more:n,group:n,semantic_and:t,semantic_not:t,rule_ref:function(t){var r=asts$6.findRule(e,t.name);return t.match=o(r)},literal:function(e){var t=0===e.value.length?ALWAYS_MATCH$1:SOMETIMES_MATCH$1;return e.match=t},class:function(e){var t=0===e.parts.length?NEVER_MATCH$1:SOMETIMES_MATCH$1;return e.match=t},any:t});o(e)}inferenceMatchResult$1.ALWAYS_MATCH=ALWAYS_MATCH$1,inferenceMatchResult$1.SOMETIMES_MATCH=SOMETIMES_MATCH$1,inferenceMatchResult$1.NEVER_MATCH=NEVER_MATCH$1;var inferenceMatchResult_1=inferenceMatchResult$1,__spreadArray$4=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},asts$5=asts_1,op$1=opcodes_1,visitor$8=visitor_1,_a$4=inferenceMatchResult_1,ALWAYS_MATCH=_a$4.ALWAYS_MATCH,SOMETIMES_MATCH=_a$4.SOMETIMES_MATCH,NEVER_MATCH=_a$4.NEVER_MATCH;function generateBytecode$1(e,t){var r=[],n=[],a=[],o=[],s=[];function u(e){var t=r.indexOf(e);return-1===t?r.push(e)-1:t}function i(e){var t=JSON.stringify(e),r=a.findIndex((function(e){return JSON.stringify(e)===t}));return-1===r?a.push(e)-1:r}function c(e,t,r){var n={predicate:e,params:t,body:r.code,location:r.codeLocation},a=JSON.stringify(n),s=o.findIndex((function(e){return JSON.stringify(e)===a}));return-1===s?o.push(n)-1:s}function l(e){return s.push(e)-1}function p(e){var t={};return Object.keys(e).forEach((function(r){t[r]=e[r]})),t}function f(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return e.concat.apply(e,t)}function d(e,t,r,n){return e===ALWAYS_MATCH?r:e===NEVER_MATCH?n:t.concat([r.length,n.length],r,n)}function g(e,t,r,n){var a=Object.keys(r).map((function(e){return n-r[e]}));return[op$1.CALL,e,t,a.length].concat(a)}function h(e,t,r){var n=0|e.match;return f([op$1.PUSH_CURR_POS],[op$1.SILENT_FAILS_ON],b(e,{sp:r.sp+1,env:p(r.env),action:null}),[op$1.SILENT_FAILS_OFF],d(t?-n:n,[t?op$1.IF_ERROR:op$1.IF_NOT_ERROR],f([op$1.POP],[t?op$1.POP:op$1.POP_CURR_POS],[op$1.PUSH_UNDEFINED]),f([op$1.POP],[t?op$1.POP_CURR_POS:op$1.POP],[op$1.PUSH_FAILED])))}function m(e,t,r){var n=c(!0,Object.keys(r.env),e);return f([op$1.UPDATE_SAVED_POS],g(n,0,r.env,r.sp),d(0|e.match,[op$1.IF],f([op$1.POP],t?[op$1.PUSH_FAILED]:[op$1.PUSH_UNDEFINED]),f([op$1.POP],t?[op$1.PUSH_UNDEFINED]:[op$1.PUSH_FAILED])))}function $(e){return t=[op$1.WHILE_NOT_ERROR],r=f([op$1.APPEND],e),t.concat([r.length],r);var t,r}var A,b=(A={grammar:function(e){e.rules.forEach(b),e.literals=r,e.classes=n,e.expectations=a,e.functions=o,e.locations=s},rule:function(e){e.bytecode=b(e.expression,{sp:-1,env:{},pluck:[],action:null})},named:function(e,t){var r=0|e.match,n=r===NEVER_MATCH?null:i({type:"rule",value:e.name});return f([op$1.SILENT_FAILS_ON],b(e.expression,t),[op$1.SILENT_FAILS_OFF],d(r,[op$1.IF_ERROR],[op$1.FAIL,n],[]))},choice:function(e,t){return function e(t,r){var n=0|t[0].match,a=b(t[0],{sp:r.sp,env:p(r.env),action:null});return n===ALWAYS_MATCH?a:f(a,t.length>1?d(SOMETIMES_MATCH,[op$1.IF_ERROR],f([op$1.POP],e(t.slice(1),r)),[]):[])}(e.alternatives,t)},action:function(e,t){var r=p(t.env),n="sequence"!==e.expression.type||0===e.expression.elements.length,a=b(e.expression,{sp:t.sp+(n?1:0),env:r,action:e}),o=0|e.expression.match,s=n&&o!==NEVER_MATCH?c(!1,Object.keys(r),e):null;return n?f([op$1.PUSH_CURR_POS],a,d(o,[op$1.IF_NOT_ERROR],f([op$1.LOAD_SAVED_POS,1],g(s,1,r,t.sp+2)),[]),[op$1.NIP]):a},sequence:function(e,t){return f([op$1.PUSH_CURR_POS],function t(r,n){if(r.length>0){var a=e.elements.length-r.length+1;return f(b(r[0],{sp:n.sp,env:n.env,pluck:n.pluck,action:null}),d(0|r[0].match,[op$1.IF_NOT_ERROR],t(r.slice(1),{sp:n.sp+1,env:n.env,pluck:n.pluck,action:n.action}),f(a>1?[op$1.POP_N,a]:[op$1.POP],[op$1.POP_CURR_POS],[op$1.PUSH_FAILED])))}if(n.pluck.length>0)return f([op$1.PLUCK,e.elements.length+1,n.pluck.length],n.pluck.map((function(e){return n.sp-e})));if(n.action){var o=c(!1,Object.keys(n.env),n.action);return f([op$1.LOAD_SAVED_POS,e.elements.length],g(o,e.elements.length+1,n.env,n.sp))}return f([op$1.WRAP,e.elements.length],[op$1.NIP])}(e.elements,{sp:t.sp+1,env:t.env,pluck:[],action:t.action}))},labeled:function(e,r){var n=r.env,a=e.label,o=r.sp+1;a&&(n=p(r.env),r.env[e.label]=o),e.pick&&r.pluck.push(o);var s=b(e.expression,{sp:r.sp,env:n,action:null});return a&&e.labelLocation&&t&&"source-and-map"===t.output?f([op$1.SOURCE_MAP_LABEL_PUSH,o,u(a),l(e.labelLocation)],s,[op$1.SOURCE_MAP_LABEL_POP,o]):s},text:function(e,t){return f([op$1.PUSH_CURR_POS],b(e.expression,{sp:t.sp+1,env:p(t.env),action:null}),d(0|e.match,[op$1.IF_NOT_ERROR],f([op$1.POP],[op$1.TEXT]),[op$1.NIP]))},simple_and:function(e,t){return h(e.expression,!1,t)},simple_not:function(e,t){return h(e.expression,!0,t)},optional:function(e,t){return f(b(e.expression,{sp:t.sp,env:p(t.env),action:null}),d(-(0|e.expression.match),[op$1.IF_ERROR],f([op$1.POP],[op$1.PUSH_NULL]),[]))},zero_or_more:function(e,t){var r=b(e.expression,{sp:t.sp+1,env:p(t.env),action:null});return f([op$1.PUSH_EMPTY_ARRAY],r,$(r),[op$1.POP])},one_or_more:function(e,t){var r=b(e.expression,{sp:t.sp+1,env:p(t.env),action:null});return f([op$1.PUSH_EMPTY_ARRAY],r,d(0|e.expression.match,[op$1.IF_NOT_ERROR],f($(r),[op$1.POP]),f([op$1.POP],[op$1.POP],[op$1.PUSH_FAILED])))},group:function(e,t){return b(e.expression,{sp:t.sp,env:p(t.env),action:null})},semantic_and:function(e,t){return m(e,!1,t)},semantic_not:function(e,t){return m(e,!0,t)},rule_ref:function(t){return[op$1.RULE,asts$5.indexOfRule(e,t.name)]},literal:function(e){if(e.value.length>0){var t=0|e.match,r=t===SOMETIMES_MATCH||t===ALWAYS_MATCH&&!e.ignoreCase?u(e.ignoreCase?e.value.toLowerCase():e.value):null,n=t!==ALWAYS_MATCH?i({type:"literal",value:e.value,ignoreCase:e.ignoreCase}):null;return d(t,e.ignoreCase?[op$1.MATCH_STRING_IC,r]:[op$1.MATCH_STRING,r],e.ignoreCase?[op$1.ACCEPT_N,e.value.length]:[op$1.ACCEPT_STRING,r],[op$1.FAIL,n])}return[op$1.PUSH_EMPTY_STRING]},class:function(e){var t=0|e.match,r=t===SOMETIMES_MATCH?function(e){var t={value:e.parts,inverted:e.inverted,ignoreCase:e.ignoreCase},r=JSON.stringify(t),a=n.findIndex((function(e){return JSON.stringify(e)===r}));return-1===a?n.push(t)-1:a}(e):null,a=t!==ALWAYS_MATCH?i({type:"class",value:e.parts,inverted:e.inverted,ignoreCase:e.ignoreCase}):null;return d(t,[op$1.MATCH_CHAR_CLASS,r],[op$1.ACCEPT_N,1],[op$1.FAIL,a])},any:function(e){var t=0|e.match,r=t!==ALWAYS_MATCH?i({type:"any"}):null;return d(t,[op$1.MATCH_ANY],[op$1.ACCEPT_N,1],[op$1.FAIL,r])}},t&&"source-and-map"===t.output&&Object.entries(A).forEach((function(e){var t=e[0],r=e[1];A[t]=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var a=r.apply(void 0,__spreadArray$4([e],t,!1));return void 0!==a&&e.location?f([op$1.SOURCE_MAP_PUSH,l(e.location)],a,[op$1.SOURCE_MAP_POP]):a}})),visitor$8.build(A));b(e)}var generateBytecode_1=generateBytecode$1,sourceMap$1={},sourceMapGenerator$1={},base64Vlq$1={},base64$6={};const intToCharMap$1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");base64$6.encode=function(e){if(0<=e&&e<intToCharMap$1.length)return intToCharMap$1[e];throw new TypeError("Must be between 0 and 63: "+e)};const base64$5=base64$6,VLQ_BASE_SHIFT$1=5,VLQ_BASE$1=1<<VLQ_BASE_SHIFT$1,VLQ_BASE_MASK$1=VLQ_BASE$1-1,VLQ_CONTINUATION_BIT$1=VLQ_BASE$1;function toVLQSigned$1(e){return e<0?1+(-e<<1):0+(e<<1)}base64Vlq$1.encode=function(e){let t,r="",n=toVLQSigned$1(e);do{t=n&VLQ_BASE_MASK$1,n>>>=VLQ_BASE_SHIFT$1,n>0&&(t|=VLQ_CONTINUATION_BIT$1),r+=base64$5.encode(t)}while(n>0);return r};var util$8={};function getArg$1(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')}util$8.getArg=getArg$1;const supportsNullProto$1=!("__proto__"in Object.create(null));function identity$1(e){return e}function toSetString$1(e){return isProtoString$1(e)?"$"+e:e}function fromSetString$1(e){return isProtoString$1(e)?e.slice(1):e}function isProtoString$1(e){if(!e)return!1;const t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(let r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function strcmp$1(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}function compareByGeneratedPositionsInflated$1(e,t){let r=e.generatedLine-t.generatedLine;return 0!==r?r:(r=e.generatedColumn-t.generatedColumn,0!==r?r:(r=strcmp$1(e.source,t.source),0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r?r:strcmp$1(e.name,t.name)))))}util$8.toSetString=supportsNullProto$1?identity$1:toSetString$1,util$8.fromSetString=supportsNullProto$1?identity$1:fromSetString$1,util$8.compareByGeneratedPositionsInflated=compareByGeneratedPositionsInflated$1;const PROTOCOL$1="http:",PROTOCOL_AND_HOST$1=`${PROTOCOL$1}//host`;function createSafeHandler$1(e){return t=>{const r=getURLType$1(t),n=buildSafeBase$1(t),a=new URL(t,n);e(a);const o=a.toString();return"absolute"===r?o:"scheme-relative"===r?o.slice(PROTOCOL$1.length):"path-absolute"===r?o.slice(PROTOCOL_AND_HOST$1.length):computeRelativeURL$1(n,o)}}function withBase$1(e,t){return new URL(e,t).toString()}function buildUniqueSegment$1(e,t){let r=0;for(;;){const n=e+r++;if(-1===t.indexOf(n))return n}}function buildSafeBase$1(e){const t=e.split("..").length-1,r=buildUniqueSegment$1("p",e);let n=`${PROTOCOL_AND_HOST$1}/`;for(let e=0;e<t;e++)n+=`${r}/`;return n}const ABSOLUTE_SCHEME$1=/^[A-Za-z0-9\+\-\.]+:/;function getURLType$1(e){return"/"===e[0]?"/"===e[1]?"scheme-relative":"path-absolute":ABSOLUTE_SCHEME$1.test(e)?"absolute":"path-relative"}function computeRelativeURL$1(e,t){"string"==typeof e&&(e=new URL(e)),"string"==typeof t&&(t=new URL(t));const r=t.pathname.split("/"),n=e.pathname.split("/");for(n.length>0&&!n[n.length-1]&&n.pop();r.length>0&&n.length>0&&r[0]===n[0];)r.shift(),n.shift();return n.map((()=>"..")).concat(r).join("/")+t.search+t.hash}const ensureDirectory$1=createSafeHandler$1((e=>{e.pathname=e.pathname.replace(/\/?$/,"/")})),normalize$1=createSafeHandler$1((e=>{}));function join$1(e,t){const r=getURLType$1(t),n=getURLType$1(e);if(e=ensureDirectory$1(e),"absolute"===r)return withBase$1(t,void 0);if("absolute"===n)return withBase$1(t,e);if("scheme-relative"===r)return normalize$1(t);if("scheme-relative"===n)return withBase$1(t,withBase$1(e,PROTOCOL_AND_HOST$1)).slice(PROTOCOL$1.length);if("path-absolute"===r)return normalize$1(t);if("path-absolute"===n)return withBase$1(t,withBase$1(e,PROTOCOL_AND_HOST$1)).slice(PROTOCOL_AND_HOST$1.length);const a=buildSafeBase$1(t+e);return computeRelativeURL$1(a,withBase$1(t,withBase$1(e,a)))}function relative$1(e,t){const r=relativeIfPossible$1(e,t);return"string"==typeof r?r:normalize$1(t)}function relativeIfPossible$1(e,t){if(getURLType$1(e)!==getURLType$1(t))return null;const r=buildSafeBase$1(e+t),n=new URL(e,r),a=new URL(t,r);try{new URL("",a.toString())}catch(e){return null}return a.protocol!==n.protocol||a.user!==n.user||a.password!==n.password||a.hostname!==n.hostname||a.port!==n.port?null:computeRelativeURL$1(n,a)}util$8.normalize=normalize$1,util$8.join=join$1,util$8.relative=relative$1;var arraySet$1={};class ArraySet$4{constructor(){this._array=[],this._set=new Map}static fromArray(e,t){const r=new ArraySet$4;for(let n=0,a=e.length;n<a;n++)r.add(e[n],t);return r}size(){return this._set.size}add(e,t){const r=this.has(e),n=this._array.length;r&&!t||this._array.push(e),r||this._set.set(e,n)}has(e){return this._set.has(e)}indexOf(e){const t=this._set.get(e);if(t>=0)return t;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}}arraySet$1.ArraySet=ArraySet$4;var mappingList$1={};const util$7=util$8;function generatedPositionAfter$1(e,t){const r=e.generatedLine,n=t.generatedLine,a=e.generatedColumn,o=t.generatedColumn;return n>r||n==r&&o>=a||util$7.compareByGeneratedPositionsInflated(e,t)<=0}class MappingList$3{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,t){this._array.forEach(e,t)}add(e){generatedPositionAfter$1(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(util$7.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}}mappingList$1.MappingList=MappingList$3;const base64VLQ$1=base64Vlq$1,util$6=util$8,ArraySet$3=arraySet$1.ArraySet,MappingList$2=mappingList$1.MappingList;class SourceMapGenerator$3{constructor(e){e||(e={}),this._file=util$6.getArg(e,"file",null),this._sourceRoot=util$6.getArg(e,"sourceRoot",null),this._skipValidation=util$6.getArg(e,"skipValidation",!1),this._sources=new ArraySet$3,this._names=new ArraySet$3,this._mappings=new MappingList$2,this._sourcesContents=null}static fromSourceMap(e){const t=e.sourceRoot,r=new SourceMapGenerator$3({file:e.file,sourceRoot:t});return e.eachMapping((function(e){const n={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(n.source=e.source,null!=t&&(n.source=util$6.relative(t,n.source)),n.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(n.name=e.name)),r.addMapping(n)})),e.sources.forEach((function(n){let a=n;null!=t&&(a=util$6.relative(t,n)),r._sources.has(a)||r._sources.add(a);const o=e.sourceContentFor(n);null!=o&&r.setSourceContent(n,o)})),r}addMapping(e){const t=util$6.getArg(e,"generated"),r=util$6.getArg(e,"original",null);let n=util$6.getArg(e,"source",null),a=util$6.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,n,a),null!=n&&(n=String(n),this._sources.has(n)||this._sources.add(n)),null!=a&&(a=String(a),this._names.has(a)||this._names.add(a)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:r&&r.line,originalColumn:r&&r.column,source:n,name:a})}setSourceContent(e,t){let r=e;null!=this._sourceRoot&&(r=util$6.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[util$6.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[util$6.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))}applySourceMap(e,t,r){let n=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');n=e.file}const a=this._sourceRoot;null!=a&&(n=util$6.relative(a,n));const o=this._mappings.toArray().length>0?new ArraySet$3:this._sources,s=new ArraySet$3;this._mappings.unsortedForEach((function(t){if(t.source===n&&null!=t.originalLine){const n=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=n.source&&(t.source=n.source,null!=r&&(t.source=util$6.join(r,t.source)),null!=a&&(t.source=util$6.relative(a,t.source)),t.originalLine=n.line,t.originalColumn=n.column,null!=n.name&&(t.name=n.name))}const u=t.source;null==u||o.has(u)||o.add(u);const i=t.name;null==i||s.has(i)||s.add(i)}),this),this._sources=o,this._names=s,e.sources.forEach((function(t){const n=e.sourceContentFor(t);null!=n&&(null!=r&&(t=util$6.join(r,t)),null!=a&&(t=util$6.relative(a,t)),this.setSourceContent(t,n))}),this)}_validateMapping(e,t,r,n){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!t&&!r&&!n);else if(!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:n}))}_serializeMappings(){let e,t,r,n,a=0,o=1,s=0,u=0,i=0,c=0,l="";const p=this._mappings.toArray();for(let f=0,d=p.length;f<d;f++){if(t=p[f],e="",t.generatedLine!==o)for(a=0;t.generatedLine!==o;)e+=";",o++;else if(f>0){if(!util$6.compareByGeneratedPositionsInflated(t,p[f-1]))continue;e+=","}e+=base64VLQ$1.encode(t.generatedColumn-a),a=t.generatedColumn,null!=t.source&&(n=this._sources.indexOf(t.source),e+=base64VLQ$1.encode(n-c),c=n,e+=base64VLQ$1.encode(t.originalLine-1-u),u=t.originalLine-1,e+=base64VLQ$1.encode(t.originalColumn-s),s=t.originalColumn,null!=t.name&&(r=this._names.indexOf(t.name),e+=base64VLQ$1.encode(r-i),i=r)),l+=e}return l}_generateSourcesContent(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=util$6.relative(t,e));const r=util$6.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null}),this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}}SourceMapGenerator$3.prototype._version=3,sourceMapGenerator$1.SourceMapGenerator=SourceMapGenerator$3;var sourceNode$1={};const SourceMapGenerator$2=sourceMapGenerator$1.SourceMapGenerator,util$5=util$8,REGEX_NEWLINE$1=/(\r?\n)/,NEWLINE_CODE$1=10,isSourceNode$1="$$$isSourceNode$$$";class SourceNode$4{constructor(e,t,r,n,a){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==a?null:a,this[isSourceNode$1]=!0,null!=n&&this.add(n)}static fromStringWithSourceMap(e,t,r){const n=new SourceNode$4,a=e.split(REGEX_NEWLINE$1);let o=0;const s=function(){return e()+(e()||"");function e(){return o<a.length?a[o++]:void 0}};let u,i=1,c=0,l=null;return t.eachMapping((function(e){if(null!==l){if(!(i<e.generatedLine)){u=a[o]||"";const t=u.substr(0,e.generatedColumn-c);return a[o]=u.substr(e.generatedColumn-c),c=e.generatedColumn,p(l,t),void(l=e)}p(l,s()),i++,c=0}for(;i<e.generatedLine;)n.add(s()),i++;c<e.generatedColumn&&(u=a[o]||"",n.add(u.substr(0,e.generatedColumn)),a[o]=u.substr(e.generatedColumn),c=e.generatedColumn),l=e}),this),o<a.length&&(l&&p(l,s()),n.add(a.splice(o).join(""))),t.sources.forEach((function(e){const a=t.sourceContentFor(e);null!=a&&(null!=r&&(e=util$5.join(r,e)),n.setSourceContent(e,a))})),n;function p(e,t){if(null===e||void 0===e.source)n.add(t);else{const a=r?util$5.join(r,e.source):e.source;n.add(new SourceNode$4(e.originalLine,e.originalColumn,a,t,e.name))}}}add(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[isSourceNode$1]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this}prepend(e){if(Array.isArray(e))for(let t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[isSourceNode$1]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this}walk(e){let t;for(let r=0,n=this.children.length;r<n;r++)t=this.children[r],t[isSourceNode$1]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let t,r;const n=this.children.length;if(n>0){for(t=[],r=0;r<n-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this}replaceRight(e,t){const r=this.children[this.children.length-1];return r[isSourceNode$1]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this}setSourceContent(e,t){this.sourceContents[util$5.toSetString(e)]=t}walkSourceContents(e){for(let t=0,r=this.children.length;t<r;t++)this.children[t][isSourceNode$1]&&this.children[t].walkSourceContents(e);const t=Object.keys(this.sourceContents);for(let r=0,n=t.length;r<n;r++)e(util$5.fromSetString(t[r]),this.sourceContents[t[r]])}toString(){let e="";return this.walk((function(t){e+=t})),e}toStringWithSourceMap(e){const t={code:"",line:1,column:0},r=new SourceMapGenerator$2(e);let n=!1,a=null,o=null,s=null,u=null;return this.walk((function(e,i){t.code+=e,null!==i.source&&null!==i.line&&null!==i.column?(a===i.source&&o===i.line&&s===i.column&&u===i.name||r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name}),a=i.source,o=i.line,s=i.column,u=i.name,n=!0):n&&(r.addMapping({generated:{line:t.line,column:t.column}}),a=null,n=!1);for(let o=0,s=e.length;o<s;o++)e.charCodeAt(o)===NEWLINE_CODE$1?(t.line++,t.column=0,o+1===s?(a=null,n=!1):n&&r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name})):t.column++})),this.walkSourceContents((function(e,t){r.setSourceContent(e,t)})),{code:t.code,map:r}}}sourceNode$1.SourceNode=SourceNode$4,sourceMap$1.SourceMapGenerator=sourceMapGenerator$1.SourceMapGenerator,sourceMap$1.SourceNode=sourceNode$1.SourceNode;var SourceNode$3=sourceMap$1.SourceNode,GrammarLocation$3=grammarLocation,Stack$2=function(){function e(e,t,r,n){this.sp=-1,this.maxSp=-1,this.varName=t,this.ruleName=e,this.type=r,this.bytecode=n,this.labels={},this.sourceMapStack=[]}return e.prototype.name=function(e){if(e<0)throw new RangeError("Rule '".concat(this.ruleName,"': The variable stack underflow: attempt to use a variable '").concat(this.varName,"<x>' at an index ").concat(e,".\nBytecode: ").concat(this.bytecode));return this.varName+e},e.prototype.sourceNode=function(e,t,r){var n=GrammarLocation$3.offsetStart(e);return new SourceNode$3(n.line,n.column?n.column-1:null,String(e.source),t,r)},e.prototype.push=function(e){++this.sp>this.maxSp&&(this.maxSp=this.sp);var t=this.labels[this.sp],r=[this.name(this.sp)," = ",e,";"];if(t){if(this.sourceMapStack.length){var n=this.sourceNode(t.location,r.splice(0,2),t.label),a=this.sourceMapPopInternal(),o=a.parts,s=a.location,u=s.start.offset<t.location.end.offset?{start:t.location.end,end:s.end,source:s.source}:s,i=this.sourceNode(u,r.concat("\n"));return this.sourceMapStack.push([o,o.length+1,s]),new SourceNode$3(null,null,t.location.source,[n,i])}return this.sourceNode(t.location,r.concat("\n"))}return r.join("")},e.prototype.pop=function(e){var t=this;return void 0!==e?(this.sp-=e,Array.from({length:e},(function(e,r){return t.name(t.sp+1+r)}))):this.name(this.sp--)},e.prototype.top=function(){return this.name(this.sp)},e.prototype.index=function(e){if(e<0)throw new RangeError("Rule '".concat(this.ruleName,"': The variable stack overflow: attempt to get a variable at a negative index ").concat(e,".\nBytecode: ").concat(this.bytecode));return this.name(this.sp-e)},e.prototype.result=function(){if(this.maxSp<0)throw new RangeError("Rule '".concat(this.ruleName,"': The variable stack is empty, can't get the result.\nBytecode: ").concat(this.bytecode));return this.name(0)},e.prototype.defines=function(){var e=this;return this.maxSp<0?"":this.type+" "+Array.from({length:this.maxSp+1},(function(t,r){return e.name(r)})).join(", ")+";"},e.prototype.checkedIf=function(e,t,r){var n=this.sp;if(t(),r){var a=this.sp;if(this.sp=n,r(),a!==this.sp)throw new Error("Rule '"+this.ruleName+"', position "+e+": Branches of a condition can't move the stack pointer differently (before: "+n+", after then: "+a+", after else: "+this.sp+"). Bytecode: "+this.bytecode)}},e.prototype.checkedLoop=function(e,t){var r=this.sp;if(t(),r!==this.sp)throw new Error("Rule '"+this.ruleName+"', position "+e+": Body of a loop can't move the stack pointer (before: "+r+", after: "+this.sp+"). Bytecode: "+this.bytecode)},e.prototype.sourceMapPush=function(e,t){if(this.sourceMapStack.length){var r=this.sourceMapStack[this.sourceMapStack.length-1];r[2].start.offset===t.start.offset&&r[2].end.offset>t.end.offset&&(r[2]={start:t.end,end:r[2].end,source:r[2].source})}this.sourceMapStack.push([e,e.length,t])},e.prototype.sourceMapPopInternal=function(){var e=this.sourceMapStack.pop(),t=e[0],r=e[1],n=e[2],a=t.splice(r).map((function(e){return e instanceof SourceNode$3?e:e+"\n"}));if(a.length){var o=GrammarLocation$3.offsetStart(n);t.push(new SourceNode$3(o.line,o.column-1,String(n.source),a))}return{parts:t,location:n}},e.prototype.sourceMapPop=function(e){var t=this.sourceMapPopInternal().location;if(this.sourceMapStack.length&&t.end.offset<this.sourceMapStack[this.sourceMapStack.length-1][2].end.offset){var r=this.sourceMapPopInternal(),n=r.parts,a=r.location,o=a.start.offset<t.end.offset?{start:t.end,end:a.end,source:a.source}:a;this.sourceMapStack.push([n,n.length+(e||0),o])}},e}(),stack=Stack$2,version$1="2.0.1",utils$1={};function hex$1(e){return e.charCodeAt(0).toString(16).toUpperCase()}function stringEscape$2(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\v/g,"\\v").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+hex$1(e)})).replace(/[\x10-\x1F\x7F-\xFF]/g,(function(e){return"\\x"+hex$1(e)})).replace(/[\u0100-\u0FFF]/g,(function(e){return"\\u0"+hex$1(e)})).replace(/[\u1000-\uFFFF]/g,(function(e){return"\\u"+hex$1(e)}))}function regexpClassEscape$2(e){return e.replace(/\\/g,"\\\\").replace(/\//g,"\\/").replace(/]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\v/g,"\\v").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+hex$1(e)})).replace(/[\x10-\x1F\x7F-\xFF]/g,(function(e){return"\\x"+hex$1(e)})).replace(/[\u0100-\u0FFF]/g,(function(e){return"\\u0"+hex$1(e)})).replace(/[\u1000-\uFFFF]/g,(function(e){return"\\u"+hex$1(e)}))}function base64$4(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=e.length%3,n=e.length-r,a="",o=0;o<n;o+=3)a+=t[e[o]>>2],a+=t[(3&e[o])<<4|e[o+1]>>4],a+=t[(15&e[o+1])<<2|e[o+2]>>6],a+=t[63&e[o+2]];return 1===r?(a+=t[e[n]>>2],a+=t[(3&e[n])<<4],a+="=="):2===r&&(a+=t[e[n]>>2],a+=t[(3&e[n])<<4|e[n+1]>>4],a+=t[(15&e[n+1])<<2],a+="="),a}utils$1.hex=hex$1,utils$1.stringEscape=stringEscape$2,utils$1.regexpClassEscape=regexpClassEscape$2,utils$1.base64=base64$4;var __spreadArray$3=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},asts$4=asts_1,op=opcodes_1,Stack$1=stack,VERSION$1=version$1,_a$3=utils$1,stringEscape$1=_a$3.stringEscape,regexpClassEscape$1=_a$3.regexpClassEscape,SourceNode$2=sourceMap$1.SourceNode,GrammarLocation$2=grammarLocation;function toSourceNode(e,t,r){var n=GrammarLocation$2.offsetStart(t),a=n.line,o=n.column-1,s=e.split("\n");return 1===s.length?new SourceNode$2(a,o,String(t.source),e,r):new SourceNode$2(null,null,String(t.source),s.map((function(e,n){return new SourceNode$2(a+n,0===n?o:0,String(t.source),n===s.length-1?e:[e,"\n"],r)})))}function wrapInSourceNode(e,t,r,n,a){if(r){var o=GrammarLocation$2.offsetEnd(r);return new SourceNode$2(null,null,String(r.source),[e,toSourceNode(t,r,a),new SourceNode$2(o.line,o.column-1,String(r.source),n)])}return new SourceNode$2(null,null,null,[e,t,n])}function generateJS$1(e,t){function r(e){var t=!0,r=0;return function e(n){return Array.isArray(n)?n.map(e):n instanceof SourceNode$2?(r++,n.children=e(n.children),r--,n):(n=t?n.replace(/^(.+)$/gm,"  $1"):n.replace(/\n(\s*\S)/g,"\n  $1"),t=!r||n.endsWith("\n"),n)}(e)}function n(e){return"peg$c"+e}function a(e){return"peg$r"+e}function o(e){return"peg$e"+e}function s(e){return"peg$f"+e}function u(e){return"peg$parse"+e}function i(e){return e.codeLocation?toSourceNode(e.code,e.codeLocation,"$"+e.type):e.code}e.code=function(e){function n(){return["// Generated by Peggy ".concat(VERSION$1,"."),"//","// https://peggyjs.org/"]}function a(){return t.trace?["{","  SyntaxError: peg$SyntaxError,","  DefaultTracer: peg$DefaultTracer,","  parse: peg$parse","}"].join("\n"):["{","  SyntaxError: peg$SyntaxError,","  parse: peg$parse","}"].join("\n")}var o={bare:function(){return __spreadArray$3(__spreadArray$3([],n(),!0),["(function() {",'  "use strict";',"",e,"",r("return "+a()+";"),"})()"],!1)},commonjs:function(){var r=Object.keys(t.dependencies),o=n();return o.push("",'"use strict";',""),r.length>0&&(r.forEach((function(e){o.push("var "+e+' = require("'+stringEscape$1(t.dependencies[e])+'");')})),o.push("")),o.push(e,"","module.exports = "+a()+";"),o},es:function(){var r=Object.keys(t.dependencies),a=n();return a.push(""),r.length>0&&(r.forEach((function(e){a.push("import "+e+' from "'+stringEscape$1(t.dependencies[e])+'";')})),a.push("")),a.push(e,"","export {","  peg$SyntaxError as SyntaxError,",t.trace?"  peg$DefaultTracer as DefaultTracer,":"","  peg$parse as parse","};"),a},amd:function(){var o=Object.keys(t.dependencies),s="["+o.map((function(e){return t.dependencies[e]})).map((function(e){return'"'+stringEscape$1(e)+'"'})).join(", ")+"]",u=o.join(", ");return __spreadArray$3(__spreadArray$3([],n(),!0),["define("+s+", function("+u+") {",'  "use strict";',"",e,"",r("return "+a()+";"),"});"],!1)},globals:function(){return __spreadArray$3(__spreadArray$3([],n(),!0),["(function(root) {",'  "use strict";',"",e,"",r("root."+t.exportVar+" = "+a()+";"),"})(this);"],!1)},umd:function(){var o=Object.keys(t.dependencies),s=o.map((function(e){return t.dependencies[e]})),u="["+s.map((function(e){return'"'+stringEscape$1(e)+'"'})).join(", ")+"]",i=s.map((function(e){return'require("'+stringEscape$1(e)+'")'})).join(", "),c=o.join(", "),l=n();return l.push("(function(root, factory) {",'  if (typeof define === "function" && define.amd) {',"    define("+u+", factory);",'  } else if (typeof module === "object" && module.exports) {',"    module.exports = factory("+i+");"),null!==t.exportVar&&l.push("  } else {","    root."+t.exportVar+" = factory();"),l.push("  }","})(this, function("+c+") {",'  "use strict";',"",e,"",r("return "+a()+";"),"});"),l}},s=o[t.format]();return new SourceNode$2(null,null,t.grammarSource,s.map((function(e){return e instanceof SourceNode$2?e:e+"\n"})))}(function(){var c=[];e.topLevelInitializer&&(c.push(i(e.topLevelInitializer)),c.push("")),c.push("function peg$subclass(child, parent) {","  function C() { this.constructor = child; }","  C.prototype = parent.prototype;","  child.prototype = new C();","}","","function peg$SyntaxError(message, expected, found, location) {","  var self = Error.call(this, message);","  // istanbul ignore next Check is a necessary evil to support older environments","  if (Object.setPrototypeOf) {","    Object.setPrototypeOf(self, peg$SyntaxError.prototype);","  }","  self.expected = expected;","  self.found = found;","  self.location = location;",'  self.name = "SyntaxError";',"  return self;","}","","peg$subclass(peg$SyntaxError, Error);","","function peg$padEnd(str, targetLength, padString) {",'  padString = padString || " ";',"  if (str.length > targetLength) { return str; }","  targetLength -= str.length;","  padString += padString.repeat(targetLength);","  return str + padString.slice(0, targetLength);","}","","peg$SyntaxError.prototype.format = function(sources) {",'  var str = "Error: " + this.message;',"  if (this.location) {","    var src = null;","    var k;","    for (k = 0; k < sources.length; k++) {","      if (sources[k].source === this.location.source) {","        src = sources[k].text.split(/\\r\\n|\\n|\\r/g);","        break;","      }","    }","    var s = this.location.start;",'    var offset_s = (this.location.source && (typeof this.location.source.offset === "function"))',"      ? this.location.source.offset(s)","      : s;",'    var loc = this.location.source + ":" + offset_s.line + ":" + offset_s.column;',"    if (src) {","      var e = this.location.end;","      var filler = peg$padEnd(\"\", offset_s.line.toString().length, ' ');","      var line = src[s.line - 1];","      var last = s.line === e.line ? e.column : line.length + 1;","      var hatLen = (last - s.column) || 1;",'      str += "\\n --\x3e " + loc + "\\n"','          + filler + " |\\n"','          + offset_s.line + " | " + line + "\\n"','          + filler + " | " + peg$padEnd("", s.column - 1, \' \')','          + peg$padEnd("", hatLen, "^");',"    } else {",'      str += "\\n at " + loc;',"    }","  }","  return str;","};","","peg$SyntaxError.buildMessage = function(expected, found) {","  var DESCRIBE_EXPECTATION_FNS = {","    literal: function(expectation) {",'      return "\\"" + literalEscape(expectation.text) + "\\"";',"    },","","    class: function(expectation) {","      var escapedParts = expectation.parts.map(function(part) {","        return Array.isArray(part)",'          ? classEscape(part[0]) + "-" + classEscape(part[1])',"          : classEscape(part);","      });","",'      return "[" + (expectation.inverted ? "^" : "") + escapedParts.join("") + "]";',"    },","","    any: function() {",'      return "any character";',"    },","","    end: function() {",'      return "end of input";',"    },","","    other: function(expectation) {","      return expectation.description;","    }","  };","","  function hex(ch) {","    return ch.charCodeAt(0).toString(16).toUpperCase();","  }","","  function literalEscape(s) {","    return s",'      .replace(/\\\\/g, "\\\\\\\\")','      .replace(/"/g,  "\\\\\\"")','      .replace(/\\0/g, "\\\\0")','      .replace(/\\t/g, "\\\\t")','      .replace(/\\n/g, "\\\\n")','      .replace(/\\r/g, "\\\\r")','      .replace(/[\\x00-\\x0F]/g,          function(ch) { return "\\\\x0" + hex(ch); })','      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return "\\\\x"  + hex(ch); });',"  }","","  function classEscape(s) {","    return s",'      .replace(/\\\\/g, "\\\\\\\\")','      .replace(/\\]/g, "\\\\]")','      .replace(/\\^/g, "\\\\^")','      .replace(/-/g,  "\\\\-")','      .replace(/\\0/g, "\\\\0")','      .replace(/\\t/g, "\\\\t")','      .replace(/\\n/g, "\\\\n")','      .replace(/\\r/g, "\\\\r")','      .replace(/[\\x00-\\x0F]/g,          function(ch) { return "\\\\x0" + hex(ch); })','      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return "\\\\x"  + hex(ch); });',"  }","","  function describeExpectation(expectation) {","    return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);","  }","","  function describeExpected(expected) {","    var descriptions = expected.map(describeExpectation);","    var i, j;","","    descriptions.sort();","","    if (descriptions.length > 0) {","      for (i = 1, j = 1; i < descriptions.length; i++) {","        if (descriptions[i - 1] !== descriptions[i]) {","          descriptions[j] = descriptions[i];","          j++;","        }","      }","      descriptions.length = j;","    }","","    switch (descriptions.length) {","      case 1:","        return descriptions[0];","","      case 2:",'        return descriptions[0] + " or " + descriptions[1];',"","      default:",'        return descriptions.slice(0, -1).join(", ")','          + ", or "',"          + descriptions[descriptions.length - 1];","    }","  }","","  function describeFound(found) {",'    return found ? "\\"" + literalEscape(found) + "\\"" : "end of input";',"  }","",'  return "Expected " + describeExpected(expected) + " but " + describeFound(found) + " found.";',"};",""),t.trace&&c.push("function peg$DefaultTracer() {","  this.indentLevel = 0;","}","","peg$DefaultTracer.prototype.trace = function(event) {","  var that = this;","","  function log(event) {","    function repeat(string, n) {",'       var result = "", i;',"","       for (i = 0; i < n; i++) {","         result += string;","       }","","       return result;","    }","","    function pad(string, length) {",'      return string + repeat(" ", length - string.length);',"    }","",'    if (typeof console === "object") {',"      console.log(",'        event.location.start.line + ":" + event.location.start.column + "-"','          + event.location.end.line + ":" + event.location.end.column + " "','          + pad(event.type, 10) + " "','          + repeat("  ", that.indentLevel) + event.rule',"      );","    }","  }","","  switch (event.type) {",'    case "rule.enter":',"      log(event);","      this.indentLevel++;","      break;","",'    case "rule.match":',"      this.indentLevel--;","      log(event);","      break;","",'    case "rule.fail":',"      this.indentLevel--;","      log(event);","      break;","","    default:",'      throw new Error("Invalid event type: " + event.type + ".");',"  }","};","");var l="{ "+t.allowedStartRules.map((function(e){return e+": "+u(e)})).join(", ")+" }",p=u(t.allowedStartRules[0]);return c.push("function peg$parse(input, options) {","  options = options !== undefined ? options : {};","","  var peg$FAILED = {};","  var peg$source = options.grammarSource;","","  var peg$startRuleFunctions = "+l+";","  var peg$startRuleFunction = "+p+";","",new SourceNode$2(null,null,t.grammarSource,[e.literals.map((function(e,t){return"  var "+n(t)+' = "'+stringEscape$1(e)+'";'})).concat("",e.classes.map((function(e,t){return"  var "+a(t)+" = /^["+((r=e).inverted?"^":"")+r.value.map((function(e){return Array.isArray(e)?regexpClassEscape$1(e[0])+"-"+regexpClassEscape$1(e[1]):regexpClassEscape$1(e)})).join("")+"]/"+(r.ignoreCase?"i":"")+";";var r}))).concat("",e.expectations.map((function(e,t){return"  var "+o(t)+" = "+function(e){switch(e.type){case"rule":return'peg$otherExpectation("'+stringEscape$1(e.value)+'")';case"literal":return'peg$literalExpectation("'+stringEscape$1(e.value)+'", '+e.ignoreCase+")";case"class":return"peg$classExpectation(["+e.value.map((function(e){return Array.isArray(e)?'["'+stringEscape$1(e[0])+'", "'+stringEscape$1(e[1])+'"]':'"'+stringEscape$1(e)+'"'})).join(", ")+"], "+e.inverted+", "+e.ignoreCase+")";case"any":return"peg$anyExpectation()";default:throw new Error("Unknown expectation type ("+JSON.stringify(e)+")")}}(e)+";"}))).concat("").join("\n"),e.functions.map((function(e,t){return wrapInSourceNode("\n  var ".concat(s(t)," = function(").concat(e.params.join(", "),") {"),e.body,e.location,"};")}))]),"","  var peg$currPos = 0;","  var peg$savedPos = 0;","  var peg$posDetailsCache = [{ line: 1, column: 1 }];","  var peg$maxFailPos = 0;","  var peg$maxFailExpected = [];","  var peg$silentFails = 0;",""),t.cache&&c.push("  var peg$resultsCache = {};",""),t.trace&&c.push('  var peg$tracer = "tracer" in options ? options.tracer : new peg$DefaultTracer();',""),c.push("  var peg$result;","",'  if ("startRule" in options) {',"    if (!(options.startRule in peg$startRuleFunctions)) {",'      throw new Error("Can\'t start parsing from rule \\"" + options.startRule + "\\".");',"    }","","    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];","  }","","  function text() {","    return input.substring(peg$savedPos, peg$currPos);","  }","","  function offset() {","    return peg$savedPos;","  }","","  function range() {","    return {","      source: peg$source,","      start: peg$savedPos,","      end: peg$currPos","    };","  }","","  function location() {","    return peg$computeLocation(peg$savedPos, peg$currPos);","  }","","  function expected(description, location) {","    location = location !== undefined","      ? location","      : peg$computeLocation(peg$savedPos, peg$currPos);","","    throw peg$buildStructuredError(","      [peg$otherExpectation(description)],","      input.substring(peg$savedPos, peg$currPos),","      location","    );","  }","","  function error(message, location) {","    location = location !== undefined","      ? location","      : peg$computeLocation(peg$savedPos, peg$currPos);","","    throw peg$buildSimpleError(message, location);","  }","","  function peg$literalExpectation(text, ignoreCase) {",'    return { type: "literal", text: text, ignoreCase: ignoreCase };',"  }","","  function peg$classExpectation(parts, inverted, ignoreCase) {",'    return { type: "class", parts: parts, inverted: inverted, ignoreCase: ignoreCase };',"  }","","  function peg$anyExpectation() {",'    return { type: "any" };',"  }","","  function peg$endExpectation() {",'    return { type: "end" };',"  }","","  function peg$otherExpectation(description) {",'    return { type: "other", description: description };',"  }","","  function peg$computePosDetails(pos) {","    var details = peg$posDetailsCache[pos];","    var p;","","    if (details) {","      return details;","    } else {","      p = pos - 1;","      while (!peg$posDetailsCache[p]) {","        p--;","      }","","      details = peg$posDetailsCache[p];","      details = {","        line: details.line,","        column: details.column","      };","","      while (p < pos) {","        if (input.charCodeAt(p) === 10) {","          details.line++;","          details.column = 1;","        } else {","          details.column++;","        }","","        p++;","      }","","      peg$posDetailsCache[pos] = details;","","      return details;","    }","  }","","  function peg$computeLocation(startPos, endPos, offset) {","    var startPosDetails = peg$computePosDetails(startPos);","    var endPosDetails = peg$computePosDetails(endPos);","","    var res = {","      source: peg$source,","      start: {","        offset: startPos,","        line: startPosDetails.line,","        column: startPosDetails.column","      },","      end: {","        offset: endPos,","        line: endPosDetails.line,","        column: endPosDetails.column","      }","    };",'    if (offset && peg$source && (typeof peg$source.offset === "function")) {',"      res.start = peg$source.offset(res.start);","      res.end = peg$source.offset(res.end);","    }","    return res;","  }","","  function peg$fail(expected) {","    if (peg$currPos < peg$maxFailPos) { return; }","","    if (peg$currPos > peg$maxFailPos) {","      peg$maxFailPos = peg$currPos;","      peg$maxFailExpected = [];","    }","","    peg$maxFailExpected.push(expected);","  }","","  function peg$buildSimpleError(message, location) {","    return new peg$SyntaxError(message, null, null, location);","  }","","  function peg$buildStructuredError(expected, found, location) {","    return new peg$SyntaxError(","      peg$SyntaxError.buildMessage(expected, found),","      expected,","      found,","      location","    );","  }",""),e.rules.forEach((function(i){c.push.apply(c,r(function(i){var c=[],l=new Stack$1(i.name,"s","var",i.bytecode),p=function t(c){var p,f=0,d=c.length,g=[];function h(e,n){var a,o,s=n+3,u=c[f+s-2],i=c[f+s-1];l.checkedIf(f,(function(){f+=s,a=t(c.slice(f,f+u)),f+=u}),i>0?function(){o=t(c.slice(f,f+i)),f+=i}:null),g.push("if ("+e+") {"),g.push.apply(g,r(a)),i>0&&(g.push("} else {"),g.push.apply(g,r(o))),g.push("}")}function m(e){var n,a=c[f+2-1];l.checkedLoop(f,(function(){f+=2,n=t(c.slice(f,f+a)),f+=a})),g.push("while ("+e+") {"),g.push.apply(g,r(n)),g.push("}")}function $(){var e=c[f+4-1],t=s(c[f+1])+"("+c.slice(f+4,f+4+e).map((function(e){return l.index(e)})).join(", ")+")";l.pop(c[f+2]),g.push(l.push(t)),f+=4+e}for(;f<d;)switch(c[f]){case op.PUSH_EMPTY_STRING:g.push(l.push("''")),f++;break;case op.PUSH_CURR_POS:g.push(l.push("peg$currPos")),f++;break;case op.PUSH_UNDEFINED:g.push(l.push("undefined")),f++;break;case op.PUSH_NULL:g.push(l.push("null")),f++;break;case op.PUSH_FAILED:g.push(l.push("peg$FAILED")),f++;break;case op.PUSH_EMPTY_ARRAY:g.push(l.push("[]")),f++;break;case op.POP:l.pop(),f++;break;case op.POP_CURR_POS:g.push("peg$currPos = "+l.pop()+";"),f++;break;case op.POP_N:l.pop(c[f+1]),f+=2;break;case op.NIP:p=l.pop(),l.pop(),g.push(l.push(p)),f++;break;case op.APPEND:p=l.pop(),g.push(l.top()+".push("+p+");"),f++;break;case op.WRAP:g.push(l.push("["+l.pop(c[f+1]).join(", ")+"]")),f+=2;break;case op.TEXT:g.push(l.push("input.substring("+l.pop()+", peg$currPos)")),f++;break;case op.PLUCK:var A=c[f+3-1],b=3+A;p=c.slice(f+3,f+b),p=1===A?l.index(p[0]):"[ ".concat(p.map((function(e){return l.index(e)})).join(", ")," ]"),l.pop(c[f+1]),g.push(l.push(p)),f+=b;break;case op.IF:h(l.top(),0);break;case op.IF_ERROR:h(l.top()+" === peg$FAILED",0);break;case op.IF_NOT_ERROR:h(l.top()+" !== peg$FAILED",0);break;case op.WHILE_NOT_ERROR:m(l.top()+" !== peg$FAILED");break;case op.MATCH_ANY:h("input.length > peg$currPos",0);break;case op.MATCH_STRING:h(e.literals[c[f+1]].length>1?"input.substr(peg$currPos, "+e.literals[c[f+1]].length+") === "+n(c[f+1]):"input.charCodeAt(peg$currPos) === "+e.literals[c[f+1]].charCodeAt(0),1);break;case op.MATCH_STRING_IC:h("input.substr(peg$currPos, "+e.literals[c[f+1]].length+").toLowerCase() === "+n(c[f+1]),1);break;case op.MATCH_CHAR_CLASS:h(a(c[f+1])+".test(input.charAt(peg$currPos))",1);break;case op.ACCEPT_N:g.push(l.push(c[f+1]>1?"input.substr(peg$currPos, "+c[f+1]+")":"input.charAt(peg$currPos)")),g.push(c[f+1]>1?"peg$currPos += "+c[f+1]+";":"peg$currPos++;"),f+=2;break;case op.ACCEPT_STRING:g.push(l.push(n(c[f+1]))),g.push(e.literals[c[f+1]].length>1?"peg$currPos += "+e.literals[c[f+1]].length+";":"peg$currPos++;"),f+=2;break;case op.FAIL:g.push(l.push("peg$FAILED")),g.push("if (peg$silentFails === 0) { peg$fail("+o(c[f+1])+"); }"),f+=2;break;case op.LOAD_SAVED_POS:g.push("peg$savedPos = "+l.index(c[f+1])+";"),f+=2;break;case op.UPDATE_SAVED_POS:g.push("peg$savedPos = peg$currPos;"),f++;break;case op.CALL:$();break;case op.RULE:g.push(l.push(u(e.rules[c[f+1]].name)+"()")),f+=2;break;case op.SILENT_FAILS_ON:g.push("peg$silentFails++;"),f++;break;case op.SILENT_FAILS_OFF:g.push("peg$silentFails--;"),f++;break;case op.SOURCE_MAP_PUSH:l.sourceMapPush(g,e.locations[c[f+1]]),f+=2;break;case op.SOURCE_MAP_POP:l.sourceMapPop(),f++;break;case op.SOURCE_MAP_LABEL_PUSH:l.labels[c[f+1]]={label:e.literals[c[f+2]],location:e.locations[c[f+3]]},f+=4;break;case op.SOURCE_MAP_LABEL_POP:delete l.labels[c[f+1]],f+=2;break;default:throw new Error("Invalid opcode: "+c[f]+".",{rule:i.name,bytecode:c})}return g}(i.bytecode);return c.push(wrapInSourceNode("function ",u(i.name),i.nameLocation,"() {\n",i.name)),t.trace&&c.push("  var startPos = peg$currPos;"),c.push(r(l.defines())),c.push.apply(c,r(function(r,n){var a=[];return a.push(""),t.trace&&a.push("peg$tracer.trace({",'  type: "rule.enter",',"  rule: "+r+",","  location: peg$computeLocation(startPos, startPos, true)","});",""),t.cache&&(a.push("var key = peg$currPos * "+e.rules.length+" + "+n+";","var cached = peg$resultsCache[key];","","if (cached) {","  peg$currPos = cached.nextPos;",""),t.trace&&a.push("if (cached.result !== peg$FAILED) {","  peg$tracer.trace({",'    type: "rule.match",',"    rule: "+r+",","    result: cached.result,","    location: peg$computeLocation(startPos, peg$currPos, true)","  });","} else {","  peg$tracer.trace({",'    type: "rule.fail",',"    rule: "+r+",","    location: peg$computeLocation(startPos, startPos, true)","  });","}",""),a.push("  return cached.result;","}","")),a}('"'+stringEscape$1(i.name)+'"',asts$4.indexOfRule(e,i.name)))),c.push.apply(c,r(p)),c.push.apply(c,r(function(e,r){var n=[];return t.cache&&n.push("","peg$resultsCache[key] = { nextPos: peg$currPos, result: "+r+" };"),t.trace&&n.push("","if ("+r+" !== peg$FAILED) {","  peg$tracer.trace({",'    type: "rule.match",',"    rule: "+e+",","    result: "+r+",","    location: peg$computeLocation(startPos, peg$currPos, true)","  });","} else {","  peg$tracer.trace({",'    type: "rule.fail",',"    rule: "+e+",","    location: peg$computeLocation(startPos, startPos, true)","  });","}"),n.push("","return "+r+";"),n}('"'+stringEscape$1(i.name)+'"',l.result()))),c.push("}"),c}(i))),c.push("")})),e.initializer&&(c.push(i(e.initializer)),c.push("")),c.push("  peg$result = peg$startRuleFunction();","","  if (peg$result !== peg$FAILED && peg$currPos === input.length) {","    return peg$result;","  } else {","    if (peg$result !== peg$FAILED && peg$currPos < input.length) {","      peg$fail(peg$endExpectation());","    }","","    throw peg$buildStructuredError(","      peg$maxFailExpected,","      peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,","      peg$maxFailPos < input.length","        ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)","        : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)","    );","  }","}"),new SourceNode$2(null,null,t.grammarSource,c.map((function(e){return e instanceof SourceNode$2?e:e+"\n"})))}())}var generateJs=generateJS$1,asts$3=asts_1,visitor$7=visitor_1;function removeProxyRules$1(e,t,r){var n=[];e.rules.forEach((function(a,o){var s;"rule"===(s=a).type&&"rule_ref"===s.expression.type&&(function(e,t,n){visitor$7.build({rule_ref:function(a){a.name===t&&(a.name=n,r.info('Proxy rule "'.concat(t,'" replaced by the rule "').concat(n,'"'),a.location,[{message:"This rule will be used",location:asts$3.findRule(e,n).nameLocation}]))}})(e)}(e,a.name,a.expression.name),-1===t.allowedStartRules.indexOf(a.name)&&n.push(o))})),n.reverse(),n.forEach((function(t){e.rules.splice(t,1)}))}var removeProxyRules_1=removeProxyRules$1,visitor$6=visitor_1;function reportDuplicateLabels$1(e,t,r){function n(e){var t={};return Object.keys(e).forEach((function(r){t[r]=e[r]})),t}function a(e,t){o(e.expression,n(t))}var o=visitor$6.build({rule:function(e){o(e.expression,{})},choice:function(e,t){e.alternatives.forEach((function(e){o(e,n(t))}))},action:a,labeled:function(e,t){var n=e.label;n&&Object.prototype.hasOwnProperty.call(t,n)&&r.error('Label "'.concat(e.label,'" is already defined'),e.labelLocation,[{message:"Original label location",location:t[n]}]),o(e.expression,t),t[e.label]=e.labelLocation},text:a,simple_and:a,simple_not:a,optional:a,zero_or_more:a,one_or_more:a,group:a});o(e)}var reportDuplicateLabels_1=reportDuplicateLabels$1,visitor$5=visitor_1;function reportDuplicateRules$1(e,t,r){var n={};visitor$5.build({rule:function(e){Object.prototype.hasOwnProperty.call(n,e.name)?r.error('Rule "'.concat(e.name,'" is already defined'),e.nameLocation,[{message:"Original rule location",location:n[e.name]}]):n[e.name]=e.nameLocation}})(e)}var reportDuplicateRules_1=reportDuplicateRules$1,asts$2=asts_1,visitor$4=visitor_1;function reportInfiniteRecursion$1(e,t,r){var n=[],a=[],o=visitor$4.build({rule:function(e){n.push(e.name),o(e.expression),n.pop()},sequence:function(t){t.elements.every((function(t){return o(t),!asts$2.alwaysConsumesOnSuccess(e,t)}))},rule_ref:function(t){a.push(t);var s=asts$2.findRule(e,t.name);if(-1!==n.indexOf(t.name))return n.push(t.name),void r.error("Possible infinite loop when parsing (left recursion: "+n.join(" -> ")+")",s.nameLocation,a.map((function(e,t,r){return{message:t+1!==r.length?"Step ".concat(t+1,': call of the rule "').concat(e.name,'" without input consumption'):"Step ".concat(t+1,": call itself without input consumption - left recursion"),location:e.location}})));s&&o(s),a.pop()}});o(e)}var reportInfiniteRecursion_1=reportInfiniteRecursion$1,asts$1=asts_1,visitor$3=visitor_1;function reportInfiniteRepetition$1(e,t,r){visitor$3.build({zero_or_more:function(t){asts$1.alwaysConsumesOnSuccess(e,t.expression)||r.error("Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",t.location)},one_or_more:function(t){asts$1.alwaysConsumesOnSuccess(e,t.expression)||r.error("Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",t.location)}})(e)}var reportInfiniteRepetition_1=reportInfiniteRepetition$1,asts=asts_1,visitor$2=visitor_1;function reportUndefinedRules$1(e,t,r){visitor$2.build({rule_ref:function(t){asts.findRule(e,t.name)||r.error('Rule "'.concat(t.name,'" is not defined'),t.location)}})(e)}var reportUndefinedRules_1=reportUndefinedRules$1,visitor$1=visitor_1;function reportIncorrectPlucking$1(e,t,r){var n=visitor$1.build({action:function(e){n(e.expression,e)},labeled:function(e,t){e.pick&&t&&r.error('"@" cannot be used with an action block',e.labelLocation,[{message:"Action block location",location:t.codeLocation}]),n(e.expression)}});n(e)}var reportIncorrectPlucking_1=reportIncorrectPlucking$1,__spreadArray$2=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},GrammarError$3=grammarError,Defaults=function(){function e(e){"function"==typeof(e=void 0!==e?e:{}).error&&(this.error=e.error),"function"==typeof e.warning&&(this.warning=e.warning),"function"==typeof e.info&&(this.info=e.info)}return e.prototype.error=function(){},e.prototype.warning=function(){},e.prototype.info=function(){},e}(),Session$2=function(){function e(e){this._callbacks=new Defaults(e),this._firstError=null,this.errors=0,this.problems=[],this.stage=null}return e.prototype.error=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];++this.errors,null===this._firstError&&(this._firstError=new(GrammarError$3.bind.apply(GrammarError$3,__spreadArray$2([void 0],t,!1))),this._firstError.stage=this.stage,this._firstError.problems=this.problems),this.problems.push(__spreadArray$2(["error"],t,!0)),(e=this._callbacks).error.apply(e,__spreadArray$2([this.stage],t,!1))},e.prototype.warning=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this.problems.push(__spreadArray$2(["warning"],t,!0)),(e=this._callbacks).warning.apply(e,__spreadArray$2([this.stage],t,!1))},e.prototype.info=function(){for(var e,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];this.problems.push(__spreadArray$2(["info"],t,!0)),(e=this._callbacks).info.apply(e,__spreadArray$2([this.stage],t,!1))},e.prototype.checkErrors=function(){if(0!==this.errors)throw this._firstError},e}(),session=Session$2,generateBytecode=generateBytecode_1,generateJS=generateJs,inferenceMatchResult=inferenceMatchResult_1,removeProxyRules=removeProxyRules_1,reportDuplicateLabels=reportDuplicateLabels_1,reportDuplicateRules=reportDuplicateRules_1,reportInfiniteRecursion=reportInfiniteRecursion_1,reportInfiniteRepetition=reportInfiniteRepetition_1,reportUndefinedRules=reportUndefinedRules_1,reportIncorrectPlucking=reportIncorrectPlucking_1,Session$1=session,visitor=visitor_1,base64$3=utils$1.base64;function processOptions(e,t){var r={};return Object.keys(e).forEach((function(t){r[t]=e[t]})),Object.keys(t).forEach((function(e){Object.prototype.hasOwnProperty.call(r,e)||(r[e]=t[e])})),r}function isSourceMapCapable(e){return"string"==typeof e?e.length>0:e&&"function"==typeof e.offset}var compiler$2={visitor:visitor,passes:{check:[reportUndefinedRules,reportDuplicateRules,reportDuplicateLabels,reportInfiniteRecursion,reportInfiniteRepetition,reportIncorrectPlucking],transform:[removeProxyRules,inferenceMatchResult],generate:[generateBytecode,generateJS]},compile:function(ast,passes,options){if(options=void 0!==options?options:{},options=processOptions(options,{allowedStartRules:[ast.rules[0].name],cache:!1,dependencies:{},exportVar:null,format:"bare",output:"parser",trace:!1}),!Array.isArray(options.allowedStartRules))throw new Error("allowedStartRules must be an array");if(0===options.allowedStartRules.length)throw new Error("Must have at least one start rule");var allRules=ast.rules.map((function(e){return e.name}));if(options.allowedStartRules.some((function(e){return"*"===e})))options.allowedStartRules=allRules;else for(var _i=0,_a=options.allowedStartRules;_i<_a.length;_i++){var rule=_a[_i];if(-1===allRules.indexOf(rule))throw new Error('Unknown start rule "'.concat(rule,'"'))}if(("source-and-map"===options.output||"source-with-inline-map"===options.output)&&!isSourceMapCapable(options.grammarSource))throw new Error("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps");var session=new Session$1(options);switch(Object.keys(passes).forEach((function(e){session.stage=e,session.info("Process stage ".concat(e)),passes[e].forEach((function(t){session.info("Process pass ".concat(e,".").concat(t.name)),t(ast,options,session)})),session.checkErrors()})),options.output){case"parser":return eval(ast.code.toString());case"source":return ast.code.toString();case"source-and-map":return ast.code;case"source-with-inline-map":if("undefined"==typeof TextEncoder)throw new Error("TextEncoder is not supported by this platform");var sourceMap=ast.code.toStringWithSourceMap(),encoder=new TextEncoder,b64=base64$3(encoder.encode(JSON.stringify(sourceMap.map.toJSON())));return sourceMap.code+"//# sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(b64,"\n");case"ast":return ast;default:throw new Error("Invalid output format: "+options.output+".")}}},compiler_1=compiler$2,OPS_TO_PREFIXED_TYPES={$:"text","&":"simple_and","!":"simple_not"},OPS_TO_SUFFIXED_TYPES={"?":"optional","*":"zero_or_more","+":"one_or_more"},OPS_TO_SEMANTIC_PREDICATE_TYPES={"&":"semantic_and","!":"semantic_not"};function peg$subclass(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function peg$SyntaxError(e,t,r,n){var a=Error.call(this,e);return Object.setPrototypeOf&&Object.setPrototypeOf(a,peg$SyntaxError.prototype),a.expected=t,a.found=r,a.location=n,a.name="SyntaxError",a}function peg$padEnd(e,t,r){return r=r||" ",e.length>t?e:(t-=e.length,e+(r+=r.repeat(t)).slice(0,t))}function peg$parse(e,t){var r,n={},a=(t=void 0!==t?t:{}).grammarSource,o={Grammar:ct},s=ct,u="{",i="}",c="/*",l="*/",p="\\",f='"',d="'",g=/^[\n\r\u2028\u2029]/,h=/^[0-9]/,m=/^[0-9a-f]/i,$=/^[{}]/,A=/^[a-z\xB5\xDF-\xF6\xF8-\xFF\u0101\u0103\u0105\u0107\u0109\u010B\u010D\u010F\u0111\u0113\u0115\u0117\u0119\u011B\u011D\u011F\u0121\u0123\u0125\u0127\u0129\u012B\u012D\u012F\u0131\u0133\u0135\u0137-\u0138\u013A\u013C\u013E\u0140\u0142\u0144\u0146\u0148-\u0149\u014B\u014D\u014F\u0151\u0153\u0155\u0157\u0159\u015B\u015D\u015F\u0161\u0163\u0165\u0167\u0169\u016B\u016D\u016F\u0171\u0173\u0175\u0177\u017A\u017C\u017E-\u0180\u0183\u0185\u0188\u018C-\u018D\u0192\u0195\u0199-\u019B\u019E\u01A1\u01A3\u01A5\u01A8\u01AA-\u01AB\u01AD\u01B0\u01B4\u01B6\u01B9-\u01BA\u01BD-\u01BF\u01C6\u01C9\u01CC\u01CE\u01D0\u01D2\u01D4\u01D6\u01D8\u01DA\u01DC-\u01DD\u01DF\u01E1\u01E3\u01E5\u01E7\u01E9\u01EB\u01ED\u01EF-\u01F0\u01F3\u01F5\u01F9\u01FB\u01FD\u01FF\u0201\u0203\u0205\u0207\u0209\u020B\u020D\u020F\u0211\u0213\u0215\u0217\u0219\u021B\u021D\u021F\u0221\u0223\u0225\u0227\u0229\u022B\u022D\u022F\u0231\u0233-\u0239\u023C\u023F-\u0240\u0242\u0247\u0249\u024B\u024D\u024F-\u0293\u0295-\u02AF\u0371\u0373\u0377\u037B-\u037D\u0390\u03AC-\u03CE\u03D0-\u03D1\u03D5-\u03D7\u03D9\u03DB\u03DD\u03DF\u03E1\u03E3\u03E5\u03E7\u03E9\u03EB\u03ED\u03EF-\u03F3\u03F5\u03F8\u03FB-\u03FC\u0430-\u045F\u0461\u0463\u0465\u0467\u0469\u046B\u046D\u046F\u0471\u0473\u0475\u0477\u0479\u047B\u047D\u047F\u0481\u048B\u048D\u048F\u0491\u0493\u0495\u0497\u0499\u049B\u049D\u049F\u04A1\u04A3\u04A5\u04A7\u04A9\u04AB\u04AD\u04AF\u04B1\u04B3\u04B5\u04B7\u04B9\u04BB\u04BD\u04BF\u04C2\u04C4\u04C6\u04C8\u04CA\u04CC\u04CE-\u04CF\u04D1\u04D3\u04D5\u04D7\u04D9\u04DB\u04DD\u04DF\u04E1\u04E3\u04E5\u04E7\u04E9\u04EB\u04ED\u04EF\u04F1\u04F3\u04F5\u04F7\u04F9\u04FB\u04FD\u04FF\u0501\u0503\u0505\u0507\u0509\u050B\u050D\u050F\u0511\u0513\u0515\u0517\u0519\u051B\u051D\u051F\u0521\u0523\u0525\u0527\u0529\u052B\u052D\u052F\u0561-\u0587\u13F8-\u13FD\u1D00-\u1D2B\u1D6B-\u1D77\u1D79-\u1D9A\u1E01\u1E03\u1E05\u1E07\u1E09\u1E0B\u1E0D\u1E0F\u1E11\u1E13\u1E15\u1E17\u1E19\u1E1B\u1E1D\u1E1F\u1E21\u1E23\u1E25\u1E27\u1E29\u1E2B\u1E2D\u1E2F\u1E31\u1E33\u1E35\u1E37\u1E39\u1E3B\u1E3D\u1E3F\u1E41\u1E43\u1E45\u1E47\u1E49\u1E4B\u1E4D\u1E4F\u1E51\u1E53\u1E55\u1E57\u1E59\u1E5B\u1E5D\u1E5F\u1E61\u1E63\u1E65\u1E67\u1E69\u1E6B\u1E6D\u1E6F\u1E71\u1E73\u1E75\u1E77\u1E79\u1E7B\u1E7D\u1E7F\u1E81\u1E83\u1E85\u1E87\u1E89\u1E8B\u1E8D\u1E8F\u1E91\u1E93\u1E95-\u1E9D\u1E9F\u1EA1\u1EA3\u1EA5\u1EA7\u1EA9\u1EAB\u1EAD\u1EAF\u1EB1\u1EB3\u1EB5\u1EB7\u1EB9\u1EBB\u1EBD\u1EBF\u1EC1\u1EC3\u1EC5\u1EC7\u1EC9\u1ECB\u1ECD\u1ECF\u1ED1\u1ED3\u1ED5\u1ED7\u1ED9\u1EDB\u1EDD\u1EDF\u1EE1\u1EE3\u1EE5\u1EE7\u1EE9\u1EEB\u1EED\u1EEF\u1EF1\u1EF3\u1EF5\u1EF7\u1EF9\u1EFB\u1EFD\u1EFF-\u1F07\u1F10-\u1F15\u1F20-\u1F27\u1F30-\u1F37\u1F40-\u1F45\u1F50-\u1F57\u1F60-\u1F67\u1F70-\u1F7D\u1F80-\u1F87\u1F90-\u1F97\u1FA0-\u1FA7\u1FB0-\u1FB4\u1FB6-\u1FB7\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FC7\u1FD0-\u1FD3\u1FD6-\u1FD7\u1FE0-\u1FE7\u1FF2-\u1FF4\u1FF6-\u1FF7\u210A\u210E-\u210F\u2113\u212F\u2134\u2139\u213C-\u213D\u2146-\u2149\u214E\u2184\u2C30-\u2C5E\u2C61\u2C65-\u2C66\u2C68\u2C6A\u2C6C\u2C71\u2C73-\u2C74\u2C76-\u2C7B\u2C81\u2C83\u2C85\u2C87\u2C89\u2C8B\u2C8D\u2C8F\u2C91\u2C93\u2C95\u2C97\u2C99\u2C9B\u2C9D\u2C9F\u2CA1\u2CA3\u2CA5\u2CA7\u2CA9\u2CAB\u2CAD\u2CAF\u2CB1\u2CB3\u2CB5\u2CB7\u2CB9\u2CBB\u2CBD\u2CBF\u2CC1\u2CC3\u2CC5\u2CC7\u2CC9\u2CCB\u2CCD\u2CCF\u2CD1\u2CD3\u2CD5\u2CD7\u2CD9\u2CDB\u2CDD\u2CDF\u2CE1\u2CE3-\u2CE4\u2CEC\u2CEE\u2CF3\u2D00-\u2D25\u2D27\u2D2D\uA641\uA643\uA645\uA647\uA649\uA64B\uA64D\uA64F\uA651\uA653\uA655\uA657\uA659\uA65B\uA65D\uA65F\uA661\uA663\uA665\uA667\uA669\uA66B\uA66D\uA681\uA683\uA685\uA687\uA689\uA68B\uA68D\uA68F\uA691\uA693\uA695\uA697\uA699\uA69B\uA723\uA725\uA727\uA729\uA72B\uA72D\uA72F-\uA731\uA733\uA735\uA737\uA739\uA73B\uA73D\uA73F\uA741\uA743\uA745\uA747\uA749\uA74B\uA74D\uA74F\uA751\uA753\uA755\uA757\uA759\uA75B\uA75D\uA75F\uA761\uA763\uA765\uA767\uA769\uA76B\uA76D\uA76F\uA771-\uA778\uA77A\uA77C\uA77F\uA781\uA783\uA785\uA787\uA78C\uA78E\uA791\uA793-\uA795\uA797\uA799\uA79B\uA79D\uA79F\uA7A1\uA7A3\uA7A5\uA7A7\uA7A9\uA7B5\uA7B7\uA7FA\uAB30-\uAB5A\uAB60-\uAB65\uAB70-\uABBF\uFB00-\uFB06\uFB13-\uFB17\uFF41-\uFF5A]/,b=/^[\u02B0-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0374\u037A\u0559\u0640\u06E5-\u06E6\u07F4-\u07F5\u07FA\u081A\u0824\u0828\u0971\u0E46\u0EC6\u10FC\u17D7\u1843\u1AA7\u1C78-\u1C7D\u1D2C-\u1D6A\u1D78\u1D9B-\u1DBF\u2071\u207F\u2090-\u209C\u2C7C-\u2C7D\u2D6F\u2E2F\u3005\u3031-\u3035\u303B\u309D-\u309E\u30FC-\u30FE\uA015\uA4F8-\uA4FD\uA60C\uA67F\uA69C-\uA69D\uA717-\uA71F\uA770\uA788\uA7F8-\uA7F9\uA9CF\uA9E6\uAA70\uAADD\uAAF3-\uAAF4\uAB5C-\uAB5F\uFF70\uFF9E-\uFF9F]/,x=/^[\xAA\xBA\u01BB\u01C0-\u01C3\u0294\u05D0-\u05EA\u05F0-\u05F2\u0620-\u063F\u0641-\u064A\u066E-\u066F\u0671-\u06D3\u06D5\u06EE-\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u0800-\u0815\u0840-\u0858\u08A0-\u08B4\u0904-\u0939\u093D\u0950\u0958-\u0961\u0972-\u0980\u0985-\u098C\u098F-\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC-\u09DD\u09DF-\u09E1\u09F0-\u09F1\u0A05-\u0A0A\u0A0F-\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32-\u0A33\u0A35-\u0A36\u0A38-\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2-\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0-\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F-\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32-\u0B33\u0B35-\u0B39\u0B3D\u0B5C-\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99-\u0B9A\u0B9C\u0B9E-\u0B9F\u0BA3-\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60-\u0C61\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0-\u0CE1\u0CF1-\u0CF2\u0D05-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32-\u0E33\u0E40-\u0E45\u0E81-\u0E82\u0E84\u0E87-\u0E88\u0E8A\u0E8D\u0E94-\u0E97\u0E99-\u0E9F\u0EA1-\u0EA3\u0EA5\u0EA7\u0EAA-\u0EAB\u0EAD-\u0EB0\u0EB2-\u0EB3\u0EBD\u0EC0-\u0EC4\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065-\u1066\u106E-\u1070\u1075-\u1081\u108E\u10D0-\u10FA\u10FD-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16F1-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17DC\u1820-\u1842\u1844-\u1877\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE-\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C77\u1CE9-\u1CEC\u1CEE-\u1CF1\u1CF5-\u1CF6\u2135-\u2138\u2D30-\u2D67\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3006\u303C\u3041-\u3096\u309F\u30A1-\u30FA\u30FF\u3105-\u312D\u3131-\u318E\u31A0-\u31BA\u31F0-\u31FF\u3400-\u4DB5\u4E00-\u9FD5\uA000-\uA014\uA016-\uA48C\uA4D0-\uA4F7\uA500-\uA60B\uA610-\uA61F\uA62A-\uA62B\uA66E\uA6A0-\uA6E5\uA78F\uA7F7\uA7FB-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9E0-\uA9E4\uA9E7-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA6F\uAA71-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5-\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADC\uAAE0-\uAAEA\uAAF2\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uABC0-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40-\uFB41\uFB43-\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF66-\uFF6F\uFF71-\uFF9D\uFFA0-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC]/,E=/^[\u01C5\u01C8\u01CB\u01F2\u1F88-\u1F8F\u1F98-\u1F9F\u1FA8-\u1FAF\u1FBC\u1FCC\u1FFC]/,v=/^[A-Z\xC0-\xD6\xD8-\xDE\u0100\u0102\u0104\u0106\u0108\u010A\u010C\u010E\u0110\u0112\u0114\u0116\u0118\u011A\u011C\u011E\u0120\u0122\u0124\u0126\u0128\u012A\u012C\u012E\u0130\u0132\u0134\u0136\u0139\u013B\u013D\u013F\u0141\u0143\u0145\u0147\u014A\u014C\u014E\u0150\u0152\u0154\u0156\u0158\u015A\u015C\u015E\u0160\u0162\u0164\u0166\u0168\u016A\u016C\u016E\u0170\u0172\u0174\u0176\u0178-\u0179\u017B\u017D\u0181-\u0182\u0184\u0186-\u0187\u0189-\u018B\u018E-\u0191\u0193-\u0194\u0196-\u0198\u019C-\u019D\u019F-\u01A0\u01A2\u01A4\u01A6-\u01A7\u01A9\u01AC\u01AE-\u01AF\u01B1-\u01B3\u01B5\u01B7-\u01B8\u01BC\u01C4\u01C7\u01CA\u01CD\u01CF\u01D1\u01D3\u01D5\u01D7\u01D9\u01DB\u01DE\u01E0\u01E2\u01E4\u01E6\u01E8\u01EA\u01EC\u01EE\u01F1\u01F4\u01F6-\u01F8\u01FA\u01FC\u01FE\u0200\u0202\u0204\u0206\u0208\u020A\u020C\u020E\u0210\u0212\u0214\u0216\u0218\u021A\u021C\u021E\u0220\u0222\u0224\u0226\u0228\u022A\u022C\u022E\u0230\u0232\u023A-\u023B\u023D-\u023E\u0241\u0243-\u0246\u0248\u024A\u024C\u024E\u0370\u0372\u0376\u037F\u0386\u0388-\u038A\u038C\u038E-\u038F\u0391-\u03A1\u03A3-\u03AB\u03CF\u03D2-\u03D4\u03D8\u03DA\u03DC\u03DE\u03E0\u03E2\u03E4\u03E6\u03E8\u03EA\u03EC\u03EE\u03F4\u03F7\u03F9-\u03FA\u03FD-\u042F\u0460\u0462\u0464\u0466\u0468\u046A\u046C\u046E\u0470\u0472\u0474\u0476\u0478\u047A\u047C\u047E\u0480\u048A\u048C\u048E\u0490\u0492\u0494\u0496\u0498\u049A\u049C\u049E\u04A0\u04A2\u04A4\u04A6\u04A8\u04AA\u04AC\u04AE\u04B0\u04B2\u04B4\u04B6\u04B8\u04BA\u04BC\u04BE\u04C0-\u04C1\u04C3\u04C5\u04C7\u04C9\u04CB\u04CD\u04D0\u04D2\u04D4\u04D6\u04D8\u04DA\u04DC\u04DE\u04E0\u04E2\u04E4\u04E6\u04E8\u04EA\u04EC\u04EE\u04F0\u04F2\u04F4\u04F6\u04F8\u04FA\u04FC\u04FE\u0500\u0502\u0504\u0506\u0508\u050A\u050C\u050E\u0510\u0512\u0514\u0516\u0518\u051A\u051C\u051E\u0520\u0522\u0524\u0526\u0528\u052A\u052C\u052E\u0531-\u0556\u10A0-\u10C5\u10C7\u10CD\u13A0-\u13F5\u1E00\u1E02\u1E04\u1E06\u1E08\u1E0A\u1E0C\u1E0E\u1E10\u1E12\u1E14\u1E16\u1E18\u1E1A\u1E1C\u1E1E\u1E20\u1E22\u1E24\u1E26\u1E28\u1E2A\u1E2C\u1E2E\u1E30\u1E32\u1E34\u1E36\u1E38\u1E3A\u1E3C\u1E3E\u1E40\u1E42\u1E44\u1E46\u1E48\u1E4A\u1E4C\u1E4E\u1E50\u1E52\u1E54\u1E56\u1E58\u1E5A\u1E5C\u1E5E\u1E60\u1E62\u1E64\u1E66\u1E68\u1E6A\u1E6C\u1E6E\u1E70\u1E72\u1E74\u1E76\u1E78\u1E7A\u1E7C\u1E7E\u1E80\u1E82\u1E84\u1E86\u1E88\u1E8A\u1E8C\u1E8E\u1E90\u1E92\u1E94\u1E9E\u1EA0\u1EA2\u1EA4\u1EA6\u1EA8\u1EAA\u1EAC\u1EAE\u1EB0\u1EB2\u1EB4\u1EB6\u1EB8\u1EBA\u1EBC\u1EBE\u1EC0\u1EC2\u1EC4\u1EC6\u1EC8\u1ECA\u1ECC\u1ECE\u1ED0\u1ED2\u1ED4\u1ED6\u1ED8\u1EDA\u1EDC\u1EDE\u1EE0\u1EE2\u1EE4\u1EE6\u1EE8\u1EEA\u1EEC\u1EEE\u1EF0\u1EF2\u1EF4\u1EF6\u1EF8\u1EFA\u1EFC\u1EFE\u1F08-\u1F0F\u1F18-\u1F1D\u1F28-\u1F2F\u1F38-\u1F3F\u1F48-\u1F4D\u1F59\u1F5B\u1F5D\u1F5F\u1F68-\u1F6F\u1FB8-\u1FBB\u1FC8-\u1FCB\u1FD8-\u1FDB\u1FE8-\u1FEC\u1FF8-\u1FFB\u2102\u2107\u210B-\u210D\u2110-\u2112\u2115\u2119-\u211D\u2124\u2126\u2128\u212A-\u212D\u2130-\u2133\u213E-\u213F\u2145\u2183\u2C00-\u2C2E\u2C60\u2C62-\u2C64\u2C67\u2C69\u2C6B\u2C6D-\u2C70\u2C72\u2C75\u2C7E-\u2C80\u2C82\u2C84\u2C86\u2C88\u2C8A\u2C8C\u2C8E\u2C90\u2C92\u2C94\u2C96\u2C98\u2C9A\u2C9C\u2C9E\u2CA0\u2CA2\u2CA4\u2CA6\u2CA8\u2CAA\u2CAC\u2CAE\u2CB0\u2CB2\u2CB4\u2CB6\u2CB8\u2CBA\u2CBC\u2CBE\u2CC0\u2CC2\u2CC4\u2CC6\u2CC8\u2CCA\u2CCC\u2CCE\u2CD0\u2CD2\u2CD4\u2CD6\u2CD8\u2CDA\u2CDC\u2CDE\u2CE0\u2CE2\u2CEB\u2CED\u2CF2\uA640\uA642\uA644\uA646\uA648\uA64A\uA64C\uA64E\uA650\uA652\uA654\uA656\uA658\uA65A\uA65C\uA65E\uA660\uA662\uA664\uA666\uA668\uA66A\uA66C\uA680\uA682\uA684\uA686\uA688\uA68A\uA68C\uA68E\uA690\uA692\uA694\uA696\uA698\uA69A\uA722\uA724\uA726\uA728\uA72A\uA72C\uA72E\uA732\uA734\uA736\uA738\uA73A\uA73C\uA73E\uA740\uA742\uA744\uA746\uA748\uA74A\uA74C\uA74E\uA750\uA752\uA754\uA756\uA758\uA75A\uA75C\uA75E\uA760\uA762\uA764\uA766\uA768\uA76A\uA76C\uA76E\uA779\uA77B\uA77D-\uA77E\uA780\uA782\uA784\uA786\uA78B\uA78D\uA790\uA792\uA796\uA798\uA79A\uA79C\uA79E\uA7A0\uA7A2\uA7A4\uA7A6\uA7A8\uA7AA-\uA7AD\uA7B0-\uA7B4\uA7B6\uFF21-\uFF3A]/,C=/^[\u0903\u093B\u093E-\u0940\u0949-\u094C\u094E-\u094F\u0982-\u0983\u09BE-\u09C0\u09C7-\u09C8\u09CB-\u09CC\u09D7\u0A03\u0A3E-\u0A40\u0A83\u0ABE-\u0AC0\u0AC9\u0ACB-\u0ACC\u0B02-\u0B03\u0B3E\u0B40\u0B47-\u0B48\u0B4B-\u0B4C\u0B57\u0BBE-\u0BBF\u0BC1-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCC\u0BD7\u0C01-\u0C03\u0C41-\u0C44\u0C82-\u0C83\u0CBE\u0CC0-\u0CC4\u0CC7-\u0CC8\u0CCA-\u0CCB\u0CD5-\u0CD6\u0D02-\u0D03\u0D3E-\u0D40\u0D46-\u0D48\u0D4A-\u0D4C\u0D57\u0D82-\u0D83\u0DCF-\u0DD1\u0DD8-\u0DDF\u0DF2-\u0DF3\u0F3E-\u0F3F\u0F7F\u102B-\u102C\u1031\u1038\u103B-\u103C\u1056-\u1057\u1062-\u1064\u1067-\u106D\u1083-\u1084\u1087-\u108C\u108F\u109A-\u109C\u17B6\u17BE-\u17C5\u17C7-\u17C8\u1923-\u1926\u1929-\u192B\u1930-\u1931\u1933-\u1938\u1A19-\u1A1A\u1A55\u1A57\u1A61\u1A63-\u1A64\u1A6D-\u1A72\u1B04\u1B35\u1B3B\u1B3D-\u1B41\u1B43-\u1B44\u1B82\u1BA1\u1BA6-\u1BA7\u1BAA\u1BE7\u1BEA-\u1BEC\u1BEE\u1BF2-\u1BF3\u1C24-\u1C2B\u1C34-\u1C35\u1CE1\u1CF2-\u1CF3\u302E-\u302F\uA823-\uA824\uA827\uA880-\uA881\uA8B4-\uA8C3\uA952-\uA953\uA983\uA9B4-\uA9B5\uA9BA-\uA9BB\uA9BD-\uA9C0\uAA2F-\uAA30\uAA33-\uAA34\uAA4D\uAA7B\uAA7D\uAAEB\uAAEE-\uAAEF\uAAF5\uABE3-\uABE4\uABE6-\uABE7\uABE9-\uABEA\uABEC]/,y=/^[\u0300-\u036F\u0483-\u0487\u0591-\u05BD\u05BF\u05C1-\u05C2\u05C4-\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7-\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E3-\u0902\u093A\u093C\u0941-\u0948\u094D\u0951-\u0957\u0962-\u0963\u0981\u09BC\u09C1-\u09C4\u09CD\u09E2-\u09E3\u0A01-\u0A02\u0A3C\u0A41-\u0A42\u0A47-\u0A48\u0A4B-\u0A4D\u0A51\u0A70-\u0A71\u0A75\u0A81-\u0A82\u0ABC\u0AC1-\u0AC5\u0AC7-\u0AC8\u0ACD\u0AE2-\u0AE3\u0B01\u0B3C\u0B3F\u0B41-\u0B44\u0B4D\u0B56\u0B62-\u0B63\u0B82\u0BC0\u0BCD\u0C00\u0C3E-\u0C40\u0C46-\u0C48\u0C4A-\u0C4D\u0C55-\u0C56\u0C62-\u0C63\u0C81\u0CBC\u0CBF\u0CC6\u0CCC-\u0CCD\u0CE2-\u0CE3\u0D01\u0D41-\u0D44\u0D4D\u0D62-\u0D63\u0DCA\u0DD2-\u0DD4\u0DD6\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB-\u0EBC\u0EC8-\u0ECD\u0F18-\u0F19\u0F35\u0F37\u0F39\u0F71-\u0F7E\u0F80-\u0F84\u0F86-\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102D-\u1030\u1032-\u1037\u1039-\u103A\u103D-\u103E\u1058-\u1059\u105E-\u1060\u1071-\u1074\u1082\u1085-\u1086\u108D\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752-\u1753\u1772-\u1773\u17B4-\u17B5\u17B7-\u17BD\u17C6\u17C9-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u1922\u1927-\u1928\u1932\u1939-\u193B\u1A17-\u1A18\u1A1B\u1A56\u1A58-\u1A5E\u1A60\u1A62\u1A65-\u1A6C\u1A73-\u1A7C\u1A7F\u1AB0-\u1ABD\u1B00-\u1B03\u1B34\u1B36-\u1B3A\u1B3C\u1B42\u1B6B-\u1B73\u1B80-\u1B81\u1BA2-\u1BA5\u1BA8-\u1BA9\u1BAB-\u1BAD\u1BE6\u1BE8-\u1BE9\u1BED\u1BEF-\u1BF1\u1C2C-\u1C33\u1C36-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE0\u1CE2-\u1CE8\u1CED\u1CF4\u1CF8-\u1CF9\u1DC0-\u1DF5\u1DFC-\u1DFF\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302D\u3099-\u309A\uA66F\uA674-\uA67D\uA69E-\uA69F\uA6F0-\uA6F1\uA802\uA806\uA80B\uA825-\uA826\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA951\uA980-\uA982\uA9B3\uA9B6-\uA9B9\uA9BC\uA9E5\uAA29-\uAA2E\uAA31-\uAA32\uAA35-\uAA36\uAA43\uAA4C\uAA7C\uAAB0\uAAB2-\uAAB4\uAAB7-\uAAB8\uAABE-\uAABF\uAAC1\uAAEC-\uAAED\uAAF6\uABE5\uABE8\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F]/,_=/^[0-9\u0660-\u0669\u06F0-\u06F9\u07C0-\u07C9\u0966-\u096F\u09E6-\u09EF\u0A66-\u0A6F\u0AE6-\u0AEF\u0B66-\u0B6F\u0BE6-\u0BEF\u0C66-\u0C6F\u0CE6-\u0CEF\u0D66-\u0D6F\u0DE6-\u0DEF\u0E50-\u0E59\u0ED0-\u0ED9\u0F20-\u0F29\u1040-\u1049\u1090-\u1099\u17E0-\u17E9\u1810-\u1819\u1946-\u194F\u19D0-\u19D9\u1A80-\u1A89\u1A90-\u1A99\u1B50-\u1B59\u1BB0-\u1BB9\u1C40-\u1C49\u1C50-\u1C59\uA620-\uA629\uA8D0-\uA8D9\uA900-\uA909\uA9D0-\uA9D9\uA9F0-\uA9F9\uAA50-\uAA59\uABF0-\uABF9\uFF10-\uFF19]/,S=/^[\u16EE-\u16F0\u2160-\u2182\u2185-\u2188\u3007\u3021-\u3029\u3038-\u303A\uA6E6-\uA6EF]/,F=/^[_\u203F-\u2040\u2054\uFE33-\uFE34\uFE4D-\uFE4F\uFF3F]/,w=/^[ \xA0\u1680\u2000-\u200A\u202F\u205F\u3000]/,B=nt("{",!1),D=nt("}",!1),L=nt("=",!1),P=nt("/",!1),T=nt("@",!1),R=nt(":",!1),O=nt("$",!1),M=nt("&",!1),k=nt("!",!1),I=nt("?",!1),j=nt("*",!1),N=nt("+",!1),U=nt("(",!1),q=nt(")",!1),G={type:"any"},H=ot("whitespace"),z=nt("\t",!1),W=nt("\v",!1),V=nt("\f",!1),Y=nt(" ",!1),Q=nt("",!1),J=nt("\ufeff",!1),X=at(["\n","\r","\u2028","\u2029"],!1,!1),Z=ot("end of line"),K=nt("\n",!1),ee=nt("\r\n",!1),te=nt("\r",!1),re=nt("\u2028",!1),ne=nt("\u2029",!1),ae=ot("comment"),oe=nt("/*",!1),se=nt("*/",!1),ue=nt("//",!1),ie=ot("identifier"),ce=nt("_",!1),le=nt("\\",!1),pe=nt("",!1),fe=nt("",!1),de=ot("literal"),ge=nt("i",!1),he=ot("string"),me=nt('"',!1),$e=nt("'",!1),Ae=ot("character class"),be=nt("[",!1),xe=nt("^",!1),Ee=nt("]",!1),ve=nt("-",!1),Ce=nt("0",!1),ye=nt("b",!1),_e=nt("f",!1),Se=nt("n",!1),Fe=nt("r",!1),we=nt("t",!1),Be=nt("v",!1),De=nt("x",!1),Le=nt("u",!1),Pe=at([["0","9"]],!1,!1),Te=at([["0","9"],["a","f"]],!1,!0),Re=nt(".",!1),Oe=ot("code block"),Me=at(["{","}"],!1,!1),ke=at([["a","z"],"",["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","",["",""],"","",["",""],"","","","","",["",""],"","","","",["",""],["",""],"","","","","","","","","","",["",""],"","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"",["",""],"","","","","",["",""],["",""],"","","",["",""],"",["",""],["",""],["",""],"","","","","","","","","","","",["",""],"","",["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],["",""],["",""],["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"","","","",["",""],["",""],"","",["",""],"",["",""],"","","","",["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","",["",""],"","","","","","","","","","","","","",["",""],["",""],["",""],["",""],["",""],["",""]],!1,!1),Ie=at([["",""],["",""],["",""],"","","","","","",["",""],["",""],"","","","","","","","","","","",["",""],["",""],"",["",""],"","",["",""],["",""],"","","",["",""],"",["",""],["",""],"",["",""],"","",["",""],["",""],"","",["",""],"","","","",["",""],["",""],"",["",""]],!1,!1),je=at(["","","",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],"","",["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],"","",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],"","",["",""],["",""],["",""],"",["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],"",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"",["",""],["",""],"","",["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""]],!1,!1),Ne=at(["","","","",["",""],["",""],["",""],"","",""],!1,!1),Ue=at([["A","Z"],["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],"","",["",""],["",""],"",["",""],"","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],["",""],"",["",""],"","","","","","","","","",["",""],"",["",""],["",""],["",""],"",["",""],"","","","","","","","","","","","","","",["",""],["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],["",""],"","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],["",""],["",""],["",""],["",""],"","","","",["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],"",["",""],"","","",["",""],["",""],["",""],"","",["",""],"",["",""],"","","",["",""],"","",["",""],"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",["",""],"","","","","","","","","","","","","","","","","","",["",""],["",""],"",["",""]],!1,!1),qe=at(["","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],"",["",""],"",["",""],["",""],"","",["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","","",["",""],["",""],"","","",["",""],["",""],"","",["",""],"","",["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],"","","","",["",""],"",["",""],["",""],["",""],""],!1,!1),Ge=at([["",""],["",""],["",""],"",["",""],["",""],"",["",""],["",""],"",["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],"",["",""],["",""],"","",["",""],"",["",""],["",""],"",["",""],["",""],["",""],"",["",""],"",["",""],"",["",""],["",""],"",["",""],"","","",["",""],"","",["",""],"","","","",["",""],["",""],["",""],["",""],["",""],"","","","",["",""],["",""],"",["",""],"",["",""],"",["",""],"","",["",""],["",""],"",["",""],["",""],["",""],["",""],"","","",["",""],["",""],["",""],["",""],["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],["",""],["",""],["",""],["",""],"",["",""],"",["",""],"",["",""],["",""],"",["",""],["",""],"","",["",""],"","",["",""],["",""],"",["",""],["",""],"",["",""],"","",["",""],["",""],["",""],["",""],["",""],"",["",""],"",["",""],["",""],["",""],["",""],["",""],["",""],"","",["",""],["",""],["",""],["",""],"",["",""],["",""],"",["",""],["",""],["",""],"",["",""],["",""],["",""],"","","",["",""],"",["",""],["",""],["",""],["",""],"",["",""],"","",["",""],["",""],["",""],"","","","",["",""],["",""],["",""],"",["",""],"","","","","",["",""],["",""]],!1,!1),He=at([["0","9"],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""],["",""]],!1,!1),ze=at([["",""],["",""],["",""],"",["",""],["",""],["",""]],!1,!1),We=at(["_",["",""],"",["",""],["",""],""],!1,!1),Ve=at([" ","","",["",""],"","",""],!1,!1),Ye=nt(";",!1),Qe=0,Je=0,Xe=[{line:1,column:1}],Ze=0,Ke=[],et=0;if("startRule"in t){if(!(t.startRule in o))throw new Error("Can't start parsing from rule \""+t.startRule+'".');s=o[t.startRule]}function tt(){return ut(Je,Qe)}function rt(e,t){throw function(e,t){return new peg$SyntaxError(e,null,null,t)}(e,t=void 0!==t?t:ut(Je,Qe))}function nt(e,t){return{type:"literal",text:e,ignoreCase:t}}function at(e,t,r){return{type:"class",parts:e,inverted:t,ignoreCase:r}}function ot(e){return{type:"other",description:e}}function st(t){var r,n=Xe[t];if(n)return n;for(r=t-1;!Xe[r];)r--;for(n={line:(n=Xe[r]).line,column:n.column};r<t;)10===e.charCodeAt(r)?(n.line++,n.column=1):n.column++,r++;return Xe[t]=n,n}function ut(e,t,r){var n=st(e),o=st(t),s={source:a,start:{offset:e,line:n.line,column:n.column},end:{offset:t,line:o.line,column:o.column}};return r&&a&&"function"==typeof a.offset&&(s.start=a.offset(s.start),s.end=a.offset(s.end)),s}function it(e){Qe<Ze||(Qe>Ze&&(Ze=Qe,Ke=[]),Ke.push(e))}function ct(){var t,r,a,o,s,c;if(t=Qe,Ut(),r=Qe,a=function(){var t,r,a,o,s;return t=Qe,123===e.charCodeAt(Qe)?(r=u,Qe++):(r=n,0===et&&it(B)),r!==n&&(a=jt())!==n?(125===e.charCodeAt(Qe)?(o=i,Qe++):(o=n,0===et&&it(D)),o!==n&&qt()!==n?(Je=t,t={type:"top_level_initializer",code:(s=a)[0],codeLocation:s[1],location:tt()}):(Qe=t,t=n)):(Qe=t,t=n),t}(),a!==n?(o=Ut(),r=a):(Qe=r,r=n),r===n&&(r=null),a=Qe,o=function(){var e,t,r;return e=Qe,(t=jt())!==n&&qt()!==n?(Je=e,e={type:"initializer",code:(r=t)[0],codeLocation:r[1],location:tt()}):(Qe=e,e=n),e}(),o!==n?(s=Ut(),a=o):(Qe=a,a=n),a===n&&(a=null),o=[],s=Qe,(c=lt())!==n?(Ut(),s=c):(Qe=s,s=n),s!==n)for(;s!==n;)o.push(s),s=Qe,(c=lt())!==n?(Ut(),s=c):(Qe=s,s=n);else o=n;return o!==n?(Je=t,t={type:"grammar",topLevelInitializer:r,initializer:a,rules:o,location:tt()}):(Qe=t,t=n),t}function lt(){var t,r,a,o,s;return t=Qe,(r=_t())!==n?(Ut(),a=Qe,(o=wt())!==n?(Ut(),a=o):(Qe=a,a=n),a===n&&(a=null),61===e.charCodeAt(Qe)?(o="=",Qe++):(o=n,0===et&&it(L)),o!==n?(Ut(),(s=pt())!==n&&qt()!==n?(Je=t,t=function(e,t,r){return{type:"rule",name:e[0],nameLocation:e[1],expression:null!==t?{type:"named",name:t,expression:r,location:tt()}:r,location:tt()}}(r,a,s)):(Qe=t,t=n)):(Qe=t,t=n)):(Qe=t,t=n),t}function pt(){var t,r,a,o,s,u,i,c;if(t=Qe,(r=ft())!==n){for(a=[],o=Qe,Ut(),47===e.charCodeAt(Qe)?(s="/",Qe++):(s=n,0===et&&it(P)),s!==n?(Ut(),(u=ft())!==n?o=u:(Qe=o,o=n)):(Qe=o,o=n);o!==n;)a.push(o),o=Qe,Ut(),47===e.charCodeAt(Qe)?(s="/",Qe++):(s=n,0===et&&it(P)),s!==n?(Ut(),(u=ft())!==n?o=u:(Qe=o,o=n)):(Qe=o,o=n);Je=t,i=r,t=(c=a).length>0?{type:"choice",alternatives:[i].concat(c),location:tt()}:i}else Qe=t,t=n;return t}function ft(){var e,t,r,a,o,s;return e=Qe,t=function(){var e,t,r,a,o,s,u;if(e=Qe,(t=dt())!==n){for(r=[],a=Qe,Ut(),(o=dt())!==n?a=o:(Qe=a,a=n);a!==n;)r.push(a),a=Qe,Ut(),(o=dt())!==n?a=o:(Qe=a,a=n);Je=e,s=t,e=(u=r).length>0||"labeled"===s.type&&s.pick?{type:"sequence",elements:[s].concat(u),location:tt()}:s}else Qe=e,e=n;return e}(),t!==n?(r=Qe,Ut(),(a=jt())!==n?r=a:(Qe=r,r=n),r===n&&(r=null),Je=e,o=t,e=null!==(s=r)?{type:"action",expression:o,code:s[0],codeLocation:s[1],location:tt()}:o):(Qe=e,e=n),e}function dt(){var t,r,a,o,s,u,i;return t=Qe,r=function(){var t,r;return t=Qe,64===e.charCodeAt(Qe)?(r="@",Qe++):(r=n,0===et&&it(T)),r!==n&&(Je=t,r=tt()),r}(),r!==n?((a=gt())===n&&(a=null),(o=ht())!==n?(Je=t,s=r,u=a,(i=o).type.startsWith("semantic_")&&rt('"@" cannot be used on a semantic predicate',s),t={type:"labeled",label:null!==u?u[0]:null,labelLocation:null!==u?u[1]:s,pick:!0,expression:i,location:tt()}):(Qe=t,t=n)):(Qe=t,t=n),t===n&&(t=Qe,(r=gt())!==n?(a=Ut(),(o=ht())!==n?(Je=t,t=function(e,t){return{type:"labeled",label:e[0],labelLocation:e[1],expression:t,location:tt()}}(r,o)):(Qe=t,t=n)):(Qe=t,t=n),t===n&&(t=ht())),t}function gt(){var t,r,a,o;return t=Qe,(r=_t())!==n?(Ut(),58===e.charCodeAt(Qe)?(a=":",Qe++):(a=n,0===et&&it(R)),a!==n?(Je=t,o=r,Gt.indexOf(o[0])>=0&&rt("Label can't be a reserved word \"".concat(o[0],'"'),o[1]),t=o):(Qe=t,t=n)):(Qe=t,t=n),t}function ht(){var t,r,a,o;return t=Qe,r=function(){var t;return 36===e.charCodeAt(Qe)?(t="$",Qe++):(t=n,0===et&&it(O)),t===n&&(38===e.charCodeAt(Qe)?(t="&",Qe++):(t=n,0===et&&it(M)),t===n&&(33===e.charCodeAt(Qe)?(t="!",Qe++):(t=n,0===et&&it(k)))),t}(),r!==n?(Ut(),(a=mt())!==n?(Je=t,o=a,t={type:OPS_TO_PREFIXED_TYPES[r],expression:o,location:tt()}):(Qe=t,t=n)):(Qe=t,t=n),t===n&&(t=mt()),t}function mt(){var t,r,a,o;return t=Qe,(r=$t())!==n?(Ut(),a=function(){var t;return 63===e.charCodeAt(Qe)?(t="?",Qe++):(t=n,0===et&&it(I)),t===n&&(42===e.charCodeAt(Qe)?(t="*",Qe++):(t=n,0===et&&it(j)),t===n&&(43===e.charCodeAt(Qe)?(t="+",Qe++):(t=n,0===et&&it(N)))),t}(),a!==n?(Je=t,o=r,t={type:OPS_TO_SUFFIXED_TYPES[a],expression:o,location:tt()}):(Qe=t,t=n)):(Qe=t,t=n),t===n&&(t=$t()),t}function $t(){var t,r,a,o,s;return t=function(){var t,r,a;return et++,t=Qe,(r=wt())!==n?(105===e.charCodeAt(Qe)?(a="i",Qe++):(a=n,0===et&&it(ge)),a===n&&(a=null),Je=t,t={type:"literal",value:r,ignoreCase:null!==a,location:tt()}):(Qe=t,t=n),et--,t===n&&(r=n,0===et&&it(de)),t}(),t===n&&(t=function(){var t,r,a,o,s,u,i,c;if(et++,t=Qe,91===e.charCodeAt(Qe)?(r="[",Qe++):(r=n,0===et&&it(be)),r!==n){for(94===e.charCodeAt(Qe)?(a="^",Qe++):(a=n,0===et&&it(xe)),a===n&&(a=null),o=[],(s=Lt())===n&&(s=Pt());s!==n;)o.push(s),(s=Lt())===n&&(s=Pt());93===e.charCodeAt(Qe)?(s="]",Qe++):(s=n,0===et&&it(Ee)),s!==n?(105===e.charCodeAt(Qe)?(u="i",Qe++):(u=n,0===et&&it(ge)),u===n&&(u=null),Je=t,i=a,c=u,t={type:"class",parts:o.filter((function(e){return""!==e})),inverted:null!==i,ignoreCase:null!==c,location:tt()}):(Qe=t,t=n)}else Qe=t,t=n;return et--,t===n&&(r=n,0===et&&it(Ae)),t}(),t===n&&(t=function(){var t,r;return t=Qe,46===e.charCodeAt(Qe)?(r=".",Qe++):(r=n,0===et&&it(Re)),r!==n&&(Je=t,r={type:"any",location:tt()}),r}(),t===n&&(t=function(){var t,r,a,o,s,u,i;return t=Qe,(r=_t())!==n?(a=Qe,et++,o=Qe,s=Ut(),u=Qe,(i=wt())!==n?u=i=[i,Ut()]:(Qe=u,u=n),u===n&&(u=null),61===e.charCodeAt(Qe)?(i="=",Qe++):(i=n,0===et&&it(L)),i!==n?o=s=[s,u,i]:(Qe=o,o=n),et--,o===n?a=void 0:(Qe=a,a=n),a!==n?(Je=t,t=function(e){return{type:"rule_ref",name:e[0],location:tt()}}(r)):(Qe=t,t=n)):(Qe=t,t=n),t}(),t===n&&(t=function(){var t,r,a,o;return t=Qe,r=function(){var t;return 38===e.charCodeAt(Qe)?(t="&",Qe++):(t=n,0===et&&it(M)),t===n&&(33===e.charCodeAt(Qe)?(t="!",Qe++):(t=n,0===et&&it(k))),t}(),r!==n?(Ut(),(a=jt())!==n?(Je=t,o=a,t={type:OPS_TO_SEMANTIC_PREDICATE_TYPES[r],code:o[0],codeLocation:o[1],location:tt()}):(Qe=t,t=n)):(Qe=t,t=n),t}(),t===n&&(t=Qe,40===e.charCodeAt(Qe)?(r="(",Qe++):(r=n,0===et&&it(U)),r!==n?(Ut(),(a=pt())!==n?(Ut(),41===e.charCodeAt(Qe)?(o=")",Qe++):(o=n,0===et&&it(q)),o!==n?(Je=t,t="labeled"===(s=a).type||"sequence"===s.type?{type:"group",expression:s,location:tt()}:s):(Qe=t,t=n)):(Qe=t,t=n)):(Qe=t,t=n)))))),t}function At(){var t;return e.length>Qe?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(G)),t}function bt(){var t;return et++,9===e.charCodeAt(Qe)?(t="\t",Qe++):(t=n,0===et&&it(z)),t===n&&(11===e.charCodeAt(Qe)?(t="\v",Qe++):(t=n,0===et&&it(W)),t===n&&(12===e.charCodeAt(Qe)?(t="\f",Qe++):(t=n,0===et&&it(V)),t===n&&(32===e.charCodeAt(Qe)?(t=" ",Qe++):(t=n,0===et&&it(Y)),t===n&&(160===e.charCodeAt(Qe)?(t="",Qe++):(t=n,0===et&&it(Q)),t===n&&(65279===e.charCodeAt(Qe)?(t="\ufeff",Qe++):(t=n,0===et&&it(J)),t===n&&(t=function(){var t;return w.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(Ve)),t}())))))),et--,t===n&&0===et&&it(H),t}function xt(){var t;return g.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(X)),t}function Et(){var t;return et++,10===e.charCodeAt(Qe)?(t="\n",Qe++):(t=n,0===et&&it(K)),t===n&&("\r\n"===e.substr(Qe,2)?(t="\r\n",Qe+=2):(t=n,0===et&&it(ee)),t===n&&(13===e.charCodeAt(Qe)?(t="\r",Qe++):(t=n,0===et&&it(te)),t===n&&(8232===e.charCodeAt(Qe)?(t="\u2028",Qe++):(t=n,0===et&&it(re)),t===n&&(8233===e.charCodeAt(Qe)?(t="\u2029",Qe++):(t=n,0===et&&it(ne)))))),et--,t===n&&0===et&&it(Z),t}function vt(){var t;return et++,(t=function(){var t,r,a,o,s,u;if(t=Qe,e.substr(Qe,2)===c?(r=c,Qe+=2):(r=n,0===et&&it(oe)),r!==n){for(a=[],o=Qe,s=Qe,et++,e.substr(Qe,2)===l?(u=l,Qe+=2):(u=n,0===et&&it(se)),et--,u===n?s=void 0:(Qe=s,s=n),s!==n&&(u=At())!==n?o=s=[s,u]:(Qe=o,o=n);o!==n;)a.push(o),o=Qe,s=Qe,et++,e.substr(Qe,2)===l?(u=l,Qe+=2):(u=n,0===et&&it(se)),et--,u===n?s=void 0:(Qe=s,s=n),s!==n&&(u=At())!==n?o=s=[s,u]:(Qe=o,o=n);e.substr(Qe,2)===l?(o=l,Qe+=2):(o=n,0===et&&it(se)),o!==n?t=r=[r,a,o]:(Qe=t,t=n)}else Qe=t,t=n;return t}())===n&&(t=yt()),et--,t===n&&0===et&&it(ae),t}function Ct(){var t,r,a,o,s,u;if(t=Qe,e.substr(Qe,2)===c?(r=c,Qe+=2):(r=n,0===et&&it(oe)),r!==n){for(a=[],o=Qe,s=Qe,et++,e.substr(Qe,2)===l?(u=l,Qe+=2):(u=n,0===et&&it(se)),u===n&&(u=xt()),et--,u===n?s=void 0:(Qe=s,s=n),s!==n&&(u=At())!==n?o=s=[s,u]:(Qe=o,o=n);o!==n;)a.push(o),o=Qe,s=Qe,et++,e.substr(Qe,2)===l?(u=l,Qe+=2):(u=n,0===et&&it(se)),u===n&&(u=xt()),et--,u===n?s=void 0:(Qe=s,s=n),s!==n&&(u=At())!==n?o=s=[s,u]:(Qe=o,o=n);e.substr(Qe,2)===l?(o=l,Qe+=2):(o=n,0===et&&it(se)),o!==n?t=r=[r,a,o]:(Qe=t,t=n)}else Qe=t,t=n;return t}function yt(){var t,r,a,o,s,u;if(t=Qe,"//"===e.substr(Qe,2)?(r="//",Qe+=2):(r=n,0===et&&it(ue)),r!==n){for(a=[],o=Qe,s=Qe,et++,u=xt(),et--,u===n?s=void 0:(Qe=s,s=n),s!==n&&(u=At())!==n?o=s=[s,u]:(Qe=o,o=n);o!==n;)a.push(o),o=Qe,s=Qe,et++,u=xt(),et--,u===n?s=void 0:(Qe=s,s=n),s!==n&&(u=At())!==n?o=s=[s,u]:(Qe=o,o=n);t=r=[r,a]}else Qe=t,t=n;return t}function _t(){var e,t,r,a;if(et++,e=Qe,(t=St())!==n){for(r=[],a=Ft();a!==n;)r.push(a),a=Ft();Je=e,e=[t+r.join(""),tt()]}else Qe=e,e=n;return et--,e===n&&(t=n,0===et&&it(ie)),e}function St(){var t,r,a;return(t=function(){var t;return(t=function(){var t;return v.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(Ue)),t}())===n&&(t=function(){var t;return A.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(ke)),t}())===n&&(t=function(){var t;return E.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(Ne)),t}())===n&&(t=function(){var t;return b.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(Ie)),t}())===n&&(t=function(){var t;return x.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(je)),t}())===n&&(t=function(){var t;return S.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(ze)),t}()),t}())===n&&(36===e.charCodeAt(Qe)?(t="$",Qe++):(t=n,0===et&&it(O)),t===n&&(95===e.charCodeAt(Qe)?(t="_",Qe++):(t=n,0===et&&it(ce)),t===n&&(t=Qe,92===e.charCodeAt(Qe)?(r=p,Qe++):(r=n,0===et&&it(le)),r!==n&&(a=Mt())!==n?t=a:(Qe=t,t=n)))),t}function Ft(){var t;return(t=St())===n&&(t=function(){var t;return(t=function(){var t;return y.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(Ge)),t}())===n&&(t=function(){var t;return C.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(qe)),t}()),t}())===n&&(t=function(){var t;return _.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(He)),t}())===n&&(t=function(){var t;return F.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(We)),t}())===n&&(8204===e.charCodeAt(Qe)?(t="",Qe++):(t=n,0===et&&it(pe)),t===n&&(8205===e.charCodeAt(Qe)?(t="",Qe++):(t=n,0===et&&it(fe)))),t}function wt(){var t,r,a,o;if(et++,t=Qe,34===e.charCodeAt(Qe)?(r=f,Qe++):(r=n,0===et&&it(me)),r!==n){for(a=[],o=Bt();o!==n;)a.push(o),o=Bt();34===e.charCodeAt(Qe)?(o=f,Qe++):(o=n,0===et&&it(me)),o!==n?(Je=t,t=a.join("")):(Qe=t,t=n)}else Qe=t,t=n;if(t===n)if(t=Qe,39===e.charCodeAt(Qe)?(r=d,Qe++):(r=n,0===et&&it($e)),r!==n){for(a=[],o=Dt();o!==n;)a.push(o),o=Dt();39===e.charCodeAt(Qe)?(o=d,Qe++):(o=n,0===et&&it($e)),o!==n?(Je=t,t=a.join("")):(Qe=t,t=n)}else Qe=t,t=n;return et--,t===n&&(r=n,0===et&&it(he)),t}function Bt(){var t,r,a,o;return t=Qe,r=Qe,a=Qe,et++,34===e.charCodeAt(Qe)?(o=f,Qe++):(o=n,0===et&&it(me)),o===n&&(92===e.charCodeAt(Qe)?(o=p,Qe++):(o=n,0===et&&it(le)),o===n&&(o=xt())),et--,o===n?a=void 0:(Qe=a,a=n),a!==n&&(o=At())!==n?r=a=[a,o]:(Qe=r,r=n),(t=r!==n?e.substring(t,Qe):r)===n&&(t=Qe,92===e.charCodeAt(Qe)?(r=p,Qe++):(r=n,0===et&&it(le)),r!==n&&(a=Rt())!==n?t=a:(Qe=t,t=n),t===n&&(t=Tt())),t}function Dt(){var t,r,a,o;return t=Qe,r=Qe,a=Qe,et++,39===e.charCodeAt(Qe)?(o=d,Qe++):(o=n,0===et&&it($e)),o===n&&(92===e.charCodeAt(Qe)?(o=p,Qe++):(o=n,0===et&&it(le)),o===n&&(o=xt())),et--,o===n?a=void 0:(Qe=a,a=n),a!==n&&(o=At())!==n?r=a=[a,o]:(Qe=r,r=n),(t=r!==n?e.substring(t,Qe):r)===n&&(t=Qe,92===e.charCodeAt(Qe)?(r=p,Qe++):(r=n,0===et&&it(le)),r!==n&&(a=Rt())!==n?t=a:(Qe=t,t=n),t===n&&(t=Tt())),t}function Lt(){var t,r,a,o,s,u;return t=Qe,(r=Pt())!==n?(45===e.charCodeAt(Qe)?(a="-",Qe++):(a=n,0===et&&it(ve)),a!==n&&(o=Pt())!==n?(Je=t,u=o,(s=r).charCodeAt(0)>u.charCodeAt(0)&&rt("Invalid character range: "+e.substring(Je,Qe)+"."),t=[s,u]):(Qe=t,t=n)):(Qe=t,t=n),t}function Pt(){var t,r,a,o;return t=Qe,r=Qe,a=Qe,et++,93===e.charCodeAt(Qe)?(o="]",Qe++):(o=n,0===et&&it(Ee)),o===n&&(92===e.charCodeAt(Qe)?(o=p,Qe++):(o=n,0===et&&it(le)),o===n&&(o=xt())),et--,o===n?a=void 0:(Qe=a,a=n),a!==n&&(o=At())!==n?r=a=[a,o]:(Qe=r,r=n),(t=r!==n?e.substring(t,Qe):r)===n&&(t=Qe,92===e.charCodeAt(Qe)?(r=p,Qe++):(r=n,0===et&&it(le)),r!==n&&(a=Rt())!==n?t=a:(Qe=t,t=n),t===n&&(t=Tt())),t}function Tt(){var t,r;return t=Qe,92===e.charCodeAt(Qe)?(r=p,Qe++):(r=n,0===et&&it(le)),r!==n&&Et()!==n?(Je=t,t=""):(Qe=t,t=n),t}function Rt(){var t,r,a,o;return t=function(){var t;return(t=Ot())===n&&(t=function(){var t,r,a,o;return t=Qe,r=Qe,a=Qe,et++,o=function(){var t;return(t=Ot())===n&&(t=kt())===n&&(120===e.charCodeAt(Qe)?(t="x",Qe++):(t=n,0===et&&it(De)),t===n&&(117===e.charCodeAt(Qe)?(t="u",Qe++):(t=n,0===et&&it(Le)))),t}(),o===n&&(o=xt()),et--,o===n?a=void 0:(Qe=a,a=n),a!==n&&(o=At())!==n?r=a=[a,o]:(Qe=r,r=n),t=r!==n?e.substring(t,Qe):r}()),t}(),t===n&&(t=Qe,48===e.charCodeAt(Qe)?(r="0",Qe++):(r=n,0===et&&it(Ce)),r!==n?(a=Qe,et++,o=kt(),et--,o===n?a=void 0:(Qe=a,a=n),a!==n?(Je=t,t="\0"):(Qe=t,t=n)):(Qe=t,t=n),t===n&&(t=function(){var t,r,a,o,s,u,i;return t=Qe,120===e.charCodeAt(Qe)?(r="x",Qe++):(r=n,0===et&&it(De)),r!==n?(a=Qe,o=Qe,(s=It())!==n&&(u=It())!==n?o=s=[s,u]:(Qe=o,o=n),(a=o!==n?e.substring(a,Qe):o)!==n?(Je=t,i=a,t=String.fromCharCode(parseInt(i,16))):(Qe=t,t=n)):(Qe=t,t=n),t}(),t===n&&(t=Mt()))),t}function Ot(){var t,r;return 39===e.charCodeAt(Qe)?(t=d,Qe++):(t=n,0===et&&it($e)),t===n&&(34===e.charCodeAt(Qe)?(t=f,Qe++):(t=n,0===et&&it(me)),t===n&&(92===e.charCodeAt(Qe)?(t=p,Qe++):(t=n,0===et&&it(le)),t===n&&(t=Qe,98===e.charCodeAt(Qe)?(r="b",Qe++):(r=n,0===et&&it(ye)),r!==n&&(Je=t,r="\b"),(t=r)===n&&(t=Qe,102===e.charCodeAt(Qe)?(r="f",Qe++):(r=n,0===et&&it(_e)),r!==n&&(Je=t,r="\f"),(t=r)===n&&(t=Qe,110===e.charCodeAt(Qe)?(r="n",Qe++):(r=n,0===et&&it(Se)),r!==n&&(Je=t,r="\n"),(t=r)===n&&(t=Qe,114===e.charCodeAt(Qe)?(r="r",Qe++):(r=n,0===et&&it(Fe)),r!==n&&(Je=t,r="\r"),(t=r)===n&&(t=Qe,116===e.charCodeAt(Qe)?(r="t",Qe++):(r=n,0===et&&it(we)),r!==n&&(Je=t,r="\t"),(t=r)===n&&(t=Qe,118===e.charCodeAt(Qe)?(r="v",Qe++):(r=n,0===et&&it(Be)),r!==n&&(Je=t,r="\v"),t=r)))))))),t}function Mt(){var t,r,a,o,s,u,i,c,l;return t=Qe,117===e.charCodeAt(Qe)?(r="u",Qe++):(r=n,0===et&&it(Le)),r!==n?(a=Qe,o=Qe,(s=It())!==n&&(u=It())!==n&&(i=It())!==n&&(c=It())!==n?o=s=[s,u,i,c]:(Qe=o,o=n),(a=o!==n?e.substring(a,Qe):o)!==n?(Je=t,l=a,t=String.fromCharCode(parseInt(l,16))):(Qe=t,t=n)):(Qe=t,t=n),t}function kt(){var t;return h.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(Pe)),t}function It(){var t;return m.test(e.charAt(Qe))?(t=e.charAt(Qe),Qe++):(t=n,0===et&&it(Te)),t}function jt(){var t,r,a,o;return et++,t=Qe,123===e.charCodeAt(Qe)?(r=u,Qe++):(r=n,0===et&&it(B)),r!==n?(a=function(){var e,t;return e=Qe,t=Nt(),Je=e,t=[t,tt()]}(),125===e.charCodeAt(Qe)?(o=i,Qe++):(o=n,0===et&&it(D)),o!==n?t=a:(Qe=t,t=n)):(Qe=t,t=n),et--,t===n&&(r=n,0===et&&it(Oe)),t}function Nt(){var t,r,a,o,s,c;if(t=Qe,r=[],a=[],o=Qe,s=Qe,et++,$.test(e.charAt(Qe))?(c=e.charAt(Qe),Qe++):(c=n,0===et&&it(Me)),et--,c===n?s=void 0:(Qe=s,s=n),s!==n&&(c=At())!==n?o=s=[s,c]:(Qe=o,o=n),o!==n)for(;o!==n;)a.push(o),o=Qe,s=Qe,et++,$.test(e.charAt(Qe))?(c=e.charAt(Qe),Qe++):(c=n,0===et&&it(Me)),et--,c===n?s=void 0:(Qe=s,s=n),s!==n&&(c=At())!==n?o=s=[s,c]:(Qe=o,o=n);else a=n;for(a===n&&(a=Qe,123===e.charCodeAt(Qe)?(o=u,Qe++):(o=n,0===et&&it(B)),o!==n?(s=Nt(),125===e.charCodeAt(Qe)?(c=i,Qe++):(c=n,0===et&&it(D)),c!==n?a=o=[o,s,c]:(Qe=a,a=n)):(Qe=a,a=n));a!==n;){if(r.push(a),a=[],o=Qe,s=Qe,et++,$.test(e.charAt(Qe))?(c=e.charAt(Qe),Qe++):(c=n,0===et&&it(Me)),et--,c===n?s=void 0:(Qe=s,s=n),s!==n&&(c=At())!==n?o=s=[s,c]:(Qe=o,o=n),o!==n)for(;o!==n;)a.push(o),o=Qe,s=Qe,et++,$.test(e.charAt(Qe))?(c=e.charAt(Qe),Qe++):(c=n,0===et&&it(Me)),et--,c===n?s=void 0:(Qe=s,s=n),s!==n&&(c=At())!==n?o=s=[s,c]:(Qe=o,o=n);else a=n;a===n&&(a=Qe,123===e.charCodeAt(Qe)?(o=u,Qe++):(o=n,0===et&&it(B)),o!==n?(s=Nt(),125===e.charCodeAt(Qe)?(c=i,Qe++):(c=n,0===et&&it(D)),c!==n?a=o=[o,s,c]:(Qe=a,a=n)):(Qe=a,a=n))}return e.substring(t,Qe)}function Ut(){var e,t;for(e=[],(t=bt())===n&&(t=Et())===n&&(t=vt());t!==n;)e.push(t),(t=bt())===n&&(t=Et())===n&&(t=vt());return e}function qt(){var t,r,a,o;return t=Qe,r=Ut(),59===e.charCodeAt(Qe)?(a=";",Qe++):(a=n,0===et&&it(Ye)),a!==n?t=r=[r,a]:(Qe=t,t=n),t===n&&(t=Qe,r=function(){var e,t;for(e=[],(t=bt())===n&&(t=Ct());t!==n;)e.push(t),(t=bt())===n&&(t=Ct());return e}(),(a=yt())===n&&(a=null),(o=Et())!==n?t=r=[r,a,o]:(Qe=t,t=n),t===n&&(t=Qe,r=Ut(),a=function(){var t,r;return t=Qe,et++,e.length>Qe?(r=e.charAt(Qe),Qe++):(r=n,0===et&&it(G)),et--,r===n?t=void 0:(Qe=t,t=n),t}(),a!==n?t=r=[r,a]:(Qe=t,t=n))),t}var Gt=t.reservedWords||[];if((r=s())!==n&&Qe===e.length)return r;throw r!==n&&Qe<e.length&&it({type:"end"}),function(e,t,r){return new peg$SyntaxError(peg$SyntaxError.buildMessage(e,t),e,t,r)}(Ke,Ze<e.length?e.charAt(Ze):null,Ze<e.length?ut(Ze,Ze+1):ut(Ze,Ze))}peg$subclass(peg$SyntaxError,Error),peg$SyntaxError.prototype.format=function(e){var t="Error: "+this.message;if(this.location){var r,n=null;for(r=0;r<e.length;r++)if(e[r].source===this.location.source){n=e[r].text.split(/\r\n|\n|\r/g);break}var a=this.location.start,o=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(a):a,s=this.location.source+":"+o.line+":"+o.column;if(n){var u=this.location.end,i=peg$padEnd("",o.line.toString().length," "),c=n[a.line-1],l=(a.line===u.line?u.column:c.length+1)-a.column||1;t+="\n --\x3e "+s+"\n"+i+" |\n"+o.line+" | "+c+"\n"+i+" | "+peg$padEnd("",a.column-1," ")+peg$padEnd("",l,"^")}else t+="\n at "+s}return t},peg$SyntaxError.buildMessage=function(e,t){var r={literal:function(e){return'"'+a(e.text)+'"'},class:function(e){var t=e.parts.map((function(e){return Array.isArray(e)?o(e[0])+"-"+o(e[1]):o(e)}));return"["+(e.inverted?"^":"")+t.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(e){return e.description}};function n(e){return e.charCodeAt(0).toString(16).toUpperCase()}function a(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function o(e){return e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(e){return"\\x0"+n(e)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(e){return"\\x"+n(e)}))}function s(e){return r[e.type](e)}return"Expected "+function(e){var t,r,n=e.map(s);if(n.sort(),n.length>0){for(t=1,r=1;t<n.length;t++)n[t-1]!==n[t]&&(n[r]=n[t],r++);n.length=r}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(e)+" but "+function(e){return e?'"'+a(e)+'"':"end of input"}(t)+" found."};var parser$4={SyntaxError:peg$SyntaxError,parse:peg$parse},GrammarError$2=grammarError,GrammarLocation$1=grammarLocation,compiler$1=compiler_1,parser$3=parser$4,VERSION=version$1,RESERVED_WORDS=["break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","new","return","super","switch","this","throw","try","typeof","var","void","while","with","null","true","false","enum","implements","interface","let","package","private","protected","public","static","yield","await"],peg$4={VERSION:VERSION,RESERVED_WORDS:RESERVED_WORDS,GrammarError:GrammarError$2,GrammarLocation:GrammarLocation$1,parser:parser$3,compiler:compiler$1,generate:function(e,t){var r,n,a="plugins"in(t=void 0!==t?t:{})?t.plugins:[],o={parser:peg$4.parser,passes:(r=peg$4.compiler.passes,n={},Object.keys(r).forEach((function(e){n[e]=r[e].slice()})),n),reservedWords:peg$4.RESERVED_WORDS.slice()};return a.forEach((function(e){e.use(o,t)})),peg$4.compiler.compile(o.parser.parse(e,{grammarSource:t.grammarSource,reservedWords:o.reservedWords}),o.passes,t)}},peg_1=peg$4,utils={},chai$i=require$$0__default.default,Call=function(){function e(e){this.args=e}return e.prototype.calledWithExactly=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return chai$i.util.eql(this.args,e)},e}();function dummy(){var e=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.callCount++,e.called=!0,e.calls.push(new Call(t))};return e.called=!1,e.callCount=0,e.calls=[],e.getCall=function(t){return e.calls[t]},e}utils.spy=function(){return dummy()},utils.stub=function(e,t){var r=e[t],n=dummy();return e[t]=n,n.restore=function(){e[t]=r},r};var chai$h=require$$0__default.default,peg$3=peg_1,_a$2=utils,spy$1=_a$2.spy,stub$1=_a$2.stub,expect$h=chai$h.expect;describe("generated parser API",(function(){describe("parse",(function(){it("parses input",(function(){var e=peg$3.generate("start = 'a'");expect$h(e.parse("a")).to.equal("a")})),it("throws an exception on syntax error",(function(){var e=peg$3.generate("start = 'a'");expect$h((function(){e.parse("b")})).to.throw()})),it("correctly describe character class in syntax error",(function(){var e=peg$3.generate("start = [123-5]");expect$h((function(){e.parse("0")})).to.throw("[123-5]")})),describe("start rule",(function(){var e=peg$3.generate(["a = 'x' { return 'a'; }","b = 'x' { return 'b'; }","c = 'x' { return 'c'; }"].join("\n"),{allowedStartRules:["b","c"]});describe("when |startRule| is not set",(function(){it("starts parsing from the first allowed rule",(function(){expect$h(e.parse("x")).to.equal("b")}))})),describe("when |startRule| is set to an allowed rule",(function(){it("starts parsing from specified rule",(function(){expect$h(e.parse("x",{startRule:"b"})).to.equal("b"),expect$h(e.parse("x",{startRule:"c"})).to.equal("c")}))})),describe("when |startRule| is set to a disallowed start rule",(function(){it("throws an exception",(function(){expect$h((function(){e.parse("x",{startRule:"a"})})).to.throw()}))}))})),describe("tracing",(function(){var e=peg$3.generate(["start = a / b","a = 'a'","b = 'b'"].join("\n"),{trace:!0});describe("default tracer",(function(){it("traces using console.log (if console is defined)",(function(){var t=["1:1-1:1 rule.enter start","1:1-1:1 rule.enter   a","1:1-1:1 rule.fail    a","1:1-1:1 rule.enter   b","1:1-1:2 rule.match   b","1:1-1:2 rule.match start"];"object"==typeof console&&stub$1(console,"log");try{e.parse("b"),"object"==typeof console&&(expect$h(console.log.callCount).to.equal(t.length),t.forEach((function(e,t){var r=console.log.getCall(t);expect$h(r.calledWithExactly(e)).to.equal(!0)})))}finally{"object"==typeof console&&console.log.restore()}}))})),describe("custom tracers",(function(){describe("trace",(function(){it("receives tracing events",(function(){var t=[{type:"rule.enter",rule:"start",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.enter",rule:"a",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.fail",rule:"a",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.enter",rule:"b",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.match",rule:"b",result:"b",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}},{type:"rule.match",rule:"start",result:"b",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}}],r={trace:spy$1()};e.parse("b",{tracer:r}),expect$h(r.trace.callCount).to.equal(t.length),t.forEach((function(e,t){var n=r.trace.getCall(t);expect$h(n.calledWithExactly(e)).to.equal(!0)}))}))}))}))})),it("accepts custom options",(function(){peg$3.generate("start = 'a'").parse("a",{foo:42})}))}))}));var chai$g=require$$0__default.default,peg$2=peg_1,expect$g=chai$g.expect,stub=utils.stub;describe("generated parser behavior",(function(){function e(e){"object"==typeof console&&stub(console,"log");try{return e()}finally{"object"==typeof console&&console.log.restore()}}function t(t,r){var n=t.Assertion;n.addMethod("parse",(function(t,n,a){var o=this;a=void 0!==a?a:{};var s=e((function(){return r.flag(o,"object").parse(t,a)}));void 0!==n&&this.assert(r.eql(s,n),"expected #{this} to parse input as #{exp} but got #{act}","expected #{this} to not parse input as #{exp}",n,s,!r.flag(this,"negate"))})),n.addMethod("failToParse",(function(t,a,o){var s,u,i=this;o=void 0!==o?o:{};try{u=e((function(){return r.flag(i,"object").parse(t,o)})),s=!0}catch(e){u=e,s=!1}this.assert(!s,"expected #{this} to fail to parse input but got #{act}","expected #{this} to not fail to parse input but #{act} was thrown",null,u),s||void 0===a||Object.keys(a).forEach((function(e){new n(u).to.have.property(e).that.is.deep.equal(a[e])}))}))}var r;beforeEach((function(){chai$g.use(t)})),r=function(e){describe("initializer",(function(){it("executes the code before parsing starts",(function(){var t=peg$2.generate(["{ var result = 42; }","start = 'a' { return result; }"].join("\n"),e);expect$g(t).to.parse("a",42)})),describe("available variables and functions",(function(){it("|options| contains options",(function(){var t=peg$2.generate(["{ var result = options; }","start = 'a' { return result; }"].join("\n"),e);expect$g(t).to.parse("a",{a:42},{a:42})}))}))})),describe("rule",(function(){e.cache?it("caches rule match results",(function(){var t=peg$2.generate(["{ var n = 0; }","start = (a 'b') / (a 'c') { return n; }","a = 'a' { n++; }"].join("\n"),e);expect$g(t).to.parse("ac",1)})):it("doesn't cache rule match results",(function(){var t=peg$2.generate(["{ var n = 0; }","start = (a 'b') / (a 'c') { return n; }","a = 'a' { n++; }"].join("\n"),e);expect$g(t).to.parse("ac",2)})),describe("when the expression matches",(function(){describe("without display name",(function(){describe("returns its match result",(function(){it("when expression may match",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.parse("a","a")})),it("when expression always match",(function(){var t=peg$2.generate("start = 'a'*",e);expect$g(t).to.parse("",[])}))}))})),describe("with display name",(function(){describe("returns its match result",(function(){it("when expression may match",(function(){var t=peg$2.generate("start 'start' = 'a'",e);expect$g(t).to.parse("a","a")})),it("when expression always match",(function(){var t=peg$2.generate("start 'start' = 'a'*",e);expect$g(t).to.parse("",[])}))}))}))})),describe("when the expression doesn't match",(function(){describe("without display name",(function(){describe("reports match failure and records an expectation",(function(){it("when expression may match",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1}]})})),it("when expression never match",(function(){var t=peg$2.generate("start = []",e);expect$g(t).to.failToParse("b",{expected:[{type:"class",parts:[],inverted:!1,ignoreCase:!1}]})}))}))})),describe("with display name",(function(){it('reports match failure and records an expectation of type "other" when expression may match',(function(){var t=peg$2.generate("start 'start' = 'a'",e);expect$g(t).to.failToParse("b",{expected:[{type:"other",description:"start"}]})})),it("reports match failure and doesn't records any expectations when expression never match",(function(){var t=peg$2.generate("start 'start' = []",e);expect$g(t).to.failToParse("b",{expected:[]})})),it("discards any expectations recorded when matching the expression",(function(){var t=peg$2.generate("start 'start' = 'a'",e);expect$g(t).to.failToParse("b",{expected:[{type:"other",description:"start"}]})}))}))}))})),describe("literal",(function(){describe("matching",(function(){it("matches empty literals",(function(){var t=peg$2.generate("start = ''",e);expect$g(t).to.parse("")})),it("matches one-character literals",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.parse("a"),expect$g(t).to.failToParse("b")})),it("matches multi-character literals",(function(){var t=peg$2.generate("start = 'abcd'",e);expect$g(t).to.parse("abcd"),expect$g(t).to.failToParse("efgh")})),it('is case sensitive without the "i" flag',(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.parse("a"),expect$g(t).to.failToParse("A")})),it('is case insensitive with the "i" flag',(function(){var t=peg$2.generate("start = 'a'i",e);expect$g(t).to.parse("a"),expect$g(t).to.parse("A")}))})),describe("when it matches",(function(){it("returns the matched text",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.parse("a","a")})),it("consumes the matched text",(function(){var t=peg$2.generate("start = 'a' .",e);expect$g(t).to.parse("ab")}))})),describe("when it doesn't match",(function(){it('reports match failure and records an expectation of type "literal"',(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1}]})}))}))})),describe("character class",(function(){describe("matching",(function(){it("matches empty classes",(function(){var t=peg$2.generate("start = []",e);expect$g(t).to.failToParse("a")})),it("matches classes with a character list",(function(){var t=peg$2.generate("start = [abc]",e);expect$g(t).to.parse("a"),expect$g(t).to.parse("b"),expect$g(t).to.parse("c"),expect$g(t).to.failToParse("d")})),it("matches classes with a character range",(function(){var t=peg$2.generate("start = [a-c]",e);expect$g(t).to.parse("a"),expect$g(t).to.parse("b"),expect$g(t).to.parse("c"),expect$g(t).to.failToParse("d")})),it("matches inverted classes",(function(){var t=peg$2.generate("start = [^a]",e);expect$g(t).to.failToParse("a"),expect$g(t).to.parse("b")})),it('is case sensitive without the "i" flag',(function(){var t=peg$2.generate("start = [a]",e);expect$g(t).to.parse("a"),expect$g(t).to.failToParse("A")})),it('is case insensitive with the "i" flag',(function(){var t=peg$2.generate("start = [a]i",e);expect$g(t).to.parse("a"),expect$g(t).to.parse("A")}))})),describe("when it matches",(function(){it("returns the matched character",(function(){var t=peg$2.generate("start = [a]",e);expect$g(t).to.parse("a","a")})),it("consumes the matched character",(function(){var t=peg$2.generate("start = [a] .",e);expect$g(t).to.parse("ab")}))})),describe("when it doesn't match",(function(){it('reports match failure and records an expectation of type "class"',(function(){var t=peg$2.generate("start = [a]",e);expect$g(t).to.failToParse("b",{expected:[{type:"class",parts:["a"],inverted:!1,ignoreCase:!1}]})}))}))})),describe("dot",(function(){describe("matching",(function(){it("matches any character",(function(){var t=peg$2.generate("start = .",e);expect$g(t).to.parse("a"),expect$g(t).to.parse("b"),expect$g(t).to.parse("c")}))})),describe("when it matches",(function(){it("returns the matched character",(function(){var t=peg$2.generate("start = .",e);expect$g(t).to.parse("a","a")})),it("consumes the matched character",(function(){var t=peg$2.generate("start = . .",e);expect$g(t).to.parse("ab")}))})),describe("when it doesn't match",(function(){it('reports match failure and records an expectation of type "any"',(function(){var t=peg$2.generate("start = .",e);expect$g(t).to.failToParse("",{expected:[{type:"any"}]})}))}))})),describe("rule reference",(function(){describe("when referenced rule's expression matches",(function(){it("returns its result",(function(){var t=peg$2.generate(["start = a","a = 'a'"].join("\n"),e);expect$g(t).to.parse("a","a")}))})),describe("when referenced rule's expression doesn't match",(function(){it("reports match failure",(function(){var t=peg$2.generate(["start = a","a = 'a'"].join("\n"),e);expect$g(t).to.failToParse("b")}))}))})),describe("positive semantic predicate",(function(){describe("when the code returns a truthy value",(function(){it("returns |undefined|",(function(){var t=peg$2.generate("start = &{ return true; } ''",e);expect$g(t).to.parse("",[void 0,""])}))})),describe("when the code returns a falsey value",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = &{ return false; }",e);expect$g(t).to.failToParse("")}))})),describe("label variables",(function(){describe("in containing sequence",(function(){it("can access variables defined by preceding labeled elements",(function(){var t=peg$2.generate("start = a:'a' &{ return a === 'a'; }",e);expect$g(t).to.parse("a")})),it("cannot access variable defined by labeled predicate element",(function(){var t=peg$2.generate("start = 'a' b:&{ return b === undefined; } 'c'",e);expect$g(t).to.failToParse("ac")})),it("cannot access variables defined by following labeled elements",(function(){var t=peg$2.generate("start = &{ return a === 'a'; } a:'a'",e);expect$g(t).to.failToParse("a")})),it("cannot access variables defined by subexpressions",(function(){[{grammar:"start = (a:'a') &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')? &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')* &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')+ &{ return a === 'a'; }",input:"a"},{grammar:"start = $(a:'a') &{ return a === 'a'; }",input:"a"},{grammar:"start = &(a:'a') 'a' &{ return a === 'a'; }",input:"a"},{grammar:"start = !(a:'a') 'b' &{ return a === 'a'; }",input:"b"},{grammar:"start = b:(a:'a') &{ return a === 'a'; }",input:"a"},{grammar:"start = ('a' b:'b' 'c') &{ return b === 'b'; }",input:"abc"},{grammar:"start = (a:'a' { return a; }) &{ return a === 'a'; }",input:"a"},{grammar:"start = ('a' / b:'b' / 'c') &{ return b === 'b'; }",input:"b"}].forEach((function(t){var r=peg$2.generate(t.grammar,e);expect$g(r).to.failToParse(t.input)}))}))})),describe("in outer sequence",(function(){it("can access variables defined by preceding labeled elements",(function(){var t=peg$2.generate("start = a:'a' ('b' &{ return a === 'a'; })",e);expect$g(t).to.parse("ab")})),it("cannot access variable defined by labeled predicate element",(function(){var t=peg$2.generate("start = 'a' b:('b' &{ return b === undefined; }) 'c'",e);expect$g(t).to.failToParse("abc")})),it("cannot access variables defined by following labeled elements",(function(){var t=peg$2.generate("start = ('a' &{ return b === 'b'; }) b:'b'",e);expect$g(t).to.failToParse("ab")}))}))})),describe("initializer variables & functions",(function(){it("can access variables defined in the initializer",(function(){var t=peg$2.generate(["{ var v = 42 }","start = &{ return v === 42; }"].join("\n"),e);expect$g(t).to.parse("")})),it("can access functions defined in the initializer",(function(){var t=peg$2.generate(["{ function f() { return 42; } }","start = &{ return f() === 42; }"].join("\n"),e);expect$g(t).to.parse("")}))})),describe("available variables & functions",(function(){it("|options| contains options",(function(){var t=peg$2.generate(["{ var result; }","start = &{ result = options; return true; } { return result; }"].join("\n"),e);expect$g(t).to.parse("",{a:42},{a:42})})),it("|location| returns current location info",(function(){var t=peg$2.generate(["{ var result; }","start = line (nl+ line)* { return result; }","line = thing (' '+ thing)*","thing = digit / mark","digit = [0-9]","mark = &{ result = location(); return true; } 'x'","nl = '\\r'? '\\n'"].join("\n"),e);expect$g(t).to.parse("1\n2\n\n3\n\n\n4 5 x",{source:void 0,start:{offset:13,line:7,column:5},end:{offset:13,line:7,column:5}}),expect$g(t).to.parse("1\nx",{source:void 0,start:{offset:2,line:2,column:1},end:{offset:2,line:2,column:1}}),expect$g(t).to.parse("1\r\nx",{source:void 0,start:{offset:3,line:2,column:1},end:{offset:3,line:2,column:1}})})),it("|offset| returns current start offset",(function(){var t=peg$2.generate(["start = [0-9]+ @mark","mark = 'xx' { return offset(); }"].join("\n"),e);expect$g(t).to.parse("0123456xx",7)})),it("|range| returns current range",(function(){var t=peg$2.generate(["start = [0-9]+ @mark","mark = 'xx' { return range(); }"].join("\n"),e);expect$g(t).to.parse("0123456xx",{source:void 0,start:7,end:9})}))}))})),describe("negative semantic predicate",(function(){describe("when the code returns a falsey value",(function(){it("returns |undefined|",(function(){var t=peg$2.generate("start = !{ return false; } ''",e);expect$g(t).to.parse("",[void 0,""])}))})),describe("when the code returns a truthy value",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = !{ return true; }",e);expect$g(t).to.failToParse("")}))})),describe("label variables",(function(){describe("in containing sequence",(function(){it("can access variables defined by preceding labeled elements",(function(){var t=peg$2.generate("start = a:'a' !{ return a !== 'a'; }",e);expect$g(t).to.parse("a")})),it("cannot access variable defined by labeled predicate element",(function(){var t=peg$2.generate("start = 'a' b:!{ return b !== undefined; } 'c'",e);expect$g(t).to.failToParse("ac")})),it("cannot access variables defined by following labeled elements",(function(){var t=peg$2.generate("start = !{ return a !== 'a'; } a:'a'",e);expect$g(t).to.failToParse("a")})),it("cannot access variables defined by subexpressions",(function(){[{grammar:"start = (a:'a') !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')? !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')* !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')+ !{ return a !== 'a'; }",input:"a"},{grammar:"start = $(a:'a') !{ return a !== 'a'; }",input:"a"},{grammar:"start = &(a:'a') 'a' !{ return a !== 'a'; }",input:"a"},{grammar:"start = !(a:'a') 'b' !{ return a !== 'a'; }",input:"b"},{grammar:"start = b:(a:'a') !{ return a !== 'a'; }",input:"a"},{grammar:"start = ('a' b:'b' 'c') !{ return b !== 'b'; }",input:"abc"},{grammar:"start = (a:'a' { return a; }) !{ return a !== 'a'; }",input:"a"},{grammar:"start = ('a' / b:'b' / 'c') !{ return b !== 'b'; }",input:"b"}].forEach((function(t){var r=peg$2.generate(t.grammar,e);expect$g(r).to.failToParse(t.input)}))}))})),describe("in outer sequence",(function(){it("can access variables defined by preceding labeled elements",(function(){var t=peg$2.generate("start = a:'a' ('b' !{ return a !== 'a'; })",e);expect$g(t).to.parse("ab")})),it("cannot access variable defined by labeled predicate element",(function(){var t=peg$2.generate("start = 'a' b:('b' !{ return b !== undefined; }) 'c'",e);expect$g(t).to.failToParse("abc")})),it("cannot access variables defined by following labeled elements",(function(){var t=peg$2.generate("start = ('a' !{ return b !== 'b'; }) b:'b'",e);expect$g(t).to.failToParse("ab")}))}))})),describe("initializer variables & functions",(function(){it("can access variables defined in the initializer",(function(){var t=peg$2.generate(["{ var v = 42 }","start = !{ return v !== 42; }"].join("\n"),e);expect$g(t).to.parse("")})),it("can access functions defined in the initializer",(function(){var t=peg$2.generate(["{ function f() { return 42; } }","start = !{ return f() !== 42; }"].join("\n"),e);expect$g(t).to.parse("")}))})),describe("available variables & functions",(function(){it("|options| contains options",(function(){var t=peg$2.generate(["{ var result; }","start = !{ result = options; return false; } { return result; }"].join("\n"),e);expect$g(t).to.parse("",{a:42},{a:42})})),it("|location| returns current location info",(function(){var t=peg$2.generate(["{ var result; }","start = line (nl+ line)* { return result; }","line = thing (' '+ thing)*","thing = digit / mark","digit = [0-9]","mark = !{ result = location(); return false; } 'x'","nl = '\\r'? '\\n'"].join("\n"),e);expect$g(t).to.parse("1\n2\n\n3\n\n\n4 5 x",{source:void 0,start:{offset:13,line:7,column:5},end:{offset:13,line:7,column:5}}),expect$g(t).to.parse("1\nx",{source:void 0,start:{offset:2,line:2,column:1},end:{offset:2,line:2,column:1}}),expect$g(t).to.parse("1\r\nx",{source:void 0,start:{offset:3,line:2,column:1},end:{offset:3,line:2,column:1}})}))}))})),describe("group",(function(){describe("when the expression matches",(function(){it("returns its match result",(function(){var t=peg$2.generate("start = ('a')",e);expect$g(t).to.parse("a","a")}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = ('a')",e);expect$g(t).to.failToParse("b")}))}))})),describe("optional",(function(){describe("when the expression matches",(function(){it("returns its match result",(function(){var t=peg$2.generate("start = 'a'?",e);expect$g(t).to.parse("a","a")}))})),describe("when the expression doesn't match",(function(){it("returns |null|",(function(){var t=peg$2.generate("start = 'a'?",e);expect$g(t).to.parse("",null)}))}))})),describe("zero or more",(function(){describe("when the expression matches zero or more times",(function(){it("returns an array of its match results",(function(){var t=peg$2.generate("start = 'a'*",e);expect$g(t).to.parse("",[]),expect$g(t).to.parse("a",["a"]),expect$g(t).to.parse("aaa",["a","a","a"])}))}))})),describe("one or more",(function(){describe("when the expression matches one or more times",(function(){it("returns an array of its match results",(function(){var t=peg$2.generate("start = 'a'+",e);expect$g(t).to.parse("a",["a"]),expect$g(t).to.parse("aaa",["a","a","a"])}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = 'a'+",e);expect$g(t).to.failToParse("")}))}))})),describe("text",(function(){describe("when the expression matches",(function(){it("returns the matched text",(function(){var t=peg$2.generate("start = $('a' 'b' 'c')",e);expect$g(t).to.parse("abc","abc")}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = $('a')",e);expect$g(t).to.failToParse("b")}))}))})),describe("positive simple predicate",(function(){describe("when the expression matches",(function(){it("returns |undefined|",(function(){var t=peg$2.generate("start = &'a' 'a'",e);expect$g(t).to.parse("a",[void 0,"a"])})),it("resets parse position",(function(){var t=peg$2.generate("start = &'a' 'a'",e);expect$g(t).to.parse("a")}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = &'a'",e);expect$g(t).to.failToParse("b")})),it("discards any expectations recorded when matching the expression",(function(){var t=peg$2.generate("start = 'a' / &'b' / 'c'",e);expect$g(t).to.failToParse("d",{expected:[{type:"literal",text:"a",ignoreCase:!1},{type:"literal",text:"c",ignoreCase:!1}]})}))}))})),describe("negative simple predicate",(function(){describe("when the expression matches",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = !'a'",e);expect$g(t).to.failToParse("a")}))})),describe("when the expression doesn't match",(function(){it("returns |undefined|",(function(){var t=peg$2.generate("start = !'a' 'b'",e);expect$g(t).to.parse("b",[void 0,"b"])})),it("resets parse position",(function(){var t=peg$2.generate("start = !'a' 'b'",e);expect$g(t).to.parse("b")})),it("discards any expectations recorded when matching the expression",(function(){var t=peg$2.generate("start = 'a' / !'b' / 'c'",e);expect$g(t).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1},{type:"literal",text:"c",ignoreCase:!1}]})}))}))})),describe("label",(function(){describe("when the expression matches",(function(){it("returns its match result",(function(){var t=peg$2.generate("start = a:'a'",e);expect$g(t).to.parse("a","a")}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = a:'a'",e);expect$g(t).to.failToParse("b")}))}))})),describe("sequence",(function(){describe("when all expressions match",(function(){it("returns an array of their match results",(function(){var t=peg$2.generate("start = 'a' 'b' 'c'",e);expect$g(t).to.parse("abc",["a","b","c"])})),it("plucks a single value",(function(){var t=peg$2.generate("start = @'a'",e);expect$g(t).to.parse("a","a"),t=peg$2.generate("start = @'a' / @'b'",e),expect$g(t).to.parse("a","a"),expect$g(t).to.parse("b","b"),t=peg$2.generate("start = 'a' @'b' 'c'",e),expect$g(t).to.parse("abc","b"),t=peg$2.generate("start = 'a' ( @'b' 'c' )",e),expect$g(t).to.parse("abc",["a","b"]),t=peg$2.generate("start = 'a' @( 'b' @'c' 'd' )",e),expect$g(t).to.parse("abcd","c"),t=peg$2.generate("start = 'a' ( @'b' 'c' ) @'d'",e),expect$g(t).to.parse("abcd","d"),t=peg$2.generate("start = 'a' @'b' 'c' / 'd' 'e' @'f'",e),expect$g(t).to.parse("def","f")})),it("plucks a multiple values",(function(){var t=peg$2.generate("start = 'a' @'b' @'c'",e);expect$g(t).to.parse("abc",["b","c"]),t=peg$2.generate("start = 'a' ( @'b' @'c' )",e),expect$g(t).to.parse("abc",["a",["b","c"]]),t=peg$2.generate("start = 'a' @( 'b' @'c' @'d' )",e),expect$g(t).to.parse("abcd",["c","d"]),t=peg$2.generate("start = 'a' @( @'b' 'c' ) @'d' 'e'",e),expect$g(t).to.parse("abcde",["b","d"]),t=peg$2.generate("start = 'a' @'b' 'c' / @'d' 'e' @'f'",e),expect$g(t).to.parse("def",["d","f"])})),it('prevents "@" on a semantic predicate',(function(){expect$g((function(){return peg$2.generate("start1 = 'a' @&{ /* semantic_and */ } 'c'")}),e).to.throw(),expect$g((function(){return peg$2.generate("start2 = 'a' @!{ /* semantic_not */ } 'c'")}),e).to.throw()}))})),describe("when any expression doesn't match",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = 'a' 'b' 'c'",e);expect$g(t).to.failToParse("dbc"),expect$g(t).to.failToParse("adc"),expect$g(t).to.failToParse("abd")})),it("resets parse position",(function(){var t=peg$2.generate("start = 'a' 'b' / 'a'",e);expect$g(t).to.parse("a","a")}))}))})),describe("action",(function(){describe("when the expression matches",(function(){it("returns the value returned by the code",(function(){var t=peg$2.generate("start = 'a' { return 42; }",e);expect$g(t).to.parse("a",42)})),describe("label variables",(function(){describe("in the expression",(function(){it("can access variable defined by labeled expression",(function(){var t=peg$2.generate("start = a:'a' { return a; }",e);expect$g(t).to.parse("a","a")})),it("can access variables defined by labeled sequence elements",(function(){var t=peg$2.generate("start = a:'a' b:'b' c:'c' { return [a, b, c]; }",e);expect$g(t).to.parse("abc",["a","b","c"])})),it("cannot access variables defined by subexpressions",(function(){[{grammar:"start = (a:'a') { return a; }",input:"a"},{grammar:"start = (a:'a')? { return a; }",input:"a"},{grammar:"start = (a:'a')* { return a; }",input:"a"},{grammar:"start = (a:'a')+ { return a; }",input:"a"},{grammar:"start = $(a:'a') { return a; }",input:"a"},{grammar:"start = &(a:'a') 'a' { return a; }",input:"a"},{grammar:"start = !(a:'a') 'b' { return a; }",input:"b"},{grammar:"start = b:(a:'a') { return a; }",input:"a"},{grammar:"start = ('a' b:'b' 'c') { return b; }",input:"abc"},{grammar:"start = (a:'a' { return a; }) { return a; }",input:"a"},{grammar:"start = ('a' / b:'b' / 'c') { return b; }",input:"b"}].forEach((function(t){var r=peg$2.generate(t.grammar,e);expect$g(r).to.failToParse(t.input)}))}))})),describe("in outer sequence",(function(){it("can access variables defined by preceding labeled elements",(function(){var t=peg$2.generate("start = a:'a' ('b' { return a; })",e);expect$g(t).to.parse("ab",["a","a"])})),it("cannot access variable defined by labeled action element",(function(){var t=peg$2.generate("start = 'a' b:('b' { return b; }) c:'c'",e);expect$g(t).to.failToParse("abc")})),it("cannot access variables defined by following labeled elements",(function(){var t=peg$2.generate("start = ('a' { return b; }) b:'b'",e);expect$g(t).to.failToParse("ab")}))}))})),describe("initializer variables & functions",(function(){it("can access variables defined in the initializer",(function(){var t=peg$2.generate(["{ var v = 42 }","start = 'a' { return v; }"].join("\n"),e);expect$g(t).to.parse("a",42)})),it("can access functions defined in the initializer",(function(){var t=peg$2.generate(["{ function f() { return 42; } }","start = 'a' { return f(); }"].join("\n"),e);expect$g(t).to.parse("a",42)}))})),describe("available variables & functions",(function(){it("|options| contains options",(function(){var t=peg$2.generate("start = 'a' { return options; }",e);expect$g(t).to.parse("a",{a:42},{a:42})})),it("|text| returns text matched by the expression",(function(){var t=peg$2.generate("start = 'a' { return text(); }",e);expect$g(t).to.parse("a","a")})),it("|location| returns location info of the expression",(function(){var t=peg$2.generate(["{ var result; }","start = line (nl+ line)* { return result; }","line = thing (' '+ thing)*","thing = digit / mark","digit = [0-9]","mark = 'x' { result = location(); }","nl = '\\r'? '\\n'"].join("\n"),e);expect$g(t).to.parse("1\n2\n\n3\n\n\n4 5 x",{source:void 0,start:{offset:13,line:7,column:5},end:{offset:14,line:7,column:6}}),expect$g(t).to.parse("1\nx",{source:void 0,start:{offset:2,line:2,column:1},end:{offset:3,line:2,column:2}}),expect$g(t).to.parse("1\r\nx",{source:void 0,start:{offset:3,line:2,column:1},end:{offset:4,line:2,column:2}})})),describe("|expected|",(function(){it("terminates parsing and throws an exception",(function(){var t=peg$2.generate("start = 'a' { expected('a'); }",e);expect$g(t).to.failToParse("a",{message:'Expected a but "a" found.',expected:[{type:"other",description:"a"}],found:"a",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}})})),it("allows to set custom location info",(function(){var t=peg$2.generate(["start = 'a' {","  expected('a', {","    start: { offset: 1, line: 1, column: 2 },","    end: { offset: 2, line: 1, column: 3 }","  });","}"].join("\n"),e);expect$g(t).to.failToParse("a",{message:'Expected a but "a" found.',expected:[{type:"other",description:"a"}],found:"a",location:{start:{offset:1,line:1,column:2},end:{offset:2,line:1,column:3}}})}))})),describe("|error|",(function(){it("terminates parsing and throws an exception",(function(){var t=peg$2.generate("start = 'a' { error('a'); }",e);expect$g(t).to.failToParse("a",{message:"a",found:null,expected:null,location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}})})),it("allows to set custom location info",(function(){var t=peg$2.generate(["start = 'a' {","  error('a', {","    start: { offset: 1, line: 1, column: 2 },","    end: { offset: 2, line: 1, column: 3 }","  });","}"].join("\n"),e);expect$g(t).to.failToParse("a",{message:"a",expected:null,found:null,location:{start:{offset:1,line:1,column:2},end:{offset:2,line:1,column:3}}})}))}))}))})),describe("when the expression doesn't match",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = 'a' { return 42; }",e);expect$g(t).to.failToParse("b")})),it("doesn't execute the code",(function(){var t=peg$2.generate("start = 'a' { throw 'Boom!'; } / 'b'",e);expect$g(t).to.parse("b")}))}))})),describe("choice",(function(){describe("when any expression matches",(function(){it("returns its match result",(function(){var t=peg$2.generate("start = 'a' / 'b' / 'c'",e);expect$g(t).to.parse("a","a"),expect$g(t).to.parse("b","b"),expect$g(t).to.parse("c","c")}))})),describe("when all expressions don't match",(function(){it("reports match failure",(function(){var t=peg$2.generate("start = 'a' / 'b' / 'c'",e);expect$g(t).to.failToParse("d")}))}))})),describe("error reporting",(function(){describe("behavior",(function(){it("reports only the rightmost error",(function(){var t=peg$2.generate("start = 'a' 'b' / 'a' 'c' 'd'",e);expect$g(t).to.failToParse("ace",{expected:[{type:"literal",text:"d",ignoreCase:!1}]})}))})),describe("expectations reporting",(function(){it("reports expectations correctly with no alternative",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("ab",{expected:[{type:"end"}]})})),it("reports expectations correctly with one alternative",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1}]})})),it("reports expectations correctly with multiple alternatives",(function(){var t=peg$2.generate("start = 'a' / 'b' / 'c'",e);expect$g(t).to.failToParse("d",{expected:[{type:"literal",text:"a",ignoreCase:!1},{type:"literal",text:"b",ignoreCase:!1},{type:"literal",text:"c",ignoreCase:!1}]})}))})),describe("found string reporting",(function(){it("reports found string correctly at the end of input",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("",{found:null})})),it("reports found string correctly in the middle of input",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("b",{found:"b"})}))})),describe("message building",(function(){it("builds message correctly with no alternative",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("ab",{message:'Expected end of input but "b" found.'})})),it("builds message correctly with one alternative",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("b",{message:'Expected "a" but "b" found.'})})),it("builds message correctly with multiple alternatives",(function(){var t=peg$2.generate("start = 'a' / 'b' / 'c'",e);expect$g(t).to.failToParse("d",{message:'Expected "a", "b", or "c" but "d" found.'})})),it("builds message correctly at the end of input",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("",{message:'Expected "a" but end of input found.'})})),it("builds message correctly in the middle of input",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("b",{message:'Expected "a" but "b" found.'})})),it("removes duplicates from expectations",(function(){var t=peg$2.generate("start = 'a' / 'a'",e);expect$g(t).to.failToParse("b",{message:'Expected "a" but "b" found.'})})),it("sorts expectations",(function(){var t=peg$2.generate("start = 'c' / 'b' / 'a'",e);expect$g(t).to.failToParse("d",{message:'Expected "a", "b", or "c" but "d" found.'})}))})),describe("position reporting",(function(){it("reports position correctly at the end of input",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("",{location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}})})),it("reports position correctly in the middle of input",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("b",{location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}})})),it("reports position correctly with trailing input",(function(){var t=peg$2.generate("start = 'a'",e);expect$g(t).to.failToParse("aa",{location:{source:void 0,start:{offset:1,line:1,column:2},end:{offset:2,line:1,column:3}}})})),it("reports position correctly in complex cases",(function(){var t=peg$2.generate(["start = line (nl+ line)*","line = digit (' '+ digit)*","digit = [0-9]","nl = '\\r'? '\\n'"].join("\n"),e);expect$g(t).to.failToParse("1\n2\n\n3\n\n\n4 5 x",{location:{source:void 0,start:{offset:13,line:7,column:5},end:{offset:14,line:7,column:6}}}),expect$g(t).to.failToParse("1\nx",{location:{source:void 0,start:{offset:2,line:2,column:1},end:{offset:3,line:2,column:2}}}),expect$g(t).to.failToParse("1\r\nx",{location:{source:void 0,start:{offset:3,line:2,column:1},end:{offset:4,line:2,column:2}}})})),it("reports location source correctly",(function(){var t={source:"object"},r=peg$2.generate(["start = line (nl+ line)*","line = digit (' '+ digit)*","digit = [0-9]","nl = '\\r'? '\\n'"].join("\n"),e);expect$g(r).to.failToParse("1\n2\n\n3\n\n\n4 5 x",{location:{source:t,start:{offset:13,line:7,column:5},end:{offset:14,line:7,column:6}}},{grammarSource:t})}))}))})),describe("complex examples",(function(){it("handles arithmetics example correctly",(function(){var t=peg$2.generate(["Expr = Sum","Sum = head:Product tail:(('+' / '-') Product)* {","        return tail.reduce(function(result, element) {","          if (element[0] === '+') { return result + element[1]; }","          if (element[0] === '-') { return result - element[1]; }","        }, head);","      }","Product = head:Value tail:(('*' / '/') Value)* {","            return tail.reduce(function(result, element) {","              if (element[0] === '*') { return result * element[1]; }","              if (element[0] === '/') { return result / element[1]; }","            }, head);","          }","Value = digits:[0-9]+     { return parseInt(digits.join(''), 10); }","      / '(' expr:Expr ')' { return expr; }"].join("\n"),e);expect$g(t).to.parse("0",0),expect$g(t).to.parse("123",123),expect$g(t).to.parse("(42+43)",85),expect$g(t).to.parse("42",42),expect$g(t).to.parse("42*43",1806),expect$g(t).to.parse("42*43*44*45",3575880),expect$g(t).to.parse("42/43",42/43),expect$g(t).to.parse("42/43/44/45",42/43/44/45),expect$g(t).to.parse("42*43",1806),expect$g(t).to.parse("42*43+44*45",3786),expect$g(t).to.parse("42*43+44*45+46*47+48*49",8300),expect$g(t).to.parse("42*43-44*45",-174),expect$g(t).to.parse("42*43-44*45-46*47-48*49",-4688),expect$g(t).to.parse("42+43",85),expect$g(t).to.parse("(1+2)*(3+4)",21)})),it("handles non-context-free language correctly",(function(){var t=peg$2.generate(["S = &(A 'c') a:'a'+ B:B !('a' / 'b' / 'c') { return a.join('') + B; }","A = a:'a' A:A? b:'b' { return [a, A, b].join(''); }","B = b:'b' B:B? c:'c' { return [b, B, c].join(''); }"].join("\n"),e);expect$g(t).to.parse("abc","abc"),expect$g(t).to.parse("aaabbbccc","aaabbbccc"),expect$g(t).to.failToParse("aabbbccc"),expect$g(t).to.failToParse("aaaabbbccc"),expect$g(t).to.failToParse("aaabbccc"),expect$g(t).to.failToParse("aaabbbbccc"),expect$g(t).to.failToParse("aaabbbcc"),expect$g(t).to.failToParse("aaabbbcccc")})),it("handles nested comments example correctly",(function(){var t=peg$2.generate(["C = begin:Begin ns:N* end:End { return begin + ns.join('') + end; }","N = C","  / !Begin !End z:Z { return z; }","Z = .","Begin = '(*'","End = '*)'"].join("\n"),e);expect$g(t).to.parse("(**)","(**)"),expect$g(t).to.parse("(*abc*)","(*abc*)"),expect$g(t).to.parse("(*(**)*)","(*(**)*)"),expect$g(t).to.parse("(*abc(*def*)ghi(*(*(*jkl*)*)*)mno*)","(*abc(*def*)ghi(*(*(*jkl*)*)*)mno*)")}))})),describe("run side-effects in non-matching",(function(){it("positive semantic predicate",(function(){var t=peg$2.generate("\n        { let i = 0; }\n        start = (neverMatched / .) { return i; };\n        neverMatched = &{ i = 1; return true; } [];\n        ",e);expect$g(t).to.parse("b",1),t=peg$2.generate('\n        { let i = 0; }\n        start = ("a" / neverMatched / .) { return i; };\n        neverMatched = &{ i = 1; return true; } [];\n        ',e),expect$g(t).to.parse("b",1)})),it("negative semantic predicate",(function(){var t=peg$2.generate("\n        { let i = 0; }\n        start = (neverMatched / .) { return i; };\n        neverMatched = !{ i = 1; return false; } [];\n        ",e);expect$g(t).to.parse("b",1),t=peg$2.generate('\n        { let i = 0; }\n        start = ("a" / neverMatched / .) { return i; };\n        neverMatched = !{ i = 1; return false; } [];\n        ',e),expect$g(t).to.parse("b",1)})),it("action",(function(){var t=peg$2.generate("\n        { let i = 0; }\n        start = (neverMatched / .) { return i; };\n        neverMatched = (. { i = 1; }) [];\n        ",e);expect$g(t).to.parse("b",1),t=peg$2.generate('\n        { let i = 0; }\n        start = ("a" / neverMatched / .) { return i; };\n        neverMatched = (. { i = 1; }) [];\n        ',e),expect$g(t).to.parse("b",1)}))}))},[{cache:!1,trace:!1},{cache:!1,trace:!0},{cache:!1,trace:!1},{cache:!1,trace:!0},{cache:!0,trace:!1},{cache:!0,trace:!0},{cache:!0,trace:!1},{cache:!0,trace:!0}].forEach((function(e){describe("with options "+chai$g.util.inspect(e),(function(){var t,n;r((t=e,n={},Object.keys(t).forEach((function(e){n[e]=t[e]})),n))}))})),describe("syntax errors",(function(){it("formats",(function(){var e={source:"stdin",text:"==="};try{peg$2.generate(e.text,{grammarSource:e.source})}catch(t){expect$g(t).to.be.an.instanceof(peg$2.parser.SyntaxError),expect$g(t.format([e])).to.equal('Error: Expected "{", code block, comment, end of line, identifier, or whitespace but "=" found.\n --\x3e stdin:1:1\n  |\n1 | ===\n  | ^')}try{peg$2.generate("===",{grammarSource:"stdin"})}catch(e){expect$g(e).to.be.an.instanceof(peg$2.parser.SyntaxError),expect$g(e.format([])).to.equal('Error: Expected "{", code block, comment, end of line, identifier, or whitespace but "=" found.\n at stdin:1:1')}})),it("reports multiple errors in each compilation stage",(function(){try{peg$2.generate("\n          start = leftRecursion\n          leftRecursion = duplicatedLabel:duplicatedRule duplicatedLabel:missingRule\n          duplicatedRule = missingRule\n          duplicatedRule = start\n        ")}catch(t){expect$g(t).with.property("stage","check"),expect$g(t).with.property("problems").to.be.an("array"),t.problems.forEach((function(e){expect$g(e).to.be.an("array").lengthOf.gte(2),expect$g(e[0]).to.be.oneOf(["error","warning","info"])}));var e=t.problems.filter((function(e){return"error"===e[0]})).map((function(e){return e[1]}));expect$g(e).to.include.members(['Rule "missingRule" is not defined','Rule "duplicatedRule" is already defined','Label "duplicatedLabel" is already defined',"Possible infinite loop when parsing (left recursion: duplicatedRule -> start -> leftRecursion -> duplicatedRule)"])}}))}))}));var name="peggy",version="2.0.1",description="Parser generator for JavaScript",keywords=["grammar","parser generator","PEG","PEG.js"],homepage="https://peggyjs.org/",repository="peggyjs/peggy",bugs="https://github.com/peggyjs/peggy/issues",license="MIT",author="David Majda <david@majda.cz> (https://majda.cz/)",main="lib/peg.js",unpkg="browser/peggy.min.js",jsdelivr="browser/peggy.min.js",types="lib/peg.d.ts",bin={peggy:"bin/peggy.js"},scripts={clean:"rimraf build browser bin/*.map && mkdir browser",parser:"node bin/peggy.js -o lib/parser.js --format commonjs src/parser.pegjs",examples:"node bin/peggy.js -c docs/js/options.js docs/js/examples.peggy",set_version:"node ./tools/set_version",lint:"eslint . --ext js,ts,mjs",ts:"tsc --build tsconfig.json",docs:"cd docs && npm run build",test:"jest","test:web":"cd web-test && npm test","test:all":"npm run test && npm run test:web",benchmark:"node ./benchmark/run_bench.js",rollup:"copyfiles package.json build/ts && rollup -c",terser:"npm run terser:peggy && npm run terser:tests && npm run terser:bench","terser:peggy":"terser -c passes=2 -m reserved=['GrammarLocation'] --sequences 40 build/rollup/peggy.umd.js -o build/peggy.min.js","terser:tests":"terser -c passes=2 -m --sequences 40 --module build/rollup/test.umd.js -o build/test-bundle.min.js","terser:bench":"terser -c passes=2 -m --sequences 40 --module build/rollup/benchmark.umd.js -o build/benchmark-bundle.min.js",headers:"node ./tools/header.js build/peggy.min.js build/benchmark-bundle.min.js build/test-bundle.min.js",deploy:"npm run deploy:peggy && npm run deploy:tests && npm run deploy:bench",coverage:"npm run rollup && npm run parser -- -m inline && npm test","deploy:peggy":"copyfiles -f build/peggy.min.js docs/vendor/peggy/ && copyfiles -f build/peggy.min.js browser/","deploy:tests":"copyfiles -f build/test-bundle.min.js docs/js/","deploy:bench":"copyfiles -f build/benchmark-bundle.min.js docs/js/",build:"npm run build:notidy && npm run tidy","build:notidy":"npm run setup && npm run make && npm run lint && npm run audit",setup:"npm run clean && npm run set_version",make:"npm run parser && npm run ts && npm run rollup && npm run terser && npm run examples && npm run docs && npm run headers && npm run deploy",audit:"npm run test && npm run benchmark",tidy:"rimraf -f build",start:"cd docs && npm start"},devDependencies={"@peggyjs/eslint-config":"^3.0.0","@rollup/plugin-commonjs":"^22.0.1","@rollup/plugin-json":"^4.1.0","@rollup/plugin-multi-entry":"^4.1.0","@rollup/plugin-node-resolve":"^13.3.0","@rollup/plugin-typescript":"^8.3.4","@types/chai":"^4.3.1","@types/jest":"^28.1.6","@types/node":"^18.6.2","@typescript-eslint/eslint-plugin":"^5.31.0","@typescript-eslint/parser":"^5.31.0",chai:"^4.3.6","chai-like":"^1.1.1",copyfiles:"^2.4.1",eslint:"^8.20.0",express:"4.18.1",jest:"^28.1.3",rimraf:"^3.0.2",rollup:"^2.77.2","rollup-plugin-ignore":"1.0.10","source-map":"^0.8.0-beta.0",terser:"^5.14.2","ts-jest":"^28.0.7",tsd:"^0.22.0",tslib:"^2.4.0",typescript:"^4.7.4"},dependencies={commander:"^9.4.0","source-map-generator":"0.8.0"},tsd={directory:"test/types"},engines={node:">=10"},require$$2={name:name,version:version,description:description,keywords:keywords,homepage:homepage,repository:repository,bugs:bugs,license:license,author:author,main:main,unpkg:unpkg,jsdelivr:jsdelivr,types:types,bin:bin,scripts:scripts,devDependencies:devDependencies,dependencies:dependencies,tsd:tsd,engines:engines},sourceMap={},sourceMapGenerator={},base64Vlq={},base64$2={};const intToCharMap="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");base64$2.encode=function(e){if(0<=e&&e<intToCharMap.length)return intToCharMap[e];throw new TypeError("Must be between 0 and 63: "+e)};const base64$1=base64$2,VLQ_BASE_SHIFT=5,VLQ_BASE=1<<VLQ_BASE_SHIFT,VLQ_BASE_MASK=VLQ_BASE-1,VLQ_CONTINUATION_BIT=VLQ_BASE;function toVLQSigned(e){return e<0?1+(-e<<1):0+(e<<1)}base64Vlq.encode=function(e){let t,r="",n=toVLQSigned(e);do{t=n&VLQ_BASE_MASK,n>>>=VLQ_BASE_SHIFT,n>0&&(t|=VLQ_CONTINUATION_BIT),r+=base64$1.encode(t)}while(n>0);return r};var util$4={},urlBrowser=require$$0__default$1.default.URL;const URL$1=urlBrowser;function getArg(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')}util$4.getArg=getArg;const supportsNullProto=!("__proto__"in Object.create(null));function identity(e){return e}function toSetString(e){return isProtoString(e)?"$"+e:e}function fromSetString(e){return isProtoString(e)?e.slice(1):e}function isProtoString(e){if(!e)return!1;const t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(let r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function strcmp(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}function compareByGeneratedPositionsInflated(e,t){let r=e.generatedLine-t.generatedLine;return 0!==r?r:(r=e.generatedColumn-t.generatedColumn,0!==r?r:(r=strcmp(e.source,t.source),0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r?r:strcmp(e.name,t.name)))))}function parseSourceMapInput(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))}util$4.toSetString=supportsNullProto?identity:toSetString,util$4.fromSetString=supportsNullProto?identity:fromSetString,util$4.compareByGeneratedPositionsInflated=compareByGeneratedPositionsInflated,util$4.parseSourceMapInput=parseSourceMapInput;const PROTOCOL="http:",PROTOCOL_AND_HOST=`${PROTOCOL}//host`;function createSafeHandler(e){return t=>{const r=getURLType(t),n=buildSafeBase(t),a=new URL$1(t,n);e(a);const o=a.toString();return"absolute"===r?o:"scheme-relative"===r?o.slice(PROTOCOL.length):"path-absolute"===r?o.slice(PROTOCOL_AND_HOST.length):computeRelativeURL(n,o)}}function withBase(e,t){return new URL$1(e,t).toString()}function buildUniqueSegment(e,t){let r=0;for(;;){const n=e+r++;if(-1===t.indexOf(n))return n}}function buildSafeBase(e){const t=e.split("..").length-1,r=buildUniqueSegment("p",e);let n=`${PROTOCOL_AND_HOST}/`;for(let e=0;e<t;e++)n+=`${r}/`;return n}const ABSOLUTE_SCHEME=/^[A-Za-z0-9\+\-\.]+:/;function getURLType(e){return"/"===e[0]?"/"===e[1]?"scheme-relative":"path-absolute":ABSOLUTE_SCHEME.test(e)?"absolute":"path-relative"}function computeRelativeURL(e,t){"string"==typeof e&&(e=new URL$1(e)),"string"==typeof t&&(t=new URL$1(t));const r=t.pathname.split("/"),n=e.pathname.split("/");for(n.length>0&&!n[n.length-1]&&n.pop();r.length>0&&n.length>0&&r[0]===n[0];)r.shift(),n.shift();return n.map((()=>"..")).concat(r).join("/")+t.search+t.hash}const ensureDirectory=createSafeHandler((e=>{e.pathname=e.pathname.replace(/\/?$/,"/")})),trimFilename=createSafeHandler((e=>{e.href=new URL$1(".",e.toString()).toString()})),normalize=createSafeHandler((e=>{}));function join(e,t){const r=getURLType(t),n=getURLType(e);if(e=ensureDirectory(e),"absolute"===r)return withBase(t,void 0);if("absolute"===n)return withBase(t,e);if("scheme-relative"===r)return normalize(t);if("scheme-relative"===n)return withBase(t,withBase(e,PROTOCOL_AND_HOST)).slice(PROTOCOL.length);if("path-absolute"===r)return normalize(t);if("path-absolute"===n)return withBase(t,withBase(e,PROTOCOL_AND_HOST)).slice(PROTOCOL_AND_HOST.length);const a=buildSafeBase(t+e);return computeRelativeURL(a,withBase(t,withBase(e,a)))}function relative(e,t){const r=relativeIfPossible(e,t);return"string"==typeof r?r:normalize(t)}function relativeIfPossible(e,t){if(getURLType(e)!==getURLType(t))return null;const r=buildSafeBase(e+t),n=new URL$1(e,r),a=new URL$1(t,r);try{new URL$1("",a.toString())}catch(e){return null}return a.protocol!==n.protocol||a.user!==n.user||a.password!==n.password||a.hostname!==n.hostname||a.port!==n.port?null:computeRelativeURL(n,a)}function computeSourceURL(e,t,r){e&&"path-absolute"===getURLType(t)&&(t=t.replace(/^\//,""));let n=normalize(t||"");return e&&(n=join(e,n)),r&&(n=join(trimFilename(r),n)),n}util$4.normalize=normalize,util$4.join=join,util$4.relative=relative,util$4.computeSourceURL=computeSourceURL;var arraySet={};class ArraySet$2{constructor(){this._array=[],this._set=new Map}static fromArray(e,t){const r=new ArraySet$2;for(let n=0,a=e.length;n<a;n++)r.add(e[n],t);return r}size(){return this._set.size}add(e,t){const r=this.has(e),n=this._array.length;r&&!t||this._array.push(e),r||this._set.set(e,n)}has(e){return this._set.has(e)}indexOf(e){const t=this._set.get(e);if(t>=0)return t;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}}arraySet.ArraySet=ArraySet$2;var mappingList={};const util$3=util$4;function generatedPositionAfter(e,t){const r=e.generatedLine,n=t.generatedLine,a=e.generatedColumn,o=t.generatedColumn;return n>r||n==r&&o>=a||util$3.compareByGeneratedPositionsInflated(e,t)<=0}class MappingList$1{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,t){this._array.forEach(e,t)}add(e){generatedPositionAfter(this._last,e)?(this._last=e,this._array.push(e)):(this._sorted=!1,this._array.push(e))}toArray(){return this._sorted||(this._array.sort(util$3.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}}mappingList.MappingList=MappingList$1;const base64VLQ=base64Vlq,util$2=util$4,ArraySet$1=arraySet.ArraySet,MappingList=mappingList.MappingList;class SourceMapGenerator$1{constructor(e){e||(e={}),this._file=util$2.getArg(e,"file",null),this._sourceRoot=util$2.getArg(e,"sourceRoot",null),this._skipValidation=util$2.getArg(e,"skipValidation",!1),this._sources=new ArraySet$1,this._names=new ArraySet$1,this._mappings=new MappingList,this._sourcesContents=null}static fromSourceMap(e){const t=e.sourceRoot,r=new SourceMapGenerator$1({file:e.file,sourceRoot:t});return e.eachMapping((function(e){const n={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(n.source=e.source,null!=t&&(n.source=util$2.relative(t,n.source)),n.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(n.name=e.name)),r.addMapping(n)})),e.sources.forEach((function(n){let a=n;null!==t&&(a=util$2.relative(t,n)),r._sources.has(a)||r._sources.add(a);const o=e.sourceContentFor(n);null!=o&&r.setSourceContent(n,o)})),r}addMapping(e){const t=util$2.getArg(e,"generated"),r=util$2.getArg(e,"original",null);let n=util$2.getArg(e,"source",null),a=util$2.getArg(e,"name",null);this._skipValidation||this._validateMapping(t,r,n,a),null!=n&&(n=String(n),this._sources.has(n)||this._sources.add(n)),null!=a&&(a=String(a),this._names.has(a)||this._names.add(a)),this._mappings.add({generatedLine:t.line,generatedColumn:t.column,originalLine:null!=r&&r.line,originalColumn:null!=r&&r.column,source:n,name:a})}setSourceContent(e,t){let r=e;null!=this._sourceRoot&&(r=util$2.relative(this._sourceRoot,r)),null!=t?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[util$2.toSetString(r)]=t):this._sourcesContents&&(delete this._sourcesContents[util$2.toSetString(r)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))}applySourceMap(e,t,r){let n=t;if(null==t){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');n=e.file}const a=this._sourceRoot;null!=a&&(n=util$2.relative(a,n));const o=this._mappings.toArray().length>0?new ArraySet$1:this._sources,s=new ArraySet$1;this._mappings.unsortedForEach((function(t){if(t.source===n&&null!=t.originalLine){const n=e.originalPositionFor({line:t.originalLine,column:t.originalColumn});null!=n.source&&(t.source=n.source,null!=r&&(t.source=util$2.join(r,t.source)),null!=a&&(t.source=util$2.relative(a,t.source)),t.originalLine=n.line,t.originalColumn=n.column,null!=n.name&&(t.name=n.name))}const u=t.source;null==u||o.has(u)||o.add(u);const i=t.name;null==i||s.has(i)||s.add(i)}),this),this._sources=o,this._names=s,e.sources.forEach((function(t){const n=e.sourceContentFor(t);null!=n&&(null!=r&&(t=util$2.join(r,t)),null!=a&&(t=util$2.relative(a,t)),this.setSourceContent(t,n))}),this)}_validateMapping(e,t,r,n){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!t&&!r&&!n);else if(!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:n}))}_serializeMappings(){let e,t,r,n,a=0,o=1,s=0,u=0,i=0,c=0,l="";const p=this._mappings.toArray();for(let f=0,d=p.length;f<d;f++){if(t=p[f],e="",t.generatedLine!==o)for(a=0;t.generatedLine!==o;)e+=";",o++;else if(f>0){if(!util$2.compareByGeneratedPositionsInflated(t,p[f-1]))continue;e+=","}e+=base64VLQ.encode(t.generatedColumn-a),a=t.generatedColumn,null!=t.source&&(n=this._sources.indexOf(t.source),e+=base64VLQ.encode(n-c),c=n,e+=base64VLQ.encode(t.originalLine-1-u),u=t.originalLine-1,e+=base64VLQ.encode(t.originalColumn-s),s=t.originalColumn,null!=t.name&&(r=this._names.indexOf(t.name),e+=base64VLQ.encode(r-i),i=r)),l+=e}return l}_generateSourcesContent(e,t){return e.map((function(e){if(!this._sourcesContents)return null;null!=t&&(e=util$2.relative(t,e));const r=util$2.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,r)?this._sourcesContents[r]:null}),this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}}SourceMapGenerator$1.prototype._version=3,sourceMapGenerator.SourceMapGenerator=SourceMapGenerator$1;var sourceMapConsumer={},binarySearch$1={};!function(e){function t(r,n,a,o,s,u){const i=Math.floor((n-r)/2)+r,c=s(a,o[i],!0);return 0===c?i:c>0?n-i>1?t(i,n,a,o,s,u):u==e.LEAST_UPPER_BOUND?n<o.length?n:-1:i:i-r>1?t(r,i,a,o,s,u):u==e.LEAST_UPPER_BOUND?i:r<0?-1:r}e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(r,n,a,o){if(0===n.length)return-1;let s=t(-1,n.length,r,n,a,o||e.GREATEST_LOWER_BOUND);if(s<0)return-1;for(;s-1>=0&&0===a(n[s],n[s-1],!0);)--s;return s}}(binarySearch$1);var readWasmBrowser={exports:{}};let mappingsWasm=null;readWasmBrowser.exports=function(){if("string"==typeof mappingsWasm)return fetch(mappingsWasm).then((e=>e.arrayBuffer()));if(mappingsWasm instanceof ArrayBuffer)return Promise.resolve(mappingsWasm);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},readWasmBrowser.exports.initialize=e=>{mappingsWasm=e};const readWasm$1=readWasmBrowser.exports;function Mapping(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let cachedWasm=null;var wasm$1=function(){if(cachedWasm)return cachedWasm;const e=[];return cachedWasm=readWasm$1().then((t=>WebAssembly.instantiate(t,{env:{mapping_callback(t,r,n,a,o,s,u,i,c,l){const p=new Mapping;p.generatedLine=t+1,p.generatedColumn=r,n&&(p.lastGeneratedColumn=a-1),o&&(p.source=s,p.originalLine=u+1,p.originalColumn=i,c&&(p.name=l)),e[e.length-1](p)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}}))).then((t=>({exports:t.instance.exports,withMappingCallback:(t,r)=>{e.push(t);try{r()}finally{e.pop()}}}))).then(null,(e=>{throw cachedWasm=null,e})),cachedWasm};const util$1=util$4,binarySearch=binarySearch$1,ArraySet=arraySet.ArraySet,readWasm=readWasmBrowser.exports,wasm=wasm$1,INTERNAL=Symbol("smcInternal");class SourceMapConsumer$1{constructor(e,t){return e==INTERNAL?Promise.resolve(this):_factory(e,t)}static initialize(e){readWasm.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,t){return _factoryBSM(e,t)}static async with(e,t,r){const n=await new SourceMapConsumer$1(e,t);try{return await r(n)}finally{n.destroy()}}eachMapping(e,t,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}SourceMapConsumer$1.prototype._version=3,SourceMapConsumer$1.GENERATED_ORDER=1,SourceMapConsumer$1.ORIGINAL_ORDER=2,SourceMapConsumer$1.GREATEST_LOWER_BOUND=1,SourceMapConsumer$1.LEAST_UPPER_BOUND=2,sourceMapConsumer.SourceMapConsumer=SourceMapConsumer$1;class BasicSourceMapConsumer extends SourceMapConsumer$1{constructor(e,t){return super(INTERNAL).then((r=>{let n=e;"string"==typeof e&&(n=util$1.parseSourceMapInput(e));const a=util$1.getArg(n,"version"),o=util$1.getArg(n,"sources").map(String),s=util$1.getArg(n,"names",[]),u=util$1.getArg(n,"sourceRoot",null),i=util$1.getArg(n,"sourcesContent",null),c=util$1.getArg(n,"mappings"),l=util$1.getArg(n,"file",null);if(a!=r._version)throw new Error("Unsupported version: "+a);return r._sourceLookupCache=new Map,r._names=ArraySet.fromArray(s.map(String),!0),r._sources=ArraySet.fromArray(o,!0),r._absoluteSources=ArraySet.fromArray(r._sources.toArray().map((function(e){return util$1.computeSourceURL(u,e,t)})),!0),r.sourceRoot=u,r.sourcesContent=i,r._mappings=c,r._sourceMapURL=t,r.file=l,r._computedColumnSpans=!1,r._mappingsPtr=0,r._wasm=null,wasm().then((e=>(r._wasm=e,r)))}))}_findSourceIndex(e){const t=this._sourceLookupCache.get(e);if("number"==typeof t)return t;const r=util$1.computeSourceURL(null,e,this._sourceMapURL);if(this._absoluteSources.has(r)){const t=this._absoluteSources.indexOf(r);return this._sourceLookupCache.set(e,t),t}const n=util$1.computeSourceURL(this.sourceRoot,e,this._sourceMapURL);if(this._absoluteSources.has(n)){const t=this._absoluteSources.indexOf(n);return this._sourceLookupCache.set(e,t),t}return-1}static fromSourceMap(e,t){return new BasicSourceMapConsumer(e.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return 0===this._mappingsPtr&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const e=this._mappings,t=e.length,r=this._wasm.exports.allocate_mappings(t),n=new Uint8Array(this._wasm.exports.memory.buffer,r,t);for(let r=0;r<t;r++)n[r]=e.charCodeAt(r);const a=this._wasm.exports.parse_mappings(r);if(!a){const e=this._wasm.exports.get_last_error();let t=`Error parsing mappings (code ${e}): `;switch(e){case 1:t+="the mappings contained a negative line, column, source index, or name index";break;case 2:t+="the mappings contained a number larger than 2**32";break;case 3:t+="reached EOF while in the middle of parsing a VLQ";break;case 4:t+="invalid base 64 character while parsing a VLQ";break;default:t+="unknown error code"}throw new Error(t)}this._mappingsPtr=a}eachMapping(e,t,r){const n=t||null,a=r||SourceMapConsumer$1.GENERATED_ORDER;this._wasm.withMappingCallback((t=>{null!==t.source&&(t.source=this._absoluteSources.at(t.source),null!==t.name&&(t.name=this._names.at(t.name))),this._computedColumnSpans&&null===t.lastGeneratedColumn&&(t.lastGeneratedColumn=1/0),e.call(n,t)}),(()=>{switch(a){case SourceMapConsumer$1.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case SourceMapConsumer$1.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}}))}allGeneratedPositionsFor(e){let t=util$1.getArg(e,"source");const r=util$1.getArg(e,"line"),n=e.column||0;if(t=this._findSourceIndex(t),t<0)return[];if(r<1)throw new Error("Line numbers must be >= 1");if(n<0)throw new Error("Column numbers must be >= 0");const a=[];return this._wasm.withMappingCallback((e=>{let t=e.lastGeneratedColumn;this._computedColumnSpans&&null===t&&(t=1/0),a.push({line:e.generatedLine,column:e.generatedColumn,lastColumn:t})}),(()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),t,r-1,"column"in e,n)})),a}destroy(){0!==this._mappingsPtr&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(e){const t={generatedLine:util$1.getArg(e,"line"),generatedColumn:util$1.getArg(e,"column")};if(t.generatedLine<1)throw new Error("Line numbers must be >= 1");if(t.generatedColumn<0)throw new Error("Column numbers must be >= 0");let r,n=util$1.getArg(e,"bias",SourceMapConsumer$1.GREATEST_LOWER_BOUND);if(null==n&&(n=SourceMapConsumer$1.GREATEST_LOWER_BOUND),this._wasm.withMappingCallback((e=>r=e),(()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),t.generatedLine-1,t.generatedColumn,n)})),r&&r.generatedLine===t.generatedLine){let e=util$1.getArg(r,"source",null);null!==e&&(e=this._absoluteSources.at(e));let t=util$1.getArg(r,"name",null);return null!==t&&(t=this._names.at(t)),{source:e,line:util$1.getArg(r,"originalLine",null),column:util$1.getArg(r,"originalColumn",null),name:t}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e}))}sourceContentFor(e,t){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(e){let t=util$1.getArg(e,"source");if(t=this._findSourceIndex(t),t<0)return{line:null,column:null,lastColumn:null};const r={source:t,originalLine:util$1.getArg(e,"line"),originalColumn:util$1.getArg(e,"column")};if(r.originalLine<1)throw new Error("Line numbers must be >= 1");if(r.originalColumn<0)throw new Error("Column numbers must be >= 0");let n,a=util$1.getArg(e,"bias",SourceMapConsumer$1.GREATEST_LOWER_BOUND);if(null==a&&(a=SourceMapConsumer$1.GREATEST_LOWER_BOUND),this._wasm.withMappingCallback((e=>n=e),(()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),r.source,r.originalLine-1,r.originalColumn,a)})),n&&n.source===r.source){let e=n.lastGeneratedColumn;return this._computedColumnSpans&&null===e&&(e=1/0),{line:util$1.getArg(n,"generatedLine",null),column:util$1.getArg(n,"generatedColumn",null),lastColumn:e}}return{line:null,column:null,lastColumn:null}}}BasicSourceMapConsumer.prototype.consumer=SourceMapConsumer$1,sourceMapConsumer.BasicSourceMapConsumer=BasicSourceMapConsumer;class IndexedSourceMapConsumer extends SourceMapConsumer$1{constructor(e,t){return super(INTERNAL).then((r=>{let n=e;"string"==typeof e&&(n=util$1.parseSourceMapInput(e));const a=util$1.getArg(n,"version"),o=util$1.getArg(n,"sections");if(a!=r._version)throw new Error("Unsupported version: "+a);let s={line:-1,column:0};return Promise.all(o.map((e=>{if(e.url)throw new Error("Support for url field in sections not implemented.");const r=util$1.getArg(e,"offset"),n=util$1.getArg(r,"line"),a=util$1.getArg(r,"column");if(n<s.line||n===s.line&&a<s.column)throw new Error("Section offsets must be ordered and non-overlapping.");return s=r,new SourceMapConsumer$1(util$1.getArg(e,"map"),t).then((e=>({generatedOffset:{generatedLine:n+1,generatedColumn:a+1},consumer:e})))}))).then((e=>(r._sections=e,r)))}))}get sources(){const e=[];for(let t=0;t<this._sections.length;t++)for(let r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}originalPositionFor(e){const t={generatedLine:util$1.getArg(e,"line"),generatedColumn:util$1.getArg(e,"column")},r=binarySearch.search(t,this._sections,(function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn})),n=this._sections[r];return n?n.consumer.originalPositionFor({line:t.generatedLine-(n.generatedOffset.generatedLine-1),column:t.generatedColumn-(n.generatedOffset.generatedLine===t.generatedLine?n.generatedOffset.generatedColumn-1:0),bias:e.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))}sourceContentFor(e,t){for(let t=0;t<this._sections.length;t++){const r=this._sections[t].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')}_findSectionIndex(e){for(let t=0;t<this._sections.length;t++){const{consumer:r}=this._sections[t];if(-1!==r._findSourceIndex(e))return t}return-1}generatedPositionFor(e){const t=this._findSectionIndex(util$1.getArg(e,"source")),r=t>=0?this._sections[t]:null,n=t>=0&&t+1<this._sections.length?this._sections[t+1]:null,a=r&&r.consumer.generatedPositionFor(e);if(a&&null!==a.line){const e=r.generatedOffset.generatedLine-1,t=r.generatedOffset.generatedColumn-1;return 1===a.line&&(a.column+=t,"number"==typeof a.lastColumn&&(a.lastColumn+=t)),a.lastColumn===1/0&&n&&a.line===n.generatedOffset.generatedLine&&(a.lastColumn=n.generatedOffset.generatedColumn-2),a.line+=e,a}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(e){const t=this._findSectionIndex(util$1.getArg(e,"source")),r=t>=0?this._sections[t]:null,n=t>=0&&t+1<this._sections.length?this._sections[t+1]:null;return r?r.consumer.allGeneratedPositionsFor(e).map((e=>{const t=r.generatedOffset.generatedLine-1,a=r.generatedOffset.generatedColumn-1;return 1===e.line&&(e.column+=a,"number"==typeof e.lastColumn&&(e.lastColumn+=a)),e.lastColumn===1/0&&n&&e.line===n.generatedOffset.generatedLine&&(e.lastColumn=n.generatedOffset.generatedColumn-2),e.line+=t,e})):[]}eachMapping(e,t,r){this._sections.forEach(((n,a)=>{const o=a+1<this._sections.length?this._sections[a+1]:null,{generatedOffset:s}=n,u=s.generatedLine-1,i=s.generatedColumn-1;n.consumer.eachMapping((function(t){1===t.generatedLine&&(t.generatedColumn+=i,"number"==typeof t.lastGeneratedColumn&&(t.lastGeneratedColumn+=i)),t.lastGeneratedColumn===1/0&&o&&t.generatedLine===o.generatedOffset.generatedLine&&(t.lastGeneratedColumn=o.generatedOffset.generatedColumn-2),t.generatedLine+=u,e.call(this,t)}),t,r)}))}computeColumnSpans(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.computeColumnSpans()}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}function _factory(e,t){let r=e;"string"==typeof e&&(r=util$1.parseSourceMapInput(e));const n=null!=r.sections?new IndexedSourceMapConsumer(r,t):new BasicSourceMapConsumer(r,t);return Promise.resolve(n)}function _factoryBSM(e,t){return BasicSourceMapConsumer.fromSourceMap(e,t)}sourceMapConsumer.IndexedSourceMapConsumer=IndexedSourceMapConsumer;var sourceNode={};const SourceMapGenerator=sourceMapGenerator.SourceMapGenerator,util=util$4,REGEX_NEWLINE=/(\r?\n)/,NEWLINE_CODE=10,isSourceNode="$$$isSourceNode$$$";class SourceNode$1{constructor(e,t,r,n,a){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==a?null:a,this[isSourceNode]=!0,null!=n&&this.add(n)}static fromStringWithSourceMap(e,t,r){const n=new SourceNode$1,a=e.split(REGEX_NEWLINE);let o=0;const s=function(){return e()+(e()||"");function e(){return o<a.length?a[o++]:void 0}};let u,i=1,c=0,l=null;return t.eachMapping((function(e){if(null!==l){if(!(i<e.generatedLine)){u=a[o]||"";const t=u.substr(0,e.generatedColumn-c);return a[o]=u.substr(e.generatedColumn-c),c=e.generatedColumn,p(l,t),void(l=e)}p(l,s()),i++,c=0}for(;i<e.generatedLine;)n.add(s()),i++;c<e.generatedColumn&&(u=a[o]||"",n.add(u.substr(0,e.generatedColumn)),a[o]=u.substr(e.generatedColumn),c=e.generatedColumn),l=e}),this),o<a.length&&(l&&p(l,s()),n.add(a.splice(o).join(""))),t.sources.forEach((function(e){const a=t.sourceContentFor(e);null!=a&&(null!=r&&(e=util.join(r,e)),n.setSourceContent(e,a))})),n;function p(e,t){if(null===e||void 0===e.source)n.add(t);else{const a=r?util.join(r,e.source):e.source;n.add(new SourceNode$1(e.originalLine,e.originalColumn,a,t,e.name))}}}add(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[isSourceNode]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this}prepend(e){if(Array.isArray(e))for(let t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[isSourceNode]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this}walk(e){let t;for(let r=0,n=this.children.length;r<n;r++)t=this.children[r],t[isSourceNode]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let t,r;const n=this.children.length;if(n>0){for(t=[],r=0;r<n-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this}replaceRight(e,t){const r=this.children[this.children.length-1];return r[isSourceNode]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this}setSourceContent(e,t){this.sourceContents[util.toSetString(e)]=t}walkSourceContents(e){for(let t=0,r=this.children.length;t<r;t++)this.children[t][isSourceNode]&&this.children[t].walkSourceContents(e);const t=Object.keys(this.sourceContents);for(let r=0,n=t.length;r<n;r++)e(util.fromSetString(t[r]),this.sourceContents[t[r]])}toString(){let e="";return this.walk((function(t){e+=t})),e}toStringWithSourceMap(e){const t={code:"",line:1,column:0},r=new SourceMapGenerator(e);let n=!1,a=null,o=null,s=null,u=null;return this.walk((function(e,i){t.code+=e,null!==i.source&&null!==i.line&&null!==i.column?(a===i.source&&o===i.line&&s===i.column&&u===i.name||r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name}),a=i.source,o=i.line,s=i.column,u=i.name,n=!0):n&&(r.addMapping({generated:{line:t.line,column:t.column}}),a=null,n=!1);for(let o=0,s=e.length;o<s;o++)e.charCodeAt(o)===NEWLINE_CODE?(t.line++,t.column=0,o+1===s?(a=null,n=!1):n&&r.addMapping({source:i.source,original:{line:i.line,column:i.column},generated:{line:t.line,column:t.column},name:i.name})):t.column++})),this.walkSourceContents((function(e,t){r.setSourceContent(e,t)})),{code:t.code,map:r}}}sourceNode.SourceNode=SourceNode$1,sourceMap.SourceMapGenerator=sourceMapGenerator.SourceMapGenerator,sourceMap.SourceMapConsumer=sourceMapConsumer.SourceMapConsumer,sourceMap.SourceNode=sourceNode.SourceNode;var chaiLike$1={exports:{}},chaiLike={exports:{}},hasRequiredChaiLike$1,hasRequiredChaiLike;function requireChaiLike$1(){if(hasRequiredChaiLike$1)return chaiLike.exports;hasRequiredChaiLike$1=1;let e=[];return chaiLike.exports=function(t,r){function n(e,t){return r.type(t).toUpperCase()===e.toUpperCase()}function a(t,r){for(let n of e)if(n.match(t,r))return n.assert(t,r);if(t===r)return!0;if(n("object",r)&&n("object",t)){for(let e of Object.keys(r)){if(!(e in t))return!1;if(!a(t[e],r[e]))return!1}return!0}if(n("array",r)&&n("array",t)){if(t.length!==r.length)return!1;for(let e=0;e<r.length;e++)if(!a(t[e],r[e]))return!1;return!0}return n("RegExp",t)&&n("RegExp",r)?t.toString()===r.toString():n("Date",t)&&n("Date",r)?t.getTime()===r.getTime():!!(n("string",t)&&n("string",r)||n("number",t)&&n("number",r)||n("boolean",t)&&n("boolean",r))&&t==r}t.Assertion.addMethod("like",(function(e){let n=r.flag(this,"object");this.assert(a(n,e),"expected #{this} to be like #{exp}","expected #{this} to not like #{exp}",e,n,t.config.showDiff)}))},chaiLike.exports.extend=function(t){e.push(t)},chaiLike.exports.clearPlugins=function(){e=[]},chaiLike.exports}function requireChaiLike(){return hasRequiredChaiLike||(hasRequiredChaiLike=1,function(e){e.exports=requireChaiLike$1()}(chaiLike$1)),chaiLike$1.exports}var chai$f=require$$0__default.default,peg$1=peg_1,pkg=require$$2,SourceMapConsumer=sourceMap.SourceMapConsumer,spy=utils.spy,peggyVersion=function(){return peg$1.VERSION};chai$f.use(requireChaiLike()),beforeEach((function(){return"undefined"!=typeof window?SourceMapConsumer.initialize({"lib/mappings.wasm":"https://raw.githubusercontent.com/mozilla/source-map/0.7.3/lib/mappings.wasm"}):null}));var expect$f=chai$f.expect;describe("Peggy API",(function(){it("has the correct VERSION",(function(){expect$f(peg$1.VERSION).to.equal(pkg.version)})),describe("generate",(function(){it("generates a parser",(function(){var e=peg$1.generate("start = 'a'");expect$f(e).to.be.an("object"),expect$f(e.parse("a")).to.equal("a")})),it("throws an exception on syntax error",(function(){expect$f((function(){peg$1.generate("start = @")})).to.throw()})),it("throws an exception on semantic error",(function(){expect$f((function(){peg$1.generate("start = undefined")})).to.throw()})),describe("allowed start rules",(function(){var e=["a = 'x'","b = 'x'","c = 'x'"].join("\n");describe("when |allowedStartRules| is not set",(function(){it("generated parser can start only from the first rule",(function(){var t=peg$1.generate(e);expect$f(t.parse("x",{startRule:"a"})).to.equal("x"),expect$f((function(){t.parse("x",{startRule:"b"})})).to.throw(),expect$f((function(){t.parse("x",{startRule:"c"})})).to.throw()}))})),describe("when |allowedStartRules| is set",(function(){it("generated parser can start only from specified rules",(function(){var t=peg$1.generate(e,{allowedStartRules:["b","c"]});expect$f((function(){t.parse("x",{startRule:"a"})})).to.throw(),expect$f(t.parse("x",{startRule:"b"})).to.equal("x"),expect$f(t.parse("x",{startRule:"c"})).to.equal("x")}))}))})),describe("intermediate results caching",(function(){var e=["{ var n = 0; }","start = (a 'b') / (a 'c') { return n; }","a = 'a' { n++; }"].join("\n");describe("when |cache| is not set",(function(){it("generated parser doesn't cache intermediate parse results",(function(){var t=peg$1.generate(e);expect$f(t.parse("ac")).to.equal(2)}))})),describe("when |cache| is set to |false|",(function(){it("generated parser doesn't cache intermediate parse results",(function(){var t=peg$1.generate(e,{cache:!1});expect$f(t.parse("ac")).to.equal(2)}))})),describe("when |cache| is set to |true|",(function(){it("generated parser caches intermediate parse results",(function(){var t=peg$1.generate(e,{cache:!0});expect$f(t.parse("ac")).to.equal(1)}))}))})),describe("tracing",(function(){var e="start = 'a'";describe("when |trace| is not set",(function(){it("generated parser doesn't trace",(function(){var t=peg$1.generate(e),r={trace:spy()};t.parse("a",{tracer:r}),expect$f(r.trace.called).to.equal(!1)}))})),describe("when |trace| is set to |false|",(function(){it("generated parser doesn't trace",(function(){var t=peg$1.generate(e,{trace:!1}),r={trace:spy()};t.parse("a",{tracer:r}),expect$f(r.trace.called).to.equal(!1)}))})),describe("when |trace| is set to |true|",(function(){it("generated parser traces",(function(){var t=peg$1.generate(e,{trace:!0}),r={trace:spy()};t.parse("a",{tracer:r}),expect$f(r.trace.called).to.equal(!0)}))}))})),describe("output",(function(){var grammar="start = 'a'";describe("when |output| is not set",(function(){it("returns generated parser object",(function(){var e=peg$1.generate(grammar);expect$f(e).to.be.an("object"),expect$f(e.parse("a")).to.equal("a")}))})),describe('when |output| is set to |"parser"|',(function(){it("returns generated parser object",(function(){var e=peg$1.generate(grammar,{output:"parser"});expect$f(e).to.be.an("object"),expect$f(e.parse("a")).to.equal("a")}))})),describe('when |output| is set to |"source"|',(function(){it("returns generated parser source code",(function(){var source=peg$1.generate(grammar,{output:"source"});expect$f(source).to.be.a("string"),expect$f(eval(source).parse("a")).to.equal("a")}))})),describe('when |output| is set to |"ast"|',(function(){it("returns generated parser AST",(function(){var e=peg$1.generate(grammar,{output:"ast"});expect$f(e).to.be.an("object"),expect$f(e).to.be.like(peg$1.parser.parse(grammar))}))}))})),describe("reserved words",(function(){describe("throws an exception on reserved JS words used as a label",(function(){for(var e=function(e){it(e,(function(){expect$f((function(){peg$1.generate(["start = "+e+":end","end = 'a'"].join("\n"),{output:"source"})})).to.throw(peg$1.parser.SyntaxError)}))},t=0,r=peg$1.RESERVED_WORDS;t<r.length;t++)e(r[t])})),describe("does not throws an exception on reserved JS words used as a rule name",(function(){for(var e=function(e){it(e,(function(){expect$f((function(){peg$1.generate(["start = "+e,e+" = 'a'"].join("\n"),{output:"source"})})).to.not.throw(peg$1.parser.SyntaxError)}))},t=0,r=peg$1.RESERVED_WORDS;t<r.length;t++)e(r[t])}))})),it("accepts custom options",(function(){peg$1.generate("start = 'a'",{grammarSource:42})})),describe("generates source map",(function(){function e(e,t,r){for(var n=t instanceof RegExp?e.search(t):e.indexOf(t),a=1,o=0,s=0;s<n;++s)10===e.charCodeAt(s)?(++a,o=0):++o;if(r&&r.offset){var u=r.offset({line:a,column:o,offset:n});return delete u.offset,u}return{line:a,column:o}}var t="GLOBAL\nINITIALIZER",r="PER-PARSE\nINITIALIZER",n="NOT\nBLOCK",a="AND\nBLOCK",o="ACTION\nBLOCK",s="\n        {{".concat(t,"}}\n        {").concat(r,"}\n        RULE_1 = !{").concat(n,"} 'a' rule:RULE_2 {").concat(o,"};\n        RULE_2 'named' = &{").concat(a,"} @'b' [abc] 'def';\n        RULE_3 = RULE_1 / RULE_2;\n      ");function u(t,r,n,a){void 0===a&&(a=t);var o=peg$1.generate(s,{grammarSource:r,output:"source-and-map"}).toStringWithSourceMap(),u=o.code,i=o.map,c=e(s,t,r),l=e(u,a);return delete c.offset,delete l.offset,SourceMapConsumer.fromSourceMap(i).then((function(e){expect$f(e.originalPositionFor(l)).to.be.deep.equal(Object.assign(c,{source:String(r),name:n}))}))}for(var i=function(e){describe("with source = ".concat(chai$f.util.inspect(e)),(function(){it("global initializer",(function(){return u(t,e,"$top_level_initializer")})),it("per-parse initializer",(function(){return u(r,e,"$initializer")})),it("action block",(function(){return u(o,e,null)})),it("semantic and predicate",(function(){return u(a,e,null)})),it("semantic not predicate",(function(){return u(n,e,null)})),it("rule name",(function(){return u("RULE_1",e,"RULE_1","peg$parseRULE_1() {")})),it("labelled rule name",(function(){return u("RULE_2 'named'",e,"RULE_2","peg$parseRULE_2() {")})),it("literal expression",(function(){return u("'a'",e,null,"input.charCodeAt(peg$currPos) === 97")})),it("multichar literal",(function(){return u("'def'",e,null,"input.substr(peg$currPos, 3) === peg$c3")})),it("chars expression",(function(){return u("[abc]",e,null,"peg$r0.test(input.charAt(peg$currPos))")})),it("rule expression",(function(){return u("RULE_2",e,null,"peg$parseRULE_2();")})),it("choice expression",(function(){return u("RULE_1 / RULE_2",e,null,new RegExp([/peg\$parseRULE_1\(\);\s*/,/if \(s. === peg\$FAILED\) \{\s*/,/s. = peg\$parseRULE_2/].map((function(e){return e.source})).join("")))}))}))},c=0,l=["-",new peg$1.GrammarLocation("-",{offset:51,line:13,column:7})];c<l.length;c++)i(l[c])}))}))}));var chai$e=require$$0__default.default,_a$1=peg_1,GrammarError$1=_a$1.GrammarError,GrammarLocation=_a$1.GrammarLocation,expect$e=chai$e.expect,location={source:void 0,start:{offset:0,line:1,column:1},end:{offset:4,line:1,column:5}};describe("Grammar Errors",(function(){it("might not have a location",(function(){var e=new GrammarError$1("message");expect$e(e.location).to.equal(void 0),expect$e(e.toString()).to.equal("GrammarError: message")})),it("might have locations",(function(){location.source=void 0;var e=new GrammarError$1("message",location);expect$e(e.location).to.eql(location),expect$e(e.toString()).to.equal("GrammarError: message\n at 1:1"),e=new GrammarError$1("message",null,[{message:"Subinfo",location:location}]),expect$e(e.location).to.equal(null),expect$e(e.toString()).to.equal("GrammarError: message\n from 1:1: Subinfo"),location.source="foo.peggy",e=new GrammarError$1("message",location,[{message:"Subinfo",location:location}]),expect$e(e.toString()).to.equal("GrammarError: message\n at foo.peggy:1:1\n from foo.peggy:1:1: Subinfo")})),describe("formats",(function(){var e={source:"foo.peggy",text:"some error\nthat"},t={source:"foo.peggy",start:{offset:5,line:1,column:6},end:{offset:11,line:2,column:1}},r=[{message:"Subinfo",location:t}];describe("single problem",(function(){describe("with main location",(function(){location.source="foo.peggy";var t=new GrammarError$1("message",location,r);it("with zero-length error at the end",(function(){var t=new GrammarError$1("message",{source:"foo.peggy",start:{offset:4,line:1,column:5},end:{offset:4,line:1,column:5}});expect$e(t.format([e])).to.equal("error: message\n --\x3e foo.peggy:1:5\n  |\n1 | some error\n  |     ^")})),it("with source",(function(){expect$e(t.format([e])).to.equal("error: message\n --\x3e foo.peggy:1:1\n  |\n1 | some error\n  | ^^^^\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("without source",(function(){expect$e(t.format([])).to.equal("error: message\n at foo.peggy:1:1\n at foo.peggy:1:6: Subinfo")}))})),describe("without main location",(function(){var t=new GrammarError$1("message",null,r);it("with source",(function(){expect$e(t.format([e])).to.equal("error: message\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("without source",(function(){expect$e(t.format([])).to.equal("error: message\n at foo.peggy:1:6: Subinfo")}))}))})),describe("several problems",(function(){describe("with main location",(function(){location.source="foo.peggy";var n=new GrammarError$1("message",location,r);n.problems.push(["warning","Warning message",t,[{message:"Warning Subinfo",location:t}]]),n.problems.push(["info","Info message",null,[]]),it("with source",(function(){expect$e(n.format([e])).to.equal("error: message\n --\x3e foo.peggy:1:1\n  |\n1 | some error\n  | ^^^^\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^\n\nwarning: Warning message\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^\nnote: Warning Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("with GrammarLocation",(function(){var r=new GrammarLocation("foo.peggy",{offset:12,line:15,column:8});expect$e(String(r)).to.equal("foo.peggy"),location.source=r,t.source=r,n.diagnostics.push({message:"Column not offset",location:{source:r,start:{offset:11,line:2,column:1},end:{offset:15,line:2,column:5}}}),expect$e(n.format([{source:r,text:e.text}])).to.equal("error: message\n --\x3e foo.peggy:15:8\n   |\n15 | some error\n   | ^^^^\nnote: Subinfo\n --\x3e foo.peggy:15:13\n   |\n15 | some error\n   |      ^^^^^\nnote: Column not offset\n --\x3e foo.peggy:16:1\n   |\n16 | that\n   | ^^^^\n\nwarning: Warning message\n --\x3e foo.peggy:15:13\n   |\n15 | some error\n   |      ^^^^^\nnote: Warning Subinfo\n --\x3e foo.peggy:15:13\n   |\n15 | some error\n   |      ^^^^^"),location.source="foo.peggy",t.source="foo.peggy",n.diagnostics.pop()})),it("without source",(function(){expect$e(n.format([])).to.equal("error: message\n at foo.peggy:1:1\n at foo.peggy:1:6: Subinfo\n\nwarning: Warning message\n at foo.peggy:1:6\n at foo.peggy:1:6: Warning Subinfo")}))})),describe("without main location",(function(){var n=new GrammarError$1("message",null,r);n.problems.push(["warning","Warning message",null,[{message:"Warning Subinfo",location:t}]]),n.problems.push(["info","Info message",null,[]]),it("with source",(function(){expect$e(n.format([e])).to.equal("error: message\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^\n\nwarning: Warning message\nnote: Warning Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("without source",(function(){expect$e(n.format([])).to.equal("error: message\n at foo.peggy:1:6: Subinfo\n\nwarning: Warning message\n at foo.peggy:1:6: Warning Subinfo")}))}))}))}))}));var chai$d=require$$0__default.default,SourceNode=sourceMap.SourceNode,peg=peg_1,expect$d=chai$d.expect;describe("plugin API",(function(){describe("use",(function(){var e="start = 'a'";it("is called for each plugin",(function(){var t=[!1,!1,!1],r=[{use:function(){t[0]=!0}},{use:function(){t[1]=!0}},{use:function(){t[2]=!0}}];peg.generate(e,{plugins:r}),expect$d(t).to.deep.equal([!0,!0,!0])})),it("receives configuration",(function(){var t={use:function(e){expect$d(e).to.be.an("object"),expect$d(e.parser).to.be.an("object"),expect$d(e.parser.parse("start = 'a'")).to.be.an("object"),expect$d(e.passes).to.be.an("object"),expect$d(e.passes.check).to.be.an("array"),e.passes.check.forEach((function(e){expect$d(e).to.be.a("function")})),expect$d(e.passes.transform).to.be.an("array"),e.passes.transform.forEach((function(e){expect$d(e).to.be.a("function")})),expect$d(e.passes.generate).to.be.an("array"),e.passes.generate.forEach((function(e){expect$d(e).to.be.a("function")})),expect$d(e.reservedWords).to.be.an("array"),e.reservedWords.forEach((function(e){expect$d(e).to.be.a("string")}))}};peg.generate(e,{plugins:[t]})})),it("receives options",(function(){var t={plugins:[{use:function(e,r){expect$d(r).to.equal(t)}}],foo:42};peg.generate(e,t)})),it("can replace parser",(function(){var e={use:function(e){var t=peg.generate(["start = .* {","  return {","    type: 'grammar',","    initializer: {","      type: 'initializer',","      code: ['/* included for cover ast2SourceNode in the generate-js pass */'],","    },","    rules: [","      {","        type: 'rule',","        name: 'start',","        expression: { type: 'literal',  value: text(), ignoreCase: false }","      }","    ]","  };","}"].join("\n"));e.parser=t}},t=peg.generate("a",{plugins:[e]});expect$d(t.parse("a")).to.equal("a")})),it("can change compiler passes",(function(){var t={use:function(e){e.passes.generate=[function(e){e.code=new SourceNode(1,0,"plugin","({ parse: function() { return 42; } })")}]}},r=peg.generate(e,{plugins:[t]});expect$d(r.parse("a")).to.equal(42)})),it("can change list of reserved words",(function(){var e={use:function(e){e.reservedWords=[]}};expect$d((function(){peg.generate("start = "+peg.RESERVED_WORDS[0]+":'a'",{plugins:[e],output:"source"})})).to.not.throw()})),it("can change options",(function(){var e=["a = 'x'","b = 'x'","c = 'x'"].join("\n"),t=peg.generate(e,{allowedStartRules:["a"],plugins:[{use:function(e,t){t.allowedStartRules=["b","c"]}}]});expect$d((function(){t.parse("x",{startRule:"a"})})).to.throw(),expect$d(t.parse("x",{startRule:"b"})).to.equal("x"),expect$d(t.parse("x",{startRule:"c"})).to.equal("x")})),it("can use star for start rules",(function(){var e=["a = 'x'","b = 'x'","c = 'x'"].join("\n"),t=peg.generate(e,{allowedStartRules:["*"]});expect$d(t.parse("x",{startRule:"a"})).to.equal("x"),expect$d(t.parse("x",{startRule:"b"})).to.equal("x"),expect$d(t.parse("x",{startRule:"c"})).to.equal("x")}))}))}));var __spreadArray$1=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},chai$c=require$$0__default.default,parser$2=parser$4,expect$c=chai$c.expect;describe("Peggy grammar parser",(function(){var e={type:"literal",value:"abcd",ignoreCase:!1},t={type:"literal",value:"efgh",ignoreCase:!1},r={type:"literal",value:"ijkl",ignoreCase:!1},n={type:"literal",value:"mnop",ignoreCase:!1},a={type:"semantic_and",code:" code "},o={type:"semantic_not",code:" code "},s={type:"optional",expression:e},u={type:"zero_or_more",expression:e},i={type:"one_or_more",expression:e},c={type:"text",expression:s},l={type:"simple_not",expression:e},p={type:"simple_and",expression:s},f={type:"simple_not",expression:s},d={type:"labeled",label:"a",expression:e},g={type:"labeled",label:"b",expression:t},h={type:"labeled",label:"a",expression:l},m={type:"sequence",elements:[e,t,r]},$={type:"sequence",elements:[d,g]},A={type:"sequence",elements:[d,g,{type:"labeled",label:"c",expression:r},{type:"labeled",label:"d",expression:n}]},b={type:"group",expression:d},x={type:"group",expression:m},E={type:"action",expression:e,code:" code "},v={type:"action",expression:t,code:" code "},C={type:"action",expression:m,code:" code "},y={type:"choice",alternatives:[e,t,r]},_={type:"choice",alternatives:[E,v]},S={type:"choice",alternatives:[E,v,{type:"action",expression:r,code:" code "},{type:"action",expression:n,code:" code "}]},F={type:"named",name:"start rule",expression:e},w={type:"rule",name:"a",expression:e},B={type:"rule",name:"b",expression:t},D={type:"rule",name:"c",expression:r},L={type:"rule",name:"start",expression:e},P={type:"top_level_initializer",code:" top level code "},T={type:"initializer",code:" code "};function R(e){return{type:"grammar",topLevelInitializer:null,initializer:null,rules:[{type:"rule",name:"start",expression:e}]}}function O(t){return R({type:"action",expression:e,code:t})}function M(e,t){return R({type:"literal",value:e,ignoreCase:t})}function k(e,t,r){return R({type:"class",parts:e,inverted:t,ignoreCase:r})}function I(){return R({type:"any"})}function j(e){return R({type:"rule_ref",name:e})}var N=M("abcd",!1),U={type:"grammar",topLevelInitializer:null,initializer:null,rules:[w,B]},q=function(){function e(e){delete e.location,delete e.codeLocation,delete e.nameLocation,delete e.labelLocation}function t(e){delete e.location,delete e.codeLocation,delete e.nameLocation,delete e.labelLocation,a(e.expression)}function r(e){return function(t){delete t.location,delete t.codeLocation,delete t.nameLocation,delete t.labelLocation,t[e].forEach(a)}}var n,a=(n={grammar:function(e){delete e.location,delete e.codeLocation,delete e.nameLocation,delete e.labelLocation,e.topLevelInitializer&&a(e.topLevelInitializer),e.initializer&&a(e.initializer),e.rules.forEach(a)},top_level_initializer:e,initializer:e,rule:t,named:t,choice:r("alternatives"),action:t,sequence:r("elements"),labeled:t,text:t,simple_and:t,simple_not:t,optional:t,zero_or_more:t,one_or_more:t,group:t,semantic_and:e,semantic_not:e,rule_ref:e,literal:e,class:e,any:e},function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return n[e.type].apply(n,__spreadArray$1([e],t,!1))});return a}();function G(e,t){var r=e.Assertion;r.addMethod("parseAs",(function(e){var r=parser$2.parse(t.flag(this,"object"));q(r),this.assert(t.eql(r,e),"expected #{this} to parse as #{exp} but got #{act}","expected #{this} to not parse as #{exp}",e,r,!t.flag(this,"negate"))})),r.addMethod("failToParse",(function(e){var n,a;try{a=parser$2.parse(t.flag(this,"object")),n=!0}catch(e){a=e,n=!1}n&&q(a),this.assert(!n,"expected #{this} to fail to parse but got #{act}","expected #{this} to not fail to parse but it failed with #{act}",null,a),n||void 0===e||Object.keys(e).forEach((function(t){new r(a).to.have.property(t).that.is.deep.equal(e[t])}))}))}beforeEach((function(){chai$c.use(G)})),it("parses Grammar",(function(){expect$c("\na = 'abcd';\n").to.parseAs({type:"grammar",topLevelInitializer:null,initializer:null,rules:[w]}),expect$c("\na = 'abcd';\nb = 'efgh';\nc = 'ijkl';\n").to.parseAs({type:"grammar",topLevelInitializer:null,initializer:null,rules:[w,B,D]}),expect$c("\n{ code };\na = 'abcd';\n").to.parseAs({type:"grammar",topLevelInitializer:null,initializer:T,rules:[w]}),expect$c("\n{{ top level code }};\na = 'abcd';\n").to.parseAs({type:"grammar",topLevelInitializer:P,initializer:null,rules:[w]}),expect$c("\n{{ top level code }};\n{ code };\na = 'abcd';\n").to.parseAs({type:"grammar",topLevelInitializer:P,initializer:T,rules:[w]})})),it("parses Top-Level Initializer",(function(){expect$c("{{ top level code }};start = 'abcd'").to.parseAs({type:"grammar",topLevelInitializer:P,initializer:null,rules:[L]})})),it("parses Initializer",(function(){expect$c("{ code };start = 'abcd'").to.parseAs({type:"grammar",topLevelInitializer:null,initializer:T,rules:[L]})})),it("parses Rule",(function(){expect$c("start\n=\n'abcd';").to.parseAs(R(e)),expect$c("start\n'start rule'\n=\n'abcd';").to.parseAs(R(F))})),it("parses Expression",(function(){expect$c("start = 'abcd' / 'efgh' / 'ijkl'").to.parseAs(R(y))})),it("parses ChoiceExpression",(function(){expect$c("start = 'abcd' { code }").to.parseAs(R(E)),expect$c("start = 'abcd' { code }\n/\n'efgh' { code }").to.parseAs(R(_)),expect$c("start = 'abcd' { code }\n/\n'efgh' { code }\n/\n'ijkl' { code }\n/\n'mnop' { code }").to.parseAs(R(S))})),it("parses ActionExpression",(function(){expect$c("start = 'abcd' 'efgh' 'ijkl'").to.parseAs(R(m)),expect$c("start = 'abcd' 'efgh' 'ijkl'\n{ code }").to.parseAs(R(C))})),it("parses SequenceExpression",(function(){expect$c("start = a:'abcd'").to.parseAs(R(d)),expect$c("start = a:'abcd'\nb:'efgh'").to.parseAs(R($)),expect$c("start = a:'abcd'\nb:'efgh'\nc:'ijkl'\nd:'mnop'").to.parseAs(R(A))})),it("parses `@` (value plucking)",(function(){function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return R({type:"sequence",elements:e})}function o(e,t){return{type:"labeled",pick:!0,label:e,expression:t}}expect$c("start = @'abcd'").to.parseAs(a(o(null,e))),expect$c("start = @a:'abcd'").to.parseAs(a(o("a",e))),expect$c("start = 'abcd' @'efgh'").to.parseAs(a(e,o(null,t))),expect$c("start = a:'abcd' @b:'efgh'").to.parseAs(a(d,o("b",t))),expect$c("start = @'abcd' b:'efgh'").to.parseAs(a(o(null,e),g)),expect$c("start = a:'abcd' @'efgh' 'ijkl' @d:'mnop'").to.parseAs(a(d,o(null,t),r,o("d",n)))})),it("parses LabeledExpression",(function(){expect$c("start = a\n:\n!'abcd'").to.parseAs(R(h)),expect$c("start = !'abcd'").to.parseAs(R(l))})),it("parses PrefixedExpression",(function(){expect$c("start = !\n'abcd'?").to.parseAs(R(f)),expect$c("start = 'abcd'?").to.parseAs(R(s))})),it("parses PrefixedOperator",(function(){expect$c("start = $'abcd'?").to.parseAs(R(c)),expect$c("start = &'abcd'?").to.parseAs(R(p)),expect$c("start = !'abcd'?").to.parseAs(R(f))})),it("parses SuffixedExpression",(function(){expect$c("start = 'abcd'\n?").to.parseAs(R(s)),expect$c("start = 'abcd'").to.parseAs(R(e))})),it("parses SuffixedOperator",(function(){expect$c("start = 'abcd'?").to.parseAs(R(s)),expect$c("start = 'abcd'*").to.parseAs(R(u)),expect$c("start = 'abcd'+").to.parseAs(R(i))})),it("parses PrimaryExpression",(function(){expect$c("start = 'abcd'").to.parseAs(N),expect$c("start = [a-d]").to.parseAs(k([["a","d"]],!1,!1)),expect$c("start = .").to.parseAs(I()),expect$c("start = a").to.parseAs(j("a")),expect$c("start = &{ code }").to.parseAs(R(a)),expect$c("start = (\na:'abcd'\n)").to.parseAs(R(b)),expect$c("start = (\n'abcd' 'efgh' 'ijkl'\n)").to.parseAs(R(x)),expect$c("start = (\n'abcd'\n)").to.parseAs(N)})),it("parses RuleReferenceExpression",(function(){expect$c("start = a").to.parseAs(j("a")),expect$c("start = a\n=").to.failToParse(),expect$c("start = a\n'abcd'\n=").to.failToParse()})),it("parses SemanticPredicateExpression",(function(){expect$c("start = !\n{ code }").to.parseAs(R(o))})),it("parses SemanticPredicateOperator",(function(){expect$c("start = &{ code }").to.parseAs(R(a)),expect$c("start = !{ code }").to.parseAs(R(o))})),it("parses WhiteSpace",(function(){expect$c("start =\t'abcd'").to.parseAs(N),expect$c("start =\v'abcd'").to.parseAs(N),expect$c("start =\f'abcd'").to.parseAs(N),expect$c("start = 'abcd'").to.parseAs(N),expect$c("start ='abcd'").to.parseAs(N),expect$c("start =\ufeff'abcd'").to.parseAs(N),expect$c("start ='abcd'").to.parseAs(N)})),it("parses LineTerminator",(function(){expect$c("start = '\n'").to.failToParse(),expect$c("start = '\r'").to.failToParse(),expect$c("start = '\u2028'").to.failToParse(),expect$c("start = '\u2029'").to.failToParse()})),it("parses LineTerminatorSequence",(function(){expect$c("start =\n'abcd'").to.parseAs(N),expect$c("start =\r\n'abcd'").to.parseAs(N),expect$c("start =\r'abcd'").to.parseAs(N),expect$c("start =\u2028'abcd'").to.parseAs(N),expect$c("start =\u2029'abcd'").to.parseAs(N)})),it("parses Comment",(function(){expect$c("start =// comment\n'abcd'").to.parseAs(N),expect$c("start =/* comment */'abcd'").to.parseAs(N)})),it("parses MultiLineComment",(function(){expect$c("start =/**/'abcd'").to.parseAs(N),expect$c("start =/*a*/'abcd'").to.parseAs(N),expect$c("start =/*abc*/'abcd'").to.parseAs(N),expect$c("start =/**/*/'abcd'").to.failToParse()})),it("parses MultiLineCommentNoLineTerminator",(function(){expect$c("a = 'abcd'/**/\r\nb = 'efgh'").to.parseAs(U),expect$c("a = 'abcd'/*a*/\r\nb = 'efgh'").to.parseAs(U),expect$c("a = 'abcd'/*abc*/\r\nb = 'efgh'").to.parseAs(U),expect$c("a = 'abcd'/**/*/\r\nb = 'efgh'").to.failToParse(),expect$c("a = 'abcd'/*\n*/\r\nb = 'efgh'").to.failToParse()})),it("parses SingleLineComment",(function(){expect$c("start =//\n'abcd'").to.parseAs(N),expect$c("start =//a\n'abcd'").to.parseAs(N),expect$c("start =//abc\n'abcd'").to.parseAs(N),expect$c("start =//\n@\n'abcd'").to.failToParse()})),it("parses Identifier",(function(){expect$c("start = a:'abcd'").to.parseAs(R(d))})),it("parses IdentifierName",(function(){expect$c("start = a").to.parseAs(j("a")),expect$c("start = ab").to.parseAs(j("ab")),expect$c("start = abcd").to.parseAs(j("abcd"))})),it("parses IdentifierStart",(function(){expect$c("start = a").to.parseAs(j("a")),expect$c("start = $").to.parseAs(j("$")),expect$c("start = _").to.parseAs(j("_")),expect$c("start = \\u0061").to.parseAs(j("a"))})),it("parses IdentifierPart",(function(){expect$c("start = aa").to.parseAs(j("aa")),expect$c("start = a").to.parseAs(j("a")),expect$c("start = a0").to.parseAs(j("a0")),expect$c("start = a").to.parseAs(j("a")),expect$c("start = a").to.parseAs(j("a")),expect$c("start = a").to.parseAs(j("a"))})),it("parses LiteralMatcher",(function(){expect$c("start = 'abcd'").to.parseAs(M("abcd",!1)),expect$c("start = 'abcd'i").to.parseAs(M("abcd",!0))})),it("parses StringLiteral",(function(){expect$c('start = ""').to.parseAs(M("",!1)),expect$c('start = "a"').to.parseAs(M("a",!1)),expect$c('start = "abc"').to.parseAs(M("abc",!1)),expect$c("start = ''").to.parseAs(M("",!1)),expect$c("start = 'a'").to.parseAs(M("a",!1)),expect$c("start = 'abc'").to.parseAs(M("abc",!1))})),it("parses DoubleStringCharacter",(function(){expect$c('start = "a"').to.parseAs(M("a",!1)),expect$c('start = "\\n"').to.parseAs(M("\n",!1)),expect$c('start = "\\\n"').to.parseAs(M("",!1)),expect$c('start = """').to.failToParse(),expect$c('start = "\\"').to.failToParse(),expect$c('start = "\n"').to.failToParse()})),it("parses SingleStringCharacter",(function(){expect$c("start = 'a'").to.parseAs(M("a",!1)),expect$c("start = '\\n'").to.parseAs(M("\n",!1)),expect$c("start = '\\\n'").to.parseAs(M("",!1)),expect$c("start = '''").to.failToParse(),expect$c("start = '\\'").to.failToParse(),expect$c("start = '\n'").to.failToParse()})),it("parses CharacterClassMatcher",(function(){expect$c("start = []").to.parseAs(k([],!1,!1)),expect$c("start = [a-d]").to.parseAs(k([["a","d"]],!1,!1)),expect$c("start = [a]").to.parseAs(k(["a"],!1,!1)),expect$c("start = [a-de-hi-l]").to.parseAs(k([["a","d"],["e","h"],["i","l"]],!1,!1)),expect$c("start = [^a-d]").to.parseAs(k([["a","d"]],!0,!1)),expect$c("start = [a-d]i").to.parseAs(k([["a","d"]],!1,!0)),expect$c("start = [\\\n]").to.parseAs(k([],!1,!1))})),it("parses ClassCharacterRange",(function(){expect$c("start = [a-d]").to.parseAs(k([["a","d"]],!1,!1)),expect$c("start = [a-a]").to.parseAs(k([["a","a"]],!1,!1)),expect$c("start = [b-a]").to.failToParse({message:"Invalid character range: b-a."})})),it("parses ClassCharacter",(function(){expect$c("start = [a]").to.parseAs(k(["a"],!1,!1)),expect$c("start = [\\n]").to.parseAs(k(["\n"],!1,!1)),expect$c("start = [\\\n]").to.parseAs(k([],!1,!1)),expect$c("start = []]").to.failToParse(),expect$c("start = [\\]").to.failToParse(),expect$c("start = [\n]").to.failToParse()})),it("parses LineContinuation",(function(){expect$c("start = '\\\r\n'").to.parseAs(M("",!1))})),it("parses EscapeSequence",(function(){expect$c("start = '\\n'").to.parseAs(M("\n",!1)),expect$c("start = '\\0'").to.parseAs(M("\0",!1)),expect$c("start = '\\xFF'").to.parseAs(M("",!1)),expect$c("start = '\\uFFFF'").to.parseAs(M("",!1)),expect$c("start = '\\09'").to.failToParse()})),it("parses CharacterEscapeSequence",(function(){expect$c("start = '\\n'").to.parseAs(M("\n",!1)),expect$c("start = '\\a'").to.parseAs(M("a",!1))})),it("parses SingleEscapeCharacter",(function(){expect$c("start = '\\''").to.parseAs(M("'",!1)),expect$c("start = '\\\"'").to.parseAs(M('"',!1)),expect$c("start = '\\\\'").to.parseAs(M("\\",!1)),expect$c("start = '\\b'").to.parseAs(M("\b",!1)),expect$c("start = '\\f'").to.parseAs(M("\f",!1)),expect$c("start = '\\n'").to.parseAs(M("\n",!1)),expect$c("start = '\\r'").to.parseAs(M("\r",!1)),expect$c("start = '\\t'").to.parseAs(M("\t",!1)),expect$c("start = '\\v'").to.parseAs(M("\v",!1))})),it("parses NonEscapeCharacter",(function(){expect$c("start = '\\a'").to.parseAs(M("a",!1))})),it("parses HexEscapeSequence",(function(){expect$c("start = '\\xFF'").to.parseAs(M("",!1))})),it("parses UnicodeEscapeSequence",(function(){expect$c("start = '\\uFFFF'").to.parseAs(M("",!1))})),it("parses AnyMatcher",(function(){expect$c("start = .").to.parseAs(I())})),it("parses CodeBlock",(function(){expect$c("start = 'abcd' { code }").to.parseAs(O(" code "))})),it("parses Code",(function(){expect$c("start = 'abcd' {a}").to.parseAs(O("a")),expect$c("start = 'abcd' {abc}").to.parseAs(O("abc")),expect$c("start = 'abcd' {{a}}").to.parseAs(O("{a}")),expect$c("start = 'abcd' {{a}{b}{c}}").to.parseAs(O("{a}{b}{c}")),expect$c("start = 'abcd' {{}").to.failToParse(),expect$c("start = 'abcd' {}}").to.failToParse()})),it("parses __",(function(){expect$c("start ='abcd'").to.parseAs(N),expect$c("start = 'abcd'").to.parseAs(N),expect$c("start =\r\n'abcd'").to.parseAs(N),expect$c("start =/* comment */'abcd'").to.parseAs(N),expect$c("start =   'abcd'").to.parseAs(N)})),it("parses _",(function(){expect$c("a = 'abcd'\r\nb = 'efgh'").to.parseAs(U),expect$c("a = 'abcd' \r\nb = 'efgh'").to.parseAs(U),expect$c("a = 'abcd'/* comment */\r\nb = 'efgh'").to.parseAs(U),expect$c("a = 'abcd'   \r\nb = 'efgh'").to.parseAs(U)})),it("parses EOS",(function(){expect$c("a = 'abcd'\n;b = 'efgh'").to.parseAs(U),expect$c("a = 'abcd' \r\nb = 'efgh'").to.parseAs(U),expect$c("a = 'abcd' // comment\r\nb = 'efgh'").to.parseAs(U),expect$c("a = 'abcd'\nb = 'efgh'").to.parseAs(U)})),it("parses EOF",(function(){expect$c("start = 'abcd'\n").to.parseAs(N)})),it("generates codeLocation / nameLocation / labelLocation",(function(){var e=parser$2.parse("\n{{\n  const foo = 12;\n}}\n{\n  const bar = 13;\n}\na = label:'abcd' &{ return true; } !{ return false; } { return 'so true'; }\nb = @LABEL:'efgh'\nc = @'ijkl'\n");expect$c(e).to.eql({type:"grammar",topLevelInitializer:{type:"top_level_initializer",code:"\n  const foo = 12;\n",codeLocation:{source:void 0,start:{offset:3,line:2,column:3},end:{offset:22,line:4,column:1}},location:{source:void 0,start:{offset:1,line:2,column:1},end:{offset:25,line:5,column:1}}},initializer:{type:"initializer",code:"\n  const bar = 13;\n",codeLocation:{source:void 0,start:{offset:26,line:5,column:2},end:{offset:45,line:7,column:1}},location:{source:void 0,start:{offset:25,line:5,column:1},end:{offset:47,line:8,column:1}}},rules:[{type:"rule",name:"a",nameLocation:{source:void 0,start:{offset:47,line:8,column:1},end:{offset:48,line:8,column:2}},expression:{type:"action",expression:{type:"sequence",elements:[{type:"labeled",label:"label",labelLocation:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:56,line:8,column:10}},expression:{type:"literal",value:"abcd",ignoreCase:!1,location:{source:void 0,start:{offset:57,line:8,column:11},end:{offset:63,line:8,column:17}}},location:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:63,line:8,column:17}}},{type:"semantic_and",code:" return true; ",codeLocation:{source:void 0,start:{offset:66,line:8,column:20},end:{offset:80,line:8,column:34}},location:{source:void 0,start:{offset:64,line:8,column:18},end:{offset:81,line:8,column:35}}},{type:"semantic_not",code:" return false; ",codeLocation:{source:void 0,start:{offset:84,line:8,column:38},end:{offset:99,line:8,column:53}},location:{source:void 0,start:{offset:82,line:8,column:36},end:{offset:100,line:8,column:54}}}],location:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:100,line:8,column:54}}},code:" return 'so true'; ",codeLocation:{source:void 0,start:{offset:102,line:8,column:56},end:{offset:121,line:8,column:75}},location:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:122,line:8,column:76}}},location:{source:void 0,start:{offset:47,line:8,column:1},end:{offset:123,line:9,column:1}}},{type:"rule",name:"b",nameLocation:{source:void 0,start:{offset:123,line:9,column:1},end:{offset:124,line:9,column:2}},expression:{type:"sequence",elements:[{type:"labeled",label:"LABEL",labelLocation:{source:void 0,start:{offset:128,line:9,column:6},end:{offset:133,line:9,column:11}},pick:!0,expression:{type:"literal",value:"efgh",ignoreCase:!1,location:{source:void 0,start:{offset:134,line:9,column:12},end:{offset:140,line:9,column:18}}},location:{source:void 0,start:{offset:127,line:9,column:5},end:{offset:140,line:9,column:18}}}],location:{source:void 0,start:{offset:127,line:9,column:5},end:{offset:140,line:9,column:18}}},location:{source:void 0,start:{offset:123,line:9,column:1},end:{offset:141,line:10,column:1}}},{type:"rule",name:"c",nameLocation:{source:void 0,start:{offset:141,line:10,column:1},end:{offset:142,line:10,column:2}},expression:{type:"sequence",elements:[{type:"labeled",label:null,labelLocation:{source:void 0,start:{offset:145,line:10,column:5},end:{offset:146,line:10,column:6}},pick:!0,expression:{type:"literal",value:"ijkl",ignoreCase:!1,location:{source:void 0,start:{offset:146,line:10,column:6},end:{offset:152,line:10,column:12}}},location:{source:void 0,start:{offset:145,line:10,column:5},end:{offset:152,line:10,column:12}}}],location:{source:void 0,start:{offset:145,line:10,column:5},end:{offset:152,line:10,column:12}}},location:{source:void 0,start:{offset:141,line:10,column:1},end:{offset:153,line:11,column:1}}}],location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:153,line:11,column:1}}})}))}));var chai$b=require$$0__default.default,parser$1=parser$4,compiler=compiler_1,expect$b=chai$b.expect;describe("Peggy compiler",(function(){it("checks start rules",(function(){var e=parser$1.parse("foo='1'");expect$b(compiler.compile(e,compiler.passes)).to.be.an("object"),expect$b((function(){return compiler.compile(e,compiler.passes,{allowedStartRules:null})})).to.throw("allowedStartRules must be an array"),expect$b((function(){return compiler.compile(e,compiler.passes,{allowedStartRules:[]})})).to.throw("Must have at least one start rule"),expect$b((function(){return compiler.compile(e,compiler.passes,{allowedStartRules:["bar"]})})).to.throw('Unknown start rule "bar"')})),it("checks output type",(function(){var e=parser$1.parse("foo='1'");expect$b(compiler.compile(e,compiler.passes,{output:"source"})).to.be.a("string"),expect$b((function(){return compiler.compile(e,compiler.passes,{output:"INVALID OUTPUT TYPE"})})).to.throw("Invalid output format: INVALID OUTPUT TYPE.")})),it("generates inline sourceMappingURL",(function(){var e=parser$1.parse("foo='1'");if(expect$b(e).to.be.an("object"),"function"==typeof TextEncoder&&(expect$b(compiler.compile(e,compiler.passes,{output:"source-with-inline-map",grammarSource:"src.peggy"})).to.match(/^\/\/# sourceMappingURL=data:application\/json;charset=utf-8;base64,/m),"object"==typeof globalThis)){var t=globalThis.TextEncoder;delete globalThis.TextEncoder,expect$b((function(){return compiler.compile(e,compiler.passes,{output:"source-with-inline-map",grammarSource:"src.peggy"})})).to.throw("TextEncoder is not supported by this platform"),globalThis.TextEncoder=t}})),it("requires grammarSource with source-map",(function(){var e=parser$1.parse("foo='1'");expect$b(e).to.be.an("object"),expect$b((function(){return compiler.compile(e,compiler.passes,{output:"source-and-map"})})).to.throw("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps"),expect$b((function(){return compiler.compile(e,compiler.passes,{output:"source-and-map",grammarSource:""})})).to.throw("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps"),"function"==typeof TextEncoder&&expect$b((function(){return compiler.compile(e,compiler.passes,{output:"source-with-inline-map",grammarSource:{toString:function(){return""}}})})).to.throw("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps")}))}));var chai$a=require$$0__default.default,_a=utils$1,hex=_a.hex,stringEscape=_a.stringEscape,regexpClassEscape=_a.regexpClassEscape,base64=_a.base64,expect$a=chai$a.expect;describe("utility functions",(function(){it("hex",(function(){expect$a(hex("0")).to.equal("30"),expect$a(hex("\0")).to.equal("0"),expect$a(hex("\n")).to.equal("A"),expect$a(hex("\ufeff")).to.equal("FEFF")})),it("stringEscape",(function(){expect$a(stringEscape("abc")).to.equal("abc"),expect$a(stringEscape('\\"\0\b\t\n\v\f\r')).to.equal('\\\\\\"\\0\\b\\t\\n\\v\\f\\r'),expect$a(stringEscape("")).to.equal("\\x01\\x0F"),expect$a(stringEscape("")).to.equal("\\x10\\x1F\\x7F"),expect$a(stringEscape("")).to.equal("\\u0100\\u0FFF"),expect$a(stringEscape("")).to.equal("\\u1000\\uFFFF")})),it("regexpClassEscape",(function(){expect$a(regexpClassEscape("\\\0\b\t\n\v\f\r")).to.equal("\\\\\\0\\b\\t\\n\\v\\f\\r"),expect$a(regexpClassEscape("/]^-")).to.equal("\\/\\]\\^\\-"),expect$a(regexpClassEscape("")).to.equal("\\x01\\x0F"),expect$a(regexpClassEscape("")).to.equal("\\x10\\x1F\\x7F"),expect$a(regexpClassEscape("")).to.equal("\\u0100\\u0FFF"),expect$a(regexpClassEscape("")).to.equal("\\u1000\\uFFFF")})),it("base64",(function(){expect$a(base64(new Uint8Array([]))).to.equal(""),expect$a(base64(new Uint8Array([97]))).to.equal("YQ=="),expect$a(base64(new Uint8Array([97,98]))).to.equal("YWI="),expect$a(base64(new Uint8Array([97,98,99]))).to.equal("YWJj"),expect$a(base64(new Uint8Array([97,98,99,100]))).to.equal("YWJjZA=="),expect$a(base64(new Uint8Array([97,98,99,100,101]))).to.equal("YWJjZGU="),expect$a(base64(new Uint8Array([97,98,99,100,101,102]))).to.equal("YWJjZGVm")}))}));var chai$9=require$$0__default.default,Stack=stack,expect$9=chai$9.expect;describe("utility class Stack",(function(){describe("for an empty stack",(function(){var e;beforeEach((function(){e=new Stack("rule","v","let",[42])})),describe("throws an error when attempting",(function(){it("`pop`",(function(){expect$9((function(){return e.pop()})).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -1.\nBytecode: 42")})),it("`top`",(function(){expect$9((function(){return e.top()})).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -1.\nBytecode: 42")})),it("`result`",(function(){expect$9((function(){return e.result()})).to.throw(RangeError,"Rule 'rule': The variable stack is empty, can't get the result")})),it("`index`",(function(){expect$9((function(){return e.index(-2)})).to.throw(RangeError,"Rule 'rule': The variable stack overflow: attempt to get a variable at a negative index -2.\nBytecode: 42"),expect$9((function(){return e.index(0)})).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -1.\nBytecode: 42"),expect$9((function(){return e.index(2)})).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -3.\nBytecode: 42")}))})),it("`defines` returns an empty string",(function(){expect$9(e.defines()).to.equal("")}))})),it("throws an error when attempting `pop` more than `push`",(function(){var e=new Stack("rule","v","let",[42]);e.push("1"),expect$9((function(){return e.pop(3)})).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -2.\nBytecode: 42")})),it("returns a variable with an index 0 for `result`",(function(){var e=new Stack("rule","v","let",[]);e.push("1"),expect$9(e.result()).to.equal("v0")})),it("`defines` returns a define expression for all used variables",(function(){var e=new Stack("rule","v","let",[]);e.push("1"),e.push("2"),e.pop(),e.push("3"),expect$9(e.defines()).to.equal("let v0, v1;")})),describe("`checkedIf` method",(function(){var e;beforeEach((function(){(e=new Stack("rule","v","let",[42])).push("1")})),describe("does not throws an error",(function(){it("without the else brach",(function(){expect$9((function(){return e.checkedIf(0,(function(){}))})).to.not.throw(),expect$9((function(){return e.checkedIf(0,(function(){return e.pop()}))})).to.not.throw(),expect$9((function(){return e.checkedIf(0,(function(){return e.push("2")}))})).to.not.throw()})),describe("when the stack pointer",(function(){it("was not moving in both the arms",(function(){function t(){}function r(){e.push("1"),e.pop()}function n(){e.push("1"),e.push("2"),e.pop(2)}function a(){e.push("1"),e.pop(),e.push("2"),e.pop()}expect$9((function(){return e.checkedIf(0,t,t)})).to.not.throw(),expect$9((function(){return e.checkedIf(0,r,r)})).to.not.throw(),expect$9((function(){return e.checkedIf(0,n,n)})).to.not.throw(),expect$9((function(){return e.checkedIf(0,a,a)})).to.not.throw()})),it("increases on the same value in both the arms",(function(){expect$9((function(){return e.checkedIf(0,(function(){return e.push("1")}),(function(){return e.push("2")}))})).to.not.throw()})),it("decreases on the same value in both the arms",(function(){e.push("2"),expect$9((function(){return e.checkedIf(0,(function(){return e.pop(2)}),(function(){e.pop(),e.pop()}))})).to.not.throw()}))}))})),describe("throws an error when the stack pointer",(function(){it("was not moving in `if` and decreases in `then`",(function(){expect$9((function(){e.checkedIf(0,(function(){}),(function(){return e.pop()}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 0, after else: -1). Bytecode: 42")})),it("decreases in `if` and was not moving in `then`",(function(){expect$9((function(){e.checkedIf(0,(function(){return e.pop()}),(function(){}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: -1, after else: 0). Bytecode: 42")})),it("was not moving in `if` and increases in `then`",(function(){expect$9((function(){e.checkedIf(0,(function(){}),(function(){return e.push("2")}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 0, after else: 1). Bytecode: 42")})),it("increases in `if` and was not moving in `then`",(function(){expect$9((function(){e.checkedIf(0,(function(){return e.push("2")}),(function(){}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 1, after else: 0). Bytecode: 42")})),it("decreases in `if` and increases in `then`",(function(){expect$9((function(){e.checkedIf(0,(function(){return e.pop()}),(function(){return e.push("2")}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: -1, after else: 1). Bytecode: 42")})),it("increases in `if` and decreases in `then`",(function(){expect$9((function(){e.checkedIf(0,(function(){return e.push("2")}),(function(){return e.pop()}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 1, after else: -1). Bytecode: 42")}))}))})),describe("`checkedLoop` method",(function(){var e;beforeEach((function(){(e=new Stack("rule","v","let",[42])).push("1")})),it("does not throws an error when the stack pointer was not moving",(function(){function t(){}function r(){e.push("1"),e.pop()}function n(){e.push("1"),e.push("2"),e.pop(2)}function a(){e.push("1"),e.pop(),e.push("2"),e.pop()}expect$9((function(){return e.checkedLoop(0,t)})).to.not.throw(),expect$9((function(){return e.checkedLoop(0,r)})).to.not.throw(),expect$9((function(){return e.checkedLoop(0,n)})).to.not.throw(),expect$9((function(){return e.checkedLoop(0,a)})).to.not.throw()})),it("throws an error when the stack pointer increases",(function(){expect$9((function(){return e.checkedLoop(0,(function(){return e.push("1")}))})).to.throw(Error,"Rule 'rule', position 0: Body of a loop can't move the stack pointer (before: 0, after: 1). Bytecode: 42")})),it("throws an error when the stack pointer decreases",(function(){expect$9((function(){return e.checkedLoop(0,(function(){return e.pop()}))})).to.throw(Error,"Rule 'rule', position 0: Body of a loop can't move the stack pointer (before: 0, after: -1). Bytecode: 42")}))}))}));var __spreadArray=commonjsGlobal&&commonjsGlobal.__spreadArray||function(e,t,r){if(r||2===arguments.length)for(var n,a=0,o=t.length;a<o;a++)!n&&a in t||(n||(n=Array.prototype.slice.call(t,0,a)),n[a]=t[a]);return e.concat(n||Array.prototype.slice.call(t))},GrammarError=peg_1.GrammarError,parser=parser$4,Session=session,helpers$9=function(e,t){var r=e.Assertion;e.use(requireChaiLike()),r.addMethod("changeAST",(function(e,n,a){a=void 0!==a?a:{};var o=parser.parse(e,a);t.flag(this,"object")(o,a,new Session({error:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];throw new(GrammarError.bind.apply(GrammarError,__spreadArray([void 0],t,!1)))}})),new r(o).like(n)})),r.addMethod("reportError",(function(e,n){var a,o,s=parser.parse(e);try{t.flag(this,"object")(s,{},new Session({error:function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];throw new(GrammarError.bind.apply(GrammarError,__spreadArray([void 0],t,!1)))}})),a=!0}catch(e){o=e,a=!1}this.assert(!a,"expected #{this} to report an error but it didn't","expected #{this} to not report an error but #{act} was reported",null,o),a||void 0===n||Object.keys(n).forEach((function(e){new r(o).to.have.property(e).that.is.deep.equal(n[e])}))}))},chai$8=require$$0__default.default,helpers$8=helpers$9,pass$8=inferenceMatchResult_1;chai$8.use(helpers$8);var expect$8=chai$8.expect;describe("compiler pass |inferenceMatchResult|",(function(){it("calculate |match| property for |any| correctly",(function(){expect$8(pass$8).to.changeAST("start = .",{rules:[{match:0}]})})),it("calculate |match| property for |literal| correctly",(function(){expect$8(pass$8).to.changeAST("start = ''",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = ''i",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = 'a'",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = 'a'i",{rules:[{match:0}]})})),it("calculate |match| property for |class| correctly",(function(){expect$8(pass$8).to.changeAST("start = []",{rules:[{match:-1}]}),expect$8(pass$8).to.changeAST("start = []i",{rules:[{match:-1}]}),expect$8(pass$8).to.changeAST("start = [a]",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = [a]i",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = [a-b]",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = [a-b]i",{rules:[{match:0}]})})),it("calculate |match| property for |sequence| correctly",(function(){expect$8(pass$8).to.changeAST("start = 'a' 'b'",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = 'a' ''",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = '' 'b'",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = '' ''",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = 'a' []",{rules:[{match:-1}]}),expect$8(pass$8).to.changeAST("start = [] 'b'",{rules:[{match:-1}]}),expect$8(pass$8).to.changeAST("start = [] []",{rules:[{match:-1}]})})),it("calculate |match| property for |choice| correctly",(function(){expect$8(pass$8).to.changeAST("start = 'a' / 'b'",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = 'a' / ''",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = ''  / 'b'",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = ''  / ''",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = 'a' / []",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = []  / 'b'",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = []  / []",{rules:[{match:-1}]})})),it("calculate |match| property for predicates correctly",(function(){expect$8(pass$8).to.changeAST("start = &.",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = &''",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = &[]",{rules:[{match:-1}]}),expect$8(pass$8).to.changeAST("start = !.",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = !''",{rules:[{match:-1}]}),expect$8(pass$8).to.changeAST("start = ![]",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = &{ code }",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = !{ code }",{rules:[{match:0}]})})),it("calculate |match| property for |text| correctly",(function(){expect$8(pass$8).to.changeAST("start = $.",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = $''",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = $[]",{rules:[{match:-1}]})})),it("calculate |match| property for |action| correctly",(function(){expect$8(pass$8).to.changeAST("start = .  { code }",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = '' { code }",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = [] { code }",{rules:[{match:-1}]})})),it("calculate |match| property for |labeled| correctly",(function(){expect$8(pass$8).to.changeAST("start = a:.",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = a:''",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = a:[]",{rules:[{match:-1}]})})),it("calculate |match| property for |named| correctly",(function(){expect$8(pass$8).to.changeAST("start 'start' = .",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start 'start' = ''",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start 'start' = []",{rules:[{match:-1}]})})),it("calculate |match| property for |optional| correctly",(function(){expect$8(pass$8).to.changeAST("start = .?",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = ''?",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = []?",{rules:[{match:1}]})})),it("calculate |match| property for |zero_or_more| correctly",(function(){expect$8(pass$8).to.changeAST("start = .*",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = ''*",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = []*",{rules:[{match:1}]})})),it("calculate |match| property for |one_or_more| correctly",(function(){expect$8(pass$8).to.changeAST("start = .+",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = ''+",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = []+",{rules:[{match:-1}]})})),it("calculate |match| property for |group| correctly",(function(){expect$8(pass$8).to.changeAST("start = (.)",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = ('')",{rules:[{match:1}]}),expect$8(pass$8).to.changeAST("start = ([])",{rules:[{match:-1}]})})),it("calculate |match| property for |rule_ref| correctly",(function(){expect$8(pass$8).to.changeAST(["start = end","end = . "].join("\n"),{rules:[{match:0},{match:0}]}),expect$8(pass$8).to.changeAST(["start = end","end = ''"].join("\n"),{rules:[{match:1},{match:1}]}),expect$8(pass$8).to.changeAST(["start = end","end = []"].join("\n"),{rules:[{match:-1},{match:-1}]}),expect$8(pass$8).to.changeAST("start = .  start",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = '' start",{rules:[{match:0}]}),expect$8(pass$8).to.changeAST("start = [] start",{rules:[{match:-1}]}),expect$8(pass$8).to.changeAST("start = . start []",{rules:[{match:-1}]})}))}));var chai$7=require$$0__default.default,helpers$7=helpers$9,pass$7=removeProxyRules_1;chai$7.use(helpers$7);var expect$7=chai$7.expect;describe("compiler pass |removeProxyRules|",(function(){describe("when a proxy rule isn't listed in |allowedStartRules|",(function(){it("updates references and removes it",(function(){expect$7(pass$7).to.changeAST(["start = proxy","proxy = proxied","proxied = 'a'"].join("\n"),{rules:[{name:"start",expression:{type:"rule_ref",name:"proxied"}},{name:"proxied"}]},{allowedStartRules:["start"]})}))})),describe("when a proxy rule is listed in |allowedStartRules|",(function(){it("updates references but doesn't remove it",(function(){expect$7(pass$7).to.changeAST(["start = proxy","proxy = proxied","proxied = 'a'"].join("\n"),{rules:[{name:"start",expression:{type:"rule_ref",name:"proxied"}},{name:"proxy",expression:{type:"rule_ref",name:"proxied"}},{name:"proxied"}]},{allowedStartRules:["start","proxy"]})}))}))}));var chai$6=require$$0__default.default,helpers$6=helpers$9,pass$6=generateBytecode_1;chai$6.use(helpers$6);var expect$6=chai$6.expect;describe("compiler pass |generateBytecode|",(function(){function e(e){return{rules:[{bytecode:e}]}}function t(e,t){return{rules:[{bytecode:e}],locations:t}}function r(e,t,r,n){return{literals:e,classes:t,expectations:r,functions:n}}describe("for grammar",(function(){it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(["a = 'a'","b = 'b'","c = 'c'"].join("\n"),{rules:[{bytecode:[18,0,2,2,22,0,23,0]},{bytecode:[18,1,2,2,22,1,23,1]},{bytecode:[18,2,2,2,22,2,23,2]}]})})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(["a = 'a'","b = 'b'","c = 'c'"].join("\n"),r(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[]))})),it("generates correct source mapping",(function(){expect$6(pass$6).to.changeAST(["a = 'a'"].join("\n"),t([37,0,18,0,2,2,22,0,23,0,38],[{source:"-",start:{offset:4,line:1,column:5},end:{offset:7,line:1,column:8}}]),{grammarSource:"-",output:"source-and-map"})})),it("generates correct plucking bytecode",(function(){expect$6(pass$6).to.changeAST("start = 'a' @'b' 'c'",e([5,18,0,2,2,22,0,23,0,15,34,3,18,1,2,2,22,1,23,1,15,19,4,18,2,2,2,22,2,23,2,15,4,4,36,4,1,1,8,3,7,3,8,2,7,3,6,7,3])),expect$6(pass$6).to.changeAST("start = 'a' @'b' @'c'",e([5,18,0,2,2,22,0,23,0,15,35,3,18,1,2,2,22,1,23,1,15,20,4,18,2,2,2,22,2,23,2,15,5,4,36,4,2,1,0,8,3,7,3,8,2,7,3,6,7,3]))}))})),describe("for rule",(function(){it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST("start = 'a'",e([18,0,2,2,22,0,23,0]))}))})),describe("for named",(function(){var t="start 'start' = 'a'";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([28,18,0,2,2,22,0,23,1,29,14,2,0,23,0]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"rule",value:"start"},{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for choice",(function(){it("generates correct bytecode and source mapping",(function(){expect$6(pass$6).to.changeAST("start = 'a' / label:'b' / 'c'",t([37,5,37,0,18,0,2,2,22,0,23,0,38,14,36,0,6,37,3,39,0,2,2,37,1,18,1,2,2,22,1,23,1,38,40,0,38,14,12,0,6,37,4,18,3,2,2,22,3,23,2,38,38],[{source:"-",start:{offset:8,line:1,column:9},end:{offset:11,line:1,column:12}},{source:"-",start:{offset:20,line:1,column:21},end:{offset:23,line:1,column:24}},{source:"-",start:{offset:14,line:1,column:15},end:{offset:19,line:1,column:20}},{source:"-",start:{offset:14,line:1,column:15},end:{offset:23,line:1,column:24}},{source:"-",start:{offset:26,line:1,column:27},end:{offset:29,line:1,column:30}},{source:"-",start:{offset:8,line:1,column:9},end:{offset:29,line:1,column:30}}]),{grammarSource:"-",output:"source-and-map"})}))})),describe("for action",(function(){describe("without labels",(function(){var t="start = 'a' { code }";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:" code ",location:{source:void 0,start:{offset:13,line:1,column:14},end:{offset:19,line:1,column:20}}}]))}))})),describe("with one label",(function(){var t="start = a:'a' { code }";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,7,0,24,1,26,0,1,1,0,9]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:["a"],body:" code ",location:{source:void 0,start:{offset:15,line:1,column:16},end:{offset:21,line:1,column:22}}}]))}))})),describe("with multiple labels",(function(){var t="start = a:'a' b:'b' c:'c' { code }";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,39,3,18,1,2,2,22,1,23,1,15,24,4,18,2,2,2,22,2,23,2,15,9,4,24,3,26,0,4,3,2,1,0,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[{predicate:!1,params:["a","b","c"],body:" code ",location:{source:void 0,start:{offset:27,line:1,column:28},end:{offset:33,line:1,column:34}}}]))}))}))})),describe("for sequence",(function(){var t="start = 'a' 'b' 'c'";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,33,3,18,1,2,2,22,1,23,1,15,18,4,18,2,2,2,22,2,23,2,15,3,4,11,3,9,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[]))}))})),describe("for labeled",(function(){it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST("start = a:'a'",e([18,0,2,2,22,0,23,0]))}))})),describe("for text",(function(){it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST("start = $'a'",e([5,18,0,2,2,22,0,23,0,15,2,1,6,12,9]))}))})),describe("for simple_and",(function(){var t="start = &'a'";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([5,28,18,0,2,2,22,0,23,0,29,15,3,3,6,7,1,6,6,3]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for simple_not",(function(){var t="start = !'a'";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([5,28,18,0,2,2,22,0,23,0,29,14,3,3,6,6,1,6,7,3]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for optional",(function(){var t="start = 'a'?";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([18,0,2,2,22,0,23,0,14,2,0,6,2]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for zero_or_more",(function(){var t="start = 'a'*";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for one_or_more",(function(){var t="start = 'a'+";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,15,12,3,16,9,10,18,0,2,2,22,0,23,0,6,6,6,3]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for group",(function(){var t="start = ('a')";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([18,0,2,2,22,0,23,0]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for semantic_and",(function(){describe("without labels",(function(){var t="start = &{ code }";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([25,26,0,0,0,13,2,2,6,1,6,3]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r([],[],[],[{predicate:!0,params:[],body:" code ",location:{source:void 0,start:{offset:10,line:1,column:11},end:{offset:16,line:1,column:17}}}]))}))})),describe("with labels",(function(){var t="start = a:'a' b:'b' c:'c' &{ code }";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,55,3,18,1,2,2,22,1,23,1,15,40,4,18,2,2,2,22,2,23,2,15,25,4,25,26,0,0,3,2,1,0,13,2,2,6,1,6,3,15,3,4,11,4,9,8,4,7,3,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[{predicate:!0,params:["a","b","c"],body:" code ",location:{source:void 0,start:{offset:28,line:1,column:29},end:{offset:34,line:1,column:35}}}]))}))}))})),describe("for semantic_not",(function(){describe("without labels",(function(){var t="start = !{ code }";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([25,26,0,0,0,13,2,2,6,3,6,1]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r([],[],[],[{predicate:!0,params:[],body:" code ",location:{source:void 0,start:{offset:10,line:1,column:11},end:{offset:16,line:1,column:17}}}]))}))})),describe("with labels",(function(){var t="start = a:'a' b:'b' c:'c' !{ code }";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,55,3,18,1,2,2,22,1,23,1,15,40,4,18,2,2,2,22,2,23,2,15,25,4,25,26,0,0,3,2,1,0,13,2,2,6,3,6,1,15,3,4,11,4,9,8,4,7,3,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[{predicate:!0,params:["a","b","c"],body:" code ",location:{source:void 0,start:{offset:28,line:1,column:29},end:{offset:34,line:1,column:35}}}]))}))}))})),describe("for rule_ref",(function(){it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(["start = other","other = 'other'"].join("\n"),{rules:[{bytecode:[27,1]},{}]})}))})),describe("for literal",(function(){describe("empty",(function(){var t="start = ''";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([35]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r([],[],[],[]))}))})),describe("non-empty case-sensitive",(function(){var t="start = 'a'";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([18,0,2,2,22,0,23,0]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("non-empty case-insensitive",(function(){var t="start = 'A'i";it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([19,0,2,2,21,1,23,0]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r(["a"],[],[{type:"literal",value:"A",ignoreCase:!0}],[]))}))}))})),describe("for class",(function(){it("generates correct bytecode",(function(){expect$6(pass$6).to.changeAST("start = [a]",e([20,0,2,2,21,1,23,0]))})),describe("non-inverted case-sensitive",(function(){it("defines correct constants",(function(){expect$6(pass$6).to.changeAST("start = [a]",r([],[{value:["a"],ignoreCase:!1,inverted:!1}],[{type:"class",value:["a"],ignoreCase:!1,inverted:!1}],[]))}))})),describe("inverted case-sensitive",(function(){it("defines correct constants",(function(){expect$6(pass$6).to.changeAST("start = [^a]",r([],[{value:["a"],ignoreCase:!1,inverted:!0}],[{type:"class",value:["a"],ignoreCase:!1,inverted:!0}],[]))}))})),describe("non-inverted case-insensitive",(function(){it("defines correct constants",(function(){expect$6(pass$6).to.changeAST("start = [a]i",r([],[{value:["a"],ignoreCase:!0,inverted:!1}],[{type:"class",value:["a"],ignoreCase:!0,inverted:!1}],[]))}))})),describe("complex",(function(){it("defines correct constants",(function(){expect$6(pass$6).to.changeAST("start = [ab-def-hij-l]",r([],[{value:["a",["b","d"],"e",["f","h"],"i",["j","l"]],ignoreCase:!1,inverted:!1}],[{type:"class",value:["a",["b","d"],"e",["f","h"],"i",["j","l"]],ignoreCase:!1,inverted:!1}],[]))}))}))})),describe("for any",(function(){var t="start = .";it("generates bytecode",(function(){expect$6(pass$6).to.changeAST(t,e([17,2,2,21,1,23,0]))})),it("defines correct constants",(function(){expect$6(pass$6).to.changeAST(t,r([],[],[{type:"any"}],[]))}))}))}));var chai$5=require$$0__default.default,helpers$5=helpers$9,pass$5=reportDuplicateRules_1;chai$5.use(helpers$5);var expect$5=chai$5.expect;describe("compiler pass |reportDuplicateRules|",(function(){it("reports duplicate rules",(function(){expect$5(pass$5).to.reportError(["start = 'a'","start = 'b'"].join("\n"),{message:'Rule "start" is already defined',location:{source:void 0,start:{offset:12,line:2,column:1},end:{offset:17,line:2,column:6}},diagnostics:[{message:"Original rule location",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:5,line:1,column:6}}}]})}))}));var chai$4=require$$0__default.default,helpers$4=helpers$9,pass$4=reportDuplicateLabels_1;chai$4.use(helpers$4);var expect$4=chai$4.expect;describe("compiler pass |reportDuplicateLabels|",(function(){describe("in a sequence",(function(){it("reports labels duplicate with labels of preceding elements",(function(){expect$4(pass$4).to.reportError("start = a:'a' a:'a'",{message:'Label "a" is already defined',location:{source:void 0,start:{offset:14,line:1,column:15},end:{offset:15,line:1,column:16}},diagnostics:[{message:"Original label location",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:9,line:1,column:10}}}]})})),it("doesn't report labels duplicate with labels in subexpressions",(function(){expect$4(pass$4).to.not.reportError("start = ('a' / a:'a' / 'a') a:'a'"),expect$4(pass$4).to.not.reportError("start = (a:'a' { }) a:'a'"),expect$4(pass$4).to.not.reportError("start = ('a' a:'a' 'a') a:'a'"),expect$4(pass$4).to.not.reportError("start = b:(a:'a') a:'a'"),expect$4(pass$4).to.not.reportError("start = $(a:'a') a:'a'"),expect$4(pass$4).to.not.reportError("start = &(a:'a') a:'a'"),expect$4(pass$4).to.not.reportError("start = !(a:'a') a:'a'"),expect$4(pass$4).to.not.reportError("start = (a:'a')? a:'a'"),expect$4(pass$4).to.not.reportError("start = (a:'a')* a:'a'"),expect$4(pass$4).to.not.reportError("start = (a:'a')+ a:'a'"),expect$4(pass$4).to.not.reportError("start = (a:'a') a:'a'")}))})),describe("in a choice",(function(){it("doesn't report labels duplicate with labels of preceding alternatives",(function(){expect$4(pass$4).to.not.reportError("start = a:'a' / a:'a'")}))})),describe("in outer sequence",(function(){it("reports labels duplicate with labels of preceding elements",(function(){expect$4(pass$4).to.reportError("start = a:'a' (a:'a')",{message:'Label "a" is already defined',location:{source:void 0,start:{offset:15,line:1,column:16},end:{offset:16,line:1,column:17}},diagnostics:[{message:"Original label location",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:9,line:1,column:10}}}]})})),it("doesn't report labels duplicate with the label of the current element",(function(){expect$4(pass$4).to.not.reportError("start = a:(a:'a')")})),it("doesn't report labels duplicate with labels of following elements",(function(){expect$4(pass$4).to.not.reportError("start = (a:'a') a:'a'")}))}))}));var chai$3=require$$0__default.default,helpers$3=helpers$9,pass$3=reportInfiniteRecursion_1;chai$3.use(helpers$3);var expect$3=chai$3.expect;describe("compiler pass |reportInfiniteRecursion|",(function(){it("reports direct left recursion",(function(){expect$3(pass$3).to.reportError("start = start",{message:"Possible infinite loop when parsing (left recursion: start -> start)",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:5,line:1,column:6}}})})),it("reports indirect left recursion",(function(){expect$3(pass$3).to.reportError(["start = stop","stop = start"].join("\n"),{message:"Possible infinite loop when parsing (left recursion: start -> stop -> start)",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:5,line:1,column:6}}})})),describe("in sequences",(function(){it("reports left recursion if all preceding elements match empty string",(function(){expect$3(pass$3).to.reportError("start = '' '' '' start")})),it("doesn't report left recursion if some preceding element doesn't match empty string",(function(){expect$3(pass$3).to.not.reportError("start = 'a' '' '' start"),expect$3(pass$3).to.not.reportError("start = '' 'a' '' start"),expect$3(pass$3).to.not.reportError("start = '' '' 'a' start")})),it("reports left recursion when rule reference is wrapped in an expression",(function(){expect$3(pass$3).to.reportError("start = '' start?")})),it("computes expressions that always consume input on success correctly",(function(){expect$3(pass$3).to.reportError(["start = a start","a 'a' = ''"].join("\n")),expect$3(pass$3).to.not.reportError(["start = a start","a 'a' = 'a'"].join("\n")),expect$3(pass$3).to.reportError("start = ('' / 'a' / 'b') start"),expect$3(pass$3).to.reportError("start = ('a' / '' / 'b') start"),expect$3(pass$3).to.reportError("start = ('a' / 'b' / '') start"),expect$3(pass$3).to.not.reportError("start = ('a' / 'b' / 'c') start"),expect$3(pass$3).to.reportError("start = ('' { }) start"),expect$3(pass$3).to.not.reportError("start = ('a' { }) start"),expect$3(pass$3).to.reportError("start = ('' '' '') start"),expect$3(pass$3).to.not.reportError("start = ('a' '' '') start"),expect$3(pass$3).to.not.reportError("start = ('' 'a' '') start"),expect$3(pass$3).to.not.reportError("start = ('' '' 'a') start"),expect$3(pass$3).to.reportError("start = a:'' start"),expect$3(pass$3).to.not.reportError("start = a:'a' start"),expect$3(pass$3).to.reportError("start = $'' start"),expect$3(pass$3).to.not.reportError("start = $'a' start"),expect$3(pass$3).to.reportError("start = &'' start"),expect$3(pass$3).to.reportError("start = &'a' start"),expect$3(pass$3).to.reportError("start = !'' start"),expect$3(pass$3).to.reportError("start = !'a' start"),expect$3(pass$3).to.reportError("start = ''? start"),expect$3(pass$3).to.reportError("start = 'a'? start"),expect$3(pass$3).to.reportError("start = ''* start"),expect$3(pass$3).to.reportError("start = 'a'* start"),expect$3(pass$3).to.reportError("start = ''+ start"),expect$3(pass$3).to.not.reportError("start = 'a'+ start"),expect$3(pass$3).to.reportError("start = ('') start"),expect$3(pass$3).to.not.reportError("start = ('a') start"),expect$3(pass$3).to.reportError("start = &{ } start"),expect$3(pass$3).to.reportError("start = !{ } start"),expect$3(pass$3).to.reportError(["start = a start","a = ''"].join("\n")),expect$3(pass$3).to.not.reportError(["start = a start","a = 'a'"].join("\n")),expect$3(pass$3).to.reportError("start = '' start"),expect$3(pass$3).to.not.reportError("start = 'a' start"),expect$3(pass$3).to.not.reportError("start = [a-d] start"),expect$3(pass$3).to.not.reportError("start = . start")}))}))}));var chai$2=require$$0__default.default,helpers$2=helpers$9,pass$2=reportInfiniteRepetition_1;chai$2.use(helpers$2);var expect$2=chai$2.expect;describe("compiler pass |reportInfiniteRepetition|",(function(){it("reports infinite loops for zero_or_more",(function(){expect$2(pass$2).to.reportError("start = ('')*",{message:"Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:13,line:1,column:14}}})})),it("reports infinite loops for one_or_more",(function(){expect$2(pass$2).to.reportError("start = ('')+",{message:"Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:13,line:1,column:14}}})})),it("computes expressions that always consume input on success correctly",(function(){expect$2(pass$2).to.reportError(["start = a*","a 'a' = ''"].join("\n")),expect$2(pass$2).to.not.reportError(["start = a*","a 'a' = 'a'"].join("\n")),expect$2(pass$2).to.reportError("start = ('' / 'a' / 'b')*"),expect$2(pass$2).to.reportError("start = ('a' / '' / 'b')*"),expect$2(pass$2).to.reportError("start = ('a' / 'b' / '')*"),expect$2(pass$2).to.not.reportError("start = ('a' / 'b' / 'c')*"),expect$2(pass$2).to.reportError("start = ('' { })*"),expect$2(pass$2).to.not.reportError("start = ('a' { })*"),expect$2(pass$2).to.reportError("start = ('' '' '')*"),expect$2(pass$2).to.not.reportError("start = ('a' '' '')*"),expect$2(pass$2).to.not.reportError("start = ('' 'a' '')*"),expect$2(pass$2).to.not.reportError("start = ('' '' 'a')*"),expect$2(pass$2).to.reportError("start = (a:'')*"),expect$2(pass$2).to.not.reportError("start = (a:'a')*"),expect$2(pass$2).to.reportError("start = ($'')*"),expect$2(pass$2).to.not.reportError("start = ($'a')*"),expect$2(pass$2).to.reportError("start = (&'')*"),expect$2(pass$2).to.reportError("start = (&'a')*"),expect$2(pass$2).to.reportError("start = (!'')*"),expect$2(pass$2).to.reportError("start = (!'a')*"),expect$2(pass$2).to.reportError("start = (''?)*"),expect$2(pass$2).to.reportError("start = ('a'?)*"),expect$2(pass$2).to.reportError("start = (''*)*"),expect$2(pass$2).to.reportError("start = ('a'*)*"),expect$2(pass$2).to.reportError("start = (''+)*"),expect$2(pass$2).to.not.reportError("start = ('a'+)*"),expect$2(pass$2).to.reportError("start = ('')*"),expect$2(pass$2).to.not.reportError("start = ('a')*"),expect$2(pass$2).to.reportError("start = (&{ })*"),expect$2(pass$2).to.reportError("start = (!{ })*"),expect$2(pass$2).to.reportError(["start = a*","a = ''"].join("\n")),expect$2(pass$2).to.not.reportError(["start = a*","a = 'a'"].join("\n")),expect$2(pass$2).to.reportError("start = ''*"),expect$2(pass$2).to.not.reportError("start = 'a'*"),expect$2(pass$2).to.not.reportError("start = [a-d]*"),expect$2(pass$2).to.not.reportError("start = .*")}))}));var chai$1=require$$0__default.default,helpers$1=helpers$9,pass$1=reportIncorrectPlucking_1;chai$1.use(helpers$1);var expect$1=chai$1.expect;describe("compiler pass |reportIncorrectPlucking|",(function(){it('prevents "@" from being used with an action block',(function(){expect$1(pass$1).to.reportError("start1 = 'a' @'b' 'c' { /* empty action block */ }",{message:'"@" cannot be used with an action block',location:{source:void 0,start:{offset:13,line:1,column:14},end:{offset:14,line:1,column:15}},diagnostics:[{message:"Action block location",location:{source:void 0,start:{offset:23,line:1,column:24},end:{offset:49,line:1,column:50}}}]}),expect$1(pass$1).to.reportError("start2 = 'a' @('b' @'c' { /* empty action block */ })",{message:'"@" cannot be used with an action block',location:{source:void 0,start:{offset:19,line:1,column:20},end:{offset:20,line:1,column:21}},diagnostics:[{message:"Action block location",location:{source:void 0,start:{offset:25,line:1,column:26},end:{offset:51,line:1,column:52}}}]})})),it("allows valid plucking",(function(){expect$1(pass$1).not.to.reportError("\n\n      start1 =  @'1'               // return '1'\n      start2 =  @'1' / @'2'        // return '1' or '2'\n      start2 =   '1'   @'2' '3'    // return '2'\n      start3 =   '1' @b:'2' '3'    // return '2', label \"b\" can be used in semantic predicates\n      start4 = a:'1' @b:'2' '3'    // return '2', labels \"a\" and \"b\" can be used in semantic predicates\n      start5 =  @'1'   @'2' '3'    // return ['1', '2']\n      start6 =  @'1' @b:'2' '3'    // return ['1', '2'], label \"b\" can be used in semantic predicates\n      start7 = a:'1'   @'2' &{}    // return '2' if the semantic predicate doesnt fail\n      start8 = @a:$[a-z]i+ &{ return a === 'foo' } // return \"foo\"\n\n    ")}))}));var chai=require$$0__default.default,helpers=helpers$9,pass=reportUndefinedRules_1;chai.use(helpers);var expect=chai.expect;describe("compiler pass |reportUndefinedRules|",(function(){it("reports undefined rules",(function(){expect(pass).to.reportError("start = undefined",{message:'Rule "undefined" is not defined',location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:17,line:1,column:18}}})}))})),exports.peggyVersion=peggyVersion,Object.defineProperty(exports,"__esModule",{value:!0})}));