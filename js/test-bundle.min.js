// peggy 5.0.1
//
// https://peggyjs.org/
//
// Copyright (c) 2025- the Peggy authors
// Licensed under the MIT License.

var global,factory;global=this,factory=function(require$$0,require$$0$1){var generatedParserApi_spec={},grammarLocation,hasRequiredGrammarLocation,grammarError,hasRequiredGrammarError,visitor_1,hasRequiredVisitor,asts_1,hasRequiredAsts,addImportedRules_1,hasRequiredAddImportedRules,fixLibraryNumbers_1,hasRequiredFixLibraryNumbers,opcodes_1,hasRequiredOpcodes,intern,hasRequiredIntern,inferenceMatchResult_1,hasRequiredInferenceMatchResult,generateBytecode_1,hasRequiredGenerateBytecode;function requireGrammarLocation(){return hasRequiredGrammarLocation?grammarLocation:(hasRequiredGrammarLocation=1,grammarLocation=class{constructor(e,t){this.source=e,this.start=t}toString(){return String(this.source)}offset(e){return{line:e.line+this.start.line-1,column:1===e.line?e.column+this.start.column-1:e.column,offset:e.offset+this.start.offset}}static offsetStart(e){return e.source&&"function"==typeof e.source.offset?e.source.offset(e.start):e.start}static offsetEnd(e){return e.source&&"function"==typeof e.source.offset?e.source.offset(e.end):e.end}})}function requireGrammarError(){if(hasRequiredGrammarError)return grammarError;hasRequiredGrammarError=1;const e=requireGrammarLocation();class t extends SyntaxError{constructor(e,t,r){super(e),this.name="GrammarError",this.location=t,void 0===r&&(r=[]),this.diagnostics=r,this.stage=null,this.problems=[["error",e,t,r]]}toString(){let e=super.toString();this.location&&(e+="\n at ",void 0!==this.location.source&&null!==this.location.source&&(e+=`${this.location.source}:`),e+=`${this.location.start.line}:${this.location.start.column}`);for(const t of this.diagnostics)e+="\n from ",void 0!==t.location.source&&null!==t.location.source&&(e+=`${t.location.source}:`),e+=`${t.location.start.line}:${t.location.start.column}: ${t.message}`;return e}format(t){const r=t.map((({source:e,text:t})=>({source:e,text:null!=t?String(t).split(/\r\n|\n|\r/g):[]})));function a(t,a,o=""){let s="";const n=r.find((({source:e})=>e===t.source)),i=t.start,c=e.offsetStart(t);if(n){const e=t.end,r=n.text[i.line-1],l=(i.line===e.line?e.column:r.length+1)-i.column||1;o&&(s+=`\nnote: ${o}`),s+=`\n --\x3e ${t.source}:${c.line}:${c.column}\n${"".padEnd(a)} |\n${c.line.toString().padStart(a)} | ${r}\n${"".padEnd(a)} | ${"".padEnd(i.column-1)}${"".padEnd(l,"^")}`}else s+=`\n at ${t.source}:${c.line}:${c.column}`,o&&(s+=`: ${o}`);return s}return this.problems.filter((e=>"info"!==e[0])).map((t=>function(t,r,o,s=[]){let n=-1/0;n=o?s.reduce(((t,{location:r})=>Math.max(t,e.offsetStart(r).line)),o.start.line):Math.max.apply(null,s.map((e=>e.location.start.line))),n=n.toString().length;let i=`${t}: ${r}`;o&&(i+=a(o,n));for(const e of s)i+=a(e.location,n,e.message);return i}(...t))).join("\n\n")}}return grammarError=t}function requireVisitor(){return hasRequiredVisitor?visitor_1:(hasRequiredVisitor=1,visitor_1={build(e){function t(t,...r){return e[t.type](t,...r)}function r(){}function a(e,...r){return t(e.expression,...r)}function o(e){return function(r,...a){r[e].forEach((e=>t(e,...a)))}}const s={grammar(e,...r){for(const a of e.imports)t(a,...r);if(e.topLevelInitializer)if(Array.isArray(e.topLevelInitializer))for(const a of e.topLevelInitializer)t(a,...r);else t(e.topLevelInitializer,...r);if(e.initializer)if(Array.isArray(e.initializer))for(const a of e.initializer)t(a,...r);else t(e.initializer,...r);e.rules.forEach((e=>t(e,...r)))},grammar_import:r,top_level_initializer:r,initializer:r,rule:a,named:a,choice:o("alternatives"),action:a,sequence:o("elements"),labeled:a,text:a,simple_and:a,simple_not:a,optional:a,zero_or_more:a,one_or_more:a,repeated:(e,...r)=>(e.delimiter&&t(e.delimiter,...r),t(e.expression,...r)),group:a,semantic_and:r,semantic_not:r,rule_ref:r,library_ref:r,literal:r,class:r,any:r};return Object.keys(s).forEach((t=>{Object.prototype.hasOwnProperty.call(e,t)||(e[t]=s[t])})),t}})}function requireAsts(){if(hasRequiredAsts)return asts_1;hasRequiredAsts=1;const e=requireVisitor();function t(e,t){if(!e||!t)return e||t;const r=Array.isArray(e)?e:[e];return r.push(t),r}const r={findRule(e,t){for(let r=0;r<e.rules.length;r++)if(e.rules[r].name===t)return e.rules[r]},indexOfRule(e,t){for(let r=0;r<e.rules.length;r++)if(e.rules[r].name===t)return r;return-1},alwaysConsumesOnSuccess(t,a){function o(){return!0}function s(){return!1}const n=e.build({choice:e=>e.alternatives.every(n),sequence:e=>e.elements.some(n),simple_and:s,simple_not:s,optional:s,zero_or_more:s,repeated(e){const t=e.min?e.min:e.max;return!("constant"!==t.type||0===t.value||!n(e.expression)&&!(t.value>1&&e.delimiter&&n(e.delimiter)))},semantic_and:s,semantic_not:s,rule_ref(e){const a=r.findRule(t,e.name);return a?n(a):void 0},library_ref:s,literal:e=>""!==e.value,class:o,any:o});return n(a)},combine:e=>e.reduce(((e,r)=>(e.topLevelInitializer=t(e.topLevelInitializer,r.topLevelInitializer),e.initializer=t(e.initializer,r.initializer),e.rules=e.rules.concat(r.rules),e)))};return asts_1=r}function requireAddImportedRules(){return hasRequiredAddImportedRules?addImportedRules_1:(hasRequiredAddImportedRules=1,addImportedRules_1=function(e){let t=0;for(const r of e.imports){for(const a of r.what){let o;switch(a.type){case"import_binding_all":continue;case"import_binding_default":break;case"import_binding":o=a.binding;break;case"import_binding_rename":o=a.rename;break;default:throw new TypeError("Unknown binding type")}e.rules.push({type:"rule",name:a.binding,nameLocation:a.location,expression:{type:"library_ref",name:o,library:r.from.module,libraryNumber:t,location:a.location},location:r.from.location})}t++}})}function requireFixLibraryNumbers(){if(hasRequiredFixLibraryNumbers)return fixLibraryNumbers_1;hasRequiredFixLibraryNumbers=1;const e=requireVisitor();return fixLibraryNumbers_1=function(t,r,a){const o=e.build({library_ref(e){-1===e.libraryNumber&&(e.libraryNumber=function(e,t){let r=0;for(const a of e.imports){for(const e of a.what)if("import_binding_all"===e.type&&e.binding===t)return r;r++}return-1}(t,e.library),-1===e.libraryNumber&&a.error(`Unknown module "${e.library}"`,e.location))}});o(t)},fixLibraryNumbers_1}function requireOpcodes(){return hasRequiredOpcodes?opcodes_1:(hasRequiredOpcodes=1,opcodes_1={PUSH:0,PUSH_EMPTY_STRING:35,PUSH_UNDEFINED:1,PUSH_NULL:2,PUSH_FAILED:3,PUSH_EMPTY_ARRAY:4,PUSH_CURR_POS:5,POP:6,POP_CURR_POS:7,POP_N:8,NIP:9,APPEND:10,WRAP:11,TEXT:12,PLUCK:36,IF:13,IF_ERROR:14,IF_NOT_ERROR:15,IF_LT:30,IF_GE:31,IF_LT_DYNAMIC:32,IF_GE_DYNAMIC:33,WHILE_NOT_ERROR:16,MATCH_ANY:17,MATCH_STRING:18,MATCH_STRING_IC:19,MATCH_CHAR_CLASS:20,MATCH_UNICODE_CLASS:42,MATCH_REGEXP:20,ACCEPT_N:21,ACCEPT_STRING:22,FAIL:23,LOAD_SAVED_POS:24,UPDATE_SAVED_POS:25,CALL:26,RULE:27,LIBRARY_RULE:41,SILENT_FAILS_ON:28,SILENT_FAILS_OFF:29,SOURCE_MAP_PUSH:37,SOURCE_MAP_POP:38,SOURCE_MAP_LABEL_PUSH:39,SOURCE_MAP_LABEL_POP:40})}function requireIntern(){return hasRequiredIntern?intern:(hasRequiredIntern=1,intern=class{constructor(e){this.options={stringify:String,convert:e=>e,...e},this.items=[],this.offsets=Object.create(null)}add(e){const t=this.options.convert(e);if(!t)return-1;const r=this.options.stringify(t);let a=this.offsets[r];return void 0===a&&(a=this.items.push(t)-1,this.offsets[r]=a),a}get(e){return this.items[e]}map(e){return this.items.map(e)}})}function requireInferenceMatchResult(){if(hasRequiredInferenceMatchResult)return inferenceMatchResult_1;hasRequiredInferenceMatchResult=1;const e=requireVisitor(),t=requireAsts(),r=requireGrammarError(),a=-1;function o(o){function s(e){return e.match=0}function n(e){return l(e.expression),e.match=1}function i(e){return e.match=l(e.expression)}function c(e,t){const r=e.length;let o=0,s=0;for(let t=0;t<r;++t){const r=l(e[t]);1===r&&++o,r===a&&++s}return o===r?1:t?s===r?a:0:s>0?a:0}const l=e.build({rule(e){let t,a=0;if(void 0===e.match){e.match=0;do{if(t=e.match,e.match=l(e.expression),++a>6)throw new r("Infinity cycle detected when trying to evaluate node match result",e.location)}while(t!==e.match)}return e.match},named:i,choice:e=>e.match=c(e.alternatives,!0),action:i,sequence:e=>e.match=c(e.elements,!1),labeled:i,text:i,simple_and:i,simple_not:e=>e.match=-l(e.expression),optional:n,zero_or_more:n,one_or_more:i,repeated(e){const t=l(e.expression),r=e.delimiter?l(e.delimiter):a,o=e.min?e.min:e.max;return"constant"!==o.type||"constant"!==e.max.type?e.match=0:0===e.max.value||null!==e.max.value&&o.value>e.max.value?e.match=a:t===a?e.match=0===o.value?1:a:1===t?e.delimiter&&o.value>=2?e.match=r:e.match=1:e.delimiter&&o.value>=2?e.match=r===a?a:0:e.match=0===o.value?1:0},group:i,semantic_and:s,semantic_not:s,rule_ref(e){const r=t.findRule(o,e.name);return r?e.match=l(r):0},library_ref:()=>0,literal(e){const t=0===e.value.length?1:0;return e.match=t},class(e){const t=0===e.parts.length?a:0;return e.match=t},any:s});l(o)}return o.ALWAYS_MATCH=1,o.SOMETIMES_MATCH=0,o.NEVER_MATCH=a,inferenceMatchResult_1=o}function requireGenerateBytecode(){if(hasRequiredGenerateBytecode)return generateBytecode_1;hasRequiredGenerateBytecode=1;const e=requireAsts(),t=requireOpcodes(),r=requireVisitor(),a=requireIntern(),{ALWAYS_MATCH:o,SOMETIMES_MATCH:s,NEVER_MATCH:n}=requireInferenceMatchResult();return generateBytecode_1=function(i,c){const l=new a,u=new a({stringify:JSON.stringify,convert:e=>({value:e.parts,inverted:e.inverted,ignoreCase:e.ignoreCase,unicode:e.unicode})}),p=new a({stringify:JSON.stringify}),d=new a,m=[],h=[];function f(e,t,r){const a={predicate:e,params:t,body:r.code,location:r.codeLocation},o=JSON.stringify(a),s=m.findIndex((e=>JSON.stringify(e)===o));return-1===s?m.push(a)-1:s}function g(e){return h.push(e)-1}function b(e){const t={};return Object.keys(e).forEach((r=>{t[r]=e[r]})),t}function y(e,...t){return e.concat(...t)}function A(e,t,r,a){return e===o?r:e===n?a:t.concat([r.length,a.length],r,a)}function x(e,r,a,o){const s=Object.keys(a).map((e=>o-a[e]));return[t.CALL,e,r,s.length].concat(s)}function v(e,r,a){const o=e.match||0;return y([t.PUSH_CURR_POS],[t.SILENT_FAILS_ON],P(e,{sp:a.sp+1,env:b(a.env),action:null}),[t.SILENT_FAILS_OFF],A(r?-o:o,[r?t.IF_ERROR:t.IF_NOT_ERROR],y([t.POP],[r?t.POP:t.POP_CURR_POS],[t.PUSH_UNDEFINED]),y([t.POP],[r?t.POP_CURR_POS:t.POP],[t.PUSH_FAILED])))}function S(e,r,a){const o=f(!0,Object.keys(a.env),e);return y([t.UPDATE_SAVED_POS],x(o,0,a.env,a.sp),A(e.match||0,[t.IF],y([t.POP],r?[t.PUSH_FAILED]:[t.PUSH_UNDEFINED]),y([t.POP],r?[t.PUSH_UNDEFINED]:[t.PUSH_FAILED])))}function _(e){return r=[t.WHILE_NOT_ERROR],a=y([t.APPEND],e),r.concat([a.length],a);var r,a}function R(e,r,a,o){switch(e.type){case"constant":return{pre:[],post:[],sp:a};case"variable":return e.sp=o+a-r[e.value],{pre:[],post:[],sp:a};case"function":return e.sp=o,{pre:x(f(!0,Object.keys(r),{code:e.value,codeLocation:e.codeLocation}),0,r,a),post:[t.NIP],sp:a+1};default:throw function(e){return new Error(`Unknown boundary type "${e.type}" for the "repeated" node`)}(e)}}function T(e,r){if(null!==r.value){const a="constant"===r.type?[t.IF_GE,r.value]:[t.IF_GE_DYNAMIC,r.sp||0];return A(s,a,[t.PUSH_FAILED],e)}return e}const P=(w={grammar(e){e.rules.forEach(P),e.literals=l.items,e.classes=u.items,e.expectations=p.items,e.importedNames=d.items,e.functions=m,e.locations=h},rule(e){e.bytecode=P(e.expression,{sp:-1,env:{},pluck:[],action:null})},named(e,r){const a=e.match||0,s=a===o?-1:p.add({type:"rule",value:e.name});return y([t.SILENT_FAILS_ON],P(e.expression,r),[t.SILENT_FAILS_OFF],A(-a,[t.IF_ERROR],[t.FAIL,s],[]))},choice:(e,r)=>function e(r,a){const n=r[0].match||0,i=P(r[0],{sp:a.sp,env:b(a.env),action:null});return n===o?i:y(i,r.length>1?A(s,[t.IF_ERROR],y([t.POP],e(r.slice(1),a)),[]):[])}(e.alternatives,r),action(e,r){const a=b(r.env),o="sequence"!==e.expression.type||0===e.expression.elements.length,s=P(e.expression,{sp:r.sp+(o?1:0),env:a,action:e}),i=e.expression.match||0,c=o&&i!==n?f(!1,Object.keys(a),e):-1;return o?y([t.PUSH_CURR_POS],s,A(i,[t.IF_NOT_ERROR],y([t.LOAD_SAVED_POS,1],x(c,1,a,r.sp+2)),[]),[t.NIP]):s},sequence:(e,r)=>y([t.PUSH_CURR_POS],function r(a,o){if(a.length>0){const s=e.elements.length-a.length+1;return y(P(a[0],{sp:o.sp,env:o.env,pluck:o.pluck,action:null}),A(a[0].match||0,[t.IF_NOT_ERROR],r(a.slice(1),{sp:o.sp+1,env:o.env,pluck:o.pluck,action:o.action}),y(s>1?[t.POP_N,s]:[t.POP],[t.POP_CURR_POS],[t.PUSH_FAILED])))}if(o.pluck&&o.pluck.length>0)return y([t.PLUCK,e.elements.length+1,o.pluck.length],o.pluck.map((e=>o.sp-e)));if(o.action){const r=f(!1,Object.keys(o.env),o.action);return y([t.LOAD_SAVED_POS,e.elements.length],x(r,e.elements.length+1,o.env,o.sp))}return y([t.WRAP,e.elements.length],[t.NIP])}(e.elements,{sp:r.sp+1,env:r.env,pluck:[],action:r.action})),labeled(e,r){let a=r.env;const o=e.label,s=r.sp+1;o&&(a=b(r.env),r.env[o]=s),e.pick&&r.pluck.push(s);const n=P(e.expression,{sp:r.sp,env:a,action:null});return o&&e.labelLocation&&c&&"source-and-map"===c.output?y([t.SOURCE_MAP_LABEL_PUSH,s,l.add(o),g(e.labelLocation)],n,[t.SOURCE_MAP_LABEL_POP,s]):n},text:(e,r)=>y([t.PUSH_CURR_POS],P(e.expression,{sp:r.sp+1,env:b(r.env),action:null}),A(e.match||0,[t.IF_NOT_ERROR],y([t.POP],[t.TEXT]),[t.NIP])),simple_and:(e,t)=>v(e.expression,!1,t),simple_not:(e,t)=>v(e.expression,!0,t),optional:(e,r)=>y(P(e.expression,{sp:r.sp,env:b(r.env),action:null}),A(-(e.expression.match||0),[t.IF_ERROR],y([t.POP],[t.PUSH_NULL]),[])),zero_or_more(e,r){const a=P(e.expression,{sp:r.sp+1,env:b(r.env),action:null});return y([t.PUSH_EMPTY_ARRAY],a,_(a),[t.POP])},one_or_more(e,r){const a=P(e.expression,{sp:r.sp+1,env:b(r.env),action:null});return y([t.PUSH_EMPTY_ARRAY],a,A(e.expression.match||0,[t.IF_NOT_ERROR],y(_(a),[t.POP]),y([t.POP],[t.POP],[t.PUSH_FAILED])))},repeated(e,r){const a=e.min?e.min:e.max,o="constant"!==a.type||a.value>0,n="constant"!==e.max.type&&null!==e.max.value,i=o?2:1,c=e.min?R(e.min,r.env,r.sp,2+("function"===e.max.type?1:0)):{pre:[],post:[],sp:r.sp},l=R(e.max,r.env,c.sp,i),u=P(e.expression,{sp:l.sp+i,env:b(r.env),action:null}),p=null!==e.delimiter?P(e.expression,{sp:l.sp+i+1,env:b(r.env),action:null}):u,d=function(e,r,a,o,s){return e?y([t.PUSH_CURR_POS],P(e,{sp:o.sp+s+1,env:b(o.env),action:null}),A(e.match||0,[t.IF_NOT_ERROR],y([t.POP],a,A(-r,[t.IF_ERROR],[t.POP,t.POP_CURR_POS,t.PUSH_FAILED],[t.NIP])),[t.NIP])):a}(e.delimiter,e.expression.match||0,p,r,i),m=T(d,e.max),h=n?T(u,e.max):u,f=y(o?[t.PUSH_CURR_POS]:[],[t.PUSH_EMPTY_ARRAY],h,_(m),[t.POP]);return y(c.pre,l.pre,o?function(e,r){const a="constant"===r.type?[t.IF_LT,r.value]:[t.IF_LT_DYNAMIC,r.sp||0];return y(e,A(s,a,[t.POP,t.POP_CURR_POS,t.PUSH_FAILED],[t.NIP]))}(f,a):f,l.post,c.post)},group:(e,t)=>P(e.expression,{sp:t.sp,env:b(t.env),action:null}),semantic_and:(e,t)=>S(e,!1,t),semantic_not:(e,t)=>S(e,!0,t),rule_ref:r=>[t.RULE,e.indexOfRule(i,r.name)],library_ref:e=>[t.LIBRARY_RULE,e.libraryNumber,d.add(e.name)],literal(e){if(e.value.length>0){const r=e.match||0,a=r===s||r===o&&!e.ignoreCase?l.add(e.ignoreCase?e.value.toLowerCase():e.value):-1,n=r!==o?p.add({type:"literal",value:e.value,ignoreCase:e.ignoreCase}):-1;return A(r,e.ignoreCase?[t.MATCH_STRING_IC,a]:[t.MATCH_STRING,a],e.ignoreCase?[t.ACCEPT_N,e.value.length]:[t.ACCEPT_STRING,a],[t.FAIL,n])}return[t.PUSH_EMPTY_STRING]},class(e){const r=e.match||0,a=r===s?u.add(e):-1,n=r!==o?p.add({type:"class",value:e.parts,inverted:e.inverted,ignoreCase:e.ignoreCase,unicode:e.unicode}):-1;return A(r,[e.unicode?t.MATCH_UNICODE_CLASS:t.MATCH_CHAR_CLASS,a],[t.ACCEPT_N,e.unicode?-1:1],[t.FAIL,n])},any(e){const r=e.match||0,a=r!==o?p.add({type:"any"}):-1;return A(r,[t.MATCH_ANY],[t.ACCEPT_N,1],[t.FAIL,a])}},c&&"source-and-map"===c.output&&Object.keys(w).forEach((e=>{const r=w[e];w[e]=function(e,...a){const o=r(e,...a);return void 0!==o&&e.location?y([t.SOURCE_MAP_PUSH,g(e.location)],o,[t.SOURCE_MAP_POP]):o}})),r.build(w));var w;P(i)}}var sourceMap$1={},sourceMapGenerator$1={},base64Vlq$1={},base64$1={},hasRequiredBase64$1,hasRequiredBase64Vlq$1;function requireBase64$1(){if(hasRequiredBase64$1)return base64$1;hasRequiredBase64$1=1;const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return base64$1.encode=function(t){if(0<=t&&t<e.length)return e[t];throw new TypeError("Must be between 0 and 63: "+t)},base64$1}function requireBase64Vlq$1(){if(hasRequiredBase64Vlq$1)return base64Vlq$1;hasRequiredBase64Vlq$1=1;const e=requireBase64$1();return base64Vlq$1.encode=function(t){let r,a="",o=function(e){return e<0?1+(-e<<1):0+(e<<1)}(t);do{r=31&o,o>>>=5,o>0&&(r|=32),a+=e.encode(r)}while(o>0);return a},base64Vlq$1}var util$1={},hasRequiredUtil$1;function requireUtil$1(){if(hasRequiredUtil$1)return util$1;hasRequiredUtil$1=1,util$1.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};const e=!("__proto__"in Object.create(null));function t(e){return e}function r(e){if(!e)return!1;const t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(let r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function a(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}util$1.toSetString=e?t:function(e){return r(e)?"$"+e:e},util$1.fromSetString=e?t:function(e){return r(e)?e.slice(1):e},util$1.compareByGeneratedPositionsInflated=function(e,t){let r=e.generatedLine-t.generatedLine;return 0!==r?r:(r=e.generatedColumn-t.generatedColumn,0!==r?r:(r=a(e.source,t.source),0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r?r:a(e.name,t.name)))))};const o="http://host";function s(e){return t=>{const r=l(t),a=i(t),o=new URL(t,a);e(o);const s=o.toString();return"absolute"===r?s:"scheme-relative"===r?s.slice(5):"path-absolute"===r?s.slice(11):u(a,s)}}function n(e,t){return new URL(e,t).toString()}function i(e){const t=e.split("..").length-1,r=function(e,t){let r=0;for(;;){const e="p"+r++;if(-1===t.indexOf(e))return e}}(0,e);let a=`${o}/`;for(let e=0;e<t;e++)a+=`${r}/`;return a}const c=/^[A-Za-z0-9\+\-\.]+:/;function l(e){return"/"===e[0]?"/"===e[1]?"scheme-relative":"path-absolute":c.test(e)?"absolute":"path-relative"}function u(e,t){"string"==typeof e&&(e=new URL(e)),"string"==typeof t&&(t=new URL(t));const r=t.pathname.split("/"),a=e.pathname.split("/");for(a.length>0&&!a[a.length-1]&&a.pop();r.length>0&&a.length>0&&r[0]===a[0];)r.shift(),a.shift();return a.map((()=>"..")).concat(r).join("/")+t.search+t.hash}const p=s((e=>{e.pathname=e.pathname.replace(/\/?$/,"/")})),d=s((e=>{}));return util$1.normalize=d,util$1.join=function(e,t){const r=l(t),a=l(e);if(e=p(e),"absolute"===r)return n(t,void 0);if("absolute"===a)return n(t,e);if("scheme-relative"===r)return d(t);if("scheme-relative"===a)return n(t,n(e,o)).slice(5);if("path-absolute"===r)return d(t);if("path-absolute"===a)return n(t,n(e,o)).slice(11);const s=i(t+e);return u(s,n(t,n(e,s)))},util$1.relative=function(e,t){const r=function(e,t){if(l(e)!==l(t))return null;const r=i(e+t),a=new URL(e,r),o=new URL(t,r);try{new URL("",o.toString())}catch(e){return null}return o.protocol!==a.protocol||o.user!==a.user||o.password!==a.password||o.hostname!==a.hostname||o.port!==a.port?null:u(a,o)}(e,t);return"string"==typeof r?r:d(t)},util$1}var arraySet$1={},hasRequiredArraySet$1;function requireArraySet$1(){if(hasRequiredArraySet$1)return arraySet$1;hasRequiredArraySet$1=1;class e{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const a=new e;for(let e=0,o=t.length;e<o;e++)a.add(t[e],r);return a}size(){return this._set.size}add(e,t){const r=this.has(e),a=this._array.length;r&&!t||this._array.push(e),r||this._set.set(e,a)}has(e){return this._set.has(e)}indexOf(e){const t=this._set.get(e);if(t>=0)return t;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}}return arraySet$1.ArraySet=e,arraySet$1}var mappingList$1={},hasRequiredMappingList$1,hasRequiredSourceMapGenerator$1;function requireMappingList$1(){if(hasRequiredMappingList$1)return mappingList$1;hasRequiredMappingList$1=1;const e=requireUtil$1();return mappingList$1.MappingList=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,t){this._array.forEach(e,t)}add(t){!function(t,r){const a=t.generatedLine,o=r.generatedLine,s=t.generatedColumn,n=r.generatedColumn;return o>a||o==a&&n>=s||e.compareByGeneratedPositionsInflated(t,r)<=0}(this._last,t)?(this._sorted=!1,this._array.push(t)):(this._last=t,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(e.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}},mappingList$1}function requireSourceMapGenerator$1(){if(hasRequiredSourceMapGenerator$1)return sourceMapGenerator$1;hasRequiredSourceMapGenerator$1=1;const e=requireBase64Vlq$1(),t=requireUtil$1(),r=requireArraySet$1().ArraySet,a=requireMappingList$1().MappingList;class o{constructor(e){e||(e={}),this._file=t.getArg(e,"file",null),this._sourceRoot=t.getArg(e,"sourceRoot",null),this._skipValidation=t.getArg(e,"skipValidation",!1),this._sources=new r,this._names=new r,this._mappings=new a,this._sourcesContents=null}static fromSourceMap(e){const r=e.sourceRoot,a=new o({file:e.file,sourceRoot:r});return e.eachMapping((function(e){const o={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(o.source=e.source,null!=r&&(o.source=t.relative(r,o.source)),o.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(o.name=e.name)),a.addMapping(o)})),e.sources.forEach((function(o){let s=o;null!=r&&(s=t.relative(r,o)),a._sources.has(s)||a._sources.add(s);const n=e.sourceContentFor(o);null!=n&&a.setSourceContent(o,n)})),a}addMapping(e){const r=t.getArg(e,"generated"),a=t.getArg(e,"original",null);let o=t.getArg(e,"source",null),s=t.getArg(e,"name",null);this._skipValidation||this._validateMapping(r,a,o,s),null!=o&&(o=String(o),this._sources.has(o)||this._sources.add(o)),null!=s&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:r.line,generatedColumn:r.column,originalLine:a&&a.line,originalColumn:a&&a.column,source:o,name:s})}setSourceContent(e,r){let a=e;null!=this._sourceRoot&&(a=t.relative(this._sourceRoot,a)),null!=r?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[t.toSetString(a)]=r):this._sourcesContents&&(delete this._sourcesContents[t.toSetString(a)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))}applySourceMap(e,a,o){let s=a;if(null==a){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');s=e.file}const n=this._sourceRoot;null!=n&&(s=t.relative(n,s));const i=this._mappings.toArray().length>0?new r:this._sources,c=new r;this._mappings.unsortedForEach((function(r){if(r.source===s&&null!=r.originalLine){const a=e.originalPositionFor({line:r.originalLine,column:r.originalColumn});null!=a.source&&(r.source=a.source,null!=o&&(r.source=t.join(o,r.source)),null!=n&&(r.source=t.relative(n,r.source)),r.originalLine=a.line,r.originalColumn=a.column,null!=a.name&&(r.name=a.name))}const a=r.source;null==a||i.has(a)||i.add(a);const l=r.name;null==l||c.has(l)||c.add(l)}),this),this._sources=i,this._names=c,e.sources.forEach((function(r){const a=e.sourceContentFor(r);null!=a&&(null!=o&&(r=t.join(o,r)),null!=n&&(r=t.relative(n,r)),this.setSourceContent(r,a))}),this)}_validateMapping(e,t,r,a){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!t&&!r&&!a);else if(!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:a}))}_serializeMappings(){let r,a,o,s,n=0,i=1,c=0,l=0,u=0,p=0,d="";const m=this._mappings.toArray();for(let h=0,f=m.length;h<f;h++){if(a=m[h],r="",a.generatedLine!==i)for(n=0;a.generatedLine!==i;)r+=";",i++;else if(h>0){if(!t.compareByGeneratedPositionsInflated(a,m[h-1]))continue;r+=","}r+=e.encode(a.generatedColumn-n),n=a.generatedColumn,null!=a.source&&(s=this._sources.indexOf(a.source),r+=e.encode(s-p),p=s,r+=e.encode(a.originalLine-1-l),l=a.originalLine-1,r+=e.encode(a.originalColumn-c),c=a.originalColumn,null!=a.name&&(o=this._names.indexOf(a.name),r+=e.encode(o-u),u=o)),d+=r}return d}_generateSourcesContent(e,r){return e.map((function(e){if(!this._sourcesContents)return null;null!=r&&(e=t.relative(r,e));const a=t.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,a)?this._sourcesContents[a]:null}),this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}}return o.prototype._version=3,sourceMapGenerator$1.SourceMapGenerator=o,sourceMapGenerator$1}var sourceNode$1={},hasRequiredSourceNode$1,hasRequiredSourceMap$1,stack,hasRequiredStack;function requireSourceNode$1(){if(hasRequiredSourceNode$1)return sourceNode$1;hasRequiredSourceNode$1=1;const e=requireSourceMapGenerator$1().SourceMapGenerator,t=requireUtil$1(),r=/(\r?\n)/,a="$$$isSourceNode$$$";class o{constructor(e,t,r,o,s){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==s?null:s,this[a]=!0,null!=o&&this.add(o)}static fromStringWithSourceMap(e,a,s){const n=new o,i=e.split(r);let c=0;const l=function(){return e()+(e()||"");function e(){return c<i.length?i[c++]:void 0}};let u,p=1,d=0,m=null;return a.eachMapping((function(e){if(null!==m){if(!(p<e.generatedLine)){u=i[c]||"";const t=u.substr(0,e.generatedColumn-d);return i[c]=u.substr(e.generatedColumn-d),d=e.generatedColumn,h(m,t),void(m=e)}h(m,l()),p++,d=0}for(;p<e.generatedLine;)n.add(l()),p++;d<e.generatedColumn&&(u=i[c]||"",n.add(u.substr(0,e.generatedColumn)),i[c]=u.substr(e.generatedColumn),d=e.generatedColumn),m=e}),this),c<i.length&&(m&&h(m,l()),n.add(i.splice(c).join(""))),a.sources.forEach((function(e){const r=a.sourceContentFor(e);null!=r&&(null!=s&&(e=t.join(s,e)),n.setSourceContent(e,r))})),n;function h(e,r){if(null===e||void 0===e.source)n.add(r);else{const a=s?t.join(s,e.source):e.source;n.add(new o(e.originalLine,e.originalColumn,a,r,e.name))}}}add(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this}prepend(e){if(Array.isArray(e))for(let t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this}walk(e){let t;for(let r=0,o=this.children.length;r<o;r++)t=this.children[r],t[a]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let t,r;const a=this.children.length;if(a>0){for(t=[],r=0;r<a-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this}replaceRight(e,t){const r=this.children[this.children.length-1];return r[a]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this}setSourceContent(e,r){this.sourceContents[t.toSetString(e)]=r}walkSourceContents(e){for(let t=0,r=this.children.length;t<r;t++)this.children[t][a]&&this.children[t].walkSourceContents(e);const r=Object.keys(this.sourceContents);for(let a=0,o=r.length;a<o;a++)e(t.fromSetString(r[a]),this.sourceContents[r[a]])}toString(){let e="";return this.walk((function(t){e+=t})),e}toStringWithSourceMap(t){const r={code:"",line:1,column:0},a=new e(t);let o=!1,s=null,n=null,i=null,c=null;return this.walk((function(e,t){r.code+=e,null!==t.source&&null!==t.line&&null!==t.column?(s===t.source&&n===t.line&&i===t.column&&c===t.name||a.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:r.line,column:r.column},name:t.name}),s=t.source,n=t.line,i=t.column,c=t.name,o=!0):o&&(a.addMapping({generated:{line:r.line,column:r.column}}),s=null,o=!1);for(let n=0,i=e.length;n<i;n++)10===e.charCodeAt(n)?(r.line++,r.column=0,n+1===i?(s=null,o=!1):o&&a.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:r.line,column:r.column},name:t.name})):r.column++})),this.walkSourceContents((function(e,t){a.setSourceContent(e,t)})),{code:r.code,map:a}}}return sourceNode$1.SourceNode=o,sourceNode$1}function requireSourceMap$1(){return hasRequiredSourceMap$1||(hasRequiredSourceMap$1=1,sourceMap$1.SourceMapGenerator=requireSourceMapGenerator$1().SourceMapGenerator,sourceMap$1.SourceNode=requireSourceNode$1().SourceNode),sourceMap$1}function requireStack(){if(hasRequiredStack)return stack;hasRequiredStack=1;const{SourceNode:e}=requireSourceMap$1(),t=requireGrammarLocation();class r{constructor(e,t,r,a){this.sp=-1,this.maxSp=-1,this.varName=t,this.ruleName=e,this.type=r,this.bytecode=a,this.labels={},this.sourceMapStack=[]}name(e){if(e<0)throw new RangeError(`Rule '${this.ruleName}': The variable stack underflow: attempt to use a variable '${this.varName}<x>' at an index ${e}.\nBytecode: ${this.bytecode}`);return this.varName+e}static sourceNode(r,a,o){const s=t.offsetStart(r);return new e(s.line,s.column?s.column-1:null,String(r.source),a,o)}push(t){++this.sp>this.maxSp&&(this.maxSp=this.sp);const a=this.labels[this.sp],o=[this.name(this.sp)," = ",t,";"];if(a){if(this.sourceMapStack.length){const t=r.sourceNode(a.location,o.splice(0,2),a.label),{parts:s,location:n}=this.sourceMapPopInternal(),i=n.start.offset<a.location.end.offset?{start:a.location.end,end:n.end,source:n.source}:n,c=r.sourceNode(i,o.concat("\n"));return this.sourceMapStack.push([s,s.length+1,n]),new e(null,null,a.location.source,[t,c])}return r.sourceNode(a.location,o.concat("\n"))}return o.join("")}pop(e){return void 0!==e?(this.sp-=e,Array.from({length:e},((e,t)=>this.name(this.sp+1+t)))):this.name(this.sp--)}top(){return this.name(this.sp)}index(e){if(e<0)throw new RangeError(`Rule '${this.ruleName}': The variable stack overflow: attempt to get a variable at a negative index ${e}.\nBytecode: ${this.bytecode}`);return this.name(this.sp-e)}result(){if(this.maxSp<0)throw new RangeError(`Rule '${this.ruleName}': The variable stack is empty, can't get the result.\nBytecode: ${this.bytecode}`);return this.name(0)}defines(){return this.maxSp<0?"":this.type+" "+Array.from({length:this.maxSp+1},((e,t)=>this.name(t))).join(", ")+";"}checkedIf(e,t,r){const a=this.sp,o=t();if(!r)return[o];const s=this.sp;this.sp=a;const n=r();if(s!==this.sp)throw new Error("Rule '"+this.ruleName+"', position "+e+": Branches of a condition can't move the stack pointer differently (before: "+a+", after then: "+s+", after else: "+this.sp+"). Bytecode: "+this.bytecode);return[o,n]}checkedLoop(e,t){const r=this.sp,a=t();if(r!==this.sp)throw new Error("Rule '"+this.ruleName+"', position "+e+": Body of a loop can't move the stack pointer (before: "+r+", after: "+this.sp+"). Bytecode: "+this.bytecode);return a}sourceMapPush(e,t){if(this.sourceMapStack.length){const e=this.sourceMapStack[this.sourceMapStack.length-1];e[2].start.offset===t.start.offset&&e[2].end.offset>t.end.offset&&(e[2]={start:t.end,end:e[2].end,source:e[2].source})}this.sourceMapStack.push([e,e.length,t])}sourceMapPopInternal(){const r=this.sourceMapStack.pop();if(!r)throw new RangeError(`Rule '${this.ruleName}': Attempting to pop an empty source map stack.\nBytecode: ${this.bytecode}`);const[a,o,s]=r,n=a.splice(o).map((t=>t instanceof e?t:t+"\n"));if(n.length){const r=t.offsetStart(s);a.push(new e(r.line,r.column-1,String(s.source),n))}return{parts:a,location:s}}sourceMapPop(e){const{location:t}=this.sourceMapPopInternal();if(this.sourceMapStack.length&&t.end.offset<this.sourceMapStack[this.sourceMapStack.length-1][2].end.offset){const{parts:r,location:a}=this.sourceMapPopInternal(),o=a.start.offset<t.end.offset?{start:t.end,end:a.end,source:a.source}:a;this.sourceMapStack.push([r,r.length+(e||0),o])}}}return stack=r}var version$1={},hasRequiredVersion;function requireVersion(){return hasRequiredVersion||(hasRequiredVersion=1,version$1.version="5.0.1"),version$1}var utils$1={},hasRequiredUtils$1,parser,hasRequiredParser,generateJs,hasRequiredGenerateJs,removeProxyRules_1,hasRequiredRemoveProxyRules,mergeCharacterClasses_1,hasRequiredMergeCharacterClasses,removeUnusedRules_1,hasRequiredRemoveUnusedRules,reportDuplicateImports_1,hasRequiredReportDuplicateImports,reportDuplicateLabels_1,hasRequiredReportDuplicateLabels,reportDuplicateRules_1,hasRequiredReportDuplicateRules,reportInfiniteRecursion_1,hasRequiredReportInfiniteRecursion,reportInfiniteRepetition_1,hasRequiredReportInfiniteRepetition,reportUndefinedRules_1,hasRequiredReportUndefinedRules,reportIncorrectPlucking_1,hasRequiredReportIncorrectPlucking,reportUnreachable_1,hasRequiredReportUnreachable,session,hasRequiredSession,compiler_1,hasRequiredCompiler,peg_1,hasRequiredPeg;function requireUtils$1(){if(hasRequiredUtils$1)return utils$1;function e(e){return e.codePointAt(0).toString(16).toUpperCase()}return hasRequiredUtils$1=1,utils$1.hex=e,utils$1.stringEscape=function(t){return"object"==typeof t?`\\\\${t.value}`:t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\v/g,"\\v").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\u{10000}-\u{10FFFF}]/gu,(t=>`\\u{${e(t)}}`)).replace(/[\x00-\x0F]/g,(t=>"\\x0"+e(t))).replace(/[\x10-\x1F\x7F-\xFF]/g,(t=>"\\x"+e(t))).replace(/[\u0100-\u0FFF]/g,(t=>"\\u0"+e(t))).replace(/[\u1000-\uFFFF]/g,(t=>"\\u"+e(t)))},utils$1.regexpClassEscape=function(t){return"object"==typeof t?`\\${t.value}`:t.replace(/\\/g,"\\\\").replace(/\//g,"\\/").replace(/]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\v/g,"\\v").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(t=>"\\x0"+e(t))).replace(/[\x10-\x1F\x7F-\xFF]/g,(t=>"\\x"+e(t))).replace(/[\u{10000}-\u{10FFFF}]/gu,(t=>"\\u{"+e(t)+"}")).replace(/[\u0100-\u0FFF]/g,(t=>"\\u0"+e(t))).replace(/[\u1000-\uFFFF]/g,(t=>"\\u"+e(t)))},utils$1.base64=function(e){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r=e.length%3,a=e.length-r;let o="";for(let r=0;r<a;r+=3)o+=t[e[r]>>2],o+=t[(3&e[r])<<4|e[r+1]>>4],o+=t[(15&e[r+1])<<2|e[r+2]>>6],o+=t[63&e[r+2]];return 1===r?(o+=t[e[a]>>2],o+=t[(3&e[a])<<4],o+="=="):2===r&&(o+=t[e[a]>>2],o+=t[(3&e[a])<<4|e[a+1]>>4],o+=t[(15&e[a+1])<<2],o+="="),o},utils$1.codePointLen1=function(e){const t=e[Symbol.iterator](),r=t.next();return r.done?-1:t.next().done?r.value.codePointAt(0):-1},utils$1}function requireParser(){if(hasRequiredParser)return parser;hasRequiredParser=1;const e={$:"text","&":"simple_and","!":"simple_not"},t={"?":"optional","*":"zero_or_more","+":"one_or_more"},r={"&":"semantic_and","!":"semantic_not"};class a extends SyntaxError{constructor(e,t,r,a){super(e),this.expected=t,this.found=r,this.location=a,this.name="SyntaxError"}format(e){let t="Error: "+this.message;if(this.location){let r=null;const a=e.find((e=>e.source===this.location.source));a&&(r=a.text.split(/\r\n|\n|\r/g));const o=this.location.start,s=this.location.source&&"function"==typeof this.location.source.offset?this.location.source.offset(o):o,n=this.location.source+":"+s.line+":"+s.column;if(r){const e=this.location.end,a="".padEnd(s.line.toString().length," "),i=r[o.line-1],c=(o.line===e.line?e.column:i.length+1)-o.column||1;t+="\n --\x3e "+n+"\n"+a+" |\n"+s.line+" | "+i+"\n"+a+" | "+"".padEnd(o.column-1," ")+"".padEnd(c,"^")}else t+="\n at "+n}return t}static buildMessage(e,t){function r(e){return e.codePointAt(0).toString(16).toUpperCase()}const a=Object.prototype.hasOwnProperty.call(RegExp.prototype,"unicode")?new RegExp("[\\p{C}\\p{Mn}\\p{Mc}]","gu"):null;function o(e){return a?e.replace(a,(e=>"\\u{"+r(e)+"}")):e}function s(e){return o(e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+r(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+r(e))))}function n(e){return o(e.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(e=>"\\x0"+r(e))).replace(/[\x10-\x1F\x7F-\x9F]/g,(e=>"\\x"+r(e))))}const i={literal:e=>'"'+s(e.text)+'"',class(e){const t=e.parts.map((e=>Array.isArray(e)?n(e[0])+"-"+n(e[1]):n(e)));return"["+(e.inverted?"^":"")+t.join("")+"]"+(e.unicode?"u":"")},any:()=>"any character",end:()=>"end of input",other:e=>e.description};function c(e){return i[e.type](e)}return"Expected "+function(e){const t=e.map(c);if(t.sort(),t.length>0){let e=1;for(let r=1;r<t.length;r++)t[r-1]!==t[r]&&(t[e]=t[r],e++);t.length=e}switch(t.length){case 1:return t[0];case 2:return t[0]+" or "+t[1];default:return t.slice(0,-1).join(", ")+", or "+t[t.length-1]}}(e)+" but "+function(e){return e?'"'+s(e)+'"':"end of input"}(t)+" found."}}return parser={StartRules:["Grammar","ImportsAndSource"],SyntaxError:a,parse:function(o,s){const n={},i=(s=void 0!==s?s:{}).grammarSource,c={Grammar:Kt,ImportsAndSource:function(){let e,t,r;return e=Mt,t=function(){let e,t;return e=Mt,t=Mt,Xt(),t=o.substring(t,Mt),Ot=e,t={type:"top_level_initializer",code:t,codeLocation:Bt()},e=t,e}(),r=function(){let e,t,r,a;for(e=Mt,t=Mt,r=[],o.length>Mt?(a=o.charAt(Mt),Mt++):(a=n,0===Dt&&Zt(ye));a!==n;)r.push(a),o.length>Mt?(a=o.charAt(Mt),Mt++):(a=n,0===Dt&&Zt(ye));return t=o.substring(t,Mt),Ot=e,t={type:"top_level_initializer",code:t,codeLocation:Bt()},e=t,e}(),Ot=e,e=[t,r],e}};let l=Kt;const u="import",p=";",d=",",m="*",h="as",f="{",g="}",b="from",y="=",A="/",x="@",v=":",S="|",_="..",R="(",T=")",P=".",w="\n",E="\r\n",C="/*",q="*/",$="//",L="\\",I="i",k='"',M="'",O="[",F="^",U="]",j="p",N="_",D="u",B="-",G="0",z="b",H="f",V="n",W="r",J="t",Y="v",Z="x",K=/^[!$&]/,X=/^[*-+?]/,Q=/^[!&]/,ee=/^[\0-\uD7FF\uE000-\uFFFF]/,te=/^[\uD800-\uDBFF]/,re=/^[\uDC00-\uDFFF]/,ae=/^[\uD800-\uDFFF]/,oe=/^[\t\v-\f \p{Zs}\xA0\uFEFF]/u,se=/^[\n\r\u2028\u2029]/,ne=/^[\r\u2028-\u2029]/,ie=/^[\p{ID_Start}_]/u,ce=/^[$\p{ID_Continue}]/u,le=/^[\n\r"\\\u2028-\u2029]/,ue=/^[\n\r'\\\u2028-\u2029]/,pe=/^[a-z]/i,de=/^[\n\r\\-\]\u2028-\u2029]/,me=/^["'\\]/,he=/^[0-9pux]/,fe=/^[0-9]/,ge=/^[0-9a-f]/i,be=/^[{}]/,ye={type:"any"},Ae=Ht("import",!1),xe=Ht(";",!1),ve=Ht(",",!1),Se=Ht("*",!1),_e=Ht("as",!1),Re=Ht("{",!1),Te=Ht("}",!1),Pe=Ht("from",!1),we=Ht("=",!1),Ee=Ht("/",!1),Ce=Ht("@",!1),qe=Ht(":",!1),$e=Vt(["!","$","&"],!1,!1,!1),Le=Vt([["*","+"],"?"],!1,!1,!1),Ie=Ht("|",!1),ke=Ht("..",!1),Me=Ht("(",!1),Oe=Ht(")",!1),Fe=Ht(".",!1),Ue=Vt(["!","&"],!1,!1,!1),je=Vt([["\0","퟿"],["","￿"]],!1,!1,!1),Ne=Vt([["\ud800","\udbff"]],!1,!1,!1),De=Vt([["\udc00","\udfff"]],!1,!1,!1),Be=Vt([["\ud800","\udfff"]],!1,!1,!1),Ge=Wt("whitespace"),ze=Vt(["\t",["\v","\f"]," ","\\p{Zs}"," ","\ufeff"],!1,!1,!0),He=Vt(["\n","\r","\u2028","\u2029"],!1,!1,!1),Ve=Wt("end of line"),We=Ht("\n",!1),Je=Ht("\r\n",!1),Ye=Vt(["\r",["\u2028","\u2029"]],!1,!1,!1),Ze=Wt("comment"),Ke=Ht("/*",!1),Xe=Ht("*/",!1),Qe=Ht("//",!1),et=Wt("identifier"),tt=Vt(["\\p{ID_Start}","_"],!1,!1,!0),rt=Ht("\\",!1),at=Vt(["$","\\p{ID_Continue}"],!1,!1,!0),ot=Wt("literal"),st=Ht("i",!1),nt=Wt("string"),it=Ht('"',!1),ct=Ht("'",!1),lt=Vt(["\n","\r",'"',"\\",["\u2028","\u2029"]],!1,!1,!1),ut=Vt(["\n","\r","'","\\",["\u2028","\u2029"]],!1,!1,!1),pt=Wt("character class"),dt=Ht("[",!1),mt=Ht("^",!1),ht=Ht("]",!1),ft=Ht("p",!0),gt=Ht("_",!1),bt=Vt([["a","z"]],!1,!0,!1),yt=Ht("u",!1),At=Ht("-",!1),xt=Vt(["\n","\r",["\\","]"],["\u2028","\u2029"]],!1,!1,!1),vt=Ht("0",!1),St=Vt(['"',"'","\\"],!1,!1,!1),_t=Ht("b",!1),Rt=Ht("f",!1),Tt=Ht("n",!1),Pt=Ht("r",!1),wt=Ht("t",!1),Et=Ht("v",!1),Ct=Vt([["0","9"],"p","u","x"],!1,!1,!1),qt=Ht("x",!1),$t=Vt([["0","9"]],!1,!1,!1),Lt=Vt([["0","9"],["a","f"]],!1,!0,!1),It=Wt("code block"),kt=Vt(["{","}"],!1,!1,!1);let Mt=0|s.peg$currPos,Ot=Mt;const Ft=[{line:1,column:1}];let Ut,jt=Mt,Nt=s.peg$maxFailExpected||[],Dt=0|s.peg$silentFails;if(s.startRule){if(!(s.startRule in c))throw new Error("Can't start parsing from rule \""+s.startRule+'".');l=c[s.startRule]}function Bt(){return Yt(Ot,Mt)}function Gt(e,t){throw function(e,t){return new a(e,null,null,t)}(e,t=void 0!==t?t:Yt(Ot,Mt))}function zt(e=Mt){const t=o.codePointAt(e);return void 0===t?"":String.fromCodePoint(t)}function Ht(e,t){return{type:"literal",text:e,ignoreCase:t}}function Vt(e,t,r,a){return{type:"class",parts:e,inverted:t,ignoreCase:r,unicode:a}}function Wt(e){return{type:"other",description:e}}function Jt(e){let t,r=Ft[e];if(r)return r;if(e>=Ft.length)t=Ft.length-1;else for(t=e;!Ft[--t];);for(r=Ft[t],r={line:r.line,column:r.column};t<e;)10===o.charCodeAt(t)?(r.line++,r.column=1):r.column++,t++;return Ft[e]=r,r}function Yt(e,t,r){const a=Jt(e),o=Jt(t);return{source:i,start:{offset:e,line:a.line,column:a.column},end:{offset:t,line:o.line,column:o.column}}}function Zt(e){Mt<jt||(Mt>jt&&(jt=Mt,Nt=[]),Nt.push(e))}function Kt(){let e,t,r,a,s,i,c,l;if(e=Mt,t=Xt(),r=Mt,a=Nr(),s=function(){let e,t,r,a,s;var i;return e=Mt,123===o.charCodeAt(Mt)?(t=f,Mt++):(t=n,0===Dt&&Zt(Re)),t!==n?(r=Ur(),r!==n?(125===o.charCodeAt(Mt)?(a=g,Mt++):(a=n,0===Dt&&Zt(Te)),a!==n?(s=Dr(),s!==n?(Ot=e,e={type:"top_level_initializer",code:(i=r)[0],codeLocation:i[1],location:Bt()}):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e}(),s!==n?r=s:(Mt=r,r=n),r===n&&(r=null),a=Mt,s=Nr(),i=function(){let e,t,r;var a;return e=Mt,t=Ur(),t!==n?(r=Dr(),r!==n?(Ot=e,e={type:"initializer",code:(a=t)[0],codeLocation:a[1],location:Bt()}):(Mt=e,e=n)):(Mt=e,e=n),e}(),i!==n?a=i:(Mt=a,a=n),a===n&&(a=null),s=Nr(),i=[],c=Mt,l=sr(),l!==n?(Nr(),c=l):(Mt=c,c=n),c!==n)for(;c!==n;)i.push(c),c=Mt,l=sr(),l!==n?(Nr(),c=l):(Mt=c,c=n);else i=n;return i!==n?(Ot=e,e={type:"grammar",imports:t,topLevelInitializer:r,initializer:a,rules:i,location:Bt()}):(Mt=e,e=n),e}function Xt(){let e,t;for(e=[],t=Qt();t!==n;)e.push(t),t=Qt();return e}function Qt(){let e,t,r,a,s,i,c,l;return e=Mt,Nr(),o.substr(Mt,6)===u?(t=u,Mt+=6):(t=n,0===Dt&&Zt(Ae)),t!==n?(Nr(),r=function(){let e,t,r,a,s;var i,c;return e=er(),e===n&&(e=tr(),e===n&&(e=Mt,t=function(){let e,t;var r;return e=Mt,t=or(),t!==n&&(Ot=e,t={type:"import_binding_default",binding:(r=t)[0],location:r[1]}),e=t,e}(),t!==n?(r=Mt,Nr(),44===o.charCodeAt(Mt)?(a=d,Mt++):(a=n,0===Dt&&Zt(ve)),a!==n?(Nr(),s=er(),s===n&&(s=tr()),s!==n?r=s:(Mt=r,r=n)):(Mt=r,r=n),r===n&&(r=null),Ot=e,i=t,e=(c=r)?(c.unshift(i),c):[i]):(Mt=e,e=n))),e}(),r!==n?(a=Nr(),s=function(){let e,t,r;return e=Mt,o.substr(Mt,4)===b?(t=b,Mt+=4):(t=n,0===Dt&&Zt(Pe)),t!==n?(Nr(),r=ar(),r!==n?e=r:(Mt=e,e=n)):(Mt=e,e=n),e}(),s!==n?(i=Mt,c=Nr(),59===o.charCodeAt(Mt)?(l=p,Mt++):(l=n,0===Dt&&Zt(xe)),l!==n?(c=[c,l],i=c):(Mt=i,i=n),i===n&&(i=null),Ot=e,e={type:"grammar_import",what:r,from:s,location:Bt()}):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=Mt,Nr(),o.substr(Mt,6)===u?(t=u,Mt+=6):(t=n,0===Dt&&Zt(Ae)),t!==n?(Nr(),r=ar(),r!==n?(a=Mt,s=Nr(),59===o.charCodeAt(Mt)?(i=p,Mt++):(i=n,0===Dt&&Zt(xe)),i!==n?(s=[s,i],a=s):(Mt=a,a=n),a===n&&(a=null),Ot=e,e={type:"grammar_import",what:[],from:r,location:Bt()}):(Mt=e,e=n)):(Mt=e,e=n)),e}function er(){let e,t,r,a;var s;return e=Mt,42===o.charCodeAt(Mt)?(t=m,Mt++):(t=n,0===Dt&&Zt(Se)),t!==n?(Nr(),o.substr(Mt,2)===h?(r=h,Mt+=2):(r=n,0===Dt&&Zt(_e)),r!==n?(Nr(),a=or(),a!==n?(Ot=e,e=[{type:"import_binding_all",binding:(s=a)[0],location:s[1]}]):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e}function tr(){let e,t,r,a,s,i;return e=Mt,123===o.charCodeAt(Mt)?(t=f,Mt++):(t=n,0===Dt&&Zt(Re)),t!==n?(Nr(),125===o.charCodeAt(Mt)?(r=g,Mt++):(r=n,0===Dt&&Zt(Te)),r!==n?(Ot=e,e=[]):(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=Mt,123===o.charCodeAt(Mt)?(t=f,Mt++):(t=n,0===Dt&&Zt(Re)),t!==n?(Nr(),r=function(){let e,t,r,a,s,i,c;for(e=Mt,t=[],r=rr();r!==n;)t.push(r),r=Mt,a=Mt,s=Nr(),44===o.charCodeAt(Mt)?(i=d,Mt++):(i=n,0===Dt&&Zt(ve)),i!==n?(c=Nr(),s=[s,i,c],a=s):(Mt=a,a=n),a!==n?(a=rr(),a===n?(Mt=r,r=n):r=a):r=a;return t.length<1?(Mt=e,e=n):e=t,e}(),r!==n?(Nr(),a=Mt,44===o.charCodeAt(Mt)?(s=d,Mt++):(s=n,0===Dt&&Zt(ve)),s!==n?(i=Nr(),s=[s,i],a=s):(Mt=a,a=n),a===n&&(a=null),125===o.charCodeAt(Mt)?(s=g,Mt++):(s=n,0===Dt&&Zt(Te)),s!==n?e=r:(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)),e}function rr(){let e,t,r,a;var s,i;return e=Mt,t=function(){let e,t;return e=vr(),e===n&&(e=Mt,t=_r(),t!==n&&(Ot=e,t=[t,Bt()]),e=t),e}(),t!==n?(Nr(),o.substr(Mt,2)===h?(r=h,Mt+=2):(r=n,0===Dt&&Zt(_e)),r!==n?(Nr(),a=or(),a!==n?(Ot=e,i=a,e={type:"import_binding_rename",rename:(s=t)[0],renameLocation:s[1],binding:i[0],location:i[1]}):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=Mt,t=or(),t!==n&&(Ot=e,t=function(e){return{type:"import_binding",binding:e[0],location:e[1]}}(t)),e=t),e}function ar(){let e,t;return e=Mt,t=_r(),t!==n&&(Ot=e,t=function(e){return{type:"import_module_specifier",module:e,location:Bt()}}(t)),e=t,e}function or(){let e,t;return e=Mt,t=function(){let e,t;var r;return e=Mt,t=vr(),t!==n&&(Ot=e,r=t,Br.has(r[0])&&Gt(`Binding identifier can't be a reserved word "${r[0]}"`,r[1]),t=r[0]),e=t,e}(),t!==n&&(Ot=e,t=[t,Bt()]),e=t,e}function sr(){let e,t,r,a,s,i;var c,l,u;return e=Mt,t=vr(),t!==n?(Nr(),r=Mt,a=_r(),a!==n?(Nr(),r=a):(Mt=r,r=n),r===n&&(r=null),61===o.charCodeAt(Mt)?(a=y,Mt++):(a=n,0===Dt&&Zt(we)),a!==n?(Nr(),s=nr(),s!==n?(i=Dr(),i!==n?(Ot=e,l=r,u=s,e={type:"rule",name:(c=t)[0],nameLocation:c[1],expression:null!==l?{type:"named",name:l,expression:u,location:Bt()}:u,location:Bt()}):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e}function nr(){let e,t,r,a,s,i;if(e=Mt,t=ir(),t!==n){for(r=[],a=Mt,Nr(),47===o.charCodeAt(Mt)?(s=A,Mt++):(s=n,0===Dt&&Zt(Ee)),s!==n?(Nr(),i=ir(),i!==n?a=i:(Mt=a,a=n)):(Mt=a,a=n);a!==n;)r.push(a),a=Mt,Nr(),47===o.charCodeAt(Mt)?(s=A,Mt++):(s=n,0===Dt&&Zt(Ee)),s!==n?(Nr(),i=ir(),i!==n?a=i:(Mt=a,a=n)):(Mt=a,a=n);Ot=e,c=t,e=(l=r).length>0?{type:"choice",alternatives:[c].concat(l),location:Bt()}:c}else Mt=e,e=n;var c,l;return e}function ir(){let e,t,r,a;var o,s;return e=Mt,t=function(){let e,t,r,a,o;if(e=Mt,t=cr(),t!==n){for(r=[],a=Mt,Nr(),o=cr(),o!==n?a=o:(Mt=a,a=n);a!==n;)r.push(a),a=Mt,Nr(),o=cr(),o!==n?a=o:(Mt=a,a=n);Ot=e,s=t,e=(i=r).length>0||"labeled"===s.type&&s.pick?{type:"sequence",elements:[s].concat(i),location:Bt()}:s}else Mt=e,e=n;var s,i;return e}(),t!==n?(r=Mt,Nr(),a=Ur(),a!==n?r=a:(Mt=r,r=n),r===n&&(r=null),Ot=e,o=t,e=null!==(s=r)?{type:"action",expression:o,code:s[0],codeLocation:s[1],location:Bt()}:o):(Mt=e,e=n),e}function cr(){let e,t,r,a;var s,i,c;return e=Mt,t=function(){let e,t;return e=Mt,64===o.charCodeAt(Mt)?(t=x,Mt++):(t=n,0===Dt&&Zt(Ce)),t!==n&&(Ot=e,t=Bt()),e=t,e}(),t!==n?(r=lr(),r===n&&(r=null),a=ur(),a!==n?(Ot=e,s=t,i=r,(c=a).type.startsWith("semantic_")&&Gt('"@" cannot be used on a semantic predicate',s),e={type:"labeled",label:null!==i?i[0]:null,labelLocation:null!==i?i[1]:s,pick:!0,expression:c,location:Bt()}):(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=Mt,t=lr(),t!==n?(r=ur(),r!==n?(Ot=e,e=function(e,t){return{type:"labeled",label:e[0],labelLocation:e[1],expression:t,location:Bt()}}(t,r)):(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=ur())),e}function lr(){let e,t,r;var a;return e=Mt,t=vr(),t!==n?(Nr(),58===o.charCodeAt(Mt)?(r=v,Mt++):(r=n,0===Dt&&Zt(qe)),r!==n?(Nr(),Ot=e,a=t,Br.has(a[0])&&Gt(`Label can't be a reserved word "${a[0]}"`,a[1]),e=a):(Mt=e,e=n)):(Mt=e,e=n),e}function ur(){let t,r,a;return t=Mt,r=function(){let e;return e=o.charAt(Mt),K.test(e)?Mt++:(e=n,0===Dt&&Zt($e)),e}(),r!==n?(Nr(),a=pr(),a!==n?(Ot=t,t={type:e[r],expression:a,location:Bt()}):(Mt=t,t=n)):(Mt=t,t=n),t===n&&(t=pr()),t}function pr(){let e,r,a;return e=Mt,r=mr(),r!==n?(Nr(),a=function(){let e;return e=o.charAt(Mt),X.test(e)?Mt++:(e=n,0===Dt&&Zt(Le)),e}(),a!==n?(Ot=e,e={type:t[a],expression:r,location:Bt()}):(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=function(){let e,t,r,a,s,i,c;return e=Mt,t=mr(),t!==n?(Nr(),124===o.charCodeAt(Mt)?(r=S,Mt++):(r=n,0===Dt&&Zt(Ie)),r!==n?(Nr(),a=function(){let e,t,r,a;var s,i;return e=Mt,t=dr(),t===n&&(t=null),Nr(),o.substr(Mt,2)===_?(r=_,Mt+=2):(r=n,0===Dt&&Zt(ke)),r!==n?(Nr(),a=dr(),a===n&&(a=null),Ot=e,e=[null!==(s=t)?s:{type:"constant",value:0},null!==(i=a)?i:{type:"constant",value:null}]):(Mt=e,e=n),e===n&&(e=Mt,t=dr(),t!==n&&(Ot=e,t=[null,t]),e=t),e}(),a!==n?(Nr(),s=Mt,44===o.charCodeAt(Mt)?(i=d,Mt++):(i=n,0===Dt&&Zt(ve)),i!==n?(Nr(),c=nr(),c!==n?(Nr(),s=c):(Mt=s,s=n)):(Mt=s,s=n),s===n&&(s=null),124===o.charCodeAt(Mt)?(i=S,Mt++):(i=n,0===Dt&&Zt(Ie)),i!==n?(Ot=e,e=function(e,t,r){const a=t[0],o=t[1];return"constant"===o.type&&0===o.value&&Gt("The maximum count of repetitions of the rule must be > 0",o.location),{type:"repeated",min:a,max:o,expression:e,delimiter:r,location:Bt()}}(t,a,s)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e}(),e===n&&(e=mr())),e}function dr(){let e,t;return e=Mt,t=function(){let e,t,r,a;if(e=Mt,t=Mt,r=[],a=Or(),a!==n)for(;a!==n;)r.push(a),a=Or();else r=n;return t=r!==n?o.substring(t,Mt):r,t!==n&&(Ot=e,t=parseInt(t,10)),e=t,e}(),t!==n&&(Ot=e,t={type:"constant",value:t,location:Bt()}),e=t,e===n&&(e=Mt,t=vr(),t!==n&&(Ot=e,t={type:"variable",value:t[0],location:Bt()}),e=t,e===n&&(e=Mt,t=Ur(),t!==n&&(Ot=e,t=function(e){return{type:"function",value:e[0],codeLocation:e[1],location:Bt()}}(t)),e=t)),e}function mr(){let e,t,a,s;var i;return e=function(){let e,t,r;return Dt++,e=Mt,t=_r(),t!==n?(105===o.charCodeAt(Mt)?(r=I,Mt++):(r=n,0===Dt&&Zt(st)),r===n&&(r=null),Ot=e,e={type:"literal",value:t,ignoreCase:null!==r,location:Bt()}):(Mt=e,e=n),Dt--,e===n&&(t=n,0===Dt&&Zt(ot)),e}(),e===n&&(e=function(){let e,t,r,a,s,i;if(Dt++,e=Mt,91===o.charCodeAt(Mt)?(t=O,Mt++):(t=n,0===Dt&&Zt(dt)),t!==n){for(94===o.charCodeAt(Mt)?(r=F,Mt++):(r=n,0===Dt&&Zt(mt)),r===n&&(r=null),a=[],s=Pr(),s===n&&(s=qr(),s===n&&(s=$r()));s!==n;)a.push(s),s=Pr(),s===n&&(s=qr(),s===n&&(s=$r()));93===o.charCodeAt(Mt)?(s=U,Mt++):(s=n,0===Dt&&Zt(ht)),s!==n?(i=function(){let e,t,r;for(e=Mt,t=[],r=Cr();r!==n;)t.push(r),r=Cr();return Ot=e,t=function(e){const t=Object.fromEntries(e);return Object.keys(t).length!==e.length&&Gt("Invalid flags"),t}(t),e=t,e}(),Ot=e,e=function(e,t,r){if(e&&0===t.length){if(!r.unicode)return{type:"any",location:Bt()};t=[["\ud800","\udfff"]]}return{type:"class",parts:t.filter((e=>""!==e)),inverted:Boolean(e),ignoreCase:Boolean(r.ignoreCase),location:Bt(),unicode:Boolean(r.unicode)||t.flat().some((e=>"object"==typeof e&&e.unicode||e.codePointAt(0)>65535))}}(r,a,i)):(Mt=e,e=n)}else Mt=e,e=n;return Dt--,e===n&&(t=n,0===Dt&&Zt(pt)),e}(),e===n&&(e=function(){let e,t;return e=Mt,46===o.charCodeAt(Mt)?(t=P,Mt++):(t=n,0===Dt&&Zt(Fe)),t!==n&&(Ot=e,t={type:"any",location:Bt()}),e=t,e}(),e===n&&(e=function(){let e,t,r,a,s,i,c,l;var u;return e=Mt,t=vr(),t!==n?(46===o.charCodeAt(Mt)?(r=P,Mt++):(r=n,0===Dt&&Zt(Fe)),r!==n?(a=vr(),a!==n?(Ot=e,u=t,e={type:"library_ref",name:a[0],library:u[0],libraryNumber:-1,location:Bt()}):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=Mt,t=vr(),t!==n?(r=Mt,Dt++,a=Mt,s=Nr(),i=Mt,c=_r(),c!==n?(l=Nr(),c=[c,l],i=c):(Mt=i,i=n),i===n&&(i=null),61===o.charCodeAt(Mt)?(c=y,Mt++):(c=n,0===Dt&&Zt(we)),c!==n?(s=[s,i,c],a=s):(Mt=a,a=n),Dt--,a===n?r=void 0:(Mt=r,r=n),r!==n?(Ot=e,e={type:"rule_ref",name:t[0],location:Bt()}):(Mt=e,e=n)):(Mt=e,e=n)),e}(),e===n&&(e=function(){let e,t,a;var s;return e=Mt,t=function(){let e;return e=o.charAt(Mt),Q.test(e)?Mt++:(e=n,0===Dt&&Zt(Ue)),e}(),t!==n?(Nr(),a=Ur(),a!==n?(Ot=e,e={type:r[t],code:(s=a)[0],codeLocation:s[1],location:Bt()}):(Mt=e,e=n)):(Mt=e,e=n),e}(),e===n&&(e=Mt,40===o.charCodeAt(Mt)?(t=R,Mt++):(t=n,0===Dt&&Zt(Me)),t!==n?(Nr(),a=nr(),a!==n?(Nr(),41===o.charCodeAt(Mt)?(s=T,Mt++):(s=n,0===Dt&&Zt(Oe)),s!==n?(Ot=e,e="labeled"===(i=a).type||"sequence"===i.type?{type:"group",expression:i,location:Bt()}:i):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n)))))),e}function hr(){let e;return e=function(){let e;return e=o.charAt(Mt),ee.test(e)?Mt++:(e=n,0===Dt&&Zt(je)),e}(),e===n&&(e=function(){let e,t,r,a;return e=Mt,t=Mt,r=o.charAt(Mt),te.test(r)?Mt++:(r=n,0===Dt&&Zt(Ne)),r!==n?(a=o.charAt(Mt),re.test(a)?Mt++:(a=n,0===Dt&&Zt(De)),a!==n?(r=[r,a],t=r):(Mt=t,t=n)):(Mt=t,t=n),e=t!==n?o.substring(e,Mt):t,e===n&&(e=o.charAt(Mt),ae.test(e)?Mt++:(e=n,0===Dt&&Zt(Be))),e}()),e}function fr(){let e;return Dt++,e=zt(),oe.test(e)?Mt+=e.length:(e=n,0===Dt&&Zt(ze)),Dt--,e===n&&0===Dt&&Zt(Ge),e}function gr(){let e;return e=o.charAt(Mt),se.test(e)?Mt++:(e=n,0===Dt&&Zt(He)),e}function br(){let e;return Dt++,10===o.charCodeAt(Mt)?(e=w,Mt++):(e=n,0===Dt&&Zt(We)),e===n&&(o.substr(Mt,2)===E?(e=E,Mt+=2):(e=n,0===Dt&&Zt(Je)),e===n&&(e=o.charAt(Mt),ne.test(e)?Mt++:(e=n,0===Dt&&Zt(Ye)))),Dt--,e===n&&0===Dt&&Zt(Ve),e}function yr(){let e;return Dt++,e=function(){let e,t,r,a,s,i;if(e=Mt,o.substr(Mt,2)===C?(t=C,Mt+=2):(t=n,0===Dt&&Zt(Ke)),t!==n){for(r=[],a=Mt,s=Mt,Dt++,o.substr(Mt,2)===q?(i=q,Mt+=2):(i=n,0===Dt&&Zt(Xe)),Dt--,i===n?s=void 0:(Mt=s,s=n),s!==n?(i=hr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n);a!==n;)r.push(a),a=Mt,s=Mt,Dt++,o.substr(Mt,2)===q?(i=q,Mt+=2):(i=n,0===Dt&&Zt(Xe)),Dt--,i===n?s=void 0:(Mt=s,s=n),s!==n?(i=hr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n);o.substr(Mt,2)===q?(a=q,Mt+=2):(a=n,0===Dt&&Zt(Xe)),a!==n?(t=[t,r,a],e=t):(Mt=e,e=n)}else Mt=e,e=n;return e}(),e===n&&(e=xr()),Dt--,e===n&&0===Dt&&Zt(Ze),e}function Ar(){let e,t,r,a,s,i;if(e=Mt,o.substr(Mt,2)===C?(t=C,Mt+=2):(t=n,0===Dt&&Zt(Ke)),t!==n){for(r=[],a=Mt,s=Mt,Dt++,o.substr(Mt,2)===q?(i=q,Mt+=2):(i=n,0===Dt&&Zt(Xe)),i===n&&(i=gr()),Dt--,i===n?s=void 0:(Mt=s,s=n),s!==n?(i=hr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n);a!==n;)r.push(a),a=Mt,s=Mt,Dt++,o.substr(Mt,2)===q?(i=q,Mt+=2):(i=n,0===Dt&&Zt(Xe)),i===n&&(i=gr()),Dt--,i===n?s=void 0:(Mt=s,s=n),s!==n?(i=hr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n);o.substr(Mt,2)===q?(a=q,Mt+=2):(a=n,0===Dt&&Zt(Xe)),a!==n?(t=[t,r,a],e=t):(Mt=e,e=n)}else Mt=e,e=n;return e}function xr(){let e,t,r,a,s,i;if(e=Mt,o.substr(Mt,2)===$?(t=$,Mt+=2):(t=n,0===Dt&&Zt(Qe)),t!==n){for(r=[],a=Mt,s=Mt,Dt++,i=gr(),Dt--,i===n?s=void 0:(Mt=s,s=n),s!==n?(i=hr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n);a!==n;)r.push(a),a=Mt,s=Mt,Dt++,i=gr(),Dt--,i===n?s=void 0:(Mt=s,s=n),s!==n?(i=hr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n);t=[t,r],e=t}else Mt=e,e=n;return e}function vr(){let e,t,r,a;if(Dt++,e=Mt,t=function(){let e,t,r;return e=zt(),ie.test(e)?Mt+=e.length:(e=n,0===Dt&&Zt(tt)),e===n&&(e=Mt,92===o.charCodeAt(Mt)?(t=L,Mt++):(t=n,0===Dt&&Zt(rt)),t!==n?(r=Mr(),r!==n?e=r:(Mt=e,e=n)):(Mt=e,e=n)),e}(),t!==n){for(r=[],a=Sr();a!==n;)r.push(a),a=Sr();Ot=e,e=[t+r.join(""),Bt()]}else Mt=e,e=n;return Dt--,e===n&&(t=n,0===Dt&&Zt(et)),e}function Sr(){let e;return e=zt(),ce.test(e)?Mt+=e.length:(e=n,0===Dt&&Zt(at)),e}function _r(){let e,t,r,a;if(Dt++,e=Mt,34===o.charCodeAt(Mt)?(t=k,Mt++):(t=n,0===Dt&&Zt(it)),t!==n){for(r=[],a=Rr();a!==n;)r.push(a),a=Rr();34===o.charCodeAt(Mt)?(a=k,Mt++):(a=n,0===Dt&&Zt(it)),a!==n?(Ot=e,e=r.join("")):(Mt=e,e=n)}else Mt=e,e=n;if(e===n)if(e=Mt,39===o.charCodeAt(Mt)?(t=M,Mt++):(t=n,0===Dt&&Zt(ct)),t!==n){for(r=[],a=Tr();a!==n;)r.push(a),a=Tr();39===o.charCodeAt(Mt)?(a=M,Mt++):(a=n,0===Dt&&Zt(ct)),a!==n?(Ot=e,e=r.join("")):(Mt=e,e=n)}else Mt=e,e=n;return Dt--,e===n&&(t=n,0===Dt&&Zt(nt)),e}function Rr(){let e,t,r,a;return e=Mt,t=Mt,r=Mt,Dt++,a=o.charAt(Mt),le.test(a)?Mt++:(a=n,0===Dt&&Zt(lt)),Dt--,a===n?r=void 0:(Mt=r,r=n),r!==n?(a=hr(),a!==n?(r=[r,a],t=r):(Mt=t,t=n)):(Mt=t,t=n),e=t!==n?o.substring(e,Mt):t,e===n&&(e=Mt,92===o.charCodeAt(Mt)?(t=L,Mt++):(t=n,0===Dt&&Zt(rt)),t!==n?(r=Ir(),r!==n?e=r:(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=Lr())),e}function Tr(){let e,t,r,a;return e=Mt,t=Mt,r=Mt,Dt++,a=o.charAt(Mt),ue.test(a)?Mt++:(a=n,0===Dt&&Zt(ut)),Dt--,a===n?r=void 0:(Mt=r,r=n),r!==n?(a=hr(),a!==n?(r=[r,a],t=r):(Mt=t,t=n)):(Mt=t,t=n),e=t!==n?o.substring(e,Mt):t,e===n&&(e=Mt,92===o.charCodeAt(Mt)?(t=L,Mt++):(t=n,0===Dt&&Zt(rt)),t!==n?(r=Ir(),r!==n?e=r:(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=Lr())),e}function Pr(){let e,t,r;return e=Mt,92===o.charCodeAt(Mt)?(t=L,Mt++):(t=n,0===Dt&&Zt(rt)),t!==n?(r=function(){let e,t,r,a,s,i,c;return e=Mt,t=Mt,r=Mt,a=o.charAt(Mt),a.toLowerCase()===j?Mt++:(a=n,0===Dt&&Zt(ft)),a!==n?(123===o.charCodeAt(Mt)?(s=f,Mt++):(s=n,0===Dt&&Zt(Re)),s!==n?(i=function(){let e,t,r,a;return e=Mt,t=function(){let e,t,r;if(e=Mt,t=[],r=Er(),r!==n)for(;r!==n;)t.push(r),r=Er();else t=n;return e=t!==n?o.substring(e,Mt):t,e}(),t!==n?(61===o.charCodeAt(Mt)?(r=y,Mt++):(r=n,0===Dt&&Zt(we)),r!==n?(a=function(){let e,t,r;if(e=Mt,t=[],r=wr(),r!==n)for(;r!==n;)t.push(r),r=wr();else t=n;return e=t!==n?o.substring(e,Mt):t,e}(),a!==n?(t=[t,r,a],e=t):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=function(){let e,t,r;if(e=Mt,t=[],r=wr(),r!==n)for(;r!==n;)t.push(r),r=wr();else t=n;return e=t!==n?o.substring(e,Mt):t,e}()),e}(),i!==n?(125===o.charCodeAt(Mt)?(c=g,Mt++):(c=n,0===Dt&&Zt(Te)),c!==n?(a=[a,s,i,c],r=a):(Mt=r,r=n)):(Mt=r,r=n)):(Mt=r,r=n)):(Mt=r,r=n),t=r!==n?o.substring(t,Mt):r,t!==n&&(Ot=e,t={type:"classEscape",value:t,unicode:!0,location:Bt()}),e=t,e}(),r!==n?e=r:(Mt=e,e=n)):(Mt=e,e=n),e}function wr(){let e;return e=Er(),e===n&&(e=Or()),e}function Er(){let e;return e=function(){let e;return e=o.charAt(Mt),pe.test(e)?Mt++:(e=n,0===Dt&&Zt(bt)),e}(),e===n&&(95===o.charCodeAt(Mt)?(e=N,Mt++):(e=n,0===Dt&&Zt(gt))),e}function Cr(){let e,t;return e=Mt,105===o.charCodeAt(Mt)?(t=I,Mt++):(t=n,0===Dt&&Zt(st)),t!==n&&(Ot=e,t=["ignoreCase",!0]),e=t,e===n&&(e=Mt,117===o.charCodeAt(Mt)?(t=D,Mt++):(t=n,0===Dt&&Zt(yt)),t!==n&&(Ot=e,t=["unicode",!0]),e=t),e}function qr(){let e,t,r,a;return e=Mt,t=$r(),t!==n?(45===o.charCodeAt(Mt)?(r=B,Mt++):(r=n,0===Dt&&Zt(At)),r!==n?(a=$r(),a!==n?(Ot=e,i=a,(s=t).charCodeAt(0)>i.charCodeAt(0)&&Gt("Invalid character range: "+o.substring(Ot,Mt)+"."),e=[s,i]):(Mt=e,e=n)):(Mt=e,e=n)):(Mt=e,e=n),e;var s,i}function $r(){let e,t,r,a;return e=Mt,t=Mt,r=Mt,Dt++,a=o.charAt(Mt),de.test(a)?Mt++:(a=n,0===Dt&&Zt(xt)),Dt--,a===n?r=void 0:(Mt=r,r=n),r!==n?(a=hr(),a!==n?(r=[r,a],t=r):(Mt=t,t=n)):(Mt=t,t=n),e=t!==n?o.substring(e,Mt):t,e===n&&(e=Mt,92===o.charCodeAt(Mt)?(t=L,Mt++):(t=n,0===Dt&&Zt(rt)),t!==n?(r=Ir(),r!==n?e=r:(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=Lr())),e}function Lr(){let e,t,r;return e=Mt,92===o.charCodeAt(Mt)?(t=L,Mt++):(t=n,0===Dt&&Zt(rt)),t!==n?(r=br(),r!==n?(Ot=e,e=""):(Mt=e,e=n)):(Mt=e,e=n),e}function Ir(){let e,t,r,a;return e=function(){let e;return e=kr(),e===n&&(e=function(){let e,t,r,a;return e=Mt,t=Mt,r=Mt,Dt++,a=function(){let e;return e=kr(),e===n&&(e=o.charAt(Mt),he.test(e)?Mt++:(e=n,0===Dt&&Zt(Ct))),e}(),a===n&&(a=gr()),Dt--,a===n?r=void 0:(Mt=r,r=n),r!==n?(a=hr(),a!==n?(r=[r,a],t=r):(Mt=t,t=n)):(Mt=t,t=n),e=t!==n?o.substring(e,Mt):t,e}()),e}(),e===n&&(e=Mt,48===o.charCodeAt(Mt)?(t=G,Mt++):(t=n,0===Dt&&Zt(vt)),t!==n?(r=Mt,Dt++,a=Or(),Dt--,a===n?r=void 0:(Mt=r,r=n),r!==n?(Ot=e,e="\0"):(Mt=e,e=n)):(Mt=e,e=n),e===n&&(e=function(){let e,t,r,a,s,i;var c;return e=Mt,120===o.charCodeAt(Mt)?(t=Z,Mt++):(t=n,0===Dt&&Zt(qt)),t!==n?(r=Mt,a=Mt,s=Fr(),s!==n?(i=Fr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n),r=a!==n?o.substring(r,Mt):a,r!==n?(Ot=e,c=r,e=String.fromCharCode(parseInt(c,16))):(Mt=e,e=n)):(Mt=e,e=n),e}(),e===n&&(e=Mr()))),e}function kr(){let e,t;return e=o.charAt(Mt),me.test(e)?Mt++:(e=n,0===Dt&&Zt(St)),e===n&&(e=Mt,98===o.charCodeAt(Mt)?(t=z,Mt++):(t=n,0===Dt&&Zt(_t)),t!==n&&(Ot=e,t="\b"),e=t,e===n&&(e=Mt,102===o.charCodeAt(Mt)?(t=H,Mt++):(t=n,0===Dt&&Zt(Rt)),t!==n&&(Ot=e,t="\f"),e=t,e===n&&(e=Mt,110===o.charCodeAt(Mt)?(t=V,Mt++):(t=n,0===Dt&&Zt(Tt)),t!==n&&(Ot=e,t="\n"),e=t,e===n&&(e=Mt,114===o.charCodeAt(Mt)?(t=W,Mt++):(t=n,0===Dt&&Zt(Pt)),t!==n&&(Ot=e,t="\r"),e=t,e===n&&(e=Mt,116===o.charCodeAt(Mt)?(t=J,Mt++):(t=n,0===Dt&&Zt(wt)),t!==n&&(Ot=e,t="\t"),e=t,e===n&&(e=Mt,118===o.charCodeAt(Mt)?(t=Y,Mt++):(t=n,0===Dt&&Zt(Et)),t!==n&&(Ot=e,t="\v"),e=t)))))),e}function Mr(){let e,t,r,a,s,i,c,l;var u;if(e=Mt,117===o.charCodeAt(Mt)?(t=D,Mt++):(t=n,0===Dt&&Zt(yt)),t!==n?(r=Mt,a=Mt,s=Fr(),s!==n?(i=Fr(),i!==n?(c=Fr(),c!==n?(l=Fr(),l!==n?(s=[s,i,c,l],a=s):(Mt=a,a=n)):(Mt=a,a=n)):(Mt=a,a=n)):(Mt=a,a=n),r=a!==n?o.substring(r,Mt):a,r!==n?(Ot=e,u=r,e=String.fromCharCode(parseInt(u,16))):(Mt=e,e=n)):(Mt=e,e=n),e===n)if(e=Mt,117===o.charCodeAt(Mt)?(t=D,Mt++):(t=n,0===Dt&&Zt(yt)),t!==n)if(123===o.charCodeAt(Mt)?(r=f,Mt++):(r=n,0===Dt&&Zt(Re)),r!==n){if(a=Mt,s=[],i=Fr(),i!==n)for(;i!==n;)s.push(i),i=Fr();else s=n;a=s!==n?o.substring(a,Mt):s,a!==n?(125===o.charCodeAt(Mt)?(s=g,Mt++):(s=n,0===Dt&&Zt(Te)),s!==n?(Ot=e,e=function(e){return String.fromCodePoint(parseInt(e,16))}(a)):(Mt=e,e=n)):(Mt=e,e=n)}else Mt=e,e=n;else Mt=e,e=n;return e}function Or(){let e;return e=o.charAt(Mt),fe.test(e)?Mt++:(e=n,0===Dt&&Zt($t)),e}function Fr(){let e;return e=o.charAt(Mt),ge.test(e)?Mt++:(e=n,0===Dt&&Zt(Lt)),e}function Ur(){let e,t,r,a;return Dt++,e=Mt,123===o.charCodeAt(Mt)?(t=f,Mt++):(t=n,0===Dt&&Zt(Re)),t!==n?(r=function(){let e,t;return e=Mt,t=jr(),Ot=e,t=[t,Bt()],e=t,e}(),125===o.charCodeAt(Mt)?(a=g,Mt++):(a=n,0===Dt&&Zt(Te)),a!==n?e=r:(Mt=e,e=n)):(Mt=e,e=n),Dt--,e===n&&(t=n,0===Dt&&Zt(It)),e}function jr(){let e,t,r,a,s,i;if(e=Mt,t=[],r=[],a=Mt,s=Mt,Dt++,i=o.charAt(Mt),be.test(i)?Mt++:(i=n,0===Dt&&Zt(kt)),Dt--,i===n?s=void 0:(Mt=s,s=n),s!==n?(i=hr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n),a!==n)for(;a!==n;)r.push(a),a=Mt,s=Mt,Dt++,i=o.charAt(Mt),be.test(i)?Mt++:(i=n,0===Dt&&Zt(kt)),Dt--,i===n?s=void 0:(Mt=s,s=n),s!==n?(i=hr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n);else r=n;for(r===n&&(r=Mt,123===o.charCodeAt(Mt)?(a=f,Mt++):(a=n,0===Dt&&Zt(Re)),a!==n?(s=jr(),125===o.charCodeAt(Mt)?(i=g,Mt++):(i=n,0===Dt&&Zt(Te)),i!==n?(a=[a,s,i],r=a):(Mt=r,r=n)):(Mt=r,r=n));r!==n;){if(t.push(r),r=[],a=Mt,s=Mt,Dt++,i=o.charAt(Mt),be.test(i)?Mt++:(i=n,0===Dt&&Zt(kt)),Dt--,i===n?s=void 0:(Mt=s,s=n),s!==n?(i=hr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n),a!==n)for(;a!==n;)r.push(a),a=Mt,s=Mt,Dt++,i=o.charAt(Mt),be.test(i)?Mt++:(i=n,0===Dt&&Zt(kt)),Dt--,i===n?s=void 0:(Mt=s,s=n),s!==n?(i=hr(),i!==n?(s=[s,i],a=s):(Mt=a,a=n)):(Mt=a,a=n);else r=n;r===n&&(r=Mt,123===o.charCodeAt(Mt)?(a=f,Mt++):(a=n,0===Dt&&Zt(Re)),a!==n?(s=jr(),125===o.charCodeAt(Mt)?(i=g,Mt++):(i=n,0===Dt&&Zt(Te)),i!==n?(a=[a,s,i],r=a):(Mt=r,r=n)):(Mt=r,r=n))}return e=o.substring(e,Mt),e}function Nr(){let e,t;for(e=[],t=fr(),t===n&&(t=br(),t===n&&(t=yr()));t!==n;)e.push(t),t=fr(),t===n&&(t=br(),t===n&&(t=yr()));return e}function Dr(){let e,t,r,a;if(e=[],t=Mt,r=Nr(),59===o.charCodeAt(Mt)?(a=p,Mt++):(a=n,0===Dt&&Zt(xe)),a!==n?(r=[r,a],t=r):(Mt=t,t=n),t!==n)for(;t!==n;)e.push(t),t=Mt,r=Nr(),59===o.charCodeAt(Mt)?(a=p,Mt++):(a=n,0===Dt&&Zt(xe)),a!==n?(r=[r,a],t=r):(Mt=t,t=n);else e=n;return e===n&&(e=Mt,t=function(){let e,t;for(e=[],t=fr(),t===n&&(t=Ar());t!==n;)e.push(t),t=fr(),t===n&&(t=Ar());return e}(),r=xr(),r===n&&(r=null),a=br(),a!==n?(t=[t,r,a],e=t):(Mt=e,e=n),e===n&&(e=Mt,t=Nr(),r=function(){let e,t;return e=Mt,Dt++,o.length>Mt?(t=o.charAt(Mt),Mt++):(t=n,0===Dt&&Zt(ye)),Dt--,t===n?e=void 0:(Mt=e,e=n),e}(),r!==n?(t=[t,r],e=t):(Mt=e,e=n))),e}const Br=new Set(s.reservedWords);Ut=l();const Gr=Ut!==n&&Mt===o.length;function zr(){throw Ut!==n&&Mt<o.length&&Zt({type:"end"}),function(e,t,r){return new a(a.buildMessage(e,t),e,t,r)}(Nt,jt<o.length?zt(jt):null,jt<o.length?Yt(jt,jt+1):Yt(jt,jt))}return s.peg$library?{peg$result:Ut,peg$currPos:Mt,peg$FAILED:n,peg$maxFailExpected:Nt,peg$maxFailPos:jt,peg$success:Gr,peg$throw:Gr?void 0:zr}:Gr?Ut:void zr()}}}function requireGenerateJs(){if(hasRequiredGenerateJs)return generateJs;hasRequiredGenerateJs=1;const e=requireAsts(),t=requireOpcodes(),r=requireStack(),{version:a}=requireVersion(),{stringEscape:o,regexpClassEscape:s}=requireUtils$1(),{SourceNode:n}=requireSourceMap$1(),i=requireGrammarLocation(),{parse:c}=requireParser();function l(e,t,r){const a=i.offsetStart(t),o=a.line,s=a.column-1,c=e.split("\n");return 1===c.length?new n(o,s,String(t.source),e,r):new n(null,null,String(t.source),c.map(((e,a)=>new n(o+a,0===a?s:0,String(t.source),a===c.length-1?e:[e,"\n"],r))))}function u(e,t,r,a,o){if(r){const s=i.offsetEnd(r);return new n(null,null,String(r.source),[e,l(t,r,o),new n(s.line,s.column-1,String(r.source),a)])}return new n(null,null,null,[e,t,a])}return generateJs=function(p,d){if(!(p.literals&&p.locations&&p.classes&&p.expectations&&p.functions&&p.importedNames))throw new Error("generateJS: generate bytecode was not called.");const{literals:m,locations:h,classes:f,expectations:g,functions:b,importedNames:y}=p;if(!d.allowedStartRules)throw new Error("generateJS: options.allowedStartRules was not set.");const{allowedStartRules:A}=d,x=d.dependencies||{};function v(e){let t=!0,r=0;return function e(a){return Array.isArray(a)?a.map((t=>e(t))):a instanceof n?(r++,a.children=e(a.children),r--,a):(a=t?a.replace(/^(.+)$/gm,"  $1"):a.replace(/\n(\s*\S)/g,"\n  $1"),t=!r||a.endsWith("\n"),a)}(e)}function S(e){return"peg$c"+e}function _(e){return"peg$r"+e}function R(e){return"peg$e"+e}function T(e){return"peg$f"+e}function P(e){return"peg$import"+e}function w(e){return"peg$parse"+e}function E(e){return e.codeLocation?l(e.code,e.codeLocation,"$"+e.type):e.code}p.code=function(e){function t(){return[`// @generated by Peggy ${a}.`,"//","// https://peggyjs.org/"]}function r(){const e=["{"];return d.trace&&e.push("  DefaultTracer: peg$DefaultTracer,"),d.allowedStartRules&&e.push("  StartRules: ["+d.allowedStartRules.map((e=>'"'+e+'"')).join(", ")+"],"),e.push("  SyntaxError: peg$SyntaxError,","  parse: peg$parse,"),e.push("}"),e.join("\n")}const s={bare(){if(Object.keys(x).length>0||p.imports.length>0)throw new Error("Dependencies not supported in format 'bare'.");return[...t(),"(function() {",'  "use strict";',e,v("return "+r()+";"),"})()"]},commonjs(){const a=Object.keys(x),s=t();s.push("",'"use strict";'),a.length>0&&(a.forEach((e=>{s.push("const "+e+' = require("'+o(x[e])+'");')})),s.push(""));const n=p.imports.length;for(let e=0;e<n;e++)s.push("const "+P(e)+' = require("'+o(p.imports[e].from.module)+'");');return s.push("",e,"","module.exports = "+r()+";"),s},es(){const r=Object.keys(x),a=t();a.push(""),r.length>0&&(r.forEach((e=>{a.push("import "+e+' from "'+o(x[e])+'";')})),a.push(""));for(let e=0;e<p.imports.length;e++)a.push("import * as "+P(e)+' from "'+o(p.imports[e].from.module)+'";');return a.push("",e,""),a.push("const peg$allowedStartRules = [","  "+(d.allowedStartRules?d.allowedStartRules.map((e=>'"'+e+'"')).join(",\n  "):""),"];",""),a.push("export {"),d.trace&&a.push("  peg$DefaultTracer as DefaultTracer,"),a.push("  peg$allowedStartRules as StartRules,","  peg$SyntaxError as SyntaxError,","  peg$parse as parse","};"),a},amd(){if(p.imports.length>0)throw new Error("Imports are not supported in format 'amd'.");const a=Object.keys(x),s="["+a.map((e=>x[e])).map((e=>'"'+o(e)+'"')).join(", ")+"]",n=a.join(", ");return[...t(),"define("+s+", function("+n+") {",'  "use strict";',e,"",v("return "+r()+";"),"});"]},globals(){if(Object.keys(x).length>0||p.imports.length>0)throw new Error("Dependencies not supported in format 'globals'.");if(!d.exportVar)throw new Error("No export variable defined for format 'globals'.");return[...t(),"(function(root) {",'  "use strict";',e,"",v("root."+d.exportVar+" = "+r()+";"),"})(this);"]},umd(){if(p.imports.length>0)throw new Error("Imports are not supported in format 'umd'.");const a=Object.keys(x),s=a.map((e=>x[e])),n="["+s.map((e=>'"'+o(e)+'"')).join(", ")+"]",i=s.map((e=>'require("'+o(e)+'")')).join(", "),c=a.join(", "),l=t();return l.push("(function(root, factory) {",'  if (typeof define === "function" && define.amd) {',"    define("+n+", factory);",'  } else if (typeof module === "object" && module.exports) {',"    module.exports = factory("+i+");"),d.exportVar&&l.push("  } else {","    root."+d.exportVar+" = factory();"),l.push("  }","})(this, function("+c+") {",'  "use strict";',e,"",v("return "+r()+";"),"});"),l}},i=s[d.format||"bare"]();return new n(null,null,d.grammarSource,i.map((e=>e instanceof n?e:e+"\n")))}(function(){const a=[];let l=p.topLevelInitializer;if(l)if(Array.isArray(l)){if("es"===d.format){const e=[],t=[];for(const r of l){const[a,o]=c(r.code,{startRule:"ImportsAndSource",grammarSource:new i(r.codeLocation.source,r.codeLocation.start)});a.code?(e.push(a),t.push(o)):t.push(r)}l=t.concat(e)}const e=l.slice(0).reverse();for(const t of e)a.push(E(t)),a.push("")}else a.push(E(l)),a.push("");a.push("class peg$SyntaxError extends SyntaxError {","  constructor(message, expected, found, location) {","    super(message);","    this.expected = expected;","    this.found = found;","    this.location = location;",'    this.name = "SyntaxError";',"  }","","  format(sources) {",'    let str = "Error: " + this.message;',"    if (this.location) {","      let src = null;","      const st = sources.find(s => s.source === this.location.source);","      if (st) {","        src = st.text.split(/\\r\\n|\\n|\\r/g);","      }","      const s = this.location.start;",'      const offset_s = (this.location.source && (typeof this.location.source.offset === "function"))',"        ? this.location.source.offset(s)","        : s;",'      const loc = this.location.source + ":" + offset_s.line + ":" + offset_s.column;',"      if (src) {","        const e = this.location.end;",'        const filler = "".padEnd(offset_s.line.toString().length, " ");',"        const line = src[s.line - 1];","        const last = s.line === e.line ? e.column : line.length + 1;","        const hatLen = (last - s.column) || 1;",'        str += "\\n --\x3e " + loc + "\\n"','            + filler + " |\\n"','            + offset_s.line + " | " + line + "\\n"','            + filler + " | " + "".padEnd(s.column - 1, " ")','            + "".padEnd(hatLen, "^");',"      } else {",'        str += "\\n at " + loc;',"      }","    }","    return str;","  }","","  static buildMessage(expected, found) {","    function hex(ch) {","      return ch.codePointAt(0).toString(16).toUpperCase();","    }","",'    const nonPrintable = Object.prototype.hasOwnProperty.call(RegExp.prototype, "unicode")','      ? new RegExp("[\\\\p{C}\\\\p{Mn}\\\\p{Mc}]", "gu")',"      : null;","    function unicodeEscape(s) {","      if (nonPrintable) {",'        return s.replace(nonPrintable,  ch => "\\\\u{" + hex(ch) + "}");',"      }","      return s;","    }","","    function literalEscape(s) {","      return unicodeEscape(s",'        .replace(/\\\\/g, "\\\\\\\\")','        .replace(/"/g,  "\\\\\\"")','        .replace(/\\0/g, "\\\\0")','        .replace(/\\t/g, "\\\\t")','        .replace(/\\n/g, "\\\\n")','        .replace(/\\r/g, "\\\\r")','        .replace(/[\\x00-\\x0F]/g,          ch => "\\\\x0" + hex(ch))','        .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, ch => "\\\\x"  + hex(ch)));',"    }","","    function classEscape(s) {","      return unicodeEscape(s",'        .replace(/\\\\/g, "\\\\\\\\")','        .replace(/\\]/g, "\\\\]")','        .replace(/\\^/g, "\\\\^")','        .replace(/-/g,  "\\\\-")','        .replace(/\\0/g, "\\\\0")','        .replace(/\\t/g, "\\\\t")','        .replace(/\\n/g, "\\\\n")','        .replace(/\\r/g, "\\\\r")','        .replace(/[\\x00-\\x0F]/g,          ch => "\\\\x0" + hex(ch))','        .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, ch => "\\\\x"  + hex(ch)));',"    }","","    const DESCRIBE_EXPECTATION_FNS = {","      literal(expectation) {",'        return "\\"" + literalEscape(expectation.text) + "\\"";',"      },","","      class(expectation) {","        const escapedParts = expectation.parts.map(","          part => (Array.isArray(part)",'            ? classEscape(part[0]) + "-" + classEscape(part[1])',"            : classEscape(part))","        );","",'        return "[" + (expectation.inverted ? "^" : "") + escapedParts.join("") + "]" + (expectation.unicode ? "u" : "");',"      },","","      any() {",'        return "any character";',"      },","","      end() {",'        return "end of input";',"      },","","      other(expectation) {","        return expectation.description;","      },","    };","","    function describeExpectation(expectation) {","      return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);","    }","","    function describeExpected(expected) {","      const descriptions = expected.map(describeExpectation);","      descriptions.sort();","","      if (descriptions.length > 0) {","        let j = 1;","        for (let i = 1; i < descriptions.length; i++) {","          if (descriptions[i - 1] !== descriptions[i]) {","            descriptions[j] = descriptions[i];","            j++;","          }","        }","        descriptions.length = j;","      }","","      switch (descriptions.length) {","        case 1:","          return descriptions[0];","","        case 2:",'          return descriptions[0] + " or " + descriptions[1];',"","        default:",'          return descriptions.slice(0, -1).join(", ")','            + ", or "',"            + descriptions[descriptions.length - 1];","      }","    }","","    function describeFound(found) {",'      return found ? "\\"" + literalEscape(found) + "\\"" : "end of input";',"    }","",'    return "Expected " + describeExpected(expected) + " but " + describeFound(found) + " found.";',"  }","}",""),d.trace&&a.push("class peg$DefaultTracer {","  constructor() {","    this.indentLevel = 0;","  }","","  trace(event) {","    const that = this;","","    function log(event) {","      console?.log?.(",'        event.location.start.line + ":" + event.location.start.column + "-"','          + event.location.end.line + ":" + event.location.end.column + " "','          + event.type.padEnd(10, " ")','          + "".padEnd((that.indentLevel * 2) + 1, " ") + event.rule',"       );","    }","","    switch (event.type) {",'      case "rule.enter":',"        log(event);","        this.indentLevel++;","        break;","",'      case "rule.match":',"        this.indentLevel--;","        log(event);","        break;","",'      case "rule.fail":',"        this.indentLevel--;","        log(event);","        break;","","      default:",'        throw new Error("Invalid event type: " + event.type + ".");',"    }","  }","}","");const x="{\n"+A.map((e=>`    ${e}: ${w(e)},\n`)).join("")+"  }",C=w(A[0]);if(a.push("function peg$parse(input, options) {","  options = options !== undefined ? options : {};","","  const peg$FAILED = {};","  const peg$source = options.grammarSource;","","  const peg$startRuleFunctions = "+x+";","  let peg$startRuleFunction = "+C+";","",new n(null,null,d.grammarSource,[m.map(((e,t)=>"  const "+S(t)+' = "'+o(e)+'";')).concat("",f.map(((e,t)=>{return"  const "+_(t)+" = /^["+((r=e).inverted?"^":"")+r.value.map((e=>Array.isArray(e)?s(e[0])+"-"+s(e[1]):s(e))).join("")+"]/"+(r.ignoreCase?"i":"")+(r.unicode?"u":"")+";";var r}))).concat("",g.map(((e,t)=>"  const "+R(t)+" = "+function(e){switch(e.type){case"rule":return'peg$otherExpectation("'+o(e.value)+'")';case"literal":return'peg$literalExpectation("'+o(e.value)+'", '+e.ignoreCase+")";case"class":return"peg$classExpectation(["+e.value.map((e=>Array.isArray(e)?'["'+o(e[0])+'", "'+o(e[1])+'"]':'"'+o(e)+'"')).join(", ")+"], "+e.inverted+", "+e.ignoreCase+", "+e.unicode+")";case"any":return"peg$anyExpectation()";default:throw new Error("Unknown expectation type ("+JSON.stringify(e)+")")}}(e)+";"))).concat("").join("\n"),...b.map((function(e,t){return u(`\n  function ${T(t)}(${e.params.join(", ")}) {`,function(e,t=""){const r=e.match(/^\n*([ \t]+)/);return(r?e.replace(new RegExp(`^${r[1]}`,"gm"),t):e).replace(/[ \t]+$/,"")}(e.body,"    "),e.location,"  }")}))]),"","  let peg$currPos = options.peg$currPos | 0;","  let peg$savedPos = peg$currPos;","  const peg$posDetailsCache = [{ line: 1, column: 1 }];","  let peg$maxFailPos = peg$currPos;","  let peg$maxFailExpected = options.peg$maxFailExpected || [];","  let peg$silentFails = options.peg$silentFails | 0;",""),d.cache&&a.push("  let peg$resultsCache = {};",""),d.trace&&a.push('  let peg$tracer = "tracer" in options ? options.tracer : new peg$DefaultTracer();',""),a.push("  let peg$result;","","  if (options.startRule) {","    if (!(options.startRule in peg$startRuleFunctions)) {",'      throw new Error("Can\'t start parsing from rule \\"" + options.startRule + "\\".");',"    }","","    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];","  }","","  function text() {","    return input.substring(peg$savedPos, peg$currPos);","  }","","  function offset() {","    return peg$savedPos;","  }","","  function range() {","    return {","      source: peg$source,","      start: peg$savedPos,","      end: peg$currPos,","    };","  }","","  function location() {","    return peg$computeLocation(peg$savedPos, peg$currPos);","  }","","  function expected(description, location) {","    location = location !== undefined","      ? location","      : peg$computeLocation(peg$savedPos, peg$currPos);","","    throw peg$buildStructuredError(","      [peg$otherExpectation(description)],","      input.substring(peg$savedPos, peg$currPos),","      location","    );","  }","","  function error(message, location) {","    location = location !== undefined","      ? location","      : peg$computeLocation(peg$savedPos, peg$currPos);","","    throw peg$buildSimpleError(message, location);","  }","","  function peg$getUnicode(pos = peg$currPos) {","    const cp = input.codePointAt(pos);","    if (cp === undefined) {",'      return "";',"    }","    return String.fromCodePoint(cp);","  }","","  function peg$literalExpectation(text, ignoreCase) {",'    return { type: "literal", text, ignoreCase };',"  }","","  function peg$classExpectation(parts, inverted, ignoreCase, unicode) {",'    return { type: "class", parts, inverted, ignoreCase, unicode };',"  }","","  function peg$anyExpectation() {",'    return { type: "any" };',"  }","","  function peg$endExpectation() {",'    return { type: "end" };',"  }","","  function peg$otherExpectation(description) {",'    return { type: "other", description };',"  }","","  function peg$computePosDetails(pos) {","    let details = peg$posDetailsCache[pos];","    let p;","","    if (details) {","      return details;","    } else {","      if (pos >= peg$posDetailsCache.length) {","        p = peg$posDetailsCache.length - 1;","      } else {","        p = pos;","        while (!peg$posDetailsCache[--p]) {}","      }","","      details = peg$posDetailsCache[p];","      details = {","        line: details.line,","        column: details.column,","      };","","      while (p < pos) {","        if (input.charCodeAt(p) === 10) {","          details.line++;","          details.column = 1;","        } else {","          details.column++;","        }","","        p++;","      }","","      peg$posDetailsCache[pos] = details;","","      return details;","    }","  }","","  function peg$computeLocation(startPos, endPos, offset) {","    const startPosDetails = peg$computePosDetails(startPos);","    const endPosDetails = peg$computePosDetails(endPos);","","    const res = {","      source: peg$source,","      start: {","        offset: startPos,","        line: startPosDetails.line,","        column: startPosDetails.column,","      },","      end: {","        offset: endPos,","        line: endPosDetails.line,","        column: endPosDetails.column,","      },","    };",'    if (offset && peg$source && (typeof peg$source.offset === "function")) {',"      res.start = peg$source.offset(res.start);","      res.end = peg$source.offset(res.end);","    }","    return res;","  }","","  function peg$fail(expected) {","    if (peg$currPos < peg$maxFailPos) { return; }","","    if (peg$currPos > peg$maxFailPos) {","      peg$maxFailPos = peg$currPos;","      peg$maxFailExpected = [];","    }","","    peg$maxFailExpected.push(expected);","  }","","  function peg$buildSimpleError(message, location) {","    return new peg$SyntaxError(message, null, null, location);","  }","","  function peg$buildStructuredError(expected, found, location) {","    return new peg$SyntaxError(","      peg$SyntaxError.buildMessage(expected, found),","      expected,","      found,","      location","    );","  }",""),p.imports.length>0&&a.push("  function peg$callLibrary(lib, startRule) {","    const opts = Object.assign({}, options, {","      startRule: startRule,","      peg$currPos: peg$currPos,","      peg$silentFails: peg$silentFails,","      peg$library: true,","      peg$maxFailExpected: peg$maxFailExpected","    });","    const res = lib.parse(input, opts);","    peg$currPos = res.peg$currPos;","    peg$maxFailPos = res.peg$maxFailPos;","    peg$maxFailExpected = res.peg$maxFailExpected;","    return (res.peg$result === res.peg$FAILED) ? peg$FAILED : res.peg$result;","  }",""),p.rules.forEach((s=>{a.push(...v(function(a){const s=[],n=a.bytecode,i=new r(a.name,"s","let",n),c=function e(r){let a=0;const o=r.length,s=[];let n;function c(t,o,n){const c=o+3,l=r[a+c-2],u=r[a+c-1],[p,d]=i.checkedIf(a,(()=>(a+=c+l,(n||e)(r.slice(a-l,a)))),u>0?()=>(a+=u,e(r.slice(a-u,a))):null);s.push("if ("+t+") {"),s.push(...v(p)),u>0&&(s.push("} else {"),s.push(...v(d))),s.push("}")}function l(e){switch(e){case-1:return"peg$getUnicode()";case 1:return"input.charAt(peg$currPos)";default:return`input.substr(peg$currPos, ${e})`}}function u(e,t){switch(e){case-1:return`peg$currPos += ${t}.length;`;case 1:return"peg$currPos++;";default:return"peg$currPos += ("+e+");"}}function d(o,n,p){const d=n+3;let m=l(p),h=null;r[a+d]===t.ACCEPT_N&&r[a+d+1]===p&&(s.push(i.push(m)),m=i.pop(),h=t=>{i.sp++;const r=e(t.slice(2));return r.unshift(u(p,m)),r}),c(o(m,null!==h),n,h)}function f(t){const o=r[a+2-1],n=i.checkedLoop(a,(()=>(a+=2+o,e(r.slice(a-o,a)))));s.push("while ("+t+") {"),s.push(...v(n)),s.push("}")}function g(e){const t=r[a+e-1];return T(r[a+1])+"("+r.slice(a+e,a+e+t).map((e=>i.index(e))).join(", ")+")"}for(;a<o;)switch(r[a]){case t.PUSH_EMPTY_STRING:s.push(i.push("''")),a++;break;case t.PUSH_CURR_POS:s.push(i.push("peg$currPos")),a++;break;case t.PUSH_UNDEFINED:s.push(i.push("undefined")),a++;break;case t.PUSH_NULL:s.push(i.push("null")),a++;break;case t.PUSH_FAILED:s.push(i.push("peg$FAILED")),a++;break;case t.PUSH_EMPTY_ARRAY:s.push(i.push("[]")),a++;break;case t.POP:i.pop(),a++;break;case t.POP_CURR_POS:s.push("peg$currPos = "+i.pop()+";"),a++;break;case t.POP_N:i.pop(r[a+1]),a+=2;break;case t.NIP:n=i.pop(),i.pop(),s.push(i.push(n)),a++;break;case t.APPEND:n=i.pop(),s.push(i.top()+".push("+n+");"),a++;break;case t.WRAP:s.push(i.push("["+i.pop(r[a+1]).join(", ")+"]")),a+=2;break;case t.TEXT:s.push(i.push("input.substring("+i.pop()+", peg$currPos)")),a++;break;case t.PLUCK:{const e=3,t=r[a+e-1],o=e+t;n=r.slice(a+e,a+o),n=1===t?i.index(n[0]):`[ ${n.map((e=>i.index(e))).join(", ")} ]`,i.pop(r[a+1]),s.push(i.push(n)),a+=o;break}case t.IF:c(i.top(),0);break;case t.IF_ERROR:c(i.top()+" === peg$FAILED",0);break;case t.IF_NOT_ERROR:c(i.top()+" !== peg$FAILED",0);break;case t.IF_LT:c(i.top()+".length < "+r[a+1],1);break;case t.IF_GE:c(i.top()+".length >= "+r[a+1],1);break;case t.IF_LT_DYNAMIC:c(i.top()+".length < ("+i.index(r[a+1])+"|0)",1);break;case t.IF_GE_DYNAMIC:c(i.top()+".length >= ("+i.index(r[a+1])+"|0)",1);break;case t.WHILE_NOT_ERROR:f(i.top()+" !== peg$FAILED");break;case t.MATCH_ANY:c("input.length > peg$currPos",0);break;case t.MATCH_STRING:{const e=r[a+1],t=m[e];d(((r,a)=>t.length>1?`${r} === ${S(e)}`:`${r=a?`${r}.charCodeAt(0)`:"input.charCodeAt(peg$currPos)"} === ${t.charCodeAt(0)}`),1,t.length);break}case t.MATCH_STRING_IC:{const e=r[a+1];d((t=>`${t}.toLowerCase() === ${S(e)}`),1,m[e].length);break}case t.MATCH_CHAR_CLASS:{const e=r[a+1];d((t=>`${_(e)}.test(${t})`),1,1);break}case t.MATCH_UNICODE_CLASS:{const e=r[a+1];d((t=>`${_(e)}.test(${t})`),1,-1);break}case t.ACCEPT_N:s.push(i.push(l(r[a+1]))),s.push(u(r[a+1],i.top())),a+=2;break;case t.ACCEPT_STRING:s.push(i.push(S(r[a+1]))),s.push(m[r[a+1]].length>1?"peg$currPos += "+m[r[a+1]].length+";":"peg$currPos++;"),a+=2;break;case t.FAIL:s.push(i.push("peg$FAILED")),s.push("if (peg$silentFails === 0) { peg$fail("+R(r[a+1])+"); }"),a+=2;break;case t.LOAD_SAVED_POS:s.push("peg$savedPos = "+i.index(r[a+1])+";"),a+=2;break;case t.UPDATE_SAVED_POS:s.push("peg$savedPos = peg$currPos;"),a++;break;case t.CALL:n=g(4),i.pop(r[a+2]),s.push(i.push(n)),a+=4+r[a+3];break;case t.RULE:s.push(i.push(w(p.rules[r[a+1]].name)+"()")),a+=2;break;case t.LIBRARY_RULE:{const e=r[a+2],t=-1===e?"":', "'+y[e]+'"';s.push(i.push("peg$callLibrary("+P(r[a+1])+t+")")),a+=3;break}case t.SILENT_FAILS_ON:s.push("peg$silentFails++;"),a++;break;case t.SILENT_FAILS_OFF:s.push("peg$silentFails--;"),a++;break;case t.SOURCE_MAP_PUSH:i.sourceMapPush(s,h[r[a+1]]),a+=2;break;case t.SOURCE_MAP_POP:i.sourceMapPop(),a++;break;case t.SOURCE_MAP_LABEL_PUSH:i.labels[r[a+1]]={label:m[r[a+2]],location:h[r[a+3]]},a+=4;break;case t.SOURCE_MAP_LABEL_POP:delete i.labels[r[a+1]],a+=2;break;default:throw new Error("Invalid opcode: "+r[a]+".")}return s}(n);return s.push(u("function ",w(a.name),a.nameLocation,"() {\n",a.name)),d.trace&&s.push("  var startPos = peg$currPos;"),s.push(v(i.defines())),s.push(...v(function(e,t){const r=[];return r.push(""),d.trace&&r.push("peg$tracer.trace({",'  type: "rule.enter",',"  rule: "+e+",","  location: peg$computeLocation(startPos, startPos, true)","});",""),d.cache&&(r.push("const key = peg$currPos * "+p.rules.length+" + "+t+";","const cached = peg$resultsCache[key];","","if (cached) {","  peg$currPos = cached.nextPos;",""),d.trace&&r.push("if (cached.result !== peg$FAILED) {","  peg$tracer.trace({",'    type: "rule.match",',"    rule: "+e+",","    result: cached.result,","    location: peg$computeLocation(startPos, peg$currPos, true)","  });","} else {","  peg$tracer.trace({",'    type: "rule.fail",',"    rule: "+e+",","    location: peg$computeLocation(startPos, startPos, true)","  });","}",""),r.push("  return cached.result;","}","")),r}('"'+o(a.name)+'"',e.indexOfRule(p,a.name)))),s.push(...v(c)),s.push(...v(function(e,t){const r=[];return d.cache&&r.push("","peg$resultsCache[key] = { nextPos: peg$currPos, result: "+t+" };"),d.trace&&r.push("","if ("+t+" !== peg$FAILED) {","  peg$tracer.trace({",'    type: "rule.match",',"    rule: "+e+",","    result: "+t+",","    location: peg$computeLocation(startPos, peg$currPos, true)","  });","} else {","  peg$tracer.trace({",'    type: "rule.fail",',"    rule: "+e+",","    location: peg$computeLocation(startPos, startPos, true)","  });","}"),r.push("","return "+t+";"),r}('"'+o(a.name)+'"',i.result()))),s.push("}"),s.push(""),s}(s)))})),p.initializer)if(Array.isArray(p.initializer))for(const e of p.initializer)a.push(E(e)),a.push("");else a.push(E(p.initializer)),a.push("");return a.push("  peg$result = peg$startRuleFunction();","","  const peg$success = (peg$result !== peg$FAILED && peg$currPos === input.length);","  function peg$throw() {","    if (peg$result !== peg$FAILED && peg$currPos < input.length) {","      peg$fail(peg$endExpectation());","    }","","    throw peg$buildStructuredError(","      peg$maxFailExpected,","      peg$maxFailPos < input.length ? peg$getUnicode(peg$maxFailPos) : null,","      peg$maxFailPos < input.length","        ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)","        : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)","    );","  }","  if (options.peg$library) {","    return /** @type {any} */ ({","      peg$result,","      peg$currPos,","      peg$FAILED,","      peg$maxFailExpected,","      peg$maxFailPos,","      peg$success,","      peg$throw: peg$success ? undefined : peg$throw,","    });","  }","  if (peg$success) {","    return peg$result;","  } else {","    peg$throw();","  }","}"),new n(null,null,d.grammarSource,a.map((e=>e instanceof n?e:e+"\n")))}())},generateJs}function requireRemoveProxyRules(){if(hasRequiredRemoveProxyRules)return removeProxyRules_1;hasRequiredRemoveProxyRules=1;const e=requireAsts(),t=requireVisitor();return removeProxyRules_1=function(r,a,o){r.rules.forEach((a=>{var s;"rule"===(s=a).type&&"rule_ref"===s.expression.type&&function(r,a,s){t.build({rule_ref(t){t.name===a&&(t.name=s,o.info(`Proxy rule "${a}" replaced by the rule "${s}"`,t.location,[{message:"This rule will be used",location:e.findRule(r,s).nameLocation}]))}})(r)}(r,a.name,a.expression.name)}))},removeProxyRules_1}function requireMergeCharacterClasses(){if(hasRequiredMergeCharacterClasses)return mergeCharacterClasses_1;hasRequiredMergeCharacterClasses=1;const{stringEscape:e}=requireUtils$1(),t=requireVisitor(),{codePointLen1:r}=requireUtils$1();function a(e,t){const r=e,a=t;Object.keys(r).forEach((e=>delete r[e])),Object.keys(a).forEach((e=>{r[e]=a[e]}))}const o=String.fromCodePoint(55295),s=String.fromCodePoint(57344);return mergeCharacterClasses_1=function(n,i,c){const l=Object.create(null);n.rules.forEach((e=>l[e.name]=e.expression));const u=new Set;!function(r,a){t.build({class(t){if(!t.unicode)return;const r=[];for(const n of t.parts)if(Array.isArray(n)){const[i,c]=n.map((e=>e.codePointAt(0)));i<55296&&c>57343&&(a.info(`Removing surrogate range from [${e(n[0])}-${e(n[1])}]`,t.location),r.push([s,n[1]]),n[1]=o)}t.parts.push(...r)}})(r)}(n,c);const[p,d]=[(e,t=!1)=>{switch(e.type){case"class":if(e.inverted)break;return t?{...e,parts:[...e.parts]}:e;case"literal":{const t=r(e.value);if(t<0)break;return{type:"class",parts:[e.value],inverted:!1,ignoreCase:e.ignoreCase,location:e.location,unicode:t>65535}}case"rule_ref":{const t=l[e.name];if(!t)break;u.has(e.name)||(u.add(e.name),d(t));const r=p(t,!0);return r&&(r.location=e.location),r}}return null},t.build({choice(e){let t=null,r=!1;e.alternatives.forEach(((a,o)=>{d(a);const s=p(a);s?t&&t.ignoreCase===s.ignoreCase?(t.parts.push(...s.parts),e.alternatives[o-1]=t,e.alternatives[o]=t,t.unicode=t.unicode||s.unicode,t.location={source:t.location.source,start:t.location.start,end:s.location.end},r=!0):t=s:t=null})),r&&(e.alternatives=e.alternatives.filter(((e,t,r)=>!t||e!==r[t-1])),e.alternatives.forEach(((t,r)=>{"class"===t.type&&(t.parts=function(e){e.sort(((e,t)=>{const[r,a]=Array.isArray(e)?e:[e,e],[o,s]=Array.isArray(t)?t:[t,t];return r!==o?r<o?-1:1:a!==s?a>s?-1:1:0}));let t="",r="";for(let a=0;a<e.length;a++){const o=e[a],[s,n]=Array.isArray(o)?o:[o,o];if("string"==typeof s&&"string"==typeof n&&"string"==typeof t&&"string"==typeof r){if(n<=r){e.splice(a--,1);continue}if(r.charCodeAt(0)+1>=s.charCodeAt(0)){e.splice(a--,1),e[a]=[t,r=n];continue}}t=s,r=n}return e}(t.parts),1!==t.parts.length||Array.isArray(t.parts[0])||"string"!=typeof t.parts[0]||t.inverted||(e.alternatives[r]={type:"literal",value:t.parts[0],ignoreCase:t.ignoreCase,location:t.location}))})),1===e.alternatives.length&&a(e,e.alternatives[0]))},text(e){if(d(e.expression),"class"===e.expression.type||"literal"===e.expression.type){const t=e.location;a(e,e.expression),e.location=t}}})];n.rules.forEach((e=>{u.add(e.name),d(e.expression)}))},mergeCharacterClasses_1}function requireRemoveUnusedRules(){if(hasRequiredRemoveUnusedRules)return removeUnusedRules_1;hasRequiredRemoveUnusedRules=1;const e=requireVisitor();return removeUnusedRules_1=function(t,r,a){const o=Object.create(null);t.rules.forEach((e=>{o[e.name]=e}));const s=[...r.allowedStartRules],n=new Set,i=e.build({rule_ref(e){s.push(e.name)}});for(;s.length;){const e=s.shift();n.has(e)||(n.add(e),i(o[e]))}t.rules=t.rules.filter((e=>!!n.has(e.name)||(a.info(`Removing unused rule: "${e.name}"`,e.location),!1)))},removeUnusedRules_1}function requireReportDuplicateImports(){return hasRequiredReportDuplicateImports||(hasRequiredReportDuplicateImports=1,reportDuplicateImports_1=function(e,t,r){const a={};for(const t of e.imports)for(const e of t.what)"import_binding_all"===e.type&&(Object.prototype.hasOwnProperty.call(a,e.binding)&&r.error(`Module "${e.binding}" is already imported`,e.location,[{message:"Original module location",location:a[e.binding]}]),a[e.binding]=e.location)}),reportDuplicateImports_1}function requireReportDuplicateLabels(){if(hasRequiredReportDuplicateLabels)return reportDuplicateLabels_1;hasRequiredReportDuplicateLabels=1;const e=requireVisitor();return reportDuplicateLabels_1=function(t,r,a){function o(e){const t={};return Object.keys(e).forEach((r=>{t[r]=e[r]})),t}function s(e,t){n(e.expression,o(t))}const n=e.build({rule(e){n(e.expression,{})},choice(e,t){e.alternatives.forEach((e=>{n(e,o(t))}))},action:s,labeled(e,t){const r=e.label;r&&Object.prototype.hasOwnProperty.call(t,r)&&a.error(`Label "${e.label}" is already defined`,e.labelLocation,[{message:"Original label location",location:t[r]}]),n(e.expression,t),t[e.label]=e.labelLocation},text:s,simple_and:s,simple_not:s,optional:s,zero_or_more:s,one_or_more:s,repeated(e,t){e.delimiter&&n(e.delimiter,o(t)),n(e.expression,o(t))},group:s});n(t)},reportDuplicateLabels_1}function requireReportDuplicateRules(){if(hasRequiredReportDuplicateRules)return reportDuplicateRules_1;hasRequiredReportDuplicateRules=1;const e=requireVisitor();return reportDuplicateRules_1=function(t,r,a){const o={};e.build({rule(e){Object.prototype.hasOwnProperty.call(o,e.name)?a.error(`Rule "${e.name}" is already defined`,e.nameLocation,[{message:"Original rule location",location:o[e.name]}]):o[e.name]=e.nameLocation}})(t)},reportDuplicateRules_1}function requireReportInfiniteRecursion(){if(hasRequiredReportInfiniteRecursion)return reportInfiniteRecursion_1;hasRequiredReportInfiniteRecursion=1;const e=requireAsts(),t=requireVisitor();return reportInfiniteRecursion_1=function(r,a,o){const s=[],n=[],i=new Set,c=t.build({rule(e){o.errors>0||i.has(e.name)||(i.add(e.name),s.push(e.name),c(e.expression),s.pop())},sequence(t){o.errors>0||t.elements.every((t=>(c(t),!(o.errors>0||e.alwaysConsumesOnSuccess(r,t)))))},repeated(t){o.errors>0||(c(t.expression),t.delimiter&&!e.alwaysConsumesOnSuccess(r,t.expression)&&c(t.delimiter))},rule_ref(t){if(o.errors>0)return;n.push(t);const a=e.findRule(r,t.name);if(-1!==s.indexOf(t.name))return s.push(t.name),void o.error("Possible infinite loop when parsing (left recursion: "+s.join(" -> ")+")",a.nameLocation,n.map(((e,t,r)=>({message:t+1!==r.length?`Step ${t+1}: call of the rule "${e.name}" without input consumption`:`Step ${t+1}: calls itself without input consumption - left recursion`,location:e.location}))));a&&c(a),n.pop()}});c(r)},reportInfiniteRecursion_1}function requireReportInfiniteRepetition(){if(hasRequiredReportInfiniteRepetition)return reportInfiniteRepetition_1;hasRequiredReportInfiniteRepetition=1;const e=requireAsts(),t=requireVisitor();return reportInfiniteRepetition_1=function(r,a,o){const s=t.build({zero_or_more(t){e.alwaysConsumesOnSuccess(r,t.expression)||o.error("Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",t.location)},one_or_more(t){e.alwaysConsumesOnSuccess(r,t.expression)||o.error("Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",t.location)},repeated(t){if(t.delimiter&&s(t.delimiter),!(e.alwaysConsumesOnSuccess(r,t.expression)||t.delimiter&&e.alwaysConsumesOnSuccess(r,t.delimiter)))if(null===t.max.value)o.error("Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",t.location);else{const e=t.min?t.min:t.max;o.warning("constant"===e.type&&"constant"===t.max.type?`An expression may not consume any input and may always match ${t.max.value} times`:"An expression may not consume any input and may always match with a maximum repetition count",t.location)}}});s(r)},reportInfiniteRepetition_1}function requireReportUndefinedRules(){if(hasRequiredReportUndefinedRules)return reportUndefinedRules_1;hasRequiredReportUndefinedRules=1;const e=requireAsts(),t=requireVisitor();return reportUndefinedRules_1=function(r,a,o){t.build({rule_ref(t){e.findRule(r,t.name)||o.error(`Rule "${t.name}" is not defined`,t.location)}})(r)},reportUndefinedRules_1}function requireReportIncorrectPlucking(){if(hasRequiredReportIncorrectPlucking)return reportIncorrectPlucking_1;hasRequiredReportIncorrectPlucking=1;const e=requireVisitor();return reportIncorrectPlucking_1=function(t,r,a){const o=e.build({action(e){o(e.expression,e)},labeled(e,t){e.pick&&t&&a.error('"@" cannot be used with an action block',e.labelLocation,[{message:"Action block location",location:t.codeLocation}]),o(e.expression)}});o(t)},reportIncorrectPlucking_1}function requireReportUnreachable(){if(hasRequiredReportUnreachable)return reportUnreachable_1;hasRequiredReportUnreachable=1;const e=requireVisitor(),{ALWAYS_MATCH:t,NEVER_MATCH:r}=requireInferenceMatchResult();return reportUnreachable_1=function(a,o,s){const n=e.build({choice(e){e.alternatives.forEach((e=>n(e)));for(let r=0;r<e.alternatives.length-1;r++){const a=e.alternatives[r];a.match===t&&s.warning("Always matches.  Following alternatives may not be reachable.",a.location)}},simple_and(e){n(e.expression),e.expression.match===t?s.warning("Always matches, making the & predicate redundant.",e.expression.location):e.expression.match===r&&s.warning("Never matches, making the & predicate always fail.",e.expression.location)},simple_not(e){n(e.expression),e.expression.match===t?s.warning("Always matches, making the ! predicate always fail.",e.expression.location):e.expression.match===r&&s.warning("Never matches, making the ! predicate redundant.",e.expression.location)}});n(a)},reportUnreachable_1}function requireSession(){if(hasRequiredSession)return session;hasRequiredSession=1;const e=requireGrammarError();class t{constructor(e){"function"==typeof(e=void 0!==e?e:{}).error&&(this.error=e.error),"function"==typeof e.warning&&(this.warning=e.warning),"function"==typeof e.info&&(this.info=e.info)}error(){}warning(){}info(){}}return session=class{constructor(e){this._callbacks=new t(e),this._firstError=null,this.errors=0,this.problems=[],this.stage=null}error(...t){++this.errors,null===this._firstError&&(this._firstError=new e(...t),this._firstError.stage=this.stage,this._firstError.problems=this.problems),this.problems.push(["error",...t]),this._callbacks.error(this.stage,...t)}warning(...e){this.problems.push(["warning",...e]),this._callbacks.warning(this.stage,...e)}info(...e){this.problems.push(["info",...e]),this._callbacks.info(this.stage,...e)}checkErrors(){if(0!==this.errors)throw this._firstError}}}function requireCompiler(){if(hasRequiredCompiler)return compiler_1;hasRequiredCompiler=1;const addImportedRules=requireAddImportedRules(),fixLibraryNumbers=requireFixLibraryNumbers(),generateBytecode=requireGenerateBytecode(),generateJS=requireGenerateJs(),inferenceMatchResult=requireInferenceMatchResult(),removeProxyRules=requireRemoveProxyRules(),mergeCharacterClasses=requireMergeCharacterClasses(),removeUnusedRules=requireRemoveUnusedRules(),reportDuplicateImports=requireReportDuplicateImports(),reportDuplicateLabels=requireReportDuplicateLabels(),reportDuplicateRules=requireReportDuplicateRules(),reportInfiniteRecursion=requireReportInfiniteRecursion(),reportInfiniteRepetition=requireReportInfiniteRepetition(),reportUndefinedRules=requireReportUndefinedRules(),reportIncorrectPlucking=requireReportIncorrectPlucking(),reportUnreachable=requireReportUnreachable(),Session=requireSession(),visitor=requireVisitor(),{base64:base64}=requireUtils$1();function processOptions(e,t){const r={};return Object.keys(e).forEach((t=>{r[t]=e[t]})),Object.keys(t).forEach((e=>{Object.prototype.hasOwnProperty.call(r,e)||(r[e]=t[e])})),r}function isSourceMapCapable(e){return"string"==typeof e?e.length>0:e&&"function"==typeof e.offset}const compiler={visitor:visitor,passes:{prepare:[addImportedRules,reportInfiniteRecursion],check:[reportUndefinedRules,reportDuplicateRules,reportDuplicateLabels,reportInfiniteRepetition,reportIncorrectPlucking,reportDuplicateImports],transform:[fixLibraryNumbers,removeProxyRules,mergeCharacterClasses,removeUnusedRules,inferenceMatchResult],semantic:[reportUnreachable],generate:[generateBytecode,generateJS]},compile(ast,passes,options){options=void 0!==options?options:{};const defaultStartRules=[ast.rules[0].name];if(options=processOptions(options,{allowedStartRules:defaultStartRules,cache:!1,dependencies:{},exportVar:null,format:"bare",output:"parser",trace:!1}),null!==options.allowedStartRules&&void 0!==options.allowedStartRules||(options.allowedStartRules=defaultStartRules),!Array.isArray(options.allowedStartRules))throw new Error("allowedStartRules must be an array");0===options.allowedStartRules.length&&(options.allowedStartRules=defaultStartRules);const allRules=ast.rules.map((e=>e.name));if(options.allowedStartRules.some((e=>"*"===e)))options.allowedStartRules=allRules;else for(const e of options.allowedStartRules)if(-1===allRules.indexOf(e))throw new Error(`Unknown start rule "${e}"`);if(("source-and-map"===options.output||"source-with-inline-map"===options.output)&&!isSourceMapCapable(options.grammarSource))throw new Error("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps");const session=new Session(options);switch(Object.keys(passes).forEach((e=>{session.stage=e,session.info(`Process stage ${e}`),passes[e].forEach((t=>{session.info(`Process pass ${e}.${t.name}`),t(ast,options,session)})),session.checkErrors()})),options.output){case"parser":return eval(ast.code.toString());case"source":return ast.code.toString();case"source-and-map":return ast.code;case"source-with-inline-map":{if("undefined"==typeof TextEncoder)throw new Error("TextEncoder is not supported by this platform");const e=ast.code.toStringWithSourceMap(),t=new TextEncoder,r=base64(t.encode(JSON.stringify(e.map.toJSON())));return e.code+`//# sourceMappingURL=data:application/json;charset=utf-8;base64,${r}\n`}case"ast":return ast;default:throw new Error("Invalid output format: "+options.output+".")}}};return compiler_1=compiler,compiler_1}function requirePeg(){if(hasRequiredPeg)return peg_1;hasRequiredPeg=1;const e=requireGrammarError(),t=requireGrammarLocation(),r=requireAsts(),a=requireCompiler(),o=requireParser(),{version:s}=requireVersion(),n={VERSION:s,RESERVED_WORDS:["break","case","catch","class","const","continue","debugger","default","delete","do","else","export","extends","finally","for","function","if","import","in","instanceof","new","return","super","switch","this","throw","try","typeof","var","void","while","with","null","true","false","enum","implements","interface","let","package","private","protected","public","static","yield","await","arguments","eval"],GrammarError:e,GrammarLocation:t,parser:o,compiler:a,generate(e,t){const a="plugins"in(t=void 0!==t?t:{})?t.plugins:[],o={parser:n.parser,passes:function(e){const t={};return Object.keys(e).forEach((r=>{t[r]=e[r].slice()})),t}(n.compiler.passes),reservedWords:n.RESERVED_WORDS.slice()};a.forEach((e=>{e.use(o,t)})),Array.isArray(e)||(e=[{source:t.grammarSource,text:e}]);const s=r.combine(e.map((({source:e,text:t})=>o.parser.parse(t,{grammarSource:e,reservedWords:o.reservedWords}))));return n.compiler.compile(s,o.passes,t)}};return peg_1=n}var utils={},hasRequiredUtils,hasRequiredGeneratedParserApi_spec;function requireUtils(){if(hasRequiredUtils)return utils;hasRequiredUtils=1;const e=require$$0;class t{constructor(e){this.args=e}calledWithExactly(...t){const r=e.util.eql(this.args,t);return r||console.error("Not equal",{calledWith:this.args,expected:t}),r}}function r(){function e(...r){e.callCount++,e.called=!0,e.calls.push(new t(r))}return e.called=!1,e.callCount=0,e.calls=[],e.getCall=t=>e.calls[t],e}return utils.spy=function(){return r()},utils.stub=function(e,t){const a=e[t],o=r();return e[t]=o,o.restore=()=>{e[t]=a},a},utils}function requireGeneratedParserApi_spec(){if(hasRequiredGeneratedParserApi_spec)return generatedParserApi_spec;hasRequiredGeneratedParserApi_spec=1;const e=require$$0,t=requirePeg(),{spy:r,stub:a}=requireUtils(),o=e.expect;return describe("generated parser API",(()=>{describe("parse",(()=>{it("parses input",(()=>{const e=t.generate("start = 'a'");o(e.parse("a")).to.equal("a")})),it("parses input in library mode",(()=>{const e=t.generate("start = 'a'").parse("a",{peg$library:!0});o(e.peg$result).to.equal("a"),o(e.peg$success).to.equal(!0),o(e.peg$throw).to.equal(void 0)})),it("throws an exception on syntax error",(()=>{const e=t.generate("start = 'a'");o((()=>{e.parse("b")})).to.throw()})),it("gives partial result on syntax error in library mode",(()=>{const e=t.generate("start = 'a'+").parse("aab",{peg$library:!0});o(e.peg$result).to.deep.equal(["a","a"]),o(e.peg$success).to.equal(!1),o(e.peg$throw).to.throw('Expected "a" or end of input but "b" found.')})),it("correctly describe character class in syntax error",(()=>{const e=t.generate("start = [123-5]");o((()=>{e.parse("0")})).to.throw("[123-5]")})),describe("start rule",(()=>{const e=t.generate(["a = 'x' { return 'a'; }","b = 'x' { return 'b'; }","c = 'x' { return 'c'; }"].join("\n"),{allowedStartRules:["b","c"]});describe("when |startRule| is not set",(()=>{it("starts parsing from the first allowed rule",(()=>{o(e.parse("x")).to.equal("b")}))})),describe("when |startRule| is set to an allowed rule",(()=>{it("starts parsing from specified rule",(()=>{o(e.parse("x",{startRule:"b"})).to.equal("b"),o(e.parse("x",{startRule:"c"})).to.equal("c")}))})),describe("when |startRule| is set to a disallowed start rule",(()=>{it("throws an exception",(()=>{o((()=>{e.parse("x",{startRule:"a"})})).to.throw()}))}))})),describe("tracing",(()=>{const e=t.generate(["start = a / b","a = 'a'i","b = 'b'"].join("\n"),{trace:!0});describe("default tracer",(()=>{it("traces using console.log (if console is defined)",(()=>{const t=["1:1-1:1 rule.enter start","1:1-1:1 rule.enter   a","1:1-1:1 rule.fail    a","1:1-1:1 rule.enter   b","1:1-1:2 rule.match   b","1:1-1:2 rule.match start"];"object"==typeof console&&a(console,"log");try{e.parse("b"),"object"==typeof console&&(o(console.log.callCount).to.equal(t.length),t.forEach(((e,t)=>{const r=console.log.getCall(t);o(r.calledWithExactly(e)).to.equal(!0)})))}finally{"object"==typeof console&&console.log.restore()}}))})),describe("custom tracers",(()=>{describe("trace",(()=>{it("receives tracing events",(()=>{const t=[{type:"rule.enter",rule:"start",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.enter",rule:"a",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.fail",rule:"a",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.enter",rule:"b",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}},{type:"rule.match",rule:"b",result:"b",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}},{type:"rule.match",rule:"start",result:"b",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}}],a={trace:r()};e.parse("b",{tracer:a}),o(a.trace.callCount).to.equal(t.length),t.forEach(((e,t)=>{const r=a.trace.getCall(t);o(r.calledWithExactly(e)).to.equal(!0)}))}))}))}))})),it("accepts custom options",(()=>{t.generate("start = 'a'").parse("a",{foo:42})}))}))})),generatedParserApi_spec}requireGeneratedParserApi_spec();var pegjsApi_spec={},version="5.0.1",require$$2={version:version},sourceMap={},sourceMapGenerator={},base64Vlq={},base64={},hasRequiredBase64,hasRequiredBase64Vlq;function requireBase64(){if(hasRequiredBase64)return base64;hasRequiredBase64=1;const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".split("");return base64.encode=function(t){if(0<=t&&t<e.length)return e[t];throw new TypeError("Must be between 0 and 63: "+t)},base64}function requireBase64Vlq(){if(hasRequiredBase64Vlq)return base64Vlq;hasRequiredBase64Vlq=1;const e=requireBase64();return base64Vlq.encode=function(t){let r,a="",o=function(e){return e<0?1+(-e<<1):0+(e<<1)}(t);do{r=31&o,o>>>=5,o>0&&(r|=32),a+=e.encode(r)}while(o>0);return a},base64Vlq}var util={},urlBrowser,hasRequiredUrlBrowser,hasRequiredUtil;function requireUrlBrowser(){return hasRequiredUrlBrowser?urlBrowser:(hasRequiredUrlBrowser=1,urlBrowser=require$$0$1.URL)}function requireUtil(){if(hasRequiredUtil)return util;hasRequiredUtil=1;const e=requireUrlBrowser();util.getArg=function(e,t,r){if(t in e)return e[t];if(3===arguments.length)return r;throw new Error('"'+t+'" is a required argument.')};const t=!("__proto__"in Object.create(null));function r(e){return e}function a(e){if(!e)return!1;const t=e.length;if(t<9)return!1;if(95!==e.charCodeAt(t-1)||95!==e.charCodeAt(t-2)||111!==e.charCodeAt(t-3)||116!==e.charCodeAt(t-4)||111!==e.charCodeAt(t-5)||114!==e.charCodeAt(t-6)||112!==e.charCodeAt(t-7)||95!==e.charCodeAt(t-8)||95!==e.charCodeAt(t-9))return!1;for(let r=t-10;r>=0;r--)if(36!==e.charCodeAt(r))return!1;return!0}function o(e,t){return e===t?0:null===e?1:null===t?-1:e>t?1:-1}util.toSetString=t?r:function(e){return a(e)?"$"+e:e},util.fromSetString=t?r:function(e){return a(e)?e.slice(1):e},util.compareByGeneratedPositionsInflated=function(e,t){let r=e.generatedLine-t.generatedLine;return 0!==r?r:(r=e.generatedColumn-t.generatedColumn,0!==r?r:(r=o(e.source,t.source),0!==r?r:(r=e.originalLine-t.originalLine,0!==r?r:(r=e.originalColumn-t.originalColumn,0!==r?r:o(e.name,t.name)))))},util.parseSourceMapInput=function(e){return JSON.parse(e.replace(/^\)]}'[^\n]*\n/,""))};const s="http://host";function n(t){return r=>{const a=u(r),o=c(r),s=new e(r,o);t(s);const n=s.toString();return"absolute"===a?n:"scheme-relative"===a?n.slice(5):"path-absolute"===a?n.slice(11):p(o,n)}}function i(t,r){return new e(t,r).toString()}function c(e){const t=e.split("..").length-1,r=function(e,t){let r=0;for(;;){const e="p"+r++;if(-1===t.indexOf(e))return e}}(0,e);let a=`${s}/`;for(let e=0;e<t;e++)a+=`${r}/`;return a}const l=/^[A-Za-z0-9\+\-\.]+:/;function u(e){return"/"===e[0]?"/"===e[1]?"scheme-relative":"path-absolute":l.test(e)?"absolute":"path-relative"}function p(t,r){"string"==typeof t&&(t=new e(t)),"string"==typeof r&&(r=new e(r));const a=r.pathname.split("/"),o=t.pathname.split("/");for(o.length>0&&!o[o.length-1]&&o.pop();a.length>0&&o.length>0&&a[0]===o[0];)a.shift(),o.shift();return o.map((()=>"..")).concat(a).join("/")+r.search+r.hash}const d=n((e=>{e.pathname=e.pathname.replace(/\/?$/,"/")})),m=n((t=>{t.href=new e(".",t.toString()).toString()})),h=n((e=>{}));function f(e,t){const r=u(t),a=u(e);if(e=d(e),"absolute"===r)return i(t,void 0);if("absolute"===a)return i(t,e);if("scheme-relative"===r)return h(t);if("scheme-relative"===a)return i(t,i(e,s)).slice(5);if("path-absolute"===r)return h(t);if("path-absolute"===a)return i(t,i(e,s)).slice(11);const o=c(t+e);return p(o,i(t,i(e,o)))}return util.normalize=h,util.join=f,util.relative=function(t,r){const a=function(t,r){if(u(t)!==u(r))return null;const a=c(t+r),o=new e(t,a),s=new e(r,a);try{new e("",s.toString())}catch(e){return null}return s.protocol!==o.protocol||s.user!==o.user||s.password!==o.password||s.hostname!==o.hostname||s.port!==o.port?null:p(o,s)}(t,r);return"string"==typeof a?a:h(r)},util.computeSourceURL=function(e,t,r){e&&"path-absolute"===u(t)&&(t=t.replace(/^\//,""));let a=h(t||"");return e&&(a=f(e,a)),r&&(a=f(m(r),a)),a},util}var arraySet={},hasRequiredArraySet;function requireArraySet(){if(hasRequiredArraySet)return arraySet;hasRequiredArraySet=1;class e{constructor(){this._array=[],this._set=new Map}static fromArray(t,r){const a=new e;for(let e=0,o=t.length;e<o;e++)a.add(t[e],r);return a}size(){return this._set.size}add(e,t){const r=this.has(e),a=this._array.length;r&&!t||this._array.push(e),r||this._set.set(e,a)}has(e){return this._set.has(e)}indexOf(e){const t=this._set.get(e);if(t>=0)return t;throw new Error('"'+e+'" is not in the set.')}at(e){if(e>=0&&e<this._array.length)return this._array[e];throw new Error("No element indexed by "+e)}toArray(){return this._array.slice()}}return arraySet.ArraySet=e,arraySet}var mappingList={},hasRequiredMappingList,hasRequiredSourceMapGenerator;function requireMappingList(){if(hasRequiredMappingList)return mappingList;hasRequiredMappingList=1;const e=requireUtil();return mappingList.MappingList=class{constructor(){this._array=[],this._sorted=!0,this._last={generatedLine:-1,generatedColumn:0}}unsortedForEach(e,t){this._array.forEach(e,t)}add(t){!function(t,r){const a=t.generatedLine,o=r.generatedLine,s=t.generatedColumn,n=r.generatedColumn;return o>a||o==a&&n>=s||e.compareByGeneratedPositionsInflated(t,r)<=0}(this._last,t)?(this._sorted=!1,this._array.push(t)):(this._last=t,this._array.push(t))}toArray(){return this._sorted||(this._array.sort(e.compareByGeneratedPositionsInflated),this._sorted=!0),this._array}},mappingList}function requireSourceMapGenerator(){if(hasRequiredSourceMapGenerator)return sourceMapGenerator;hasRequiredSourceMapGenerator=1;const e=requireBase64Vlq(),t=requireUtil(),r=requireArraySet().ArraySet,a=requireMappingList().MappingList;class o{constructor(e){e||(e={}),this._file=t.getArg(e,"file",null),this._sourceRoot=t.getArg(e,"sourceRoot",null),this._skipValidation=t.getArg(e,"skipValidation",!1),this._sources=new r,this._names=new r,this._mappings=new a,this._sourcesContents=null}static fromSourceMap(e){const r=e.sourceRoot,a=new o({file:e.file,sourceRoot:r});return e.eachMapping((function(e){const o={generated:{line:e.generatedLine,column:e.generatedColumn}};null!=e.source&&(o.source=e.source,null!=r&&(o.source=t.relative(r,o.source)),o.original={line:e.originalLine,column:e.originalColumn},null!=e.name&&(o.name=e.name)),a.addMapping(o)})),e.sources.forEach((function(o){let s=o;null!==r&&(s=t.relative(r,o)),a._sources.has(s)||a._sources.add(s);const n=e.sourceContentFor(o);null!=n&&a.setSourceContent(o,n)})),a}addMapping(e){const r=t.getArg(e,"generated"),a=t.getArg(e,"original",null);let o=t.getArg(e,"source",null),s=t.getArg(e,"name",null);this._skipValidation||this._validateMapping(r,a,o,s),null!=o&&(o=String(o),this._sources.has(o)||this._sources.add(o)),null!=s&&(s=String(s),this._names.has(s)||this._names.add(s)),this._mappings.add({generatedLine:r.line,generatedColumn:r.column,originalLine:null!=a&&a.line,originalColumn:null!=a&&a.column,source:o,name:s})}setSourceContent(e,r){let a=e;null!=this._sourceRoot&&(a=t.relative(this._sourceRoot,a)),null!=r?(this._sourcesContents||(this._sourcesContents=Object.create(null)),this._sourcesContents[t.toSetString(a)]=r):this._sourcesContents&&(delete this._sourcesContents[t.toSetString(a)],0===Object.keys(this._sourcesContents).length&&(this._sourcesContents=null))}applySourceMap(e,a,o){let s=a;if(null==a){if(null==e.file)throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, or the source map\'s "file" property. Both were omitted.');s=e.file}const n=this._sourceRoot;null!=n&&(s=t.relative(n,s));const i=this._mappings.toArray().length>0?new r:this._sources,c=new r;this._mappings.unsortedForEach((function(r){if(r.source===s&&null!=r.originalLine){const a=e.originalPositionFor({line:r.originalLine,column:r.originalColumn});null!=a.source&&(r.source=a.source,null!=o&&(r.source=t.join(o,r.source)),null!=n&&(r.source=t.relative(n,r.source)),r.originalLine=a.line,r.originalColumn=a.column,null!=a.name&&(r.name=a.name))}const a=r.source;null==a||i.has(a)||i.add(a);const l=r.name;null==l||c.has(l)||c.add(l)}),this),this._sources=i,this._names=c,e.sources.forEach((function(r){const a=e.sourceContentFor(r);null!=a&&(null!=o&&(r=t.join(o,r)),null!=n&&(r=t.relative(n,r)),this.setSourceContent(r,a))}),this)}_validateMapping(e,t,r,a){if(t&&"number"!=typeof t.line&&"number"!=typeof t.column)throw new Error("original.line and original.column are not numbers -- you probably meant to omit the original mapping entirely and only map the generated position. If so, pass null for the original mapping instead of an object with empty or null values.");if(e&&"line"in e&&"column"in e&&e.line>0&&e.column>=0&&!t&&!r&&!a);else if(!(e&&"line"in e&&"column"in e&&t&&"line"in t&&"column"in t&&e.line>0&&e.column>=0&&t.line>0&&t.column>=0&&r))throw new Error("Invalid mapping: "+JSON.stringify({generated:e,source:r,original:t,name:a}))}_serializeMappings(){let r,a,o,s,n=0,i=1,c=0,l=0,u=0,p=0,d="";const m=this._mappings.toArray();for(let h=0,f=m.length;h<f;h++){if(a=m[h],r="",a.generatedLine!==i)for(n=0;a.generatedLine!==i;)r+=";",i++;else if(h>0){if(!t.compareByGeneratedPositionsInflated(a,m[h-1]))continue;r+=","}r+=e.encode(a.generatedColumn-n),n=a.generatedColumn,null!=a.source&&(s=this._sources.indexOf(a.source),r+=e.encode(s-p),p=s,r+=e.encode(a.originalLine-1-l),l=a.originalLine-1,r+=e.encode(a.originalColumn-c),c=a.originalColumn,null!=a.name&&(o=this._names.indexOf(a.name),r+=e.encode(o-u),u=o)),d+=r}return d}_generateSourcesContent(e,r){return e.map((function(e){if(!this._sourcesContents)return null;null!=r&&(e=t.relative(r,e));const a=t.toSetString(e);return Object.prototype.hasOwnProperty.call(this._sourcesContents,a)?this._sourcesContents[a]:null}),this)}toJSON(){const e={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};return null!=this._file&&(e.file=this._file),null!=this._sourceRoot&&(e.sourceRoot=this._sourceRoot),this._sourcesContents&&(e.sourcesContent=this._generateSourcesContent(e.sources,e.sourceRoot)),e}toString(){return JSON.stringify(this.toJSON())}}return o.prototype._version=3,sourceMapGenerator.SourceMapGenerator=o,sourceMapGenerator}var sourceMapConsumer={},binarySearch={},hasRequiredBinarySearch;function requireBinarySearch(){return hasRequiredBinarySearch||(hasRequiredBinarySearch=1,function(e){function t(r,a,o,s,n,i){const c=Math.floor((a-r)/2)+r,l=n(o,s[c],!0);return 0===l?c:l>0?a-c>1?t(c,a,o,s,n,i):i==e.LEAST_UPPER_BOUND?a<s.length?a:-1:c:c-r>1?t(r,c,o,s,n,i):i==e.LEAST_UPPER_BOUND?c:r<0?-1:r}e.GREATEST_LOWER_BOUND=1,e.LEAST_UPPER_BOUND=2,e.search=function(r,a,o,s){if(0===a.length)return-1;let n=t(-1,a.length,r,a,o,s||e.GREATEST_LOWER_BOUND);if(n<0)return-1;for(;n-1>=0&&0===o(a[n],a[n-1],!0);)--n;return n}}(binarySearch)),binarySearch}var readWasmBrowser={exports:{}},hasRequiredReadWasmBrowser,wasm,hasRequiredWasm,hasRequiredSourceMapConsumer;function requireReadWasmBrowser(){if(hasRequiredReadWasmBrowser)return readWasmBrowser.exports;hasRequiredReadWasmBrowser=1;let e=null;return readWasmBrowser.exports=function(){if("string"==typeof e)return fetch(e).then((e=>e.arrayBuffer()));if(e instanceof ArrayBuffer)return Promise.resolve(e);throw new Error("You must provide the string URL or ArrayBuffer contents of lib/mappings.wasm by calling SourceMapConsumer.initialize({ 'lib/mappings.wasm': ... }) before using SourceMapConsumer")},readWasmBrowser.exports.initialize=t=>{e=t},readWasmBrowser.exports}function requireWasm(){if(hasRequiredWasm)return wasm;hasRequiredWasm=1;const e=requireReadWasmBrowser();function t(){this.generatedLine=0,this.generatedColumn=0,this.lastGeneratedColumn=null,this.source=null,this.originalLine=null,this.originalColumn=null,this.name=null}let r=null;return wasm=function(){if(r)return r;const a=[];return r=e().then((e=>WebAssembly.instantiate(e,{env:{mapping_callback(e,r,o,s,n,i,c,l,u,p){const d=new t;d.generatedLine=e+1,d.generatedColumn=r,o&&(d.lastGeneratedColumn=s-1),n&&(d.source=i,d.originalLine=c+1,d.originalColumn=l,u&&(d.name=p)),a[a.length-1](d)},start_all_generated_locations_for(){console.time("all_generated_locations_for")},end_all_generated_locations_for(){console.timeEnd("all_generated_locations_for")},start_compute_column_spans(){console.time("compute_column_spans")},end_compute_column_spans(){console.timeEnd("compute_column_spans")},start_generated_location_for(){console.time("generated_location_for")},end_generated_location_for(){console.timeEnd("generated_location_for")},start_original_location_for(){console.time("original_location_for")},end_original_location_for(){console.timeEnd("original_location_for")},start_parse_mappings(){console.time("parse_mappings")},end_parse_mappings(){console.timeEnd("parse_mappings")},start_sort_by_generated_location(){console.time("sort_by_generated_location")},end_sort_by_generated_location(){console.timeEnd("sort_by_generated_location")},start_sort_by_original_location(){console.time("sort_by_original_location")},end_sort_by_original_location(){console.timeEnd("sort_by_original_location")}}}))).then((e=>({exports:e.instance.exports,withMappingCallback:(e,t)=>{a.push(e);try{t()}finally{a.pop()}}}))).then(null,(e=>{throw r=null,e})),r}}function requireSourceMapConsumer(){if(hasRequiredSourceMapConsumer)return sourceMapConsumer;hasRequiredSourceMapConsumer=1;const e=requireUtil(),t=requireBinarySearch(),r=requireArraySet().ArraySet;requireBase64Vlq();const a=requireReadWasmBrowser(),o=requireWasm(),s=Symbol("smcInternal");class n{constructor(t,r){return t==s?Promise.resolve(this):function(t,r){let a=t;"string"==typeof t&&(a=e.parseSourceMapInput(t));const o=null!=a.sections?new c(a,r):new i(a,r);return Promise.resolve(o)}(t,r)}static initialize(e){a.initialize(e["lib/mappings.wasm"])}static fromSourceMap(e,t){return function(e,t){return i.fromSourceMap(e,t)}(e,t)}static async with(e,t,r){const a=await new n(e,t);try{return await r(a)}finally{a.destroy()}}eachMapping(e,t,r){throw new Error("Subclasses must implement eachMapping")}allGeneratedPositionsFor(e){throw new Error("Subclasses must implement allGeneratedPositionsFor")}destroy(){throw new Error("Subclasses must implement destroy")}}n.prototype._version=3,n.GENERATED_ORDER=1,n.ORIGINAL_ORDER=2,n.GREATEST_LOWER_BOUND=1,n.LEAST_UPPER_BOUND=2,sourceMapConsumer.SourceMapConsumer=n;class i extends n{constructor(t,a){return super(s).then((s=>{let n=t;"string"==typeof t&&(n=e.parseSourceMapInput(t));const i=e.getArg(n,"version"),c=e.getArg(n,"sources").map(String),l=e.getArg(n,"names",[]),u=e.getArg(n,"sourceRoot",null),p=e.getArg(n,"sourcesContent",null),d=e.getArg(n,"mappings"),m=e.getArg(n,"file",null);if(i!=s._version)throw new Error("Unsupported version: "+i);return s._sourceLookupCache=new Map,s._names=r.fromArray(l.map(String),!0),s._sources=r.fromArray(c,!0),s._absoluteSources=r.fromArray(s._sources.toArray().map((function(t){return e.computeSourceURL(u,t,a)})),!0),s.sourceRoot=u,s.sourcesContent=p,s._mappings=d,s._sourceMapURL=a,s.file=m,s._computedColumnSpans=!1,s._mappingsPtr=0,s._wasm=null,o().then((e=>(s._wasm=e,s)))}))}_findSourceIndex(t){const r=this._sourceLookupCache.get(t);if("number"==typeof r)return r;const a=e.computeSourceURL(null,t,this._sourceMapURL);if(this._absoluteSources.has(a)){const e=this._absoluteSources.indexOf(a);return this._sourceLookupCache.set(t,e),e}const o=e.computeSourceURL(this.sourceRoot,t,this._sourceMapURL);if(this._absoluteSources.has(o)){const e=this._absoluteSources.indexOf(o);return this._sourceLookupCache.set(t,e),e}return-1}static fromSourceMap(e,t){return new i(e.toString())}get sources(){return this._absoluteSources.toArray()}_getMappingsPtr(){return 0===this._mappingsPtr&&this._parseMappings(),this._mappingsPtr}_parseMappings(){const e=this._mappings,t=e.length,r=this._wasm.exports.allocate_mappings(t),a=new Uint8Array(this._wasm.exports.memory.buffer,r,t);for(let r=0;r<t;r++)a[r]=e.charCodeAt(r);const o=this._wasm.exports.parse_mappings(r);if(!o){const e=this._wasm.exports.get_last_error();let t=`Error parsing mappings (code ${e}): `;switch(e){case 1:t+="the mappings contained a negative line, column, source index, or name index";break;case 2:t+="the mappings contained a number larger than 2**32";break;case 3:t+="reached EOF while in the middle of parsing a VLQ";break;case 4:t+="invalid base 64 character while parsing a VLQ";break;default:t+="unknown error code"}throw new Error(t)}this._mappingsPtr=o}eachMapping(e,t,r){const a=t||null,o=r||n.GENERATED_ORDER;this._wasm.withMappingCallback((t=>{null!==t.source&&(t.source=this._absoluteSources.at(t.source),null!==t.name&&(t.name=this._names.at(t.name))),this._computedColumnSpans&&null===t.lastGeneratedColumn&&(t.lastGeneratedColumn=1/0),e.call(a,t)}),(()=>{switch(o){case n.GENERATED_ORDER:this._wasm.exports.by_generated_location(this._getMappingsPtr());break;case n.ORIGINAL_ORDER:this._wasm.exports.by_original_location(this._getMappingsPtr());break;default:throw new Error("Unknown order of iteration.")}}))}allGeneratedPositionsFor(t){let r=e.getArg(t,"source");const a=e.getArg(t,"line"),o=t.column||0;if(r=this._findSourceIndex(r),r<0)return[];if(a<1)throw new Error("Line numbers must be >= 1");if(o<0)throw new Error("Column numbers must be >= 0");const s=[];return this._wasm.withMappingCallback((e=>{let t=e.lastGeneratedColumn;this._computedColumnSpans&&null===t&&(t=1/0),s.push({line:e.generatedLine,column:e.generatedColumn,lastColumn:t})}),(()=>{this._wasm.exports.all_generated_locations_for(this._getMappingsPtr(),r,a-1,"column"in t,o)})),s}destroy(){0!==this._mappingsPtr&&(this._wasm.exports.free_mappings(this._mappingsPtr),this._mappingsPtr=0)}computeColumnSpans(){this._computedColumnSpans||(this._wasm.exports.compute_column_spans(this._getMappingsPtr()),this._computedColumnSpans=!0)}originalPositionFor(t){const r={generatedLine:e.getArg(t,"line"),generatedColumn:e.getArg(t,"column")};if(r.generatedLine<1)throw new Error("Line numbers must be >= 1");if(r.generatedColumn<0)throw new Error("Column numbers must be >= 0");let a,o=e.getArg(t,"bias",n.GREATEST_LOWER_BOUND);if(null==o&&(o=n.GREATEST_LOWER_BOUND),this._wasm.withMappingCallback((e=>a=e),(()=>{this._wasm.exports.original_location_for(this._getMappingsPtr(),r.generatedLine-1,r.generatedColumn,o)})),a&&a.generatedLine===r.generatedLine){let t=e.getArg(a,"source",null);null!==t&&(t=this._absoluteSources.at(t));let r=e.getArg(a,"name",null);return null!==r&&(r=this._names.at(r)),{source:t,line:e.getArg(a,"originalLine",null),column:e.getArg(a,"originalColumn",null),name:r}}return{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return!!this.sourcesContent&&this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some((function(e){return null==e}))}sourceContentFor(e,t){if(!this.sourcesContent)return null;const r=this._findSourceIndex(e);if(r>=0)return this.sourcesContent[r];if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')}generatedPositionFor(t){let r=e.getArg(t,"source");if(r=this._findSourceIndex(r),r<0)return{line:null,column:null,lastColumn:null};const a={source:r,originalLine:e.getArg(t,"line"),originalColumn:e.getArg(t,"column")};if(a.originalLine<1)throw new Error("Line numbers must be >= 1");if(a.originalColumn<0)throw new Error("Column numbers must be >= 0");let o,s=e.getArg(t,"bias",n.GREATEST_LOWER_BOUND);if(null==s&&(s=n.GREATEST_LOWER_BOUND),this._wasm.withMappingCallback((e=>o=e),(()=>{this._wasm.exports.generated_location_for(this._getMappingsPtr(),a.source,a.originalLine-1,a.originalColumn,s)})),o&&o.source===a.source){let t=o.lastGeneratedColumn;return this._computedColumnSpans&&null===t&&(t=1/0),{line:e.getArg(o,"generatedLine",null),column:e.getArg(o,"generatedColumn",null),lastColumn:t}}return{line:null,column:null,lastColumn:null}}}i.prototype.consumer=n,sourceMapConsumer.BasicSourceMapConsumer=i;class c extends n{constructor(t,r){return super(s).then((a=>{let o=t;"string"==typeof t&&(o=e.parseSourceMapInput(t));const s=e.getArg(o,"version"),i=e.getArg(o,"sections");if(s!=a._version)throw new Error("Unsupported version: "+s);let c={line:-1,column:0};return Promise.all(i.map((t=>{if(t.url)throw new Error("Support for url field in sections not implemented.");const a=e.getArg(t,"offset"),o=e.getArg(a,"line"),s=e.getArg(a,"column");if(o<c.line||o===c.line&&s<c.column)throw new Error("Section offsets must be ordered and non-overlapping.");return c=a,new n(e.getArg(t,"map"),r).then((e=>({generatedOffset:{generatedLine:o+1,generatedColumn:s+1},consumer:e})))}))).then((e=>(a._sections=e,a)))}))}get sources(){const e=[];for(let t=0;t<this._sections.length;t++)for(let r=0;r<this._sections[t].consumer.sources.length;r++)e.push(this._sections[t].consumer.sources[r]);return e}originalPositionFor(r){const a={generatedLine:e.getArg(r,"line"),generatedColumn:e.getArg(r,"column")},o=t.search(a,this._sections,(function(e,t){return e.generatedLine-t.generatedOffset.generatedLine||e.generatedColumn-t.generatedOffset.generatedColumn})),s=this._sections[o];return s?s.consumer.originalPositionFor({line:a.generatedLine-(s.generatedOffset.generatedLine-1),column:a.generatedColumn-(s.generatedOffset.generatedLine===a.generatedLine?s.generatedOffset.generatedColumn-1:0),bias:r.bias}):{source:null,line:null,column:null,name:null}}hasContentsOfAllSources(){return this._sections.every((function(e){return e.consumer.hasContentsOfAllSources()}))}sourceContentFor(e,t){for(let t=0;t<this._sections.length;t++){const r=this._sections[t].consumer.sourceContentFor(e,!0);if(r)return r}if(t)return null;throw new Error('"'+e+'" is not in the SourceMap.')}_findSectionIndex(e){for(let t=0;t<this._sections.length;t++){const{consumer:r}=this._sections[t];if(-1!==r._findSourceIndex(e))return t}return-1}generatedPositionFor(t){const r=this._findSectionIndex(e.getArg(t,"source")),a=r>=0?this._sections[r]:null,o=r>=0&&r+1<this._sections.length?this._sections[r+1]:null,s=a&&a.consumer.generatedPositionFor(t);if(s&&null!==s.line){const e=a.generatedOffset.generatedLine-1,t=a.generatedOffset.generatedColumn-1;return 1===s.line&&(s.column+=t,"number"==typeof s.lastColumn&&(s.lastColumn+=t)),s.lastColumn===1/0&&o&&s.line===o.generatedOffset.generatedLine&&(s.lastColumn=o.generatedOffset.generatedColumn-2),s.line+=e,s}return{line:null,column:null,lastColumn:null}}allGeneratedPositionsFor(t){const r=this._findSectionIndex(e.getArg(t,"source")),a=r>=0?this._sections[r]:null,o=r>=0&&r+1<this._sections.length?this._sections[r+1]:null;return a?a.consumer.allGeneratedPositionsFor(t).map((e=>{const t=a.generatedOffset.generatedLine-1,r=a.generatedOffset.generatedColumn-1;return 1===e.line&&(e.column+=r,"number"==typeof e.lastColumn&&(e.lastColumn+=r)),e.lastColumn===1/0&&o&&e.line===o.generatedOffset.generatedLine&&(e.lastColumn=o.generatedOffset.generatedColumn-2),e.line+=t,e})):[]}eachMapping(e,t,r){this._sections.forEach(((a,o)=>{const s=o+1<this._sections.length?this._sections[o+1]:null,{generatedOffset:n}=a,i=n.generatedLine-1,c=n.generatedColumn-1;a.consumer.eachMapping((function(t){1===t.generatedLine&&(t.generatedColumn+=c,"number"==typeof t.lastGeneratedColumn&&(t.lastGeneratedColumn+=c)),t.lastGeneratedColumn===1/0&&s&&t.generatedLine===s.generatedOffset.generatedLine&&(t.lastGeneratedColumn=s.generatedOffset.generatedColumn-2),t.generatedLine+=i,e.call(this,t)}),t,r)}))}computeColumnSpans(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.computeColumnSpans()}destroy(){for(let e=0;e<this._sections.length;e++)this._sections[e].consumer.destroy()}}return sourceMapConsumer.IndexedSourceMapConsumer=c,sourceMapConsumer}var sourceNode={},hasRequiredSourceNode,hasRequiredSourceMap;function requireSourceNode(){if(hasRequiredSourceNode)return sourceNode;hasRequiredSourceNode=1;const e=requireSourceMapGenerator().SourceMapGenerator,t=requireUtil(),r=/(\r?\n)/,a="$$$isSourceNode$$$";class o{constructor(e,t,r,o,s){this.children=[],this.sourceContents={},this.line=null==e?null:e,this.column=null==t?null:t,this.source=null==r?null:r,this.name=null==s?null:s,this[a]=!0,null!=o&&this.add(o)}static fromStringWithSourceMap(e,a,s){const n=new o,i=e.split(r);let c=0;const l=function(){return e()+(e()||"");function e(){return c<i.length?i[c++]:void 0}};let u,p=1,d=0,m=null;return a.eachMapping((function(e){if(null!==m){if(!(p<e.generatedLine)){u=i[c]||"";const t=u.substr(0,e.generatedColumn-d);return i[c]=u.substr(e.generatedColumn-d),d=e.generatedColumn,h(m,t),void(m=e)}h(m,l()),p++,d=0}for(;p<e.generatedLine;)n.add(l()),p++;d<e.generatedColumn&&(u=i[c]||"",n.add(u.substr(0,e.generatedColumn)),i[c]=u.substr(e.generatedColumn),d=e.generatedColumn),m=e}),this),c<i.length&&(m&&h(m,l()),n.add(i.splice(c).join(""))),a.sources.forEach((function(e){const r=a.sourceContentFor(e);null!=r&&(null!=s&&(e=t.join(s,e)),n.setSourceContent(e,r))})),n;function h(e,r){if(null===e||void 0===e.source)n.add(r);else{const a=s?t.join(s,e.source):e.source;n.add(new o(e.originalLine,e.originalColumn,a,r,e.name))}}}add(e){if(Array.isArray(e))e.forEach((function(e){this.add(e)}),this);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);e&&this.children.push(e)}return this}prepend(e){if(Array.isArray(e))for(let t=e.length-1;t>=0;t--)this.prepend(e[t]);else{if(!e[a]&&"string"!=typeof e)throw new TypeError("Expected a SourceNode, string, or an array of SourceNodes and strings. Got "+e);this.children.unshift(e)}return this}walk(e){let t;for(let r=0,o=this.children.length;r<o;r++)t=this.children[r],t[a]?t.walk(e):""!==t&&e(t,{source:this.source,line:this.line,column:this.column,name:this.name})}join(e){let t,r;const a=this.children.length;if(a>0){for(t=[],r=0;r<a-1;r++)t.push(this.children[r]),t.push(e);t.push(this.children[r]),this.children=t}return this}replaceRight(e,t){const r=this.children[this.children.length-1];return r[a]?r.replaceRight(e,t):"string"==typeof r?this.children[this.children.length-1]=r.replace(e,t):this.children.push("".replace(e,t)),this}setSourceContent(e,r){this.sourceContents[t.toSetString(e)]=r}walkSourceContents(e){for(let t=0,r=this.children.length;t<r;t++)this.children[t][a]&&this.children[t].walkSourceContents(e);const r=Object.keys(this.sourceContents);for(let a=0,o=r.length;a<o;a++)e(t.fromSetString(r[a]),this.sourceContents[r[a]])}toString(){let e="";return this.walk((function(t){e+=t})),e}toStringWithSourceMap(t){const r={code:"",line:1,column:0},a=new e(t);let o=!1,s=null,n=null,i=null,c=null;return this.walk((function(e,t){r.code+=e,null!==t.source&&null!==t.line&&null!==t.column?(s===t.source&&n===t.line&&i===t.column&&c===t.name||a.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:r.line,column:r.column},name:t.name}),s=t.source,n=t.line,i=t.column,c=t.name,o=!0):o&&(a.addMapping({generated:{line:r.line,column:r.column}}),s=null,o=!1);for(let n=0,i=e.length;n<i;n++)10===e.charCodeAt(n)?(r.line++,r.column=0,n+1===i?(s=null,o=!1):o&&a.addMapping({source:t.source,original:{line:t.line,column:t.column},generated:{line:r.line,column:r.column},name:t.name})):r.column++})),this.walkSourceContents((function(e,t){a.setSourceContent(e,t)})),{code:r.code,map:a}}}return sourceNode.SourceNode=o,sourceNode}function requireSourceMap(){return hasRequiredSourceMap||(hasRequiredSourceMap=1,sourceMap.SourceMapGenerator=requireSourceMapGenerator().SourceMapGenerator,sourceMap.SourceMapConsumer=requireSourceMapConsumer().SourceMapConsumer,sourceMap.SourceNode=requireSourceNode().SourceNode),sourceMap}var chaiLike$1={exports:{}},hasRequiredChaiLike$1,chaiLike,hasRequiredChaiLike,hasRequiredPegjsApi_spec;function requireChaiLike$1(){if(hasRequiredChaiLike$1)return chaiLike$1.exports;hasRequiredChaiLike$1=1;let e=[];return chaiLike$1.exports=function(t,r){function a(e,t){return r.type(t).toUpperCase()===e.toUpperCase()}function o(t,r){for(let a of e)if(a.match(t,r))return a.assert(t,r);if(t===r)return!0;if(a("object",r)&&a("object",t)){for(let e of Object.keys(r)){if(!(e in t))return!1;if(!o(t[e],r[e]))return!1}return!0}if(a("array",r)&&a("array",t)){if(t.length!==r.length)return!1;for(let e=0;e<r.length;e++)if(!o(t[e],r[e]))return!1;return!0}return a("RegExp",t)&&a("RegExp",r)?t.toString()===r.toString():a("Date",t)&&a("Date",r)?t.getTime()===r.getTime():!!(a("string",t)&&a("string",r)||a("number",t)&&a("number",r)||a("boolean",t)&&a("boolean",r))&&t==r}t.Assertion.addMethod("like",(function(e){let a=r.flag(this,"object");this.assert(o(a,e),"expected #{this} to be like #{exp}","expected #{this} to not like #{exp}",e,a,t.config.showDiff)}))},chaiLike$1.exports.extend=function(t){e.push(t)},chaiLike$1.exports.clearPlugins=function(){e=[]},chaiLike$1.exports}function requireChaiLike(){return hasRequiredChaiLike?chaiLike:(hasRequiredChaiLike=1,chaiLike=requireChaiLike$1())}function requirePegjsApi_spec(){if(hasRequiredPegjsApi_spec)return pegjsApi_spec;hasRequiredPegjsApi_spec=1;const chai=require$$0,peg=requirePeg(),pkg=require$$2,{SourceMapConsumer:SourceMapConsumer}=requireSourceMap(),{spy:spy}=requireUtils();chai.use(requireChaiLike()),beforeEach((()=>"undefined"!=typeof window?SourceMapConsumer.initialize({"lib/mappings.wasm":"https://raw.githubusercontent.com/mozilla/source-map/0.7.3/lib/mappings.wasm"}):null));const expect=chai.expect;return describe("Peggy API",(()=>{it("has the correct VERSION",(()=>{expect(peg.VERSION).to.equal(pkg.version),globalThis.peggyVersion=peg.VERSION})),describe("generate",(()=>{it("generates a parser",(()=>{const e=peg.generate("start = 'a'");expect(e).to.be.an("object"),expect(e.parse("a")).to.equal("a")})),it("throws an exception on syntax error",(()=>{expect((()=>{peg.generate("start = @")})).to.throw(),expect((()=>{peg.generate("start = 'a'\n")})).to.throw(),expect((()=>{peg.generate("start = 'a'\n")})).to.throw()})),it("throws an exception on semantic error",(()=>{expect((()=>{peg.generate("start = undefined")})).to.throw()})),it("throws an exception on bad startRule",(()=>{expect((()=>{peg.parser.parse("start = 'a'",{startRule:"BAD_START_RULE"})})).to.throw()})),describe("allowed start rules",(()=>{const e=["a = 'x'","b = 'x'","c = 'x'"].join("\n");describe("when |allowedStartRules| is not set",(()=>{it("generated parser can start only from the first rule",(()=>{const t=peg.generate(e);expect(t.parse("x",{startRule:"a"})).to.equal("x"),expect((()=>{t.parse("x",{startRule:"b"})})).to.throw(),expect((()=>{t.parse("x",{startRule:"c"})})).to.throw()}))})),describe("when |allowedStartRules| is set",(()=>{it("generated parser can start only from specified rules",(()=>{const t=peg.generate(e,{allowedStartRules:["b","c"]});expect((()=>{t.parse("x",{startRule:"a"})})).to.throw(),expect(t.parse("x",{startRule:"b"})).to.equal("x"),expect(t.parse("x",{startRule:"c"})).to.equal("x")}))}))})),describe("intermediate results caching",(()=>{const e=["{ var n = 0; }","start = (a 'b') / (a 'c') { return n; }","a = 'a' { n++; }"].join("\n");describe("when |cache| is not set",(()=>{it("generated parser doesn't cache intermediate parse results",(()=>{const t=peg.generate(e);expect(t.parse("ac")).to.equal(2)}))})),describe("when |cache| is set to |false|",(()=>{it("generated parser doesn't cache intermediate parse results",(()=>{const t=peg.generate(e,{cache:!1});expect(t.parse("ac")).to.equal(2)}))})),describe("when |cache| is set to |true|",(()=>{it("generated parser caches intermediate parse results",(()=>{const t=peg.generate(e,{cache:!0});expect(t.parse("ac")).to.equal(1)}))}))})),describe("tracing",(()=>{const e="start = 'a'";describe("when |trace| is not set",(()=>{it("generated parser doesn't trace",(()=>{const t=peg.generate(e),r={trace:spy()};t.parse("a",{tracer:r}),expect(r.trace.called).to.equal(!1)}))})),describe("when |trace| is set to |false|",(()=>{it("generated parser doesn't trace",(()=>{const t=peg.generate(e,{trace:!1}),r={trace:spy()};t.parse("a",{tracer:r}),expect(r.trace.called).to.equal(!1)}))})),describe("when |trace| is set to |true|",(()=>{it("generated parser traces",(()=>{const t=peg.generate(e,{trace:!0}),r={trace:spy()};t.parse("a",{tracer:r}),expect(r.trace.called).to.equal(!0)}))}))})),describe("output",(()=>{const grammar="start = 'a'";describe("when |output| is not set",(()=>{it("returns generated parser object",(()=>{const e=peg.generate(grammar);expect(e).to.be.an("object"),expect(e.parse("a")).to.equal("a")}))})),describe('when |output| is set to |"parser"|',(()=>{it("returns generated parser object",(()=>{const e=peg.generate(grammar,{output:"parser"});expect(e).to.be.an("object"),expect(e.parse("a")).to.equal("a")}))})),describe('when |output| is set to |"source"|',(()=>{it("returns generated parser source code",(()=>{const source=peg.generate(grammar,{output:"source"});expect(source).to.be.a("string"),expect(eval(source).parse("a")).to.equal("a")}))})),describe('when |output| is set to |"ast"|',(()=>{it("returns generated parser AST",(()=>{const e=peg.generate(grammar,{output:"ast"});expect(e).to.be.an("object"),expect(e).to.be.like(peg.parser.parse(grammar))}))}))})),describe("reserved words",(()=>{describe("throws an exception on reserved JS words used as a label",(()=>{for(const e of peg.RESERVED_WORDS)it(e,(()=>{expect((()=>{peg.generate(["start = "+e+":end","end = 'a'"].join("\n"),{output:"source"})})).to.throw(peg.parser.SyntaxError)}))})),describe("does not throw an exception on special non-reserved JS words used as a label",(()=>{const nonReserved=["abstract","boolean","byte","char","double","final","float","goto","int","long","native","short","synchronized","throws","transient","volatile","as","async","from","get","of","set"];for(const label of nonReserved)it(label,(()=>{const source=peg.generate(["start = "+label+":end { return "+label+"; }","end = 'a'"].join("\n"),{output:"source"});expect(eval(source).parse("a")).to.equal("a")}))})),describe("does not throw an exception on reserved JS words used as a rule name",(()=>{for(const rule of peg.RESERVED_WORDS)it(rule,(()=>{const source=peg.generate(["start = "+rule,rule+" = 'a'"].join("\n"),{output:"source"});expect(eval(source).parse("a")).to.equal("a")}))}))})),it("accepts custom options",(()=>{peg.generate("start = 'a'",{grammarSource:42})})),describe("generates source map",(()=>{function e(e,t,r){const a=t instanceof RegExp?e.search(t):e.indexOf(t);let o=1,s=0;for(let t=0;t<a;++t)10===e.charCodeAt(t)?(++o,s=0):++s;if(r&&r.offset){const e=r.offset({line:o,column:s,offset:a});return delete e.offset,e}return{line:o,column:s}}const t="GLOBAL\nINITIALIZER",r="PER-PARSE\nINITIALIZER",a="NOT\nBLOCK",o="AND\nBLOCK",s="ACTION\nBLOCK",n="MIN\nBLOCK",i="MAX\nBLOCK",c="EXACT\nBLOCK",l=`\n        {{${t}}}\n        {${r}}\n        RULE_1 = !{${a}} 'a' rule:RULE_2 {${s}};\n        RULE_2 'named' = &{${o}} @'b' [abc] 'def';\n        RULE_3 = RULE_1 / RULE_2;\n        RULE_4 = RULE_1|{${n}} .. {${i}}, RULE_2|{${c}}| |;\n      `;function u(t,r,a,o=t){const s=peg.generate(l,{grammarSource:r,output:"source-and-map",allowedStartRules:["*"]}),{code:n,map:i}=s.toStringWithSourceMap(),c=e(l,t,r),u=e(n,o);return delete c.offset,delete u.offset,SourceMapConsumer.fromSourceMap(i).then((e=>{expect(e.originalPositionFor(u)).to.be.deep.equal(Object.assign(c,{source:String(r),name:a}))}))}const p=new peg.GrammarLocation("-",{offset:51,line:13,column:7});for(const e of["-",p])describe(`with source = ${chai.util.inspect(e)}`,(()=>{it("global initializer",(()=>u(t,e,"$top_level_initializer"))),it("per-parse initializer",(()=>u(r,e,"$initializer"))),it("action block",(()=>u(s,e,null))),it("semantic and predicate",(()=>u(o,e,null))),it("semantic not predicate",(()=>u(a,e,null))),it("min function boundary",(()=>u(n,e,null))),it("max function boundary",(()=>u(i,e,null))),it("exact function boundary",(()=>u(c,e,null))),it("rule name",(()=>u("RULE_1",e,"RULE_1","peg$parseRULE_1() {"))),it("labelled rule name",(()=>u("RULE_2 'named'",e,"RULE_2","peg$parseRULE_2() {"))),it("literal expression",(()=>u("'a'",e,null,"input.charCodeAt(peg$currPos) === 97"))),it("multichar literal",(()=>u("'def'",e,null,"input.substr(peg$currPos, 3) === peg$c3"))),it("chars expression",(()=>u("[abc]",e,null,/s\d = input\.charAt\(peg\$currPos\);\s*if \(peg\$r0\.test\(s\d\)\)/))),it("rule expression",(()=>u("RULE_2",e,null,"peg$parseRULE_2();"))),it("choice expression",(()=>u("RULE_1 / RULE_2",e,null,new RegExp([/peg\$parseRULE_1\(\);\s*/,/if \(s. === peg\$FAILED\) \{\s*/,/s. = peg\$parseRULE_2/].map((e=>e.source)).join("")))))}))}))}))})),pegjsApi_spec}requirePegjsApi_spec();var pluginApi_spec={},hasRequiredPluginApi_spec;function requirePluginApi_spec(){if(hasRequiredPluginApi_spec)return pluginApi_spec;hasRequiredPluginApi_spec=1;const e=require$$0,{SourceNode:t}=requireSourceMap(),r=requirePeg(),a=requireOpcodes(),o=e.expect;return describe("plugin API",(()=>{describe("use",(()=>{const e="start = 'a'";it("is called for each plugin",(()=>{const t=[!1,!1,!1],a=[{use(){t[0]=!0}},{use(){t[1]=!0}},{use(){t[2]=!0}}];r.generate(e,{plugins:a}),o(t).to.deep.equal([!0,!0,!0])})),it("receives configuration",(()=>{const t={use(e){o(e).to.be.an("object"),o(e.parser).to.be.an("object"),o(e.parser.parse("start = 'a'")).to.be.an("object"),o(e.passes).to.be.an("object"),o(e.passes.check).to.be.an("array"),e.passes.check.forEach((e=>{o(e).to.be.a("function")})),o(e.passes.transform).to.be.an("array"),e.passes.transform.forEach((e=>{o(e).to.be.a("function")})),o(e.passes.generate).to.be.an("array"),e.passes.generate.forEach((e=>{o(e).to.be.a("function")})),o(e.reservedWords).to.be.an("array"),e.reservedWords.forEach((e=>{o(e).to.be.a("string")}))}};r.generate(e,{plugins:[t]})})),it("receives options",(()=>{const t={plugins:[{use(e,r){o(r).to.equal(t)}}],foo:42};r.generate(e,t)})),it("can replace parser",(()=>{const e={use(e){const t=r.generate(["start = .* {","  return {","    type: 'grammar',","    imports: [],","    initializer: {","      type: 'initializer',","      code: ['/* included for cover ast2SourceNode in the generate-js pass */'],","    },","    rules: [","      {","        type: 'rule',","        name: 'start',","        expression: { type: 'literal',  value: text(), ignoreCase: false }","      }","    ]","  };","}"].join("\n"));e.parser=t}},t=r.generate("a",{plugins:[e]});o(t.parse("a")).to.equal("a")})),it("can change compiler passes",(()=>{const a={use(e){e.passes.generate=[function(e){e.code=new t(1,0,"plugin","({ parse: function() { return 42; } })")}]}},s=r.generate(e,{plugins:[a]});o(s.parse("a")).to.equal(42)})),it("can change list of reserved words",(()=>{const e={use(e){e.reservedWords=[]}};o((()=>{r.generate("start = "+r.RESERVED_WORDS[0]+":'a'",{plugins:[e],output:"source"})})).to.not.throw()})),it("can change options",(()=>{const e=["a = 'x'","b = 'x'","c = 'x'"].join("\n"),t={use(e,t){t.allowedStartRules=["b","c"]}},a=r.generate(e,{allowedStartRules:["a"],plugins:[t]});o((()=>{a.parse("x",{startRule:"a"})})).to.throw(),o(a.parse("x",{startRule:"b"})).to.equal("x"),o(a.parse("x",{startRule:"c"})).to.equal("x")})),it("can use star for start rules",(()=>{const e=["a = 'x'","b = 'x'","c = 'x'"].join("\n"),t=r.generate(e,{allowedStartRules:["*"]});o(t.parse("x",{startRule:"a"})).to.equal("x"),o(t.parse("x",{startRule:"b"})).to.equal("x"),o(t.parse("x",{startRule:"c"})).to.equal("x")})),it("can munge the bytecode",(()=>{const e={use(e){e.passes.generate.splice(1,0,(function(e){o(e.rules.length).to.equal(2);let t=e.rules[0].bytecode;o(t[0]).to.equal(a.MATCH_STRING_IC),t.splice(4,0,a.PUSH_CURR_POS,a.POP),t[2]+=2,t=e.rules[1].bytecode,o(t[0]).to.equal(a.MATCH_STRING),o(t[4]).to.equal(a.ACCEPT_STRING),t[4]=a.ACCEPT_N,t[5]=1}))}},t=r.generate("one = 'abc'i; two = 'a'",{plugins:[e],output:"source",allowedStartRules:["*"]}),s=new RegExp([/if \(input\.substr\(peg\$currPos, 3\)/,/.toLowerCase\(\) === peg\$c0\) \{/,/\s*s0 = peg\$currPos;/,/\s*s0 = input\.substr/].map((e=>e.source)).join(""));o(t.search(s)).to.be.greaterThan(0)}))}))})),pluginApi_spec}requirePluginApi_spec();var generatedParserBehavior_spec={},hasRequiredGeneratedParserBehavior_spec;function requireGeneratedParserBehavior_spec(){if(hasRequiredGeneratedParserBehavior_spec)return generatedParserBehavior_spec;hasRequiredGeneratedParserBehavior_spec=1;const e=require$$0,t=requirePeg(),r=e.expect,{stub:a}=requireUtils();return describe("generated parser behavior",(()=>{function o(e){const t={};return Object.keys(e).forEach((r=>{t[r]=e[r]})),t}function s(e){"object"==typeof console&&a(console,"log");try{return e()}finally{"object"==typeof console&&console.log.restore()}}function n(e,t){const r=e.Assertion;r.addMethod("parse",(function(e,r,a){a=void 0!==a?a:{};const o=s((()=>t.flag(this,"object").parse(e,a)));void 0!==r&&this.assert(t.eql(o,r),"expected #{this} to parse input as #{exp} but got #{act}","expected #{this} to not parse input as #{exp}",r,o,!t.flag(this,"negate"))})),r.addMethod("failToParse",(function(e,a,o){o=void 0!==o?o:{};let n,i=!1;try{n=s((()=>t.flag(this,"object").parse(e,o))),i=!0}catch(e){n=e}this.assert(!i,"expected #{this} to fail to parse input but got #{act}","expected #{this} to not fail to parse input but #{act} was thrown",null,n),i||void 0===a||Object.keys(a).forEach((e=>{new r(n).to.have.property(e).that.is.deep.equal(a[e])}))}))}var i;beforeEach((()=>{e.use(n)})),i=e=>{describe("initializer",(()=>{it("executes the code before parsing starts",(()=>{const a=t.generate(["{ var result = 42; }","start = 'a' { return result; }"].join("\n"),e);r(a).to.parse("a",42)})),describe("available variables and functions",(()=>{it("|options| contains options",(()=>{const a=t.generate(["{ var result = options; }","start = 'a' { return result; }"].join("\n"),e);r(a).to.parse("a",{a:42},{a:42})}))}))})),describe("rule",(()=>{e.cache?it("caches rule match results",(()=>{const a=t.generate(["{ var n = 0; }","start = (a 'b') / (a 'c') { return n; }","a = 'a' { n++; }"].join("\n"),e);r(a).to.parse("ac",1)})):it("doesn't cache rule match results",(()=>{const a=t.generate(["{ var n = 0; }","start = (a 'b') / (a 'c') { return n; }","a = 'a' { n++; }"].join("\n"),e);r(a).to.parse("ac",2)})),describe("when the expression matches",(()=>{describe("without display name",(()=>{describe("returns its match result",(()=>{it("when expression may match",(()=>{const a=t.generate("start = 'a'",e);r(a).to.parse("a","a")})),it("when expression always match",(()=>{const a=t.generate("start = 'a'*",e);r(a).to.parse("",[])}))}))})),describe("with display name",(()=>{describe("returns its match result",(()=>{it("when expression may match",(()=>{const a=t.generate("start 'start' = 'a'",e);r(a).to.parse("a","a")})),it("when expression always match",(()=>{const a=t.generate("start 'start' = 'a'*",e);r(a).to.parse("",[])}))}))}))})),describe("when the expression doesn't match",(()=>{describe("without display name",(()=>{describe("reports match failure and records an expectation",(()=>{it("when expression may match",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1}]})})),it("when expression never match",(()=>{const a=t.generate("start = []",e);r(a).to.failToParse("b",{expected:[{type:"class",parts:[],inverted:!1,ignoreCase:!1,unicode:!1}]})}))}))})),describe("with display name",(()=>{it('reports match failure and records an expectation of type "other" when expression may match',(()=>{const a=t.generate("start 'start' = 'a'",e);r(a).to.failToParse("b",{expected:[{type:"other",description:"start"}]})})),it('reports match failure and records an expectation of type "other" when expression never match',(()=>{const a=t.generate("start 'start' = []",e);r(a).to.failToParse("b",{expected:[{type:"other",description:"start"}]})})),it("discards any expectations recorded when matching the expression",(()=>{const a=t.generate("start 'start' = 'a'",e);r(a).to.failToParse("b",{expected:[{type:"other",description:"start"}]})}))}))}))})),describe("literal",(()=>{describe("matching",(()=>{it("matches empty literals",(()=>{const a=t.generate("start = ''",e);r(a).to.parse("")})),it("matches one-character literals",(()=>{const a=t.generate("start = 'a'",e);r(a).to.parse("a"),r(a).to.failToParse("b")})),it("matches multi-character literals",(()=>{const a=t.generate("start = 'abcd'",e);r(a).to.parse("abcd"),r(a).to.failToParse("efgh")})),it('is case sensitive without the "i" flag',(()=>{const a=t.generate("start = 'a'",e);r(a).to.parse("a"),r(a).to.failToParse("A")})),it('is case insensitive with the "i" flag',(()=>{const a=t.generate("start = 'a'i",e);r(a).to.parse("a"),r(a).to.parse("A")}))})),describe("when it matches",(()=>{it("returns the matched text",(()=>{const a=t.generate("start = 'a'",e);r(a).to.parse("a","a")})),it("consumes the matched text",(()=>{const a=t.generate("start = 'a' .",e);r(a).to.parse("ab")}))})),describe("when it doesn't match",(()=>{it('reports match failure and records an expectation of type "literal"',(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1}]})}))}))})),describe("character class",(()=>{describe("matching",(()=>{it("matches empty classes",(()=>{const a=t.generate("start = []",e);r(a).to.failToParse("a")})),it("matches classes with a character list",(()=>{const a=t.generate("start = [abc]",e);r(a).to.parse("a"),r(a).to.parse("b"),r(a).to.parse("c"),r(a).to.failToParse("d")})),it("matches classes with a character range",(()=>{const a=t.generate("start = [a-c]",e);r(a).to.parse("a"),r(a).to.parse("b"),r(a).to.parse("c"),r(a).to.failToParse("d")})),it("matches inverted classes",(()=>{const a=t.generate("start = [^a]",e);r(a).to.failToParse("a"),r(a).to.parse("b")})),it('is case sensitive without the "i" flag',(()=>{const a=t.generate("start = [a]",e);r(a).to.parse("a"),r(a).to.failToParse("A")})),it('is case insensitive with the "i" flag',(()=>{const a=t.generate("start = [a]i",e);r(a).to.parse("a"),r(a).to.parse("A")})),it("matches unicode classes",(()=>{const a=t.generate("start = [\\u{1F4A9}]",e);r(a).to.parse("💩")})),it("matches explicit unicode classes",(()=>{const a=t.generate("start = [^a]u",e);r(a).to.parse("💩"),r(a).to.parse("A"),r(a).to.failToParse("a")})),it("matches explicit unicode classes, case-insensitive",(()=>{const a=t.generate("start = [^a]ui",e);r(a).to.parse("💩"),r(a).to.failToParse("A"),r(a).to.failToParse("a")})),it("matches not-nothing class",(()=>{const a=t.generate("start = [^]+",e);r(a).to.parse("A"),r(a).to.parse("💩"),r(a).to.failToParse("")})),it("matches not-nothing unicode class",(()=>{const a=t.generate("start = [^]u",e);r(a).to.parse("A"),r(a).to.parse("💩"),r(a).to.failToParse("")}))})),describe("when it matches",(()=>{it("returns the matched character",(()=>{const a=t.generate("start = [a]",e);r(a).to.parse("a","a")})),it("consumes the matched character",(()=>{const a=t.generate("start = [a] .",e);r(a).to.parse("ab")}))})),describe("when it doesn't match",(()=>{it('reports match failure and records an expectation of type "class"',(()=>{const a=t.generate("start = [a]",e);r(a).to.failToParse("b",{expected:[{type:"class",parts:["a"],inverted:!1,ignoreCase:!1,unicode:!1}]})}))}))})),describe("dot",(()=>{describe("matching",(()=>{it("matches any character",(()=>{const a=t.generate("start = .",e);r(a).to.parse("a"),r(a).to.parse("b"),r(a).to.parse("c")}))})),describe("when it matches",(()=>{it("returns the matched character",(()=>{const a=t.generate("start = .",e);r(a).to.parse("a","a")})),it("consumes the matched character",(()=>{const a=t.generate("start = . .",e);r(a).to.parse("ab")}))})),describe("when it doesn't match",(()=>{it('reports match failure and records an expectation of type "any"',(()=>{const a=t.generate("start = .",e);r(a).to.failToParse("",{expected:[{type:"any"}]})}))}))})),describe("rule reference",(()=>{describe("when referenced rule's expression matches",(()=>{it("returns its result",(()=>{const a=t.generate(["start = a","a = 'a'"].join("\n"),e);r(a).to.parse("a","a")}))})),describe("when referenced rule's expression doesn't match",(()=>{it("reports match failure",(()=>{const a=t.generate(["start = a","a = 'a'"].join("\n"),e);r(a).to.failToParse("b")}))}))})),describe("positive semantic predicate",(()=>{describe("when the code returns a truthy value",(()=>{it("returns |undefined|",(()=>{const a=t.generate("start = &{ return true; } ''",e);r(a).to.parse("",[void 0,""])}))})),describe("when the code returns a falsey value",(()=>{it("reports match failure",(()=>{const a=t.generate("start = &{ return false; }",e);r(a).to.failToParse("")}))})),describe("label variables",(()=>{describe("in containing sequence",(()=>{it("can access variables defined by preceding labeled elements",(()=>{const a=t.generate("start = a:'a' &{ return a === 'a'; }",e);r(a).to.parse("a")})),it("cannot access variable defined by labeled predicate element",(()=>{const a=t.generate("start = 'a' b:&{ return b === undefined; } 'c'",e);r(a).to.failToParse("ac")})),it("cannot access variables defined by following labeled elements",(()=>{const a=t.generate("start = &{ return a === 'a'; } a:'a'",e);r(a).to.failToParse("a")})),it("cannot access variables defined by subexpressions",(()=>{[{grammar:"start = (a:'a') &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')? &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')* &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')+ &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')| .. | &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')|0.. | &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')|1.. | &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')|2.. | &{ return a === 'a'; }",input:"aa"},{grammar:"start = (a:'a')| ..1| &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')| ..3| &{ return a === 'a'; }",input:"a"},{grammar:"start = (a:'a')|2..3| &{ return a === 'a'; }",input:"aa"},{grammar:"start = (a:'a')|3| &{ return a === 'a'; }",input:"aaa"},{grammar:"start = $(a:'a') &{ return a === 'a'; }",input:"a"},{grammar:"start = &(a:'a') 'a' &{ return a === 'a'; }",input:"a"},{grammar:"start = !(a:'a') 'b' &{ return a === 'a'; }",input:"b"},{grammar:"start = b:(a:'a') &{ return a === 'a'; }",input:"a"},{grammar:"start = ('a' b:'b' 'c') &{ return b === 'b'; }",input:"abc"},{grammar:"start = (a:'a' { return a; }) &{ return a === 'a'; }",input:"a"},{grammar:"start = ('a' / b:'b' / 'c') &{ return b === 'b'; }",input:"b"}].forEach((a=>{const o=t.generate(a.grammar,e);r(o).to.failToParse(a.input)}))}))})),describe("in outer sequence",(()=>{it("can access variables defined by preceding labeled elements",(()=>{const a=t.generate("start = a:'a' ('b' &{ return a === 'a'; })",e);r(a).to.parse("ab")})),it("cannot access variable defined by labeled predicate element",(()=>{const a=t.generate("start = 'a' b:('b' &{ return b === undefined; }) 'c'",e);r(a).to.failToParse("abc")})),it("cannot access variables defined by following labeled elements",(()=>{const a=t.generate("start = ('a' &{ return b === 'b'; }) b:'b'",e);r(a).to.failToParse("ab")}))}))})),describe("initializer variables & functions",(()=>{it("can access variables defined in the initializer",(()=>{const a=t.generate(["{ var v = 42 }","start = &{ return v === 42; }"].join("\n"),e);r(a).to.parse("")})),it("can access functions defined in the initializer",(()=>{const a=t.generate(["{ function f() { return 42; } }","start = &{ return f() === 42; }"].join("\n"),e);r(a).to.parse("")}))})),describe("available variables & functions",(()=>{it("|options| contains options",(()=>{const a=t.generate(["{ var result; }","start = &{ result = options; return true; } { return result; }"].join("\n"),e);r(a).to.parse("",{a:42},{a:42})})),it("|location| returns current location info",(()=>{const a=t.generate(["{ var result; }","start = line (nl+ line)* { return result; }","line = thing (' '+ thing)*","thing = digit / mark","digit = [0-9]","mark = &{ result = location(); return true; } 'x'","nl = '\\r'? '\\n'"].join("\n"),e);r(a).to.parse("1\n2\n\n3\n\n\n4 5 x",{source:void 0,start:{offset:13,line:7,column:5},end:{offset:13,line:7,column:5}}),r(a).to.parse("1\nx",{source:void 0,start:{offset:2,line:2,column:1},end:{offset:2,line:2,column:1}}),r(a).to.parse("1\r\nx",{source:void 0,start:{offset:3,line:2,column:1},end:{offset:3,line:2,column:1}})})),it("|offset| returns current start offset",(()=>{const a=t.generate(["start = [0-9]+ @mark","mark = 'xx' { return offset(); }"].join("\n"),e);r(a).to.parse("0123456xx",7)})),it("|range| returns current range",(()=>{const a=t.generate(["start = [0-9]+ @mark","mark = 'xx' { return range(); }"].join("\n"),e);r(a).to.parse("0123456xx",{source:void 0,start:7,end:9})}))}))})),describe("negative semantic predicate",(()=>{describe("when the code returns a falsey value",(()=>{it("returns |undefined|",(()=>{const a=t.generate("start = !{ return false; } ''",e);r(a).to.parse("",[void 0,""])}))})),describe("when the code returns a truthy value",(()=>{it("reports match failure",(()=>{const a=t.generate("start = !{ return true; }",e);r(a).to.failToParse("")}))})),describe("label variables",(()=>{describe("in containing sequence",(()=>{it("can access variables defined by preceding labeled elements",(()=>{const a=t.generate("start = a:'a' !{ return a !== 'a'; }",e);r(a).to.parse("a")})),it("cannot access variable defined by labeled predicate element",(()=>{const a=t.generate("start = 'a' b:!{ return b !== undefined; } 'c'",e);r(a).to.failToParse("ac")})),it("cannot access variables defined by following labeled elements",(()=>{const a=t.generate("start = !{ return a !== 'a'; } a:'a'",e);r(a).to.failToParse("a")})),it("cannot access variables defined by subexpressions",(()=>{[{grammar:"start = (a:'a') !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')? !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')* !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')+ !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')| .. | !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')|0.. | !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')|1.. | !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')|2.. | !{ return a !== 'a'; }",input:"aa"},{grammar:"start = (a:'a')| ..1| !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')| ..3| !{ return a !== 'a'; }",input:"a"},{grammar:"start = (a:'a')|2..3| !{ return a !== 'a'; }",input:"aa"},{grammar:"start = (a:'a')|3| !{ return a !== 'a'; }",input:"aaa"},{grammar:"start = $(a:'a') !{ return a !== 'a'; }",input:"a"},{grammar:"start = &(a:'a') 'a' !{ return a !== 'a'; }",input:"a"},{grammar:"start = !(a:'a') 'b' !{ return a !== 'a'; }",input:"b"},{grammar:"start = b:(a:'a') !{ return a !== 'a'; }",input:"a"},{grammar:"start = ('a' b:'b' 'c') !{ return b !== 'b'; }",input:"abc"},{grammar:"start = (a:'a' { return a; }) !{ return a !== 'a'; }",input:"a"},{grammar:"start = ('a' / b:'b' / 'c') !{ return b !== 'b'; }",input:"b"}].forEach((a=>{const o=t.generate(a.grammar,e);r(o).to.failToParse(a.input)}))}))})),describe("in outer sequence",(()=>{it("can access variables defined by preceding labeled elements",(()=>{const a=t.generate("start = a:'a' ('b' !{ return a !== 'a'; })",e);r(a).to.parse("ab")})),it("cannot access variable defined by labeled predicate element",(()=>{const a=t.generate("start = 'a' b:('b' !{ return b !== undefined; }) 'c'",e);r(a).to.failToParse("abc")})),it("cannot access variables defined by following labeled elements",(()=>{const a=t.generate("start = ('a' !{ return b !== 'b'; }) b:'b'",e);r(a).to.failToParse("ab")}))}))})),describe("initializer variables & functions",(()=>{it("can access variables defined in the initializer",(()=>{const a=t.generate(["{ var v = 42 }","start = !{ return v !== 42; }"].join("\n"),e);r(a).to.parse("")})),it("can access functions defined in the initializer",(()=>{const a=t.generate(["{ function f() { return 42; } }","start = !{ return f() !== 42; }"].join("\n"),e);r(a).to.parse("")}))})),describe("available variables & functions",(()=>{it("|options| contains options",(()=>{const a=t.generate(["{ var result; }","start = !{ result = options; return false; } { return result; }"].join("\n"),e);r(a).to.parse("",{a:42},{a:42})})),it("|location| returns current location info",(()=>{const a=t.generate(["{ var result; }","start = line (nl+ line)* { return result; }","line = thing (' '+ thing)*","thing = digit / mark","digit = [0-9]","mark = !{ result = location(); return false; } 'x'","nl = '\\r'? '\\n'"].join("\n"),e);r(a).to.parse("1\n2\n\n3\n\n\n4 5 x",{source:void 0,start:{offset:13,line:7,column:5},end:{offset:13,line:7,column:5}}),r(a).to.parse("1\nx",{source:void 0,start:{offset:2,line:2,column:1},end:{offset:2,line:2,column:1}}),r(a).to.parse("1\r\nx",{source:void 0,start:{offset:3,line:2,column:1},end:{offset:3,line:2,column:1}})}))}))})),describe("group",(()=>{describe("when the expression matches",(()=>{it("returns its match result",(()=>{const a=t.generate("start = ('a')",e);r(a).to.parse("a","a")}))})),describe("when the expression doesn't match",(()=>{it("reports match failure",(()=>{const a=t.generate("start = ('a')",e);r(a).to.failToParse("b")}))}))})),describe("optional",(()=>{describe("when the expression matches",(()=>{it("returns its match result",(()=>{const a=t.generate("start = 'a'?",e);r(a).to.parse("a","a")}))})),describe("when the expression doesn't match",(()=>{it("returns |null|",(()=>{const a=t.generate("start = 'a'?",e);r(a).to.parse("",null)}))}))})),describe("zero or more",(()=>{describe("when the expression matches zero or more times",(()=>{it("returns an array of its match results",(()=>{const a=t.generate("start = 'a'*",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.parse("aaa",["a","a","a"])}))}))})),describe("one or more",(()=>{describe("when the expression matches one or more times",(()=>{it("returns an array of its match results",(()=>{const a=t.generate("start = 'a'+",e);r(a).to.parse("a",["a"]),r(a).to.parse("aaa",["a","a","a"])}))})),describe("when the expression doesn't match",(()=>{it("reports match failure",(()=>{const a=t.generate("start = 'a'+",e);r(a).to.failToParse("")}))}))})),describe("repeated",(()=>{function a(r){const a=[];for(let e=1;e<=4;++e)for(let t=1;t<=4;++t)a[a.length]="start"+String(e)+t;const s=o(e);return s.allowedStartRules=a,t.generate(["start11 =         val:n1      x|"+r+"|      $.*","start12 =         val:n1 data:x|"+r+"|      $.*","start13 =         val:n1      x|"+r+"| rest:$.*","start14 =         val:n1 data:x|"+r+"| rest:$.*","start21 = .       val:n1      x|"+r+"|      $.*","start22 = .       val:n1 data:x|"+r+"|      $.*","start23 = .       val:n1      x|"+r+"| rest:$.*","start24 = .       val:n1 data:x|"+r+"| rest:$.*","start31 = a:.     val:n1      x|"+r+"|      $.*","start32 = a:.     val:n1 data:x|"+r+"|      $.*","start33 = a:.     val:n1      x|"+r+"| rest:$.*","start34 = a:.     val:n1 data:x|"+r+"| rest:$.*","start41 = a:. b:. val:n1      x|"+r+"|      $.*","start42 = a:. b:. val:n1 data:x|"+r+"|      $.*","start43 = a:. b:. val:n1      x|"+r+"| rest:$.*","start44 = a:. b:. val:n1 data:x|"+r+"| rest:$.*","n1 = n:$[0-9] { return parseInt(n, 10); }","x = '='"].join(";\n"),s)}describe("without delimiter",(()=>{describe("with constant boundaries",(()=>{it("| .. | matches correctly",(()=>{const a=t.generate("start = 'a'|..|",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.parse("aa",["a","a"]),r(a).to.parse("aaa",["a","a","a"])})),it("|0.. | matches correctly",(()=>{const a=t.generate("start = 'a'|0..|",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.parse("aa",["a","a"]),r(a).to.parse("aaa",["a","a","a"])})),it("|1.. | matches correctly",(()=>{const a=t.generate("start = 'a'|1..|",e);r(a).to.failToParse(""),r(a).to.parse("a",["a"]),r(a).to.parse("aa",["a","a"]),r(a).to.parse("aaa",["a","a","a"])})),it("|2.. | matches correctly",(()=>{const a=t.generate("start = 'a'|2..|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("aa",["a","a"]),r(a).to.parse("aaa",["a","a","a"])})),it("| ..1| matches correctly",(()=>{const a=t.generate("start = 'a'|..1|",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.failToParse("aa"),r(a).to.failToParse("aaa")})),it("| ..2| matches correctly",(()=>{const a=t.generate("start = 'a'|..2|",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.parse("aa",["a","a"]),r(a).to.failToParse("aaa")})),it("|2..3| matches correctly",(()=>{const a=t.generate("start = 'a'|2..3|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("aa",["a","a"]),r(a).to.parse("aaa",["a","a","a"]),r(a).to.failToParse("aaaa")})),it("|2..2| matches correctly",(()=>{const a=t.generate("start = 'a'|2..2|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("aa",["a","a"]),r(a).to.failToParse("aaa")})),it("| 2  | matches correctly",(()=>{const a=t.generate("start = 'a'|2|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("aa",["a","a"]),r(a).to.failToParse("aaa")})),it("|3..2| matches correctly",(()=>{const a=t.generate("start = 'a'|3..2|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.failToParse("aa"),r(a).to.failToParse("aaa")})),it("does not consume input on failure",(()=>{const a=t.generate("start = 'a'|3| / 'a'|2| { return 42; }",e);r(a).to.parse("aa",42)})),it("correctly pass external references to labels to repeated expression",(()=>{let a=t.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|..|",e);r(a).to.parse("abb",["a",[["b",void 0],["b",void 0]]]),a=t.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2..|",e),r(a).to.parse("abb",["a",[["b",void 0],["b",void 0]]]),a=t.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|..3|",e),r(a).to.parse("abb",["a",[["b",void 0],["b",void 0]]]),a=t.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2..3|",e),r(a).to.parse("abb",["a",[["b",void 0],["b",void 0]]]),a=t.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2|",e),r(a).to.parse("abb",["a",[["b",void 0],["b",void 0]]])}))})),describe("with variable boundaries",(()=>{it("|min..   | matches correctly",(()=>{const e=a("val..");for(let t=1;t<=4;++t){const a={startRule:"start1"+t};r(e).to.failToParse("",void 0,a),r(e).to.parse("0",[0,[],""],a),r(e).to.parse("0==",[0,["=","="],""],a),r(e).to.failToParse("1",void 0,a),r(e).to.failToParse("2=",void 0,a),r(e).to.parse("2==",[2,["=","="],""],a),r(e).to.parse("2=====",[2,["=","=","=","=","="],""],a)}for(let t=1;t<=4;++t){const a={startRule:"start2"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,["=","="],""],a),r(e).to.failToParse("-1",void 0,a),r(e).to.failToParse("-2=",void 0,a),r(e).to.parse("-2==",["-",2,["=","="],""],a),r(e).to.parse("-2=====",["-",2,["=","=","=","=","="],""],a)}for(let t=1;t<=4;++t){const a={startRule:"start3"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,["=","="],""],a),r(e).to.failToParse("-1",void 0,a),r(e).to.failToParse("-2=",void 0,a),r(e).to.parse("-2==",["-",2,["=","="],""],a),r(e).to.parse("-2=====",["-",2,["=","=","=","=","="],""],a)}for(let t=1;t<=4;++t){const a={startRule:"start4"+t};r(e).to.failToParse("--",void 0,a),r(e).to.parse("--0",["-","-",0,[],""],a),r(e).to.parse("--0==",["-","-",0,["=","="],""],a),r(e).to.failToParse("--1",void 0,a),r(e).to.failToParse("--2=",void 0,a),r(e).to.parse("--2==",["-","-",2,["=","="],""],a),r(e).to.parse("--2=====",["-","-",2,["=","=","=","=","="],""],a)}})),it("|   ..max| matches correctly",(()=>{const e=a("..val");for(let t=1;t<=4;++t){const a={startRule:"start1"+t};r(e).to.failToParse("",void 0,a),r(e).to.parse("0",[0,[],""],a),r(e).to.parse("0==",[0,[],"=="],a),r(e).to.parse("3",[3,[],""],a),r(e).to.parse("3=",[3,["="],""],a),r(e).to.parse("3===",[3,["=","=","="],""],a),r(e).to.parse("3=====",[3,["=","=","="],"=="],a)}for(let t=1;t<=4;++t){const a={startRule:"start2"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.parse("-3",["-",3,[],""],a),r(e).to.parse("-3=",["-",3,["="],""],a),r(e).to.parse("-3===",["-",3,["=","=","="],""],a),r(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a)}for(let t=1;t<=4;++t){const a={startRule:"start3"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.parse("-3",["-",3,[],""],a),r(e).to.parse("-3=",["-",3,["="],""],a),r(e).to.parse("-3===",["-",3,["=","=","="],""],a),r(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a)}for(let t=1;t<=4;++t){const a={startRule:"start4"+t};r(e).to.failToParse("--",void 0,a),r(e).to.parse("--0",["-","-",0,[],""],a),r(e).to.parse("--0==",["-","-",0,[],"=="],a),r(e).to.parse("--3",["-","-",3,[],""],a),r(e).to.parse("--3=",["-","-",3,["="],""],a),r(e).to.parse("--3===",["-","-",3,["=","=","="],""],a),r(e).to.parse("--3=====",["-","-",3,["=","=","="],"=="],a)}})),it("|min..max| matches correctly",(()=>{const a=function(){const r=[];for(let e=1;e<=4;++e)for(let t=1;t<=4;++t)r[r.length]="start"+String(e)+t;const a=o(e);return a.allowedStartRules=r,t.generate(["start11 =         min:n1 max:n1      .|min..max|      $.*","start12 =         min:n1 max:n1 data:.|min..max|      $.*","start13 =         min:n1 max:n1      .|min..max| rest:$.*","start14 =         min:n1 max:n1 data:.|min..max| rest:$.*","start21 = .       min:n1 max:n1      .|min..max|      $.*","start22 = .       min:n1 max:n1 data:.|min..max|      $.*","start23 = .       min:n1 max:n1      .|min..max| rest:$.*","start24 = .       min:n1 max:n1 data:.|min..max| rest:$.*","start31 = a:.     min:n1 max:n1      .|min..max|      $.*","start32 = a:.     min:n1 max:n1 data:.|min..max|      $.*","start33 = a:.     min:n1 max:n1      .|min..max| rest:$.*","start34 = a:.     min:n1 max:n1 data:.|min..max| rest:$.*","start41 = a:. b:. min:n1 max:n1      .|min..max|      $.*","start42 = a:. b:. min:n1 max:n1 data:.|min..max|      $.*","start43 = a:. b:. min:n1 max:n1      .|min..max| rest:$.*","start44 = a:. b:. min:n1 max:n1 data:.|min..max| rest:$.*","n1 = n:$[0-9] { return parseInt(n, 10); }"].join(";\n"),a)}();for(let e=1;e<=4;++e){const t={startRule:"start1"+e};r(a).to.failToParse("",void 0,t),r(a).to.parse("00",[0,0,[],""],t),r(a).to.parse("00==",[0,0,[],"=="],t),r(a).to.failToParse("23",void 0,t),r(a).to.failToParse("23=",void 0,t),r(a).to.parse("23==",[2,3,["=","="],""],t),r(a).to.parse("23===",[2,3,["=","=","="],""],t),r(a).to.parse("23=====",[2,3,["=","=","="],"=="],t)}for(let e=1;e<=4;++e){const t={startRule:"start2"+e};r(a).to.failToParse("-",void 0,t),r(a).to.parse("-00",["-",0,0,[],""],t),r(a).to.parse("-00==",["-",0,0,[],"=="],t),r(a).to.failToParse("-23",void 0,t),r(a).to.failToParse("-23=",void 0,t),r(a).to.parse("-23==",["-",2,3,["=","="],""],t),r(a).to.parse("-23===",["-",2,3,["=","=","="],""],t),r(a).to.parse("-23=====",["-",2,3,["=","=","="],"=="],t)}for(let e=1;e<=4;++e){const t={startRule:"start3"+e};r(a).to.failToParse("-",void 0,t),r(a).to.parse("-00",["-",0,0,[],""],t),r(a).to.parse("-00==",["-",0,0,[],"=="],t),r(a).to.failToParse("-23",void 0,t),r(a).to.failToParse("-23=",void 0,t),r(a).to.parse("-23==",["-",2,3,["=","="],""],t),r(a).to.parse("-23===",["-",2,3,["=","=","="],""],t),r(a).to.parse("-23=====",["-",2,3,["=","=","="],"=="],t)}for(let e=1;e<=4;++e){const t={startRule:"start4"+e};r(a).to.failToParse("--",void 0,t),r(a).to.parse("--00",["-","-",0,0,[],""],t),r(a).to.parse("--00==",["-","-",0,0,[],"=="],t),r(a).to.failToParse("--23",void 0,t),r(a).to.failToParse("--23=",void 0,t),r(a).to.parse("--23==",["-","-",2,3,["=","="],""],t),r(a).to.parse("--23===",["-","-",2,3,["=","=","="],""],t),r(a).to.parse("--23=====",["-","-",2,3,["=","=","="],"=="],t)}})),it("|val..val| matches correctly",(()=>{const e=a("val");for(let t=1;t<=4;++t){const a={startRule:"start1"+t};r(e).to.failToParse("",void 0,a),r(e).to.parse("0",[0,[],""],a),r(e).to.parse("0==",[0,[],"=="],a),r(e).to.failToParse("3",void 0,a),r(e).to.failToParse("3=",void 0,a),r(e).to.parse("3===",[3,["=","=","="],""],a),r(e).to.parse("3=====",[3,["=","=","="],"=="],a)}for(let t=1;t<=4;++t){const a={startRule:"start2"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.failToParse("-3",void 0,a),r(e).to.failToParse("-3=",void 0,a),r(e).to.parse("-3===",["-",3,["=","=","="],""],a),r(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a)}for(let t=1;t<=4;++t){const a={startRule:"start3"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.failToParse("-3",void 0,a),r(e).to.failToParse("-3=",void 0,a),r(e).to.parse("-3===",["-",3,["=","=","="],""],a),r(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a)}for(let t=1;t<=4;++t){const a={startRule:"start4"+t};r(e).to.failToParse("--",void 0,a),r(e).to.parse("--0",["-","-",0,[],""],a),r(e).to.parse("--0==",["-","-",0,[],"=="],a),r(e).to.failToParse("--3",void 0,a),r(e).to.failToParse("--3=",void 0,a),r(e).to.parse("--3===",["-","-",3,["=","=","="],""],a),r(e).to.parse("--3=====",["-","-",3,["=","=","="],"=="],a)}})),it("| exact  | matches correctly",(()=>{const e=a("val");for(let t=1;t<=4;++t){const a={startRule:"start1"+t};r(e).to.failToParse("",void 0,a),r(e).to.parse("0",[0,[],""],a),r(e).to.parse("0==",[0,[],"=="],a),r(e).to.failToParse("3",void 0,a),r(e).to.failToParse("3=",void 0,a),r(e).to.parse("3===",[3,["=","=","="],""],a),r(e).to.parse("3=====",[3,["=","=","="],"=="],a)}for(let t=1;t<=4;++t){const a={startRule:"start2"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.failToParse("-3",void 0,a),r(e).to.failToParse("-3=",void 0,a),r(e).to.parse("-3===",["-",3,["=","=","="],""],a),r(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a)}for(let t=1;t<=4;++t){const a={startRule:"start3"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.failToParse("-3",void 0,a),r(e).to.failToParse("-3=",void 0,a),r(e).to.parse("-3===",["-",3,["=","=","="],""],a),r(e).to.parse("-3=====",["-",3,["=","=","="],"=="],a)}for(let t=1;t<=4;++t){const a={startRule:"start4"+t};r(e).to.failToParse("--",void 0,a),r(e).to.parse("--0",["-","-",0,[],""],a),r(e).to.parse("--0==",["-","-",0,[],"=="],a),r(e).to.failToParse("--3",void 0,a),r(e).to.failToParse("--3=",void 0,a),r(e).to.parse("--3===",["-","-",3,["=","=","="],""],a),r(e).to.parse("--3=====",["-","-",3,["=","=","="],"=="],a)}}))})),describe("with function boundaries",(()=>{it("|{min}..     | matches correctly",(()=>{const a=t.generate("start = 'a'|{ return 2; }..|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("aa",["a","a"]),r(a).to.parse("aaa",["a","a","a"])})),it("|     ..{max}| matches correctly",(()=>{const a=t.generate("start = 'a'|..{ return 2; }|",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.parse("aa",["a","a"]),r(a).to.failToParse("aaa")})),it("|{min}..{max}| matches correctly",(()=>{const a=t.generate("start = 'a'|{ return 2; }..{ return 3; }|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("aa",["a","a"]),r(a).to.parse("aaa",["a","a","a"]),r(a).to.failToParse("aaaa")})),it("|{val}..{val}| matches correctly",(()=>{const a=t.generate("start = 'a'|{ return 2; }..{ return 2; }|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("aa",["a","a"]),r(a).to.failToParse("aaa")})),it("|  {exact}   | matches correctly",(()=>{const a=t.generate("start = 'a'|{ return 2; }|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("aa",["a","a"]),r(a).to.failToParse("aaa")})),describe("function called only once",(()=>{it("in |{min}..     |",(()=>{const a=t.generate("\n                { let min = 0; }\n                start = 'a'|{ ++min; return 2; }..| { return min; }\n              ",e);r(a).to.parse("aa",1),r(a).to.parse("aaa",1)})),it("in |     ..{max}|",(()=>{const a=t.generate("\n                { let max = 0; }\n                start = 'a'|..{ ++max; return 3; }| { return max; }\n              ",e);r(a).to.parse("aa",1),r(a).to.parse("aaa",1)})),it("in |{min}..{max}|",(()=>{const a=t.generate("\n                {\n                  let min = 0;\n                  let max = 0;\n                }\n                start = 'a'|\n                  { ++min; return 0; }\n                  ..\n                  { ++max; return 3; }\n                | { return [min, max]; }\n              ",e);r(a).to.parse("",[1,1]),r(a).to.parse("a",[1,1]),r(a).to.parse("aa",[1,1]),r(a).to.parse("aaa",[1,1])})),it("in |  {exact}   |",(()=>{const a=t.generate("\n                { let count = 0; }\n                start = 'a'|{ ++count; return options.exact; }| { return count; }\n              ",e);r(a).to.parse("",1,{exact:0}),r(a).to.parse("aa",1,{exact:2})}))})),it("correctly pass external references to labels to boundary expression",(()=>{let a=t.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }..|",e);r(a).to.parse("abb",["a",["b","b"]]),a=t.generate("start = ref:'a' 'b'|..{ return ref === 'a' ? 3 : 0; }|",e),r(a).to.parse("abb",["a",["b","b"]]),a=t.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }..{ return ref === 'a' ? 3 : 0; }|",e),r(a).to.parse("abb",["a",["b","b"]]),a=t.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }|",e),r(a).to.parse("abb",["a",["b","b"]])}))})),it("with functions returning non-integers",(()=>{let a=t.generate("start = 'a'|{ return 'a' }|",e);r(a).to.parse("",[]),r(a).to.failToParse("aaa",{expected:[{type:"end"}]}),a=t.generate("start = 'a'|{ return 'a' }..2|",e),r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.parse("aa",["a","a"]),r(a).to.failToParse("aaa",{expected:[{type:"end"}]}),a=t.generate("start = 'a'|..{ return 'a' }|",e),r(a).to.parse("",[]),r(a).to.failToParse("a",{expected:[{type:"end"}]}),a=t.generate("start = 'a'|{return '1.8e0' }..{ return 2.8 }|",e),r(a).to.parse("a",["a"]),r(a).to.parse("aa",["a","a"]),r(a).to.failToParse("aaa",{expected:[{type:"end"}]})}))})),describe("with delimiter",(()=>{describe("with constant boundaries",(()=>{it("| .. , delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|.., '~'|",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.parse("a~a",["a","a"]),r(a).to.parse("a~a~a",["a","a","a"])})),it("|0.. , delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|0.., '~'|",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.parse("a~a",["a","a"]),r(a).to.parse("a~a~a",["a","a","a"])})),it("|1.. , delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|1.., '~'|",e);r(a).to.failToParse(""),r(a).to.parse("a",["a"]),r(a).to.parse("a~a",["a","a"]),r(a).to.parse("a~a~a",["a","a","a"])})),it("|2.. , delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|2.., '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("a~a",["a","a"]),r(a).to.parse("a~a~a",["a","a","a"])})),it("| ..1, delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|..1, '~'|",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.failToParse("a~a"),r(a).to.failToParse("a~a~a")})),it("| ..2, delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|..2, '~'|",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.parse("a~a",["a","a"]),r(a).to.failToParse("a~a~a")})),it("|2..3, delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|2..3, '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("a~a",["a","a"]),r(a).to.parse("a~a~a",["a","a","a"]),r(a).to.failToParse("a~a~a~a")})),it("|2..2, delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|2..2, '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("a~a",["a","a"]),r(a).to.failToParse("a~a~a")})),it("|2   , delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|2, '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("a~a",["a","a"]),r(a).to.failToParse("a~a~a")})),it("|3..2, delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|3..2, '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.failToParse("a~a"),r(a).to.failToParse("a~a~a")})),it("correctly pass external references to labels to repeated expression",(()=>{let a=t.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|.., ' '|",e);r(a).to.parse("ab b",["a",[["b",void 0],["b",void 0]]]),a=t.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2.., ' '|",e),r(a).to.parse("ab b",["a",[["b",void 0],["b",void 0]]]),a=t.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|..3, ' '|",e),r(a).to.parse("ab b",["a",[["b",void 0],["b",void 0]]]),a=t.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2..3, ' '|",e),r(a).to.parse("ab b",["a",[["b",void 0],["b",void 0]]]),a=t.generate("start = ref:'a' ('b' &{ return ref === 'a'; })|2, ' '|",e),r(a).to.parse("ab b",["a",[["b",void 0],["b",void 0]]]),a=t.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }, ' '|",e),r(a).to.parse("ab b",["a",["b","b"]])}))})),describe("with variable boundaries",(()=>{it("|min..   , delimiter| matches correctly",(()=>{const e=a("val.., '~'");for(let t=1;t<=4;++t){const a={startRule:"start1"+t};r(e).to.failToParse("",void 0,a),r(e).to.parse("0",[0,[],""],a),r(e).to.parse("0==",[0,["="],"="],a),r(e).to.parse("0=~=",[0,["=","="],""],a),r(e).to.failToParse("1",void 0,a),r(e).to.failToParse("1~",void 0,a),r(e).to.failToParse("2=",void 0,a),r(e).to.failToParse("2=~",void 0,a),r(e).to.failToParse("2==",void 0,a),r(e).to.parse("2=~=",[2,["=","="],""],a),r(e).to.parse("2=~=~",[2,["=","="],"~"],a),r(e).to.parse("2=~=~=~=~=",[2,["=","=","=","=","="],""],a)}for(let t=1;t<=4;++t){const a={startRule:"start2"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,["="],"="],a),r(e).to.parse("-0=~=",["-",0,["=","="],""],a),r(e).to.failToParse("-1",void 0,a),r(e).to.failToParse("-1~",void 0,a),r(e).to.failToParse("-2=",void 0,a),r(e).to.failToParse("-2=~",void 0,a),r(e).to.failToParse("-2==",void 0,a),r(e).to.parse("-2=~=",["-",2,["=","="],""],a),r(e).to.parse("-2=~=~",["-",2,["=","="],"~"],a),r(e).to.parse("-2=~=~=~=~=",["-",2,["=","=","=","=","="],""],a)}for(let t=1;t<=4;++t){const a={startRule:"start3"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,["="],"="],a),r(e).to.parse("-0=~=",["-",0,["=","="],""],a),r(e).to.failToParse("-1",void 0,a),r(e).to.failToParse("-1~",void 0,a),r(e).to.failToParse("-2=",void 0,a),r(e).to.failToParse("-2=~",void 0,a),r(e).to.failToParse("-2==",void 0,a),r(e).to.parse("-2=~=",["-",2,["=","="],""],a),r(e).to.parse("-2=~=~",["-",2,["=","="],"~"],a),r(e).to.parse("-2=~=~=~=~=",["-",2,["=","=","=","=","="],""],a)}for(let t=1;t<=4;++t){const a={startRule:"start4"+t};r(e).to.failToParse("--",void 0,a),r(e).to.parse("--0",["-","-",0,[],""],a),r(e).to.parse("--0==",["-","-",0,["="],"="],a),r(e).to.parse("--0=~=",["-","-",0,["=","="],""],a),r(e).to.failToParse("--1",void 0,a),r(e).to.failToParse("--1~",void 0,a),r(e).to.failToParse("--2=",void 0,a),r(e).to.failToParse("--2=~",void 0,a),r(e).to.failToParse("--2==",void 0,a),r(e).to.parse("--2=~=",["-","-",2,["=","="],""],a),r(e).to.parse("--2=~=~",["-","-",2,["=","="],"~"],a),r(e).to.parse("--2=~=~=~=~=",["-","-",2,["=","=","=","=","="],""],a)}})),it("|   ..max, delimiter| matches correctly",(()=>{const e=a("..val, '~'");for(let t=1;t<=4;++t){const a={startRule:"start1"+t};r(e).to.failToParse("",void 0,a),r(e).to.parse("0",[0,[],""],a),r(e).to.parse("0==",[0,[],"=="],a),r(e).to.parse("0=~=",[0,[],"=~="],a),r(e).to.parse("3",[3,[],""],a),r(e).to.parse("3=",[3,["="],""],a),r(e).to.parse("3===",[3,["="],"=="],a),r(e).to.parse("3=~=~",[3,["=","="],"~"],a),r(e).to.parse("3=~=~=",[3,["=","=","="],""],a),r(e).to.parse("3=~=~=~=~=",[3,["=","=","="],"~=~="],a)}for(let t=1;t<=4;++t){const a={startRule:"start2"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.parse("-0=~=",["-",0,[],"=~="],a),r(e).to.parse("-3",["-",3,[],""],a),r(e).to.parse("-3=",["-",3,["="],""],a),r(e).to.parse("-3===",["-",3,["="],"=="],a),r(e).to.parse("-3=~=~",["-",3,["=","="],"~"],a),r(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),r(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a)}for(let t=1;t<=4;++t){const a={startRule:"start3"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.parse("-0=~=",["-",0,[],"=~="],a),r(e).to.parse("-3",["-",3,[],""],a),r(e).to.parse("-3=",["-",3,["="],""],a),r(e).to.parse("-3===",["-",3,["="],"=="],a),r(e).to.parse("-3=~=~",["-",3,["=","="],"~"],a),r(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),r(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a)}for(let t=1;t<=4;++t){const a={startRule:"start4"+t};r(e).to.failToParse("--",void 0,a),r(e).to.parse("--0",["-","-",0,[],""],a),r(e).to.parse("--0==",["-","-",0,[],"=="],a),r(e).to.parse("--0=~=",["-","-",0,[],"=~="],a),r(e).to.parse("--3",["-","-",3,[],""],a),r(e).to.parse("--3=",["-","-",3,["="],""],a),r(e).to.parse("--3===",["-","-",3,["="],"=="],a),r(e).to.parse("--3=~=~",["-","-",3,["=","="],"~"],a),r(e).to.parse("--3=~=~=",["-","-",3,["=","=","="],""],a),r(e).to.parse("--3=~=~=~=~=",["-","-",3,["=","=","="],"~=~="],a)}})),it("|min..max, delimiter| matches correctly",(()=>{const a=function(){const r=[];for(let e=1;e<=4;++e)for(let t=1;t<=4;++t)r[r.length]="start"+String(e)+t;const a=o(e);return a.allowedStartRules=r,t.generate(["start11 =         min:n1 max:n1      .|min..max, '~'|      $.*","start12 =         min:n1 max:n1 data:.|min..max, '~'|      $.*","start13 =         min:n1 max:n1      .|min..max, '~'| rest:$.*","start14 =         min:n1 max:n1 data:.|min..max, '~'| rest:$.*","start21 = .       min:n1 max:n1      .|min..max, '~'|      $.*","start22 = .       min:n1 max:n1 data:.|min..max, '~'|      $.*","start23 = .       min:n1 max:n1      .|min..max, '~'| rest:$.*","start24 = .       min:n1 max:n1 data:.|min..max, '~'| rest:$.*","start31 = a:.     min:n1 max:n1      .|min..max, '~'|      $.*","start32 = a:.     min:n1 max:n1 data:.|min..max, '~'|      $.*","start33 = a:.     min:n1 max:n1      .|min..max, '~'| rest:$.*","start34 = a:.     min:n1 max:n1 data:.|min..max, '~'| rest:$.*","start41 = a:. b:. min:n1 max:n1      .|min..max, '~'|      $.*","start42 = a:. b:. min:n1 max:n1 data:.|min..max, '~'|      $.*","start43 = a:. b:. min:n1 max:n1      .|min..max, '~'| rest:$.*","start44 = a:. b:. min:n1 max:n1 data:.|min..max, '~'| rest:$.*","n1 = n:$[0-9] { return parseInt(n, 10); }"].join(";\n"),a)}();for(let e=1;e<=4;++e){const t={startRule:"start1"+e};r(a).to.failToParse("",void 0,t),r(a).to.parse("00",[0,0,[],""],t),r(a).to.parse("00==",[0,0,[],"=="],t),r(a).to.parse("00=~=",[0,0,[],"=~="],t),r(a).to.failToParse("23",void 0,t),r(a).to.failToParse("23=",void 0,t),r(a).to.failToParse("23=~",void 0,t),r(a).to.failToParse("23==",void 0,t),r(a).to.parse("23=~=",[2,3,["=","="],""],t),r(a).to.parse("23=~=~",[2,3,["=","="],"~"],t),r(a).to.parse("23=~=~=",[2,3,["=","=","="],""],t),r(a).to.parse("23=~=~=~=~=",[2,3,["=","=","="],"~=~="],t)}for(let e=1;e<=4;++e){const t={startRule:"start2"+e};r(a).to.failToParse("-",void 0,t),r(a).to.parse("-00",["-",0,0,[],""],t),r(a).to.parse("-00==",["-",0,0,[],"=="],t),r(a).to.parse("-00=~=",["-",0,0,[],"=~="],t),r(a).to.failToParse("-23",void 0,t),r(a).to.failToParse("-23=",void 0,t),r(a).to.failToParse("-23=~",void 0,t),r(a).to.failToParse("-23==",void 0,t),r(a).to.parse("-23=~=",["-",2,3,["=","="],""],t),r(a).to.parse("-23=~=~",["-",2,3,["=","="],"~"],t),r(a).to.parse("-23=~=~=",["-",2,3,["=","=","="],""],t),r(a).to.parse("-23=~=~=~=~=",["-",2,3,["=","=","="],"~=~="],t)}for(let e=1;e<=4;++e){const t={startRule:"start3"+e};r(a).to.failToParse("-",void 0,t),r(a).to.parse("-00",["-",0,0,[],""],t),r(a).to.parse("-00==",["-",0,0,[],"=="],t),r(a).to.parse("-00=~=",["-",0,0,[],"=~="],t),r(a).to.failToParse("-23",void 0,t),r(a).to.failToParse("-23=",void 0,t),r(a).to.failToParse("-23=~",void 0,t),r(a).to.failToParse("-23==",void 0,t),r(a).to.parse("-23=~=",["-",2,3,["=","="],""],t),r(a).to.parse("-23=~=~",["-",2,3,["=","="],"~"],t),r(a).to.parse("-23=~=~=",["-",2,3,["=","=","="],""],t),r(a).to.parse("-23=~=~=~=~=",["-",2,3,["=","=","="],"~=~="],t)}for(let e=1;e<=4;++e){const t={startRule:"start4"+e};r(a).to.failToParse("--",void 0,t),r(a).to.parse("--00",["-","-",0,0,[],""],t),r(a).to.parse("--00==",["-","-",0,0,[],"=="],t),r(a).to.parse("--00=~=",["-","-",0,0,[],"=~="],t),r(a).to.failToParse("--23",void 0,t),r(a).to.failToParse("--23=",void 0,t),r(a).to.failToParse("--23=~",void 0,t),r(a).to.failToParse("--23==",void 0,t),r(a).to.parse("--23=~=",["-","-",2,3,["=","="],""],t),r(a).to.parse("--23=~=~",["-","-",2,3,["=","="],"~"],t),r(a).to.parse("--23=~=~=",["-","-",2,3,["=","=","="],""],t),r(a).to.parse("--23=~=~=~=~=",["-","-",2,3,["=","=","="],"~=~="],t)}})),it("|val..val, delimiter| matches correctly",(()=>{const e=a("val, '~'");for(let t=1;t<=4;++t){const a={startRule:"start1"+t};r(e).to.failToParse("",void 0,a),r(e).to.parse("0",[0,[],""],a),r(e).to.parse("0==",[0,[],"=="],a),r(e).to.parse("0=~=",[0,[],"=~="],a),r(e).to.failToParse("3",void 0,a),r(e).to.failToParse("3=",void 0,a),r(e).to.failToParse("3=~",void 0,a),r(e).to.parse("3=~=~=",[3,["=","=","="],""],a),r(e).to.parse("3=~=~=~",[3,["=","=","="],"~"],a),r(e).to.parse("3=~=~=~=~=",[3,["=","=","="],"~=~="],a)}for(let t=1;t<=4;++t){const a={startRule:"start2"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.parse("-0=~=",["-",0,[],"=~="],a),r(e).to.failToParse("-3",void 0,a),r(e).to.failToParse("-3=",void 0,a),r(e).to.failToParse("-3=~",void 0,a),r(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),r(e).to.parse("-3=~=~=~",["-",3,["=","=","="],"~"],a),r(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a)}for(let t=1;t<=4;++t){const a={startRule:"start3"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.parse("-0=~=",["-",0,[],"=~="],a),r(e).to.failToParse("-3",void 0,a),r(e).to.failToParse("-3=",void 0,a),r(e).to.failToParse("-3=~",void 0,a),r(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),r(e).to.parse("-3=~=~=~",["-",3,["=","=","="],"~"],a),r(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a)}for(let t=1;t<=4;++t){const a={startRule:"start4"+t};r(e).to.failToParse("--",void 0,a),r(e).to.parse("--0",["-","-",0,[],""],a),r(e).to.parse("--0==",["-","-",0,[],"=="],a),r(e).to.parse("--0=~=",["-","-",0,[],"=~="],a),r(e).to.failToParse("--3",void 0,a),r(e).to.failToParse("--3=",void 0,a),r(e).to.failToParse("--3=~",void 0,a),r(e).to.parse("--3=~=~=",["-","-",3,["=","=","="],""],a),r(e).to.parse("--3=~=~=~",["-","-",3,["=","=","="],"~"],a),r(e).to.parse("--3=~=~=~=~=",["-","-",3,["=","=","="],"~=~="],a)}})),it("| exact  , delimiter| matches correctly",(()=>{const e=a("val, '~'");for(let t=1;t<=4;++t){const a={startRule:"start1"+t};r(e).to.failToParse("",void 0,a),r(e).to.parse("0",[0,[],""],a),r(e).to.parse("0==",[0,[],"=="],a),r(e).to.parse("0=~=",[0,[],"=~="],a),r(e).to.failToParse("3",void 0,a),r(e).to.failToParse("3=",void 0,a),r(e).to.failToParse("3=~",void 0,a),r(e).to.parse("3=~=~=",[3,["=","=","="],""],a),r(e).to.parse("3=~=~=~",[3,["=","=","="],"~"],a),r(e).to.parse("3=~=~=~=~=",[3,["=","=","="],"~=~="],a)}for(let t=1;t<=4;++t){const a={startRule:"start2"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.parse("-0=~=",["-",0,[],"=~="],a),r(e).to.failToParse("-3",void 0,a),r(e).to.failToParse("-3=",void 0,a),r(e).to.failToParse("-3=~",void 0,a),r(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),r(e).to.parse("-3=~=~=~",["-",3,["=","=","="],"~"],a),r(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a)}for(let t=1;t<=4;++t){const a={startRule:"start3"+t};r(e).to.failToParse("-",void 0,a),r(e).to.parse("-0",["-",0,[],""],a),r(e).to.parse("-0==",["-",0,[],"=="],a),r(e).to.parse("-0=~=",["-",0,[],"=~="],a),r(e).to.failToParse("-3",void 0,a),r(e).to.failToParse("-3=",void 0,a),r(e).to.failToParse("-3=~",void 0,a),r(e).to.parse("-3=~=~=",["-",3,["=","=","="],""],a),r(e).to.parse("-3=~=~=~",["-",3,["=","=","="],"~"],a),r(e).to.parse("-3=~=~=~=~=",["-",3,["=","=","="],"~=~="],a)}for(let t=1;t<=4;++t){const a={startRule:"start4"+t};r(e).to.failToParse("--",void 0,a),r(e).to.parse("--0",["-","-",0,[],""],a),r(e).to.parse("--0==",["-","-",0,[],"=="],a),r(e).to.parse("--0=~=",["-","-",0,[],"=~="],a),r(e).to.failToParse("--3",void 0,a),r(e).to.failToParse("--3=",void 0,a),r(e).to.failToParse("--3=~",void 0,a),r(e).to.parse("--3=~=~=",["-","-",3,["=","=","="],""],a),r(e).to.parse("--3=~=~=~",["-","-",3,["=","=","="],"~"],a),r(e).to.parse("--3=~=~=~=~=",["-","-",3,["=","=","="],"~=~="],a)}}))})),describe("with function boundaries",(()=>{it("|{2}..   , delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|{ return 2; }.., '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("a~a",["a","a"]),r(a).to.parse("a~a~a",["a","a","a"])})),it("|   ..{2}, delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|..{ return 2; }, '~'|",e);r(a).to.parse("",[]),r(a).to.parse("a",["a"]),r(a).to.parse("a~a",["a","a"]),r(a).to.failToParse("a~a~a")})),it("|{2}..{3}, delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|{ return 2; }..{ return 3; }, '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("a~a",["a","a"]),r(a).to.parse("a~a~a",["a","a","a"]),r(a).to.failToParse("a~a~a~a")})),it("|{2}..{2}, delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|{ return 2; }..{ return 2; }, '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("a~a",["a","a"]),r(a).to.failToParse("a~a~a")})),it("|{2}     , delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|{ return 2; }, '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.parse("a~a",["a","a"]),r(a).to.failToParse("a~a~a")})),it("|{3}..{2}, delimiter| matches correctly",(()=>{const a=t.generate("start = 'a'|{ return 3; }..{ return 2; }, '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.failToParse("a~a"),r(a).to.failToParse("a~a~a")})),it("correctly pass external references to labels to boundary expression",(()=>{let a=t.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }.., ' '|",e);r(a).to.parse("ab b",["a",["b","b"]]),a=t.generate("start = ref:'a' 'b'|..{ return ref === 'a' ? 3 : 0; }, ' '|",e),r(a).to.parse("ab b",["a",["b","b"]]),a=t.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }..{ return ref === 'a' ? 3 : 0; }, ' '|",e),r(a).to.parse("ab b",["a",["b","b"]]),a=t.generate("start = ref:'a' 'b'|{ return ref === 'a' ? 2 : 0; }, ' '|",e),r(a).to.parse("ab b",["a",["b","b"]])}))}))})),describe("handle delimiter correctly",(()=>{it("with constant boundaries",(()=>{const a=t.generate("start = 'a'|2..3, '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.failToParse("aa"),r(a).to.failToParse("a~"),r(a).to.parse("a~a",["a","a"]),r(a).to.failToParse("a~a~"),r(a).to.parse("a~a~a",["a","a","a"]),r(a).to.failToParse("a~a~a~"),r(a).to.failToParse("a~a~a~a")})),it("with variable boundaries",(()=>{const a=t.generate(["start = min:n1 max:n1 'a'|min..max, '~'|","n1 = n:$[0-9] { return parseInt(n, 10); }"].join(";\n"),e);r(a).to.failToParse("23"),r(a).to.failToParse("23a"),r(a).to.failToParse("23aa"),r(a).to.failToParse("23a~"),r(a).to.parse("23a~a",[2,3,["a","a"]]),r(a).to.failToParse("23a~a~"),r(a).to.parse("23a~a~a",[2,3,["a","a","a"]]),r(a).to.failToParse("23a~a~a~"),r(a).to.failToParse("23a~a~a~a")})),it("with variable boundaries in delimiter",(()=>{const a=t.generate(["start = min:n1 max:n1 'a'|2, '~'|min..max||","n1 = n:$[0-9] { return parseInt(n, 10); }"].join(";\n"),e);r(a).to.failToParse("23"),r(a).to.failToParse("23a"),r(a).to.failToParse("23aa"),r(a).to.failToParse("23a~"),r(a).to.failToParse("23a~a"),r(a).to.failToParse("23a~~"),r(a).to.parse("23a~~a",[2,3,["a","a"]]),r(a).to.parse("23a~~~a",[2,3,["a","a"]]),r(a).to.failToParse("23a~~~~a"),r(a).to.failToParse("23a~~a~~a")})),it("with function boundaries",(()=>{const a=t.generate("start = 'a'|{ return 2; }..{ return 3; }, '~'|",e);r(a).to.failToParse(""),r(a).to.failToParse("a"),r(a).to.failToParse("aa"),r(a).to.failToParse("a~"),r(a).to.parse("a~a",["a","a"]),r(a).to.failToParse("a~a~"),r(a).to.parse("a~a~a",["a","a","a"]),r(a).to.failToParse("a~a~a~"),r(a).to.failToParse("a~a~a~a")}))}))})),describe("text",(()=>{describe("when the expression matches",(()=>{it("returns the matched text",(()=>{const a=t.generate("start = $('a' 'b' 'c')",e);r(a).to.parse("abc","abc")}))})),describe("when the expression doesn't match",(()=>{it("reports match failure",(()=>{const a=t.generate("start = $('a')",e);r(a).to.failToParse("b")}))}))})),describe("positive simple predicate",(()=>{describe("when the expression matches",(()=>{it("returns |undefined|",(()=>{const a=t.generate("start = &'a' 'a'",e);r(a).to.parse("a",[void 0,"a"])})),it("resets parse position",(()=>{const a=t.generate("start = &'a' 'a'",e);r(a).to.parse("a")}))})),describe("when the expression doesn't match",(()=>{it("reports match failure",(()=>{const a=t.generate("start = &'a'",e);r(a).to.failToParse("b")})),it("discards any expectations recorded when matching the expression",(()=>{const a=t.generate("start = 'a' / &'b' / 'c'",e);r(a).to.failToParse("d",{expected:[{type:"literal",text:"a",ignoreCase:!1},{type:"literal",text:"c",ignoreCase:!1}]})}))}))})),describe("negative simple predicate",(()=>{describe("when the expression matches",(()=>{it("reports match failure",(()=>{const a=t.generate("start = !'a'",e);r(a).to.failToParse("a")}))})),describe("when the expression doesn't match",(()=>{it("returns |undefined|",(()=>{const a=t.generate("start = !'a' 'b'",e);r(a).to.parse("b",[void 0,"b"])})),it("resets parse position",(()=>{const a=t.generate("start = !'a' 'b'",e);r(a).to.parse("b")})),it("discards any expectations recorded when matching the expression",(()=>{const a=t.generate("start = 'a' / !'b' / 'c'",e);r(a).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1},{type:"literal",text:"c",ignoreCase:!1}]})}))}))})),describe("label",(()=>{describe("when the expression matches",(()=>{it("returns its match result",(()=>{const a=t.generate("start = a:'a'",e);r(a).to.parse("a","a")}))})),describe("when the expression doesn't match",(()=>{it("reports match failure",(()=>{const a=t.generate("start = a:'a'",e);r(a).to.failToParse("b")}))}))})),describe("sequence",(()=>{describe("when all expressions match",(()=>{it("returns an array of their match results",(()=>{const a=t.generate("start = 'a' 'b' 'c'",e);r(a).to.parse("abc",["a","b","c"])})),it("plucks a single value",(()=>{let a=t.generate("start = @'a'",e);r(a).to.parse("a","a"),a=t.generate("start = @'a' / @'b'",e),r(a).to.parse("a","a"),r(a).to.parse("b","b"),a=t.generate("start = 'a' @'b' 'c'",e),r(a).to.parse("abc","b"),a=t.generate("start = 'a' ( @'b' 'c' )",e),r(a).to.parse("abc",["a","b"]),a=t.generate("start = 'a' @( 'b' @'c' 'd' )",e),r(a).to.parse("abcd","c"),a=t.generate("start = 'a' ( @'b' 'c' ) @'d'",e),r(a).to.parse("abcd","d"),a=t.generate("start = 'a' @'b' 'c' / 'd' 'e' @'f'",e),r(a).to.parse("def","f")})),it("plucks a multiple values",(()=>{let a=t.generate("start = 'a' @'b' @'c'",e);r(a).to.parse("abc",["b","c"]),a=t.generate("start = 'a' ( @'b' @'c' )",e),r(a).to.parse("abc",["a",["b","c"]]),a=t.generate("start = 'a' @( 'b' @'c' @'d' )",e),r(a).to.parse("abcd",["c","d"]),a=t.generate("start = 'a' @( @'b' 'c' ) @'d' 'e'",e),r(a).to.parse("abcde",["b","d"]),a=t.generate("start = 'a' @'b' 'c' / @'d' 'e' @'f'",e),r(a).to.parse("def",["d","f"])})),it('prevents "@" on a semantic predicate',(()=>{r((()=>t.generate("start1 = 'a' @&{ /* semantic_and */ } 'c'")),e).to.throw(),r((()=>t.generate("start2 = 'a' @!{ /* semantic_not */ } 'c'")),e).to.throw()}))})),describe("when any expression doesn't match",(()=>{it("reports match failure",(()=>{const a=t.generate("start = 'a' 'b' 'c'",e);r(a).to.failToParse("dbc"),r(a).to.failToParse("adc"),r(a).to.failToParse("abd")})),it("resets parse position",(()=>{const a=t.generate("start = 'a' 'b' / 'a'",e);r(a).to.parse("a","a")}))}))})),describe("action",(()=>{describe("when the expression matches",(()=>{it("returns the value returned by the code",(()=>{const a=t.generate("start = 'a' { return 42; }",e);r(a).to.parse("a",42)})),describe("label variables",(()=>{describe("in the expression",(()=>{it("can access variable defined by labeled expression",(()=>{const a=t.generate("start = a:'a' { return a; }",e);r(a).to.parse("a","a")})),it("can access variables defined by labeled sequence elements",(()=>{const a=t.generate("start = a:'a' b:'b' c:'c' { return [a, b, c]; }",e);r(a).to.parse("abc",["a","b","c"])})),it("cannot access variables defined by subexpressions",(()=>{[{grammar:"start = (a:'a') { return a; }",input:"a"},{grammar:"start = (a:'a')? { return a; }",input:"a"},{grammar:"start = (a:'a')* { return a; }",input:"a"},{grammar:"start = (a:'a')+ { return a; }",input:"a"},{grammar:"start = (a:'a')| .. | { return a; }",input:"a"},{grammar:"start = (a:'a')|0.. | { return a; }",input:"a"},{grammar:"start = (a:'a')|1.. | { return a; }",input:"a"},{grammar:"start = (a:'a')|2.. | { return a; }",input:"aa"},{grammar:"start = (a:'a')| ..1| { return a; }",input:"a"},{grammar:"start = (a:'a')| ..3| { return a; }",input:"a"},{grammar:"start = (a:'a')|2..3| { return a; }",input:"aa"},{grammar:"start = (a:'a')|3| { return a; }",input:"aaa"},{grammar:"start = $(a:'a') { return a; }",input:"a"},{grammar:"start = &(a:'a') 'a' { return a; }",input:"a"},{grammar:"start = !(a:'a') 'b' { return a; }",input:"b"},{grammar:"start = b:(a:'a') { return a; }",input:"a"},{grammar:"start = ('a' b:'b' 'c') { return b; }",input:"abc"},{grammar:"start = (a:'a' { return a; }) { return a; }",input:"a"},{grammar:"start = ('a' / b:'b' / 'c') { return b; }",input:"b"}].forEach((a=>{const o=t.generate(a.grammar,e);r(o).to.failToParse(a.input)}))}))})),describe("in outer sequence",(()=>{it("can access variables defined by preceding labeled elements",(()=>{const a=t.generate("start = a:'a' ('b' { return a; })",e);r(a).to.parse("ab",["a","a"])})),it("cannot access variable defined by labeled action element",(()=>{const a=t.generate("start = 'a' b:('b' { return b; }) c:'c'",e);r(a).to.failToParse("abc")})),it("cannot access variables defined by following labeled elements",(()=>{const a=t.generate("start = ('a' { return b; }) b:'b'",e);r(a).to.failToParse("ab")}))}))})),describe("initializer variables & functions",(()=>{it("can access variables defined in the initializer",(()=>{const a=t.generate(["{ var v = 42 }","start = 'a' { return v; }"].join("\n"),e);r(a).to.parse("a",42)})),it("can access functions defined in the initializer",(()=>{const a=t.generate(["{ function f() { return 42; } }","start = 'a' { return f(); }"].join("\n"),e);r(a).to.parse("a",42)}))})),describe("available variables & functions",(()=>{it("|options| contains options",(()=>{const a=t.generate("start = 'a' { return options; }",e);r(a).to.parse("a",{a:42},{a:42})})),it("|text| returns text matched by the expression",(()=>{const a=t.generate("start = 'a' { return text(); }",e);r(a).to.parse("a","a")})),it("|location| returns location info of the expression",(()=>{const a=t.generate(["{ var result; }","start = line (nl+ line)* { return result; }","line = thing (' '+ thing)*","thing = digit / mark","digit = [0-9]","mark = 'x' { result = location(); }","nl = '\\r'? '\\n'"].join("\n"),e);r(a).to.parse("1\n2\n\n3\n\n\n4 5 x",{source:void 0,start:{offset:13,line:7,column:5},end:{offset:14,line:7,column:6}}),r(a).to.parse("1\nx",{source:void 0,start:{offset:2,line:2,column:1},end:{offset:3,line:2,column:2}}),r(a).to.parse("1\r\nx",{source:void 0,start:{offset:3,line:2,column:1},end:{offset:4,line:2,column:2}})})),describe("|expected|",(()=>{it("terminates parsing and throws an exception",(()=>{const a=t.generate("start = 'a' { expected('a'); }",e);r(a).to.failToParse("a",{message:'Expected a but "a" found.',expected:[{type:"other",description:"a"}],found:"a",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}})})),it("allows to set custom location info",(()=>{const a=t.generate(["start = 'a' {","  expected('a', {","    start: { offset: 1, line: 1, column: 2 },","    end: { offset: 2, line: 1, column: 3 }","  });","}"].join("\n"),e);r(a).to.failToParse("a",{message:'Expected a but "a" found.',expected:[{type:"other",description:"a"}],found:"a",location:{start:{offset:1,line:1,column:2},end:{offset:2,line:1,column:3}}})}))})),describe("|error|",(()=>{it("terminates parsing and throws an exception",(()=>{const a=t.generate("start = 'a' { error('a'); }",e);r(a).to.failToParse("a",{message:"a",found:null,expected:null,location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}})})),it("allows to set custom location info",(()=>{const a=t.generate(["start = 'a' {","  error('a', {","    start: { offset: 1, line: 1, column: 2 },","    end: { offset: 2, line: 1, column: 3 }","  });","}"].join("\n"),e);r(a).to.failToParse("a",{message:"a",expected:null,found:null,location:{start:{offset:1,line:1,column:2},end:{offset:2,line:1,column:3}}})}))}))}))})),describe("when the expression doesn't match",(()=>{it("reports match failure",(()=>{const a=t.generate("start = 'a' { return 42; }",e);r(a).to.failToParse("b")})),it("doesn't execute the code",(()=>{const a=t.generate("start = 'a' { throw 'Boom!'; } / 'b'",e);r(a).to.parse("b")}))}))})),describe("choice",(()=>{describe("when any expression matches",(()=>{it("returns its match result",(()=>{const a=t.generate("start = 'a' / 'b' / 'c'",e);r(a).to.parse("a","a"),r(a).to.parse("b","b"),r(a).to.parse("c","c")}))})),describe("when all expressions don't match",(()=>{it("reports match failure",(()=>{const a=t.generate("start = 'a' / 'b' / 'c'",e);r(a).to.failToParse("d")}))}))})),describe("error reporting",(()=>{describe("behavior",(()=>{it("reports only the rightmost error",(()=>{const a=t.generate("start = 'a' 'b' / 'a' 'c' 'd'",e);r(a).to.failToParse("ace",{expected:[{type:"literal",text:"d",ignoreCase:!1}]})}))})),describe("expectations reporting",(()=>{it("reports expectations correctly with no alternative",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("ab",{expected:[{type:"end"}]})})),it("reports expectations correctly with one alternative",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("b",{expected:[{type:"literal",text:"a",ignoreCase:!1}]})})),it("reports expectations correctly with multiple alternatives",(()=>{const a=t.generate("start = 'aa' / 'bb' / 'cc'",e);r(a).to.failToParse("dd",{expected:[{type:"literal",text:"aa",ignoreCase:!1},{type:"literal",text:"bb",ignoreCase:!1},{type:"literal",text:"cc",ignoreCase:!1}]})}))})),describe("found string reporting",(()=>{it("reports found string correctly at the end of input",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("",{found:null})})),it("reports found string correctly in the middle of input",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("b",{found:"b"})}))})),describe("message building",(()=>{it("builds message correctly with no alternative",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("ab",{message:'Expected end of input but "b" found.'})})),it("builds message correctly with one alternative",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("b",{message:'Expected "a" but "b" found.'})})),it("builds message correctly with multiple alternatives",(()=>{const a=t.generate("start = 'aa' / 'bb' / 'cc'",e);r(a).to.failToParse("dd",{message:'Expected "aa", "bb", or "cc" but "d" found.'})})),it("builds message correctly at the end of input",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("",{message:'Expected "a" but end of input found.'})})),it("builds message correctly in the middle of input",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("b",{message:'Expected "a" but "b" found.'})})),it("removes duplicates from expectations",(()=>{const a=t.generate("start = 'a' / 'a'",e);r(a).to.failToParse("b",{message:'Expected "a" but "b" found.'})})),it("sorts expectations",(()=>{const a=t.generate("start = 'cc' / 'bb' / 'aa'",e);r(a).to.failToParse("d",{message:'Expected "aa", "bb", or "cc" but "d" found.'})}))})),describe("position reporting",(()=>{it("reports position correctly at the end of input",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("",{location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:0,line:1,column:1}}})})),it("reports position correctly in the middle of input",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("b",{location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:1,line:1,column:2}}})})),it("reports position correctly with trailing input",(()=>{const a=t.generate("start = 'a'",e);r(a).to.failToParse("aa",{location:{source:void 0,start:{offset:1,line:1,column:2},end:{offset:2,line:1,column:3}}})})),it("reports position correctly in complex cases",(()=>{const a=t.generate(["start = line (nl+ line)*","line = digit (' '+ digit)*","digit = [0-9]","nl = '\\r'? '\\n'"].join("\n"),e);r(a).to.failToParse("1\n2\n\n3\n\n\n4 5 x",{location:{source:void 0,start:{offset:13,line:7,column:5},end:{offset:14,line:7,column:6}}}),r(a).to.failToParse("1\nx",{location:{source:void 0,start:{offset:2,line:2,column:1},end:{offset:3,line:2,column:2}}}),r(a).to.failToParse("1\r\nx",{location:{source:void 0,start:{offset:3,line:2,column:1},end:{offset:4,line:2,column:2}}})})),it("reports location source correctly",(()=>{const a={source:"object"},o=t.generate(["start = line (nl+ line)*","line = digit (' '+ digit)*","digit = [0-9]","nl = '\\r'? '\\n'"].join("\n"),e);r(o).to.failToParse("1\n2\n\n3\n\n\n4 5 x",{location:{source:a,start:{offset:13,line:7,column:5},end:{offset:14,line:7,column:6}}},{grammarSource:a})}))}))})),describe("complex examples",(()=>{it("handles arithmetics example correctly",(()=>{const a=t.generate(["Expr = Sum","Sum = head:Product tail:(('+' / '-') Product)* {","        return tail.reduce(function(result, element) {","          if (element[0] === '+') { return result + element[1]; }","          if (element[0] === '-') { return result - element[1]; }","        }, head);","      }","Product = head:Value tail:(('*' / '/') Value)* {","            return tail.reduce(function(result, element) {","              if (element[0] === '*') { return result * element[1]; }","              if (element[0] === '/') { return result / element[1]; }","            }, head);","          }","Value = digits:[0-9]+     { return parseInt(digits.join(''), 10); }","      / '(' expr:Expr ')' { return expr; }"].join("\n"),e);r(a).to.parse("0",0),r(a).to.parse("123",123),r(a).to.parse("(42+43)",85),r(a).to.parse("42",42),r(a).to.parse("42*43",1806),r(a).to.parse("42*43*44*45",3575880),r(a).to.parse("42/43",42/43),r(a).to.parse("42/43/44/45",42/43/44/45),r(a).to.parse("42*43",1806),r(a).to.parse("42*43+44*45",3786),r(a).to.parse("42*43+44*45+46*47+48*49",8300),r(a).to.parse("42*43-44*45",-174),r(a).to.parse("42*43-44*45-46*47-48*49",-4688),r(a).to.parse("42+43",85),r(a).to.parse("(1+2)*(3+4)",21)})),it("handles non-context-free language correctly",(()=>{const a=t.generate(["S = &(A 'c') a:'a'+ B:B !('a' / 'b' / 'c') { return a.join('') + B; }","A = a:'a' A:A? b:'b' { return [a, A, b].join(''); }","B = b:'b' B:B? c:'c' { return [b, B, c].join(''); }"].join("\n"),e);r(a).to.parse("abc","abc"),r(a).to.parse("aaabbbccc","aaabbbccc"),r(a).to.failToParse("aabbbccc"),r(a).to.failToParse("aaaabbbccc"),r(a).to.failToParse("aaabbccc"),r(a).to.failToParse("aaabbbbccc"),r(a).to.failToParse("aaabbbcc"),r(a).to.failToParse("aaabbbcccc")})),it("handles nested comments example correctly",(()=>{const a=t.generate(["C = begin:Begin ns:N* end:End { return begin + ns.join('') + end; }","N = C","  / !Begin !End z:Z { return z; }","Z = .","Begin = '(*'","End = '*)'"].join("\n"),e);r(a).to.parse("(**)","(**)"),r(a).to.parse("(*abc*)","(*abc*)"),r(a).to.parse("(*(**)*)","(*(**)*)"),r(a).to.parse("(*abc(*def*)ghi(*(*(*jkl*)*)*)mno*)","(*abc(*def*)ghi(*(*(*jkl*)*)*)mno*)")}))})),describe("run side-effects in non-matching",(()=>{it("positive semantic predicate",(()=>{let a=t.generate("\n        { let i = 0; }\n        start = (neverMatched / .) { return i; };\n        neverMatched = &{ i = 1; return true; } [];\n        ",e);r(a).to.parse("b",1),a=t.generate('\n        { let i = 0; }\n        start = ("a" / neverMatched / .) { return i; };\n        neverMatched = &{ i = 1; return true; } [];\n        ',e),r(a).to.parse("b",1)})),it("negative semantic predicate",(()=>{let a=t.generate("\n        { let i = 0; }\n        start = (neverMatched / .) { return i; };\n        neverMatched = !{ i = 1; return false; } [];\n        ",e);r(a).to.parse("b",1),a=t.generate('\n        { let i = 0; }\n        start = ("a" / neverMatched / .) { return i; };\n        neverMatched = !{ i = 1; return false; } [];\n        ',e),r(a).to.parse("b",1)})),it("action",(()=>{let a=t.generate("\n        { let i = 0; }\n        start = (neverMatched / .) { return i; };\n        neverMatched = (. { i = 1; }) [];\n        ",e);r(a).to.parse("b",1),a=t.generate('\n        { let i = 0; }\n        start = ("a" / neverMatched / .) { return i; };\n        neverMatched = (. { i = 1; }) [];\n        ',e),r(a).to.parse("b",1)}))}))},[{cache:!1,trace:!1},{cache:!1,trace:!0},{cache:!0,trace:!1},{cache:!0,trace:!0}].forEach((t=>{describe("with options "+e.util.inspect(t),(()=>{i(o(t))}))})),describe("syntax errors",(()=>{it("formats",(()=>{const e={source:"stdin",text:"==="};try{t.generate(e.text,{grammarSource:e.source})}catch(a){r(a).to.be.an.instanceof(t.parser.SyntaxError),r(a.format([e])).to.equal('Error: Expected "import", "{", code block, comment, end of line, identifier, or whitespace but "=" found.\n --\x3e stdin:1:1\n  |\n1 | ===\n  | ^')}try{t.generate("===",{grammarSource:"stdin"})}catch(e){r(e).to.be.an.instanceof(t.parser.SyntaxError),r(e.format([])).to.equal('Error: Expected "import", "{", code block, comment, end of line, identifier, or whitespace but "=" found.\n at stdin:1:1')}})),it("detects infinite loops before other errors",(()=>{try{t.generate('\n          start = start\n          dup = label:"foo" label:"bar"\n        ')}catch(e){r(e).with.property("stage","prepare"),r(e).with.property("problems").to.be.an("array");const t=e.problems.filter((e=>"error"===e[0])).map((e=>e[1]));r(t).to.deep.equal(["Possible infinite loop when parsing (left recursion: start -> start)"])}})),it("reports multiple errors in each compilation stage",(()=>{try{t.generate('\n          start = leftRecursion\n          leftRecursion = duplicatedLabel:duplicatedRule duplicatedLabel:missingRule\n          duplicatedRule = missingRule\n          duplicatedRule = "nothing"\n        ')}catch(e){r(e).with.property("stage","check"),r(e).with.property("problems").to.be.an("array"),e.problems.forEach((e=>{r(e).to.be.an("array").lengthOf.gte(2),r(e[0]).to.be.oneOf(["error","warning","info"])}));const t=e.problems.filter((e=>"error"===e[0])).map((e=>e[1]));r(t).to.include.members(['Rule "missingRule" is not defined','Rule "duplicatedRule" is already defined','Label "duplicatedLabel" is already defined'])}}))}))})),generatedParserBehavior_spec}requireGeneratedParserBehavior_spec();var compiler_spec={},hasRequiredCompiler_spec;function requireCompiler_spec(){if(hasRequiredCompiler_spec)return compiler_spec;hasRequiredCompiler_spec=1;const e=require$$0,t=requireParser(),r=requireCompiler(),a=e.expect;return describe("Peggy compiler",(()=>{it("checks start rules",(()=>{const e=t.parse("foo='1'");a(r.compile(e,r.passes)).to.be.an("object"),a(r.compile(e,r.passes,{allowedStartRules:null})).to.be.an("object"),a(r.compile(e,r.passes,{allowedStartRules:void 0})).to.be.an("object"),a(r.compile(e,r.passes,{allowedStartRules:[]})).to.be.an("object"),a((()=>r.compile(e,r.passes,{allowedStartRules:{}}))).to.throw("allowedStartRules must be an array"),a((()=>r.compile(e,r.passes,{allowedStartRules:["bar"]}))).to.throw('Unknown start rule "bar"')})),it("checks output type",(()=>{const e=t.parse("foo='1'");a(r.compile(e,r.passes,{output:"source"})).to.be.a("string"),a((()=>r.compile(e,r.passes,{output:"INVALID OUTPUT TYPE"}))).to.throw("Invalid output format: INVALID OUTPUT TYPE.")})),it("generates inline sourceMappingURL",(()=>{const e=t.parse("foo='1'");if(a(e).to.be.an("object"),"function"==typeof TextEncoder&&(a(r.compile(e,r.passes,{output:"source-with-inline-map",grammarSource:"src.peggy"})).to.match(/^\/\/# sourceMappingURL=data:application\/json;charset=utf-8;base64,/m),"object"==typeof globalThis)){const t=globalThis.TextEncoder;delete globalThis.TextEncoder,a((()=>r.compile(e,r.passes,{output:"source-with-inline-map",grammarSource:"src.peggy"}))).to.throw("TextEncoder is not supported by this platform"),globalThis.TextEncoder=t}})),it("requires grammarSource with source-map",(()=>{const e=t.parse("foo='1'");a(e).to.be.an("object"),a((()=>r.compile(e,r.passes,{output:"source-and-map"}))).to.throw("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps"),a((()=>r.compile(e,r.passes,{output:"source-and-map",grammarSource:""}))).to.throw("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps"),"function"==typeof TextEncoder&&a((()=>r.compile(e,r.passes,{output:"source-with-inline-map",grammarSource:{toString:()=>""}}))).to.throw("Must provide grammarSource (as a string or GrammarLocation) in order to generate source maps")})),it("generates correct bytecode for always-match alternatives",(()=>{const e=t.parse("start = 'a'? / 'b'"),o=[];r.compile(e,r.passes,{output:"ast",warning(...e){o.push(e)}}),a(e.rules[0].bytecode).to.eql([18,0,2,2,22,0,23,0,14,2,0,6,2]),a(o).to.eql([["semantic","Always matches.  Following alternatives may not be reachable.",{start:{column:9,line:1,offset:8},end:{column:13,line:1,offset:12},source:void 0}]])})),it("detects unreachable code",(()=>{const e=t.parse("start = &('f'*) &[] !('f'*) ![] 'b'"),o=[];r.compile(e,r.passes,{output:"ast",warning(...e){o.push(e)}}),a(o).to.eql([["semantic","Always matches, making the & predicate redundant.",{start:{column:11,line:1,offset:10},end:{column:15,line:1,offset:14},source:void 0}],["semantic","Never matches, making the & predicate always fail.",{start:{column:18,line:1,offset:17},end:{column:20,line:1,offset:19},source:void 0}],["semantic","Always matches, making the ! predicate always fail.",{start:{column:23,line:1,offset:22},end:{column:27,line:1,offset:26},source:void 0}],["semantic","Never matches, making the ! predicate redundant.",{start:{column:30,line:1,offset:29},end:{column:32,line:1,offset:31},source:void 0}]])})),it("detects deeper unreachable code",(()=>{const e=t.parse("start = &('a'? / 'b') !('a'? / 'b') &('a'? / 'b')"),o=[];r.compile(e,r.passes,{output:"ast",warning(...e){o.push(e)}}),a(o).to.eql([["semantic","Always matches.  Following alternatives may not be reachable.",{start:{column:11,line:1,offset:10},end:{column:15,line:1,offset:14},source:void 0}],["semantic","Always matches.  Following alternatives may not be reachable.",{start:{column:25,line:1,offset:24},end:{column:29,line:1,offset:28},source:void 0}],["semantic","Always matches.  Following alternatives may not be reachable.",{start:{column:39,line:1,offset:38},end:{column:43,line:1,offset:42},source:void 0}]])}))})),compiler_spec}requireCompiler_spec();var intern_spec={},hasRequiredIntern_spec;function requireIntern_spec(){if(hasRequiredIntern_spec)return intern_spec;hasRequiredIntern_spec=1;const e=require$$0,t=requireIntern(),r=e.expect;return describe("utility class Intern",(()=>{it("handles strings",(()=>{const e=new t;r(e.add("one")).to.equal(0),r(e.add("one")).to.equal(0),r(e.add("two")).to.equal(1),r(e.add("one")).to.equal(0),r(e.add("two")).to.equal(1),r(e.add(void 0)).to.equal(-1),r(e.add(null)).to.equal(-1),r(e.items.length).to.equal(2),r(e.items).to.deep.equal(["one","two"]),r(e.get(0)).to.equal("one"),r(e.get(1)).to.equal("two"),r(e.get(-1)).to.equal(void 0),r(e.get(10)).to.equal(void 0);const a=e.map(((e,t)=>[e,t]));r(a).to.deep.equal([["one",0],["two",1]])})),it("does conversions",(()=>{const e=new t({convert:e=>Array.from(e).map((e=>e.codePointAt(0)))});r(e.add("abc")).to.equal(0),r(e.add("abc")).to.equal(0),r(e.add("abd")).to.equal(1),r(e.get(0)).to.deep.equal([97,98,99]),r(e.get(1)).to.deep.equal([97,98,100])})),it("stringifies",(()=>{const e=new t({stringify:()=>"same"});r(e.add("abc")).to.equal(0),r(e.add("def")).to.equal(0)}))})),intern_spec}requireIntern_spec();var addImportedRules_spec={},helpers,hasRequiredHelpers,hasRequiredAddImportedRules_spec;function requireHelpers(){if(hasRequiredHelpers)return helpers;hasRequiredHelpers=1;const{GrammarError:e}=requirePeg(),t=requireParser(),r=requireSession();return helpers=function(a,o){const s=a.Assertion;a.use(requireChaiLike()),s.addMethod("changeAST",(function(a,n,i){i=void 0!==i?i:{};const c=t.parse(a,i);o.flag(this,"object")(c,i,new r({error(t,...r){throw new e(...r)}})),new s(c).like(n)})),s.addMethod("haveErrors",(function(e,a){const n=t.parse(e),i=new r;switch(o.flag(this,"object")(n,{},i),typeof a){case"number":new s(i.errors).equal(a);break;case"object":new s(i.problems).like(a)}})),s.addMethod("reportError",(function(a,n){const i=t.parse(a);let c,l=!1;try{o.flag(this,"object")(i,{},new r({error(t,...r){throw new e(...r)}})),l=!0}catch(e){c=e}this.assert(!l,"expected #{this} to report an error but it didn't","expected #{this} to not report an error but #{act} was reported",null,c),l||void 0===n||Object.keys(n).forEach((e=>{new s(c).to.have.property(e).that.is.deep.equal(n[e])}))}))},helpers}function requireAddImportedRules_spec(){if(hasRequiredAddImportedRules_spec)return addImportedRules_spec;hasRequiredAddImportedRules_spec=1;const e=require$$0,t=requireHelpers(),r=requireAddImportedRules();e.use(t);const a=e.expect;return describe("compiler pass |addImportedRules|",(()=>{it("creates default rules with undefined startRule",(()=>{a(r).to.changeAST("\nimport foo from './foo.js'\nimport bar from './bar.js'\n\na = foo / bar\n",{rules:[{type:"rule",name:"a",expression:{type:"choice",alternatives:[{name:"foo",type:"rule_ref"},{name:"bar",type:"rule_ref"}]}},{type:"rule",name:"foo",expression:{type:"library_ref",name:void 0,library:"./foo.js",libraryNumber:0}},{type:"rule",name:"bar",expression:{type:"library_ref",name:void 0,library:"./bar.js",libraryNumber:1}}]})})),it("creates bound rules with named startRule",(()=>{a(r).to.changeAST("\nimport {foo} from './foo.js'\nimport {bar} from './bar.js'\n\na = foo / bar\n",{rules:[{type:"rule",name:"a",expression:{type:"choice",alternatives:[{name:"foo",type:"rule_ref"},{name:"bar",type:"rule_ref"}]}},{type:"rule",name:"foo",expression:{type:"library_ref",name:"foo",library:"./foo.js",libraryNumber:0}},{type:"rule",name:"bar",expression:{type:"library_ref",name:"bar",library:"./bar.js",libraryNumber:1}}]})})),it("creates bound rules with renamed startRule",(()=>{a(r).to.changeAST("\nimport {foo as foo1} from './foo.js'\nimport {bar as bar2} from './bar.js'\n\na = foo1 / bar2\n",{rules:[{type:"rule",name:"a",expression:{type:"choice",alternatives:[{name:"foo1",type:"rule_ref"},{name:"bar2",type:"rule_ref"}]}},{type:"rule",name:"foo1",expression:{type:"library_ref",name:"foo",library:"./foo.js",libraryNumber:0}},{type:"rule",name:"bar2",expression:{type:"library_ref",name:"bar",library:"./bar.js",libraryNumber:1}}]})})),it("skips import as",(()=>{a(r).to.changeAST("\nimport * as foo from './foo.js'\n\na = foo.one / foo.two\n",{rules:[{type:"rule",name:"a",expression:{type:"choice",alternatives:[{type:"library_ref",name:"one",library:"foo",libraryNumber:-1},{type:"library_ref",name:"two",library:"foo",libraryNumber:-1}]}}]})})),it("errors on bad types",(()=>{a((()=>{r({imports:[{what:[{type:"unknown"}],from:{module:"foo.js"}}]})})).to.throw(TypeError)}))})),addImportedRules_spec}requireAddImportedRules_spec();var fixLibraryNumbers_spec={},hasRequiredFixLibraryNumbers_spec;function requireFixLibraryNumbers_spec(){if(hasRequiredFixLibraryNumbers_spec)return fixLibraryNumbers_spec;hasRequiredFixLibraryNumbers_spec=1;const e=require$$0,t=requireHelpers(),r=requireFixLibraryNumbers();e.use(t);const a=e.expect;return describe("compiler pass |fixLibraryNumbers|",(()=>{it("Adds library numbers for import * as",(()=>{a(r).to.changeAST('\nimport * as foo from "./foo.js";\nimport * as bar from "./foo.js";\n\na = foo.one / bar.two\n      ',{rules:[{type:"rule",name:"a",expression:{type:"choice",alternatives:[{type:"library_ref",name:"one",library:"foo",libraryNumber:0},{type:"library_ref",name:"two",library:"bar",libraryNumber:1}]}}]})})),it("fails on unknown module names",(()=>{a(r).to.reportError("a = foo.bar",{message:'Unknown module "foo"'})}))})),fixLibraryNumbers_spec}requireFixLibraryNumbers_spec();var generateBytecode_spec={},hasRequiredGenerateBytecode_spec;function requireGenerateBytecode_spec(){if(hasRequiredGenerateBytecode_spec)return generateBytecode_spec;hasRequiredGenerateBytecode_spec=1;const e=require$$0,t=requireHelpers(),r=requireGenerateBytecode();e.use(t);const a=e.expect;return describe("compiler pass |generateBytecode|",(()=>{function e(e){return{rules:[{bytecode:e}]}}function t(e,t){return{rules:[{bytecode:e}],locations:t}}function o(e,t,r,a){return{literals:e,classes:t,expectations:r,functions:a}}describe("for grammar",(()=>{it("generates correct bytecode",(()=>{a(r).to.changeAST(["a = 'a'","b = 'b'","c = 'c'"].join("\n"),{rules:[{bytecode:[18,0,2,2,22,0,23,0]},{bytecode:[18,1,2,2,22,1,23,1]},{bytecode:[18,2,2,2,22,2,23,2]}]})})),it("allows Object prototype property names as literals",(()=>{a(r).to.changeAST(["a = '__proto__'","b = 'constructor'","c = 'hasOwnProperty'","d = 'isPrototypeOf'","e = 'propertyIsEnumerable'","f = 'toLocaleString'","g = 'toString'","h = 'valueOf'"].join("\n"),{rules:[{bytecode:[18,0,2,2,22,0,23,0]},{bytecode:[18,1,2,2,22,1,23,1]},{bytecode:[18,2,2,2,22,2,23,2]},{bytecode:[18,3,2,2,22,3,23,3]},{bytecode:[18,4,2,2,22,4,23,4]},{bytecode:[18,5,2,2,22,5,23,5]},{bytecode:[18,6,2,2,22,6,23,6]},{bytecode:[18,7,2,2,22,7,23,7]}]})})),it("defines correct constants",(()=>{a(r).to.changeAST(["a = 'a'","b = 'b'","c = 'c'"].join("\n"),o(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[]))})),it("generates correct source mapping",(()=>{a(r).to.changeAST(["a = 'a'"].join("\n"),t([37,0,18,0,2,2,22,0,23,0,38],[{source:"-",start:{offset:4,line:1,column:5},end:{offset:7,line:1,column:8}}]),{grammarSource:"-",output:"source-and-map"})})),it("generates correct plucking bytecode",(()=>{a(r).to.changeAST("start = 'a' @'b' 'c'",e([5,18,0,2,2,22,0,23,0,15,34,3,18,1,2,2,22,1,23,1,15,19,4,18,2,2,2,22,2,23,2,15,4,4,36,4,1,1,8,3,7,3,8,2,7,3,6,7,3])),a(r).to.changeAST("start = 'a' @'b' @'c'",e([5,18,0,2,2,22,0,23,0,15,35,3,18,1,2,2,22,1,23,1,15,20,4,18,2,2,2,22,2,23,2,15,5,4,36,4,2,1,0,8,3,7,3,8,2,7,3,6,7,3]))}))})),describe("for rule",(()=>{it("generates correct bytecode",(()=>{a(r).to.changeAST("start = 'a'",e([18,0,2,2,22,0,23,0]))}))})),describe("for named",(()=>{const t="start 'start' = 'a'";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([28,18,0,2,2,22,0,23,1,29,14,2,0,23,0]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"rule",value:"start"},{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for choice",(()=>{it("generates correct bytecode and source mapping",(()=>{a(r).to.changeAST("start = 'a' / label:'b' / 'c'",t([37,5,37,0,18,0,2,2,22,0,23,0,38,14,36,0,6,37,3,39,0,2,2,37,1,18,1,2,2,22,1,23,1,38,40,0,38,14,12,0,6,37,4,18,3,2,2,22,3,23,2,38,38],[{source:"-",start:{offset:8,line:1,column:9},end:{offset:11,line:1,column:12}},{source:"-",start:{offset:20,line:1,column:21},end:{offset:23,line:1,column:24}},{source:"-",start:{offset:14,line:1,column:15},end:{offset:19,line:1,column:20}},{source:"-",start:{offset:14,line:1,column:15},end:{offset:23,line:1,column:24}},{source:"-",start:{offset:26,line:1,column:27},end:{offset:29,line:1,column:30}},{source:"-",start:{offset:8,line:1,column:9},end:{offset:29,line:1,column:30}}]),{grammarSource:"-",output:"source-and-map"})}))})),describe("for action",(()=>{describe("without labels",(()=>{const t="start = 'a' { code }";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:" code ",location:{source:void 0,start:{offset:13,line:1,column:14},end:{offset:19,line:1,column:20}}}]))}))})),describe("with one label",(()=>{const t="start = a:'a' { code }";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,7,0,24,1,26,0,1,1,0,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:["a"],body:" code ",location:{source:void 0,start:{offset:15,line:1,column:16},end:{offset:21,line:1,column:22}}}]))}))})),describe("with multiple labels",(()=>{const t="start = a:'a' b:'b' c:'c' { code }";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,39,3,18,1,2,2,22,1,23,1,15,24,4,18,2,2,2,22,2,23,2,15,9,4,24,3,26,0,4,3,2,1,0,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[{predicate:!1,params:["a","b","c"],body:" code ",location:{source:void 0,start:{offset:27,line:1,column:28},end:{offset:33,line:1,column:34}}}]))}))}))})),describe("for sequence",(()=>{const t="start = 'a' 'b' 'c'";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,33,3,18,1,2,2,22,1,23,1,15,18,4,18,2,2,2,22,2,23,2,15,3,4,11,3,9,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[]))}))})),describe("for labeled",(()=>{it("generates correct bytecode",(()=>{a(r).to.changeAST("start = a:'a'",e([18,0,2,2,22,0,23,0]))}))})),describe("for text",(()=>{it("generates correct bytecode",(()=>{a(r).to.changeAST("start = $'a'",e([5,18,0,2,2,22,0,23,0,15,2,1,6,12,9]))}))})),describe("for simple_and",(()=>{const t="start = &'a'";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,28,18,0,2,2,22,0,23,0,29,15,3,3,6,7,1,6,6,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for simple_not",(()=>{const t="start = !'a'";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,28,18,0,2,2,22,0,23,0,29,14,3,3,6,6,1,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for optional",(()=>{const t="start = 'a'?";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([18,0,2,2,22,0,23,0,14,2,0,6,2]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for zero_or_more",(()=>{const t="start = 'a'*";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for one_or_more",(()=>{const t="start = 'a'+";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,15,12,3,16,9,10,18,0,2,2,22,0,23,0,6,6,6,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for repeated",(()=>{describe("without delimiter",(()=>{describe("| .. | (edge case -- no boundaries)",(()=>{const t="start = 'a'| .. |";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("with constant boundaries",(()=>{describe("| ..3| (edge case -- no min boundary)",(()=>{const t="start = 'a'| ..3|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,14,10,31,3,1,8,3,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("| ..1| (edge case -- no min boundary -- same as |optional|)",(()=>{const t="start = 'a'| ..1|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,14,10,31,1,1,8,3,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("|2.. | (edge case -- no max boundary)",(()=>{const t="start = 'a'|2.. |";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6,30,2,3,1,6,7,3,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("|0.. | (edge case -- no max boundary -- same as |zero or more|)",(()=>{const t="start = 'a'|0.. |";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("|1.. | (edge case -- no max boundary -- same as |one or more|)",(()=>{const t="start = 'a'|1.. |";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6,30,1,3,1,6,7,3,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("|2..3|",(()=>{const t="start = 'a'|2..3|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,14,10,31,3,1,8,3,18,0,2,2,22,0,23,0,6,30,2,3,1,6,7,3,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("| 42 | (edge case -- exact repetitions)",(()=>{const t="start = 'a'|42|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,14,10,31,42,1,8,3,18,0,2,2,22,0,23,0,6,30,42,3,1,6,7,3,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))}))})),describe("with variable boundaries",(()=>{describe("| ..x| (edge case -- no min boundary)",(()=>{const t="start = max:('a'{return 42;}) 'a'| ..max|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9,15,41,3,4,33,1,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,1,1,8,3,18,0,2,2,22,0,23,0,6,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("|x.. | (edge case -- no max boundary)",(()=>{const t="start = min:('a'{return 42;}) 'a'|min.. |";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9,15,40,3,5,4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6,32,2,3,1,6,7,3,9,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("|x..y|",(()=>{const t="start = min:('a'{return 42;}) max:('a'{return 42;}) 'a'|min..max|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9,15,77,3,5,18,0,2,2,22,0,23,0,15,7,0,24,1,26,1,1,1,2,9,15,50,4,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,2,1,8,3,18,0,2,2,22,0,23,0,6,32,3,3,1,6,7,3,9,15,3,4,11,3,9,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"},{predicate:!1,params:["min"],body:"return 42;"}]))}))})),describe("|exact| (edge case -- exact repetitions)",(()=>{const t="start = exact:('a'{return 42;}) 'a'|exact|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,18,0,2,2,22,0,23,0,15,6,0,24,1,26,0,1,0,9,15,50,3,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,2,1,8,3,18,0,2,2,22,0,23,0,6,32,2,3,1,6,7,3,9,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))}))})),describe("with function boundaries",(()=>{describe("| ..x| (edge case -- no min boundary)",(()=>{const t="start = 'a'| ..{return 42;}|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([26,0,0,0,4,33,1,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,1,1,8,3,18,0,2,2,22,0,23,0,6,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))})),describe("|x.. | (edge case -- no max boundary)",(()=>{const t="start = 'a'|{return 42;}.. |";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([26,0,0,0,5,4,18,0,2,2,22,0,23,0,16,9,10,18,0,2,2,22,0,23,0,6,32,2,3,1,6,7,3,9,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))})),describe("|x..y|",(()=>{const t="start = 'a'|{return 41;}..{return 43;}|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([26,0,0,0,26,1,0,0,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,2,1,8,3,18,0,2,2,22,0,23,0,6,32,3,3,1,6,7,3,9,9,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 41;"},{predicate:!0,params:[],body:"return 43;"}]))}))})),describe("|exact| (edge case -- exact repetitions)",(()=>{const t="start = 'a'|{return 42;}|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([26,0,0,0,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,14,10,33,2,1,8,3,18,0,2,2,22,0,23,0,6,32,2,3,1,6,7,3,9,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))}))}))})),describe("with delimiter",(()=>{describe("| .. , delim| (edge case -- no boundaries)",(()=>{const t="start = 'a'| .. , 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("with constant boundaries",(()=>{describe("| ..3, delim| (edge case -- no min boundary)",(()=>{const t="start = 'a'| ..3, 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,35,10,31,3,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("| ..1, delim| (edge case -- no min boundary -- same as |optional|)",(()=>{const t="start = 'a'| ..1, 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,35,10,31,1,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("|2.. , delim| (edge case -- no max boundary)",(()=>{const t="start = 'a'|2.. , 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,30,2,3,1,6,7,3,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("|0.. , delim| (edge case -- no max boundary -- same as |zero or more|)",(()=>{const t="start = 'a'|0.. , 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("|1.. , delim| (edge case -- no max boundary -- same as |one or more|)",(()=>{const t="start = 'a'|1.. , 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,30,1,3,1,6,7,3,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("|2..3, delim|",(()=>{const t="start = 'a'|2..3, 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,35,10,31,3,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,30,2,3,1,6,7,3,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))})),describe("| 42 , delim| (edge case -- exact repetitions)",(()=>{const t="start = 'a'|42, 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,4,18,0,2,2,22,0,23,0,16,35,10,31,42,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,30,42,3,1,6,7,3,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[]))}))}))})),describe("with variable boundaries",(()=>{describe("| ..x, delim| (edge case -- no min boundary)",(()=>{const t="start = max:(''{return 42;}) 'a'| ..max, 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,62,3,4,33,1,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,1,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("|x.. , delim| (edge case -- no max boundary)",(()=>{const t="start = min:(''{return 42;}) 'a'|min.. , 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,61,3,5,4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,2,3,1,6,7,3,9,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("|x..y, delim|",(()=>{const t="start = min:(''{return 42;}) max:(''{return 42;}) 'a'|min..max, 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,91,3,5,35,15,7,0,24,1,26,1,1,1,2,9,15,71,4,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,2,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,3,3,1,6,7,3,9,15,3,4,11,3,9,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"},{predicate:!1,params:["min"],body:"return 42;"}]))}))})),describe("|exact, delim| (edge case -- exact repetitions)",(()=>{const t="start = exact:(''{return 42;}) 'a'|exact, 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,71,3,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,2,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,2,3,1,6,7,3,9,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("used in delimiter",(()=>{describe("delim|min..|",(()=>{const t="start = min:(''{return 42;}) 'a'|.., 'b'|min..| |";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,74,3,4,18,0,2,2,22,0,23,0,16,52,10,5,5,4,18,1,2,2,22,1,23,1,16,9,10,18,1,2,2,22,1,23,1,6,32,4,3,1,6,7,3,9,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("delim|..max|",(()=>{const t="start = max:(''{return 42;}) 'a'|.., 'b'|..max| |";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,75,3,4,18,0,2,2,22,0,23,0,16,53,10,5,4,33,3,1,8,3,18,1,2,2,22,1,23,1,16,14,10,33,3,1,8,3,18,1,2,2,22,1,23,1,6,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))})),describe("delim|exact|",(()=>{const t="start = exact:(''{return 42;}) 'a'|.., 'b'|exact| |";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,5,35,15,6,0,24,1,26,0,1,0,9,15,84,3,4,18,0,2,2,22,0,23,0,16,62,10,5,5,4,33,4,1,8,3,18,1,2,2,22,1,23,1,16,14,10,33,4,1,8,3,18,1,2,2,22,1,23,1,6,32,4,3,1,6,7,3,9,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,15,3,4,11,2,9,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!1,params:[],body:"return 42;"}]))}))}))}))})),describe("with function boundaries",(()=>{describe("| ..x, delim| (edge case -- no min boundary)",(()=>{const t="start = 'a'| ..{return 42;}, 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([26,0,0,0,4,33,1,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,1,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))})),describe("|x.. , delim| (edge case -- no max boundary)",(()=>{const t="start = 'a'|{return 42;}.. , 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([26,0,0,0,5,4,18,0,2,2,22,0,23,0,16,30,10,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,2,3,1,6,7,3,9,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))})),describe("|x..y, delim|",(()=>{const t="start = 'a'|{return 41;}..{return 43;}, 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([26,0,0,0,26,1,0,0,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,2,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,3,3,1,6,7,3,9,9,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 41;"},{predicate:!0,params:[],body:"return 43;"}]))}))})),describe("|exact, delim| (edge case -- exact repetitions)",(()=>{const t="start = 'a'|{return 42;}, 'b'|";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([26,0,0,0,5,4,33,2,1,8,3,18,0,2,2,22,0,23,0,16,35,10,33,2,1,29,3,5,18,1,2,2,22,1,23,1,15,16,1,6,18,0,2,2,22,0,23,0,14,3,1,6,7,3,9,9,6,32,2,3,1,6,7,3,9,9]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1}],[{predicate:!0,params:[],body:"return 42;"}]))}))}))}))}))})),describe("for group",(()=>{const t="start = ('a')";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([18,0,2,2,22,0,23,0]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("for semantic_and",(()=>{describe("without labels",(()=>{const t="start = &{ code }";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([25,26,0,0,0,13,2,2,6,1,6,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o([],[],[],[{predicate:!0,params:[],body:" code ",location:{source:void 0,start:{offset:10,line:1,column:11},end:{offset:16,line:1,column:17}}}]))}))})),describe("with labels",(()=>{const t="start = a:'a' b:'b' c:'c' &{ code }";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,55,3,18,1,2,2,22,1,23,1,15,40,4,18,2,2,2,22,2,23,2,15,25,4,25,26,0,0,3,2,1,0,13,2,2,6,1,6,3,15,3,4,11,4,9,8,4,7,3,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[{predicate:!0,params:["a","b","c"],body:" code ",location:{source:void 0,start:{offset:28,line:1,column:29},end:{offset:34,line:1,column:35}}}]))}))}))})),describe("for semantic_not",(()=>{describe("without labels",(()=>{const t="start = !{ code }";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([25,26,0,0,0,13,2,2,6,3,6,1]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o([],[],[],[{predicate:!0,params:[],body:" code ",location:{source:void 0,start:{offset:10,line:1,column:11},end:{offset:16,line:1,column:17}}}]))}))})),describe("with labels",(()=>{const t="start = a:'a' b:'b' c:'c' !{ code }";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([5,18,0,2,2,22,0,23,0,15,55,3,18,1,2,2,22,1,23,1,15,40,4,18,2,2,2,22,2,23,2,15,25,4,25,26,0,0,3,2,1,0,13,2,2,6,3,6,1,15,3,4,11,4,9,8,4,7,3,8,3,7,3,8,2,7,3,6,7,3]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a","b","c"],[],[{type:"literal",value:"a",ignoreCase:!1},{type:"literal",value:"b",ignoreCase:!1},{type:"literal",value:"c",ignoreCase:!1}],[{predicate:!0,params:["a","b","c"],body:" code ",location:{source:void 0,start:{offset:28,line:1,column:29},end:{offset:34,line:1,column:35}}}]))}))}))})),describe("for rule_ref",(()=>{it("generates correct bytecode",(()=>{a(r).to.changeAST(["start = other","other = 'other'"].join("\n"),{rules:[{bytecode:[27,1]},{}]})}))})),describe("for literal",(()=>{describe("empty",(()=>{const t="start = ''";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([35]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o([],[],[],[]))}))})),describe("non-empty case-sensitive",(()=>{const t="start = 'a'";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([18,0,2,2,22,0,23,0]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"a",ignoreCase:!1}],[]))}))})),describe("non-empty case-insensitive",(()=>{const t="start = 'A'i";it("generates correct bytecode",(()=>{a(r).to.changeAST(t,e([19,0,2,2,21,1,23,0]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o(["a"],[],[{type:"literal",value:"A",ignoreCase:!0}],[]))}))}))})),describe("for class",(()=>{it("generates correct bytecode",(()=>{a(r).to.changeAST("start = [a]",e([20,0,2,2,21,1,23,0]))})),describe("non-inverted case-sensitive",(()=>{it("defines correct constants",(()=>{a(r).to.changeAST("start = [a]",o([],[{value:["a"],ignoreCase:!1,inverted:!1}],[{type:"class",value:["a"],ignoreCase:!1,inverted:!1}],[]))}))})),describe("inverted case-sensitive",(()=>{it("defines correct constants",(()=>{a(r).to.changeAST("start = [^a]",o([],[{value:["a"],ignoreCase:!1,inverted:!0}],[{type:"class",value:["a"],ignoreCase:!1,inverted:!0}],[]))}))})),describe("non-inverted case-insensitive",(()=>{it("defines correct constants",(()=>{a(r).to.changeAST("start = [a]i",o([],[{value:["a"],ignoreCase:!0,inverted:!1}],[{type:"class",value:["a"],ignoreCase:!0,inverted:!1}],[]))}))})),describe("complex",(()=>{it("defines correct constants",(()=>{a(r).to.changeAST("start = [ab-def-hij-l]",o([],[{value:["a",["b","d"],"e",["f","h"],"i",["j","l"]],ignoreCase:!1,inverted:!1}],[{type:"class",value:["a",["b","d"],"e",["f","h"],"i",["j","l"]],ignoreCase:!1,inverted:!1}],[]))}))}))})),describe("for any",(()=>{const t="start = .";it("generates bytecode",(()=>{a(r).to.changeAST(t,e([17,2,2,21,1,23,0]))})),it("defines correct constants",(()=>{a(r).to.changeAST(t,o([],[],[{type:"any"}],[]))}))}))})),generateBytecode_spec}requireGenerateBytecode_spec();var generateJs_spec={},hasRequiredGenerateJs_spec;function requireGenerateJs_spec(){if(hasRequiredGenerateJs_spec)return generateJs_spec;hasRequiredGenerateJs_spec=1;const e=require$$0,t=requireGenerateJs(),{expect:r}=e;return describe("compiler pass |generateJS|",(()=>{describe("coverage",(()=>{const e={type:"grammar",imports:[],rules:[],location:{source:"",start:{line:1,column:1,offset:0},end:{line:1,column:1,offset:0}}},a={};it("throws unless various grammar fields are set",(()=>{r((()=>t(e,a))).to.throw(Error,"generateJS: generate bytecode was not called."),e.literals=[],r((()=>t({...e,literals:[]},a))).to.throw(Error,"generateJS: generate bytecode was not called."),e.locations=[],r((()=>t({...e,literals:[]},a))).to.throw(Error,"generateJS: generate bytecode was not called."),e.classes=[],r((()=>t({...e,literals:[]},a))).to.throw(Error,"generateJS: generate bytecode was not called."),e.expectations=[],r((()=>t({...e,literals:[]},a))).to.throw(Error,"generateJS: generate bytecode was not called."),e.functions=[],r((()=>t({...e,literals:[]},a))).to.throw(Error,"generateJS: generate bytecode was not called."),e.importedNames=[],r((()=>t(e,a))).to.throw(Error,"generateJS: options.allowedStartRules was not set."),a.allowedStartRules=["start"],r((()=>t(e,a))).to.not.throw()}))}))})),generateJs_spec}requireGenerateJs_spec();var inferenceMatchResult_spec={},hasRequiredInferenceMatchResult_spec;function requireInferenceMatchResult_spec(){if(hasRequiredInferenceMatchResult_spec)return inferenceMatchResult_spec;hasRequiredInferenceMatchResult_spec=1;const e=require$$0,t=requireHelpers(),r=requireInferenceMatchResult();e.use(t);const a=e.expect;return describe("compiler pass |inferenceMatchResult|",(()=>{it("calculate |match| property for |any| correctly",(()=>{a(r).to.changeAST("start = .",{rules:[{match:0}]})})),it("calculate |match| property for |literal| correctly",(()=>{a(r).to.changeAST("start = ''",{rules:[{match:1}]}),a(r).to.changeAST("start = ''i",{rules:[{match:1}]}),a(r).to.changeAST("start = 'a'",{rules:[{match:0}]}),a(r).to.changeAST("start = 'a'i",{rules:[{match:0}]})})),it("calculate |match| property for |class| correctly",(()=>{a(r).to.changeAST("start = []",{rules:[{match:-1}]}),a(r).to.changeAST("start = []i",{rules:[{match:-1}]}),a(r).to.changeAST("start = [a]",{rules:[{match:0}]}),a(r).to.changeAST("start = [a]i",{rules:[{match:0}]}),a(r).to.changeAST("start = [a-b]",{rules:[{match:0}]}),a(r).to.changeAST("start = [a-b]i",{rules:[{match:0}]})})),it("calculate |match| property for |sequence| correctly",(()=>{a(r).to.changeAST("start = 'a' 'b'",{rules:[{match:0}]}),a(r).to.changeAST("start = 'a' ''",{rules:[{match:0}]}),a(r).to.changeAST("start = '' 'b'",{rules:[{match:0}]}),a(r).to.changeAST("start = '' ''",{rules:[{match:1}]}),a(r).to.changeAST("start = 'a' []",{rules:[{match:-1}]}),a(r).to.changeAST("start = [] 'b'",{rules:[{match:-1}]}),a(r).to.changeAST("start = [] []",{rules:[{match:-1}]})})),it("calculate |match| property for |choice| correctly",(()=>{a(r).to.changeAST("start = 'a' / 'b'",{rules:[{match:0}]}),a(r).to.changeAST("start = 'a' / ''",{rules:[{match:0}]}),a(r).to.changeAST("start = ''  / 'b'",{rules:[{match:0}]}),a(r).to.changeAST("start = ''  / ''",{rules:[{match:1}]}),a(r).to.changeAST("start = 'a' / []",{rules:[{match:0}]}),a(r).to.changeAST("start = []  / 'b'",{rules:[{match:0}]}),a(r).to.changeAST("start = []  / []",{rules:[{match:-1}]}),a(r).to.changeAST("start = 'a'? / 'b'",{rules:[{match:0}]})})),it("calculate |match| property for predicates correctly",(()=>{a(r).to.changeAST("start = &.",{rules:[{match:0}]}),a(r).to.changeAST("start = &''",{rules:[{match:1}]}),a(r).to.changeAST("start = &[]",{rules:[{match:-1}]}),a(r).to.changeAST("start = !.",{rules:[{match:0}]}),a(r).to.changeAST("start = !''",{rules:[{match:-1}]}),a(r).to.changeAST("start = ![]",{rules:[{match:1}]}),a(r).to.changeAST("start = &{ code }",{rules:[{match:0}]}),a(r).to.changeAST("start = !{ code }",{rules:[{match:0}]})})),it("calculate |match| property for |text| correctly",(()=>{a(r).to.changeAST("start = $.",{rules:[{match:0}]}),a(r).to.changeAST("start = $''",{rules:[{match:1}]}),a(r).to.changeAST("start = $[]",{rules:[{match:-1}]})})),it("calculate |match| property for |action| correctly",(()=>{a(r).to.changeAST("start = .  { code }",{rules:[{match:0}]}),a(r).to.changeAST("start = '' { code }",{rules:[{match:1}]}),a(r).to.changeAST("start = [] { code }",{rules:[{match:-1}]})})),it("calculate |match| property for |labeled| correctly",(()=>{a(r).to.changeAST("start = a:.",{rules:[{match:0}]}),a(r).to.changeAST("start = a:''",{rules:[{match:1}]}),a(r).to.changeAST("start = a:[]",{rules:[{match:-1}]})})),it("calculate |match| property for |named| correctly",(()=>{a(r).to.changeAST("start 'start' = .",{rules:[{match:0}]}),a(r).to.changeAST("start 'start' = ''",{rules:[{match:1}]}),a(r).to.changeAST("start 'start' = []",{rules:[{match:-1}]})})),it("calculate |match| property for |optional| correctly",(()=>{a(r).to.changeAST("start = .?",{rules:[{match:1}]}),a(r).to.changeAST("start = ''?",{rules:[{match:1}]}),a(r).to.changeAST("start = []?",{rules:[{match:1}]})})),it("calculate |match| property for |zero_or_more| correctly",(()=>{a(r).to.changeAST("start = .*",{rules:[{match:1}]}),a(r).to.changeAST("start = ''*",{rules:[{match:1}]}),a(r).to.changeAST("start = []*",{rules:[{match:1}]})})),it("calculate |match| property for |one_or_more| correctly",(()=>{a(r).to.changeAST("start = .+",{rules:[{match:0}]}),a(r).to.changeAST("start = ''+",{rules:[{match:1}]}),a(r).to.changeAST("start = []+",{rules:[{match:-1}]})})),describe("calculate |match| property for |repeated|",(()=>{describe("without delimiter",(()=>{describe("with constant boundaries",(()=>{it("for | .. | correctly",(()=>{a(r).to.changeAST("start =  .| .. |",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| .. |",{rules:[{match:1}]}),a(r).to.changeAST("start = []| .. |",{rules:[{match:1}]})})),it("for | ..1| correctly",(()=>{a(r).to.changeAST("start =  .| ..1|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| ..1|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| ..1|",{rules:[{match:1}]})})),it("for | ..3| correctly",(()=>{a(r).to.changeAST("start =  .| ..3|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| ..3|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| ..3|",{rules:[{match:1}]})})),it("for |0.. | correctly",(()=>{a(r).to.changeAST("start =  .|0.. |",{rules:[{match:1}]}),a(r).to.changeAST("start = ''|0.. |",{rules:[{match:1}]}),a(r).to.changeAST("start = []|0.. |",{rules:[{match:1}]})})),it("for |1.. | correctly",(()=>{a(r).to.changeAST("start =  .|1.. |",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|1.. |",{rules:[{match:1}]}),a(r).to.changeAST("start = []|1.. |",{rules:[{match:-1}]})})),it("for |2.. | correctly",(()=>{a(r).to.changeAST("start =  .|2.. |",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|2.. |",{rules:[{match:1}]}),a(r).to.changeAST("start = []|2.. |",{rules:[{match:-1}]})})),it("for |2..3| correctly",(()=>{a(r).to.changeAST("start =  .|2..3|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|2..3|",{rules:[{match:1}]}),a(r).to.changeAST("start = []|2..3|",{rules:[{match:-1}]})})),it("for | 42 | correctly",(()=>{a(r).to.changeAST("start =  .| 42 |",{rules:[{match:0}]}),a(r).to.changeAST("start = ''| 42 |",{rules:[{match:1}]}),a(r).to.changeAST("start = []| 42 |",{rules:[{match:-1}]})}))})),describe("with variable boundaries",(()=>{it("for |   ..max| correctly",(()=>{a(r).to.changeAST("start =  .|   ..max|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|   ..max|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|   ..max|",{rules:[{match:0}]})})),it("for |min..   | correctly",(()=>{a(r).to.changeAST("start =  .|min..   |",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|min..   |",{rules:[{match:0}]}),a(r).to.changeAST("start = []|min..   |",{rules:[{match:0}]})})),it("for |min..max| correctly",(()=>{a(r).to.changeAST("start =  .|min..max|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|min..max|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|min..max|",{rules:[{match:0}]})})),it("for | exact  | correctly",(()=>{a(r).to.changeAST("start =  .|exact|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|exact|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|exact|",{rules:[{match:0}]})}))})),describe("with function boundaries",(()=>{it("for |  ..{}| correctly",(()=>{a(r).to.changeAST("start =  .|   ..{}|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|   ..{}|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|   ..{}|",{rules:[{match:0}]})})),it("for |{}..  | correctly",(()=>{a(r).to.changeAST("start =  .|{}..   |",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|{}..   |",{rules:[{match:0}]}),a(r).to.changeAST("start = []|{}..   |",{rules:[{match:0}]})})),it("for |{}..{}| correctly",(()=>{a(r).to.changeAST("start =  .|{}..{}|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|{}..{}|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|{}..{}|",{rules:[{match:0}]})})),it("for |  {}  | correctly",(()=>{a(r).to.changeAST("start =  .|{}|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|{}|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|{}|",{rules:[{match:0}]})}))}))})),describe("with delimiter",(()=>{describe("with constant boundaries",(()=>{it("for | .. , delimiter| correctly",(()=>{a(r).to.changeAST("start =  .| .. , .|",{rules:[{match:1}]}),a(r).to.changeAST("start =  .| .. ,''|",{rules:[{match:1}]}),a(r).to.changeAST("start =  .| .. ,[]|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| .. , .|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| .. ,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| .. ,[]|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| .. , .|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| .. ,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| .. ,[]|",{rules:[{match:1}]})})),it("for | ..1, delimiter| correctly",(()=>{a(r).to.changeAST("start =  .| ..1, .|",{rules:[{match:1}]}),a(r).to.changeAST("start =  .| ..1,''|",{rules:[{match:1}]}),a(r).to.changeAST("start =  .| ..1,[]|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| ..1, .|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| ..1,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| ..1,[]|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| ..1, .|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| ..1,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| ..1,[]|",{rules:[{match:1}]})})),it("for | ..3, delimiter| correctly",(()=>{a(r).to.changeAST("start =  .| ..3, .|",{rules:[{match:1}]}),a(r).to.changeAST("start =  .| ..3,''|",{rules:[{match:1}]}),a(r).to.changeAST("start =  .| ..3,[]|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| ..3, .|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| ..3,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| ..3,[]|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| ..3, .|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| ..3,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = []| ..3,[]|",{rules:[{match:1}]})})),it("for |0.. , delimiter| correctly",(()=>{a(r).to.changeAST("start =  .|0.. , .|",{rules:[{match:1}]}),a(r).to.changeAST("start =  .|0.. ,''|",{rules:[{match:1}]}),a(r).to.changeAST("start =  .|0.. ,[]|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''|0.. , .|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''|0.. ,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''|0.. ,[]|",{rules:[{match:1}]}),a(r).to.changeAST("start = []|0.. , .|",{rules:[{match:1}]}),a(r).to.changeAST("start = []|0.. ,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = []|0.. ,[]|",{rules:[{match:1}]})})),it("for |1.. , delimiter| correctly",(()=>{a(r).to.changeAST("start =  .|1.. , .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|1.. ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|1.. ,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|1.. , .|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''|1.. ,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''|1.. ,[]|",{rules:[{match:1}]}),a(r).to.changeAST("start = []|1.. , .|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []|1.. ,''|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []|1.. ,[]|",{rules:[{match:-1}]})})),it("for |2.. , delimiter| correctly",(()=>{a(r).to.changeAST("start =  .|2.. , .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|2.. ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|2.. ,[]|",{rules:[{match:-1}]}),a(r).to.changeAST("start = ''|2.. , .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|2.. ,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''|2.. ,[]|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []|2.. , .|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []|2.. ,''|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []|2.. ,[]|",{rules:[{match:-1}]})})),it("for |2..3, delimiter| correctly",(()=>{a(r).to.changeAST("start =  .|2..3, .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|2..3,''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|2..3,[]|",{rules:[{match:-1}]}),a(r).to.changeAST("start = ''|2..3, .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|2..3,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''|2..3,[]|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []|2..3, .|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []|2..3,''|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []|2..3,[]|",{rules:[{match:-1}]})})),it("for | 42 , delimiter| correctly",(()=>{a(r).to.changeAST("start =  .| 42 , .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .| 42 ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .| 42 ,[]|",{rules:[{match:-1}]}),a(r).to.changeAST("start = ''| 42 , .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''| 42 ,''|",{rules:[{match:1}]}),a(r).to.changeAST("start = ''| 42 ,[]|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []| 42 , .|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []| 42 ,''|",{rules:[{match:-1}]}),a(r).to.changeAST("start = []| 42 ,[]|",{rules:[{match:-1}]})}))})),describe("with variable boundaries",(()=>{it("for |   ..max, delimiter| correctly",(()=>{a(r).to.changeAST("start =  .|   ..max, .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|   ..max,''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|   ..max,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|   ..max, .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|   ..max,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|   ..max,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|   ..max, .|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|   ..max,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|   ..max,[]|",{rules:[{match:0}]})})),it("for |min..   , delimiter| correctly",(()=>{a(r).to.changeAST("start =  .|min..   , .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|min..   ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|min..   ,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|min..   , .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|min..   ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|min..   ,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|min..   , .|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|min..   ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|min..   ,[]|",{rules:[{match:0}]})})),it("for |min..max, delimiter| correctly",(()=>{a(r).to.changeAST("start =  .|min..max, .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|min..max,''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|min..max,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|min..max, .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|min..max,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|min..max,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|min..max, .|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|min..max,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|min..max,[]|",{rules:[{match:0}]})})),it("for | exact  , delimiter| correctly",(()=>{a(r).to.changeAST("start =  .| exact  , .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .| exact  ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .| exact  ,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''| exact  , .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''| exact  ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''| exact  ,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = []| exact  , .|",{rules:[{match:0}]}),a(r).to.changeAST("start = []| exact  ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = []| exact  ,[]|",{rules:[{match:0}]})}))})),describe("with function boundaries",(()=>{it("for |  ..{}, delimiter| correctly",(()=>{a(r).to.changeAST("start =  .|   ..{}, .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|   ..{},''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|   ..{},[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|   ..{}, .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|   ..{},''|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|   ..{},[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|   ..{}, .|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|   ..{},''|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|   ..{},[]|",{rules:[{match:0}]})})),it("for |{}..  , delimiter| correctly",(()=>{a(r).to.changeAST("start =  .|{}..   , .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|{}..   ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|{}..   ,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|{}..   , .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|{}..   ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|{}..   ,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|{}..   , .|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|{}..   ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|{}..   ,[]|",{rules:[{match:0}]})})),it("for |{}..{}, delimiter| correctly",(()=>{a(r).to.changeAST("start =  .|{}..{}, .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|{}..{},''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .|{}..{},[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|{}..{}, .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|{}..{},''|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''|{}..{},[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|{}..{}, .|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|{}..{},''|",{rules:[{match:0}]}),a(r).to.changeAST("start = []|{}..{},[]|",{rules:[{match:0}]})})),it("for |  {}  , delimiter| correctly",(()=>{a(r).to.changeAST("start =  .| {}  , .|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .| {}  ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start =  .| {}  ,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''| {}  , .|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''| {}  ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = ''| {}  ,[]|",{rules:[{match:0}]}),a(r).to.changeAST("start = []| {}  , .|",{rules:[{match:0}]}),a(r).to.changeAST("start = []| {}  ,''|",{rules:[{match:0}]}),a(r).to.changeAST("start = []| {}  ,[]|",{rules:[{match:0}]})}))}))}))})),it("calculate |match| property for |group| correctly",(()=>{a(r).to.changeAST("start = (.)",{rules:[{match:0}]}),a(r).to.changeAST("start = ('')",{rules:[{match:1}]}),a(r).to.changeAST("start = ([])",{rules:[{match:-1}]})})),it("calculate |match| property for |rule_ref| correctly",(()=>{a(r).to.changeAST(["start = end","end = . "].join("\n"),{rules:[{match:0},{match:0}]}),a(r).to.changeAST(["start = end","end = ''"].join("\n"),{rules:[{match:1},{match:1}]}),a(r).to.changeAST(["start = end","end = []"].join("\n"),{rules:[{match:-1},{match:-1}]}),a(r).to.changeAST("start = .  start",{rules:[{match:0}]}),a(r).to.changeAST("start = '' start",{rules:[{match:0}]}),a(r).to.changeAST("start = [] start",{rules:[{match:-1}]}),a(r).to.changeAST("start = . start []",{rules:[{match:-1}]})}))})),inferenceMatchResult_spec}requireInferenceMatchResult_spec();var mergeCharacterClasses_spec={},hasRequiredMergeCharacterClasses_spec;function requireMergeCharacterClasses_spec(){if(hasRequiredMergeCharacterClasses_spec)return mergeCharacterClasses_spec;hasRequiredMergeCharacterClasses_spec=1;const e=require$$0,t=requireHelpers(),r=requireMergeCharacterClasses();e.use(t);const a=e.expect;return describe("compiler pass |mergeCharacterClasses|",(()=>{it("Merges single character literals, class, and ref_rules",(()=>{a(r).to.changeAST(["one = three / $('a' / 'd') / [c-f] / [efh] / [c-h] / [c-g]","two = 'P' / 'P' / three / 'P' / [Q-T]","three = $('x' / [u-w])","four = 'a' / [aaa] / 'a'"].join("\n"),{rules:[{name:"one",expression:{type:"class",parts:["a",["c","h"],["u","x"]],ignoreCase:!1,inverted:!1,location:{start:{line:1,column:7},end:{line:1,column:59}}}},{name:"two",expression:{type:"class",parts:[["P","T"],["u","x"]],ignoreCase:!1,inverted:!1,location:{start:{line:2,column:7},end:{line:2,column:38}}}},{name:"three",expression:{type:"class",parts:[["u","x"]],ignoreCase:!1,inverted:!1,location:{start:{line:3,column:9},end:{line:3,column:23}}}},{name:"four",expression:{type:"literal",value:"a",ignoreCase:!1,location:{start:{line:4,column:8},end:{line:4,column:25}}}}]},{allowedStartRules:["one"]})})),it("Merges case-independent single character literals, class, and ref_rules",(()=>{a(r).to.changeAST(["one = three / $('a'i / 'd'i) / [c-f]i / [efh]i / [c-h]i / [c-g]i","two = 'P'i / 'P'i / three / 'P'i / [Q-T]i","three = $('x'i / [u-w]i)","four = 'a'i / [aaa]i / 'a'i"].join("\n"),{rules:[{name:"one",expression:{type:"class",parts:["a",["c","h"],["u","x"]],ignoreCase:!0,inverted:!1,location:{start:{line:1,column:7},end:{line:1,column:65}}}},{name:"two",expression:{type:"class",parts:[["P","T"],["u","x"]],ignoreCase:!0,inverted:!1,location:{start:{line:2,column:7},end:{line:2,column:42}}}},{name:"three",expression:{type:"class",parts:[["u","x"]],ignoreCase:!0,inverted:!1,location:{start:{line:3,column:9},end:{line:3,column:25}}}},{name:"four",expression:{type:"literal",value:"a",ignoreCase:!0,location:{start:{line:4,column:8},end:{line:4,column:28}}}}]},{allowedStartRules:["one"]})})),it("Doesn't merge inappropriately",(()=>{a(r).to.changeAST(["case = action / 'a'i / [c-g]","invert = action / 'P' / [^Q-T]","action = 'x' { return 42; } / [u-w]"].join("\n"),{rules:[{name:"case",expression:{type:"choice",alternatives:[{type:"rule_ref",name:"action"},{type:"literal",value:"a",ignoreCase:!0},{type:"class",parts:[["c","g"]],ignoreCase:!1,inverted:!1}]}},{name:"invert",expression:{type:"choice",alternatives:[{type:"rule_ref",name:"action"},{type:"literal",value:"P",ignoreCase:!1},{type:"class",parts:[["Q","T"]],ignoreCase:!1,inverted:!0}]}},{name:"action",expression:{type:"choice",alternatives:[{type:"action"},{type:"class",parts:[["u","w"]],ignoreCase:!1,inverted:!1}]}}]},{allowedStartRules:["case"]})})),it("Handles undefined rule_refs",(()=>{a(r).to.changeAST(["start = unknown / 'a' / [c-g]"].join("\n"),{rules:[{name:"start",expression:{type:"choice",alternatives:[{type:"rule_ref",name:"unknown"},{type:"class",parts:["a",["c","g"]],ignoreCase:!1,inverted:!1}]}}]},{allowedStartRules:["start"]})})),it("handles empty literals",(()=>{a(r).to.changeAST(["start = [a] / ''"].join("\n"),{rules:[{name:"start",expression:{type:"choice",alternatives:[{type:"class",parts:["a"],ignoreCase:!1,inverted:!1,unicode:!1},{type:"literal",value:""}]}}]},{allowedStartRules:["start"]})})),it("elides surrogates from unicode ranges",(()=>{a(r).to.changeAST(["start = [\0-􏿿]"].join("\n"),{rules:[{name:"start",expression:{type:"class",parts:[["\0","퟿"],["","􏿿"]],inverted:!1,unicode:!0}}]},{allowedStartRules:["start"]}),a(r).to.haveErrors("start = [\0-􏿿]",[["info","Removing surrogate range from [\\0-\\u{10FFFF}]",{start:{column:9,line:1,offset:8},end:{column:15,line:1,offset:14},source:void 0}]])}))})),mergeCharacterClasses_spec}requireMergeCharacterClasses_spec();var removeProxyRules_spec={},hasRequiredRemoveProxyRules_spec;function requireRemoveProxyRules_spec(){if(hasRequiredRemoveProxyRules_spec)return removeProxyRules_spec;hasRequiredRemoveProxyRules_spec=1;const e=require$$0,t=requireHelpers(),r=requireRemoveProxyRules();e.use(t);const a=e.expect;return describe("compiler pass |removeProxyRules|",(()=>{it("updates references",(()=>{a(r).to.changeAST(["start = proxy","proxy = proxied","proxied = 'a'"].join("\n"),{rules:[{name:"start",expression:{type:"rule_ref",name:"proxied"}},{name:"proxy"},{name:"proxied"}]},{allowedStartRules:["start"]})}))})),removeProxyRules_spec}requireRemoveProxyRules_spec();var removeUnusedRules_spec={},hasRequiredRemoveUnusedRules_spec;function requireRemoveUnusedRules_spec(){if(hasRequiredRemoveUnusedRules_spec)return removeUnusedRules_spec;hasRequiredRemoveUnusedRules_spec=1;const e=require$$0,t=requireHelpers(),r=requireRemoveUnusedRules();e.use(t);const a=e.expect;return describe("compiler pass |removeUnusedRules|",(()=>{it("removes superfluous input rules",(()=>{a(r).to.changeAST('\none = "a"\ntwo = "b"',{rules:[{name:"one"}]},{allowedStartRules:["one"]})})),it("does not remove allowedStartRules",(()=>{a(r).to.changeAST('\none = "a"\ntwo = "b"',{rules:[{name:"one"},{name:"two"}]},{allowedStartRules:["one","two"]})})),it("removes entire trees of unused rules",(()=>{a(r).to.changeAST('\none = "a" four\ntwo = three three four\nthree = "b" four\nfour = "c"',{rules:[{name:"one"},{name:"four"}]},{allowedStartRules:["one"]})})),it("does not visit subtrees twice",(()=>{a(r).to.changeAST('\none = "a" four two three\ntwo = four "b"\nthree = four "c"\nfour = "4" five\nfive = "5"\n',{rules:[{name:"one"},{name:"two"},{name:"three"},{name:"four"},{name:"five"}]},{allowedStartRules:["one"]})}))})),removeUnusedRules_spec}requireRemoveUnusedRules_spec();var reportDuplicateImports_spec={},hasRequiredReportDuplicateImports_spec;function requireReportDuplicateImports_spec(){if(hasRequiredReportDuplicateImports_spec)return reportDuplicateImports_spec;hasRequiredReportDuplicateImports_spec=1;const e=require$$0,t=requireHelpers(),r=requireReportDuplicateImports();e.use(t);const a=e.expect;return describe("compiler pass |reportDuplicateImports|",(()=>{it("Errors when the same import all name is used twice",(()=>{a(r).to.reportError('\nimport {unrelated} from "./foo.js"\nimport * as foo from "./foo.js"\nimport * as foo from "./bar.js"\n\na = foo.one\n',{message:'Module "foo" is already imported'})}))})),reportDuplicateImports_spec}requireReportDuplicateImports_spec();var reportDuplicateLabels_spec={},hasRequiredReportDuplicateLabels_spec;function requireReportDuplicateLabels_spec(){if(hasRequiredReportDuplicateLabels_spec)return reportDuplicateLabels_spec;hasRequiredReportDuplicateLabels_spec=1;const e=require$$0,t=requireHelpers(),r=requireReportDuplicateLabels();e.use(t);const a=e.expect;return describe("compiler pass |reportDuplicateLabels|",(()=>{describe("in a sequence",(()=>{it("reports labels duplicate with labels of preceding elements",(()=>{a(r).to.reportError("start = a:'a' a:'a'",{message:'Label "a" is already defined',location:{source:void 0,start:{offset:14,line:1,column:15},end:{offset:15,line:1,column:16}},diagnostics:[{message:"Original label location",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:9,line:1,column:10}}}]})})),it("doesn't report labels duplicate with labels in subexpressions",(()=>{a(r).to.not.reportError("start = ('a' / a:'a' / 'a') a:'a'"),a(r).to.not.reportError("start = (a:'a' { }) a:'a'"),a(r).to.not.reportError("start = ('a' a:'a' 'a') a:'a'"),a(r).to.not.reportError("start = b:(a:'a') a:'a'"),a(r).to.not.reportError("start = $(a:'a') a:'a'"),a(r).to.not.reportError("start = &(a:'a') a:'a'"),a(r).to.not.reportError("start = !(a:'a') a:'a'"),a(r).to.not.reportError("start = (a:'a')? a:'a'"),a(r).to.not.reportError("start = (a:'a')* a:'a'"),a(r).to.not.reportError("start = (a:'a')+ a:'a'"),a(r).to.not.reportError("start = (a:'a')|2..3| a:'a'"),a(r).to.not.reportError("start = 'a'|2..3, a:'a'| a:'a'"),a(r).to.not.reportError("start = (a:'a') a:'a'")}))})),describe("in a choice",(()=>{it("doesn't report labels duplicate with labels of preceding alternatives",(()=>{a(r).to.not.reportError("start = a:'a' / a:'a'")}))})),describe("in outer sequence",(()=>{it("reports labels duplicate with labels of preceding elements",(()=>{a(r).to.reportError("start = a:'a' (a:'a')",{message:'Label "a" is already defined',location:{source:void 0,start:{offset:15,line:1,column:16},end:{offset:16,line:1,column:17}},diagnostics:[{message:"Original label location",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:9,line:1,column:10}}}]})})),it("doesn't report labels duplicate with the label of the current element",(()=>{a(r).to.not.reportError("start = a:(a:'a')")})),it("doesn't report labels duplicate with labels of following elements",(()=>{a(r).to.not.reportError("start = (a:'a') a:'a'")}))}))})),reportDuplicateLabels_spec}requireReportDuplicateLabels_spec();var reportDuplicateRules_spec={},hasRequiredReportDuplicateRules_spec;function requireReportDuplicateRules_spec(){if(hasRequiredReportDuplicateRules_spec)return reportDuplicateRules_spec;hasRequiredReportDuplicateRules_spec=1;const e=require$$0,t=requireHelpers(),r=requireReportDuplicateRules();e.use(t);const a=e.expect;return describe("compiler pass |reportDuplicateRules|",(()=>{it("reports duplicate rules",(()=>{a(r).to.reportError(["start = 'a'","start = 'b'"].join("\n"),{message:'Rule "start" is already defined',location:{source:void 0,start:{offset:12,line:2,column:1},end:{offset:17,line:2,column:6}},diagnostics:[{message:"Original rule location",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:5,line:1,column:6}}}]})}))})),reportDuplicateRules_spec}requireReportDuplicateRules_spec();var reportIncorrectPlucking_spec={},hasRequiredReportIncorrectPlucking_spec;function requireReportIncorrectPlucking_spec(){if(hasRequiredReportIncorrectPlucking_spec)return reportIncorrectPlucking_spec;hasRequiredReportIncorrectPlucking_spec=1;const e=require$$0,t=requireHelpers(),r=requireReportIncorrectPlucking();e.use(t);const a=e.expect;return describe("compiler pass |reportIncorrectPlucking|",(()=>{it('prevents "@" from being used with an action block',(()=>{a(r).to.reportError("start1 = 'a' @'b' 'c' { /* empty action block */ }",{message:'"@" cannot be used with an action block',location:{source:void 0,start:{offset:13,line:1,column:14},end:{offset:14,line:1,column:15}},diagnostics:[{message:"Action block location",location:{source:void 0,start:{offset:23,line:1,column:24},end:{offset:49,line:1,column:50}}}]}),a(r).to.reportError("start2 = 'a' @('b' @'c' { /* empty action block */ })",{message:'"@" cannot be used with an action block',location:{source:void 0,start:{offset:19,line:1,column:20},end:{offset:20,line:1,column:21}},diagnostics:[{message:"Action block location",location:{source:void 0,start:{offset:25,line:1,column:26},end:{offset:51,line:1,column:52}}}]})})),it("allows valid plucking",(()=>{a(r).not.to.reportError("\n\n      start1 =  @'1'               // return '1'\n      start2 =  @'1' / @'2'        // return '1' or '2'\n      start2 =   '1'   @'2' '3'    // return '2'\n      start3 =   '1' @b:'2' '3'    // return '2', label \"b\" can be used in semantic predicates\n      start4 = a:'1' @b:'2' '3'    // return '2', labels \"a\" and \"b\" can be used in semantic predicates\n      start5 =  @'1'   @'2' '3'    // return ['1', '2']\n      start6 =  @'1' @b:'2' '3'    // return ['1', '2'], label \"b\" can be used in semantic predicates\n      start7 = a:'1'   @'2' &{}    // return '2' if the semantic predicate doesnt fail\n      start8 = @a:$[a-z]i+ &{ return a === 'foo' } // return \"foo\"\n\n    ")}))})),reportIncorrectPlucking_spec}requireReportIncorrectPlucking_spec();var reportInfiniteRecursion_spec={},hasRequiredReportInfiniteRecursion_spec;function requireReportInfiniteRecursion_spec(){if(hasRequiredReportInfiniteRecursion_spec)return reportInfiniteRecursion_spec;hasRequiredReportInfiniteRecursion_spec=1;const e=require$$0,t=requireHelpers(),r=requireReportInfiniteRecursion();e.use(t);const a=e.expect;return describe("compiler pass |reportInfiniteRecursion|",(()=>{it("reports direct left recursion",(()=>{a(r).to.reportError("start = start",{message:"Possible infinite loop when parsing (left recursion: start -> start)",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:5,line:1,column:6}}})})),it("reports indirect left recursion",(()=>{a(r).to.reportError(["start = stop","stop = start"].join("\n"),{message:"Possible infinite loop when parsing (left recursion: start -> stop -> start)",location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:5,line:1,column:6}}})})),describe("in sequences",(()=>{it("reports left recursion if all preceding elements match empty string",(()=>{a(r).to.reportError("start = '' '' '' start")})),it("doesn't report left recursion if some preceding element doesn't match empty string",(()=>{a(r).to.not.reportError("start = 'a' '' '' start"),a(r).to.not.reportError("start = '' 'a' '' start"),a(r).to.not.reportError("start = '' '' 'a' start")})),it("reports left recursion when rule reference is wrapped in an expression",(()=>{a(r).to.reportError("start = '' start?")})),it("computes expressions that always consume input on success correctly",(()=>{a(r).to.reportError(["start = a start","a 'a' = ''"].join("\n")),a(r).to.not.reportError(["start = a start","a 'a' = 'a'"].join("\n")),a(r).to.reportError("start = ('' / 'a' / 'b') start"),a(r).to.reportError("start = ('a' / '' / 'b') start"),a(r).to.reportError("start = ('a' / 'b' / '') start"),a(r).to.not.reportError("start = ('a' / 'b' / 'c') start"),a(r).to.reportError("start = ('' { }) start"),a(r).to.not.reportError("start = ('a' { }) start"),a(r).to.reportError("start = ('' '' '') start"),a(r).to.not.reportError("start = ('a' '' '') start"),a(r).to.not.reportError("start = ('' 'a' '') start"),a(r).to.not.reportError("start = ('' '' 'a') start"),a(r).to.reportError("start = a:'' start"),a(r).to.not.reportError("start = a:'a' start"),a(r).to.reportError("start = $'' start"),a(r).to.not.reportError("start = $'a' start"),a(r).to.reportError("start = &'' start"),a(r).to.reportError("start = &'a' start"),a(r).to.reportError("start = !'' start"),a(r).to.reportError("start = !'a' start"),a(r).to.reportError("start = ''? start"),a(r).to.reportError("start = 'a'? start"),a(r).to.reportError("start = ''* start"),a(r).to.reportError("start = 'a'* start"),a(r).to.reportError("start = ''+ start"),a(r).to.not.reportError("start = 'a'+ start"),a(r).to.reportError("start = ''| .. | start"),a(r).to.reportError("start = ''|0.. | start"),a(r).to.reportError("start = ''|1.. | start"),a(r).to.reportError("start = ''|2.. | start"),a(r).to.reportError("start = ''| ..1| start"),a(r).to.reportError("start = ''| ..3| start"),a(r).to.reportError("start = ''|2..3| start"),a(r).to.reportError("start = ''| 42 | start"),a(r).to.reportError("start = 'a'| .. | start"),a(r).to.reportError("start = 'a'|0.. | start"),a(r).to.not.reportError("start = 'a'|1.. | start"),a(r).to.not.reportError("start = 'a'|2.. | start"),a(r).to.reportError("start = 'a'| ..1| start"),a(r).to.reportError("start = 'a'| ..3| start"),a(r).to.not.reportError("start = 'a'|2..3| start"),a(r).to.not.reportError("start = 'a'| 42 | start"),a(r).to.reportError("start = ('') start"),a(r).to.not.reportError("start = ('a') start"),a(r).to.reportError("start = &{ } start"),a(r).to.reportError("start = !{ } start"),a(r).to.reportError(["start = a start","a = ''"].join("\n")),a(r).to.not.reportError(["start = a start","a = 'a'"].join("\n")),a(r).to.reportError("start = '' start"),a(r).to.not.reportError("start = 'a' start"),a(r).to.not.reportError("start = [a-d] start"),a(r).to.not.reportError("start = . start")}))})),describe("in repeated with delimiter",(()=>{it("doesn't report left recursion for delimiter if expression not match empty string",(()=>{a(r).to.not.reportError("start = 'a'| .. , start|"),a(r).to.not.reportError("start = 'a'|0.. , start|"),a(r).to.not.reportError("start = 'a'|1.. , start|"),a(r).to.not.reportError("start = 'a'|2.. , start|"),a(r).to.not.reportError("start = 'a'| ..3, start|"),a(r).to.not.reportError("start = 'a'|2..3, start|"),a(r).to.not.reportError("start = 'a'| 42 , start|")})),it("reports left recursion for delimiter if expression match empty string",(()=>{a(r).to.reportError("start = ''| .. , start|"),a(r).to.reportError("start = ''|0.. , start|"),a(r).to.reportError("start = ''|1.. , start|"),a(r).to.reportError("start = ''|2.. , start|"),a(r).to.reportError("start = ''| ..3, start|"),a(r).to.reportError("start = ''|2..3, start|"),a(r).to.reportError("start = ''| 42 , start|")})),it("does not inifinite loop",(()=>{a(r).to.reportError('\n        start = expr*\n\n        expr\n          = expr "++"\n      ',{message:"Possible infinite loop when parsing (left recursion: start -> expr -> expr)"})}))})),it("does not fail on deeply-nested grammars",(()=>{let e="";for(let t=0;t<500;t++)e+=`foo${t} = foo${t+1} / foo${t+2}\n`;e+='foo500 = "a"\n',e+='foo501 = "a"\n',e+="bar = 'c'\n",a(r).to.not.reportError(e)})),it("does not continue after finding an error",(()=>{a(r).to.haveErrors("foo = foo 'b'",1),a(r).to.haveErrors("foo = foo / ([a] 'b')",1),a(r).to.haveErrors("foo = foo / ('b'|..|)",1),a(r).to.haveErrors("foo = foo / (bar)",1)}))})),reportInfiniteRecursion_spec}requireReportInfiniteRecursion_spec();var reportInfiniteRepetition_spec={},hasRequiredReportInfiniteRepetition_spec;function requireReportInfiniteRepetition_spec(){if(hasRequiredReportInfiniteRepetition_spec)return reportInfiniteRepetition_spec;hasRequiredReportInfiniteRepetition_spec=1;const e=require$$0,t=requireHelpers(),r=requireReportInfiniteRepetition();e.use(t);const a=e.expect;return describe("compiler pass |reportInfiniteRepetition|",(()=>{it("reports infinite loops for zero_or_more",(()=>{a(r).to.reportError("start = ('')*",{message:"Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:13,line:1,column:14}}})})),it("reports infinite loops for one_or_more",(()=>{a(r).to.reportError("start = ('')+",{message:"Possible infinite loop when parsing (repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:13,line:1,column:14}}})})),describe("reports infinite loops for repeated",(()=>{describe("without delimiter",(()=>{it("with constant boundaries",(()=>{a(r).to.reportError("start = ('')|..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:16,line:1,column:17}}}),a(r).to.reportError("start = ('')|0..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:17,line:1,column:18}}}),a(r).to.reportError("start = ('')|1..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:17,line:1,column:18}}}),a(r).to.reportError("start = ('')|2..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:17,line:1,column:18}}}),a(r).to.not.reportError("start = ('')| ..1|"),a(r).to.not.reportError("start = ('')| ..3|"),a(r).to.not.reportError("start = ('')|2..3|"),a(r).to.not.reportError("start = ('')| 42 |")})),it("with variable boundaries",(()=>{a(r).to.reportError("start = ('')|len..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:19,line:1,column:20}}}),a(r).to.not.reportError("start = ('')|..len|"),a(r).to.not.reportError("start = ('')|len1..len2|"),a(r).to.not.reportError("start = ('')|len|")})),it("with function boundaries",(()=>{a(r).to.reportError("start = ('')|{}..|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:18,line:1,column:19}}}),a(r).to.not.reportError("start = ('')|..{}|"),a(r).to.not.reportError("start = ('')|{}..{}|"),a(r).to.not.reportError("start = ('')|{}|")}))})),describe("with empty delimiter",(()=>{it("with constant boundaries",(()=>{a(r).to.reportError("start = ('')| .., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:21,line:1,column:22}}}),a(r).to.reportError("start = ('')|0.., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:21,line:1,column:22}}}),a(r).to.reportError("start = ('')|1.., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:21,line:1,column:22}}}),a(r).to.reportError("start = ('')|2.., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:21,line:1,column:22}}}),a(r).to.not.reportError("start = ('')| ..1, ''|"),a(r).to.not.reportError("start = ('')| ..3, ''|"),a(r).to.not.reportError("start = ('')|2..3, ''|"),a(r).to.not.reportError("start = ('')| 42 , ''|")})),it("with variable boundaries",(()=>{a(r).to.reportError("start = ('')|len.., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:23,line:1,column:24}}}),a(r).to.not.reportError("start = ('')|..len, ''|"),a(r).to.not.reportError("start = ('')|len1..len2, ''|"),a(r).to.not.reportError("start = ('')|len, ''|")})),it("with function boundaries",(()=>{a(r).to.reportError("start = ('')|{}.., ''|",{message:"Possible infinite loop when parsing (unbounded range repetition used with an expression that may not consume any input)",location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:22,line:1,column:23}}}),a(r).to.not.reportError("start = ('')|..{}, ''|"),a(r).to.not.reportError("start = ('')|{}..{}, ''|"),a(r).to.not.reportError("start = ('')|{}, ''|")}))})),describe("with non-empty delimiter",(()=>{it("with constant boundaries",(()=>{a(r).to.not.reportError("start = ('')| .., 'a'|"),a(r).to.not.reportError("start = ('')|0.., 'a'|"),a(r).to.not.reportError("start = ('')|1.., 'a'|"),a(r).to.not.reportError("start = ('')|2.., 'a'|"),a(r).to.not.reportError("start = ('')| ..1, 'a'|"),a(r).to.not.reportError("start = ('')| ..3, 'a'|"),a(r).to.not.reportError("start = ('')|2..3, 'a'|"),a(r).to.not.reportError("start = ('')| 42 , 'a'|")})),it("with variable boundaries",(()=>{a(r).to.not.reportError("start = ('')|len.., 'a'|"),a(r).to.not.reportError("start = ('')|..len, 'a'|"),a(r).to.not.reportError("start = ('')|len1..len2, 'a'|"),a(r).to.not.reportError("start = ('')|len, 'a'|")})),it("with function boundaries",(()=>{a(r).to.not.reportError("start = ('')|{}.., 'a'|"),a(r).to.not.reportError("start = ('')|..{}, 'a'|"),a(r).to.not.reportError("start = ('')|{}..{}, 'a'|"),a(r).to.not.reportError("start = ('')|{}, 'a'|")}))}))})),it("computes expressions that always consume input on success correctly",(()=>{a(r).to.reportError(["start = a*","a 'a' = ''"].join("\n")),a(r).to.not.reportError(["start = a*","a 'a' = 'a'"].join("\n")),a(r).to.reportError("start = ('' / 'a' / 'b')*"),a(r).to.reportError("start = ('a' / '' / 'b')*"),a(r).to.reportError("start = ('a' / 'b' / '')*"),a(r).to.not.reportError("start = ('a' / 'b' / 'c')*"),a(r).to.reportError("start = ('' { })*"),a(r).to.not.reportError("start = ('a' { })*"),a(r).to.reportError("start = ('' '' '')*"),a(r).to.not.reportError("start = ('a' '' '')*"),a(r).to.not.reportError("start = ('' 'a' '')*"),a(r).to.not.reportError("start = ('' '' 'a')*"),a(r).to.reportError("start = (a:'')*"),a(r).to.not.reportError("start = (a:'a')*"),a(r).to.reportError("start = ($'')*"),a(r).to.not.reportError("start = ($'a')*"),a(r).to.reportError("start = (&'')*"),a(r).to.reportError("start = (&'a')*"),a(r).to.reportError("start = (!'')*"),a(r).to.reportError("start = (!'a')*"),a(r).to.reportError("start = (''?)*"),a(r).to.reportError("start = ('a'?)*"),a(r).to.reportError("start = (''*)*"),a(r).to.reportError("start = ('a'*)*"),a(r).to.reportError("start = (''+)*"),a(r).to.not.reportError("start = ('a'+)*"),a(r).to.reportError("start = ('')*"),a(r).to.not.reportError("start = ('a')*"),a(r).to.reportError("start = (&{ })*"),a(r).to.reportError("start = (!{ })*"),a(r).to.reportError("start = 'a'|.., ('')*|"),a(r).to.not.reportError("start = 'a'|.., ('b')*|"),a(r).to.reportError(["start = a*","a = ''"].join("\n")),a(r).to.not.reportError(["start = a*","a = 'a'"].join("\n")),a(r).to.reportError("start = ''*"),a(r).to.not.reportError("start = 'a'*"),a(r).to.not.reportError("start = [a-d]*"),a(r).to.not.reportError("start = .*")}))})),reportInfiniteRepetition_spec}requireReportInfiniteRepetition_spec();var reportUndefinedRules_spec={},hasRequiredReportUndefinedRules_spec;function requireReportUndefinedRules_spec(){if(hasRequiredReportUndefinedRules_spec)return reportUndefinedRules_spec;hasRequiredReportUndefinedRules_spec=1;const e=require$$0,t=requireHelpers(),r=requireReportUndefinedRules();e.use(t);const a=e.expect;return describe("compiler pass |reportUndefinedRules|",(()=>{it("reports undefined rules",(()=>{a(r).to.reportError("start = undefined",{message:'Rule "undefined" is not defined',location:{source:void 0,start:{offset:8,line:1,column:9},end:{offset:17,line:1,column:18}}})}))})),reportUndefinedRules_spec}requireReportUndefinedRules_spec();var stack_spec={},hasRequiredStack_spec;function requireStack_spec(){if(hasRequiredStack_spec)return stack_spec;hasRequiredStack_spec=1;const e=require$$0,t=requireStack(),r=e.expect;return describe("utility class Stack",(()=>{describe("for an empty stack",(()=>{let e;beforeEach((()=>{e=new t("rule","v","let",[42])})),describe("throws an error when attempting",(()=>{it("`pop`",(()=>{r((()=>e.pop())).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -1.\nBytecode: 42")})),it("`top`",(()=>{r((()=>e.top())).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -1.\nBytecode: 42")})),it("`result`",(()=>{r((()=>e.result())).to.throw(RangeError,"Rule 'rule': The variable stack is empty, can't get the result")})),it("`index`",(()=>{r((()=>e.index(-2))).to.throw(RangeError,"Rule 'rule': The variable stack overflow: attempt to get a variable at a negative index -2.\nBytecode: 42"),r((()=>e.index(0))).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -1.\nBytecode: 42"),r((()=>e.index(2))).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -3.\nBytecode: 42")})),it("`sourceMapPop`",(()=>{r((()=>e.sourceMapPop())).to.throw(RangeError,"Rule 'rule': Attempting to pop an empty source map stack.\nBytecode: 42")}))})),it("`defines` returns an empty string",(()=>{r(e.defines()).to.equal("")}))})),it("throws an error when attempting `pop` more than `push`",(()=>{const e=new t("rule","v","let",[42]);e.push("1"),r((()=>e.pop(3))).to.throw(RangeError,"Rule 'rule': The variable stack underflow: attempt to use a variable 'v<x>' at an index -2.\nBytecode: 42")})),it("returns a variable with an index 0 for `result`",(()=>{const e=new t("rule","v","let",[]);e.push("1"),r(e.result()).to.equal("v0")})),it("`defines` returns a define expression for all used variables",(()=>{const e=new t("rule","v","let",[]);e.push("1"),e.push("2"),e.pop(),e.push("3"),r(e.defines()).to.equal("let v0, v1;")})),describe("`checkedIf` method",(()=>{let e;beforeEach((()=>{e=new t("rule","v","let",[42]),e.push("1")})),describe("does not throws an error",(()=>{it("without the else brach",(()=>{r((()=>e.checkedIf(0,(()=>{})))).to.not.throw(),r((()=>e.checkedIf(0,(()=>e.pop())))).to.not.throw(),r((()=>e.checkedIf(0,(()=>e.push("2"))))).to.not.throw()})),describe("when the stack pointer",(()=>{it("was not moving in both the arms",(()=>{function t(){}function a(){e.push("1"),e.pop()}function o(){e.push("1"),e.push("2"),e.pop(2)}function s(){e.push("1"),e.pop(),e.push("2"),e.pop()}r((()=>e.checkedIf(0,t,t))).to.not.throw(),r((()=>e.checkedIf(0,a,a))).to.not.throw(),r((()=>e.checkedIf(0,o,o))).to.not.throw(),r((()=>e.checkedIf(0,s,s))).to.not.throw()})),it("increases on the same value in both the arms",(()=>{r((()=>e.checkedIf(0,(()=>e.push("1")),(()=>e.push("2"))))).to.not.throw()})),it("decreases on the same value in both the arms",(()=>{e.push("2"),r((()=>e.checkedIf(0,(()=>e.pop(2)),(()=>{e.pop(),e.pop()})))).to.not.throw()}))}))})),describe("throws an error when the stack pointer",(()=>{it("was not moving in `if` and decreases in `then`",(()=>{r((()=>{e.checkedIf(0,(()=>{}),(()=>e.pop()))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 0, after else: -1). Bytecode: 42")})),it("decreases in `if` and was not moving in `then`",(()=>{r((()=>{e.checkedIf(0,(()=>e.pop()),(()=>{}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: -1, after else: 0). Bytecode: 42")})),it("was not moving in `if` and increases in `then`",(()=>{r((()=>{e.checkedIf(0,(()=>{}),(()=>e.push("2")))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 0, after else: 1). Bytecode: 42")})),it("increases in `if` and was not moving in `then`",(()=>{r((()=>{e.checkedIf(0,(()=>e.push("2")),(()=>{}))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 1, after else: 0). Bytecode: 42")})),it("decreases in `if` and increases in `then`",(()=>{r((()=>{e.checkedIf(0,(()=>e.pop()),(()=>e.push("2")))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: -1, after else: 1). Bytecode: 42")})),it("increases in `if` and decreases in `then`",(()=>{r((()=>{e.checkedIf(0,(()=>e.push("2")),(()=>e.pop()))})).to.throw(Error,"Rule 'rule', position 0: Branches of a condition can't move the stack pointer differently (before: 0, after then: 1, after else: -1). Bytecode: 42")}))}))})),describe("`checkedLoop` method",(()=>{let e;beforeEach((()=>{e=new t("rule","v","let",[42]),e.push("1")})),it("does not throws an error when the stack pointer was not moving",(()=>{function t(){}function a(){e.push("1"),e.pop()}function o(){e.push("1"),e.push("2"),e.pop(2)}function s(){e.push("1"),e.pop(),e.push("2"),e.pop()}r((()=>e.checkedLoop(0,t))).to.not.throw(),r((()=>e.checkedLoop(0,a))).to.not.throw(),r((()=>e.checkedLoop(0,o))).to.not.throw(),r((()=>e.checkedLoop(0,s))).to.not.throw()})),it("throws an error when the stack pointer increases",(()=>{r((()=>e.checkedLoop(0,(()=>e.push("1"))))).to.throw(Error,"Rule 'rule', position 0: Body of a loop can't move the stack pointer (before: 0, after: 1). Bytecode: 42")})),it("throws an error when the stack pointer decreases",(()=>{r((()=>e.checkedLoop(0,(()=>e.pop())))).to.throw(Error,"Rule 'rule', position 0: Body of a loop can't move the stack pointer (before: 0, after: -1). Bytecode: 42")}))})),describe("SourceNode handling",(()=>{it("sourceNode handles unknown column",(()=>{r(t.sourceNode({source:"",start:{line:1,column:0,offset:0},end:{line:1,column:0,offset:0}},["foo"],"test").column).to.equal(null)}))}))})),stack_spec}requireStack_spec();var utils_spec={},hasRequiredUtils_spec;function requireUtils_spec(){if(hasRequiredUtils_spec)return utils_spec;hasRequiredUtils_spec=1;const e=require$$0,{hex:t,stringEscape:r,regexpClassEscape:a,base64:o}=requireUtils$1(),s=e.expect;return describe("utility functions",(()=>{it("hex",(()=>{s(t("0")).to.equal("30"),s(t("\0")).to.equal("0"),s(t("\n")).to.equal("A"),s(t("\ufeff")).to.equal("FEFF")})),it("stringEscape",(()=>{s(r("abc")).to.equal("abc"),s(r('\\"\0\b\t\n\v\f\r')).to.equal('\\\\\\"\\0\\b\\t\\n\\v\\f\\r'),s(r("")).to.equal("\\x01\\x0F"),s(r("")).to.equal("\\x10\\x1F\\x7F"),s(r("Ā࿿")).to.equal("\\u0100\\u0FFF"),s(r("က￿")).to.equal("\\u1000\\uFFFF"),s(r("􏿿")).to.equal("\\u{10FFFF}")})),it("regexpClassEscape",(()=>{s(a("\\\0\b\t\n\v\f\r")).to.equal("\\\\\\0\\b\\t\\n\\v\\f\\r"),s(a("/]^-")).to.equal("\\/\\]\\^\\-"),s(a("")).to.equal("\\x01\\x0F"),s(a("")).to.equal("\\x10\\x1F\\x7F"),s(a("Ā࿿")).to.equal("\\u0100\\u0FFF"),s(a("က￿")).to.equal("\\u1000\\uFFFF"),s(a("􏿿")).to.equal("\\u{10FFFF}")})),it("base64",(()=>{s(o(new Uint8Array([]))).to.equal(""),s(o(new Uint8Array([97]))).to.equal("YQ=="),s(o(new Uint8Array([97,98]))).to.equal("YWI="),s(o(new Uint8Array([97,98,99]))).to.equal("YWJj"),s(o(new Uint8Array([97,98,99,100]))).to.equal("YWJjZA=="),s(o(new Uint8Array([97,98,99,100,101]))).to.equal("YWJjZGU="),s(o(new Uint8Array([97,98,99,100,101,102]))).to.equal("YWJjZGVm")}))})),utils_spec}requireUtils_spec();var grammarError_spec={},hasRequiredGrammarError_spec;function requireGrammarError_spec(){if(hasRequiredGrammarError_spec)return grammarError_spec;hasRequiredGrammarError_spec=1;const e=require$$0,{GrammarError:t,GrammarLocation:r}=requirePeg(),a=e.expect,o={source:void 0,start:{offset:0,line:1,column:1},end:{offset:4,line:1,column:5}};return describe("Grammar Errors",(()=>{it("might not have a location",(()=>{const e=new t("message");a(e.location).to.equal(void 0),a(e.toString()).to.equal("GrammarError: message")})),it("might have locations",(()=>{o.source=void 0;let e=new t("message",o);a(e.location).to.eql(o),a(e.toString()).to.equal("GrammarError: message\n at 1:1"),e=new t("message",null,[{message:"Subinfo",location:o}]),a(e.location).to.equal(null),a(e.toString()).to.equal("GrammarError: message\n from 1:1: Subinfo"),o.source="foo.peggy",e=new t("message",o,[{message:"Subinfo",location:o}]),a(e.toString()).to.equal("GrammarError: message\n at foo.peggy:1:1\n from foo.peggy:1:1: Subinfo")})),describe("formats",(()=>{const e={source:"foo.peggy",text:"some error\nthat"},s={source:"foo.peggy",start:{offset:5,line:1,column:6},end:{offset:11,line:2,column:1}},n=[{message:"Subinfo",location:s}];describe("single problem",(()=>{describe("with main location",(()=>{o.source="foo.peggy";const r=new t("message",o,n);it("with zero-length error at the end",(()=>{const r=new t("message",{source:"foo.peggy",start:{offset:4,line:1,column:5},end:{offset:4,line:1,column:5}});a(r.format([e])).to.equal("error: message\n --\x3e foo.peggy:1:5\n  |\n1 | some error\n  |     ^")})),it("with source",(()=>{a(r.format([e])).to.equal("error: message\n --\x3e foo.peggy:1:1\n  |\n1 | some error\n  | ^^^^\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("without source",(()=>{a(r.format([])).to.equal("error: message\n at foo.peggy:1:1\n at foo.peggy:1:6: Subinfo")}))})),describe("without main location",(()=>{const r=new t("message",null,n);it("with source",(()=>{a(r.format([e])).to.equal("error: message\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("without source",(()=>{a(r.format([])).to.equal("error: message\n at foo.peggy:1:6: Subinfo")}))}))})),describe("several problems",(()=>{describe("with main location",(()=>{o.source="foo.peggy";const i=new t("message",o,n);i.problems.push(["warning","Warning message",s,[{message:"Warning Subinfo",location:s}]]),i.problems.push(["info","Info message",null,[]]),it("null source text",(()=>{a(i.format([{source:null,text:null}])).to.equal("error: message\n at foo.peggy:1:1\n at foo.peggy:1:6: Subinfo\n\nwarning: Warning message\n at foo.peggy:1:6\n at foo.peggy:1:6: Warning Subinfo"),a(i.format([{source:null,text:void 0}])).to.equal("error: message\n at foo.peggy:1:1\n at foo.peggy:1:6: Subinfo\n\nwarning: Warning message\n at foo.peggy:1:6\n at foo.peggy:1:6: Warning Subinfo")})),it("with source",(()=>{a(i.format([e])).to.equal("error: message\n --\x3e foo.peggy:1:1\n  |\n1 | some error\n  | ^^^^\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^\n\nwarning: Warning message\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^\nnote: Warning Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("with GrammarLocation",(()=>{const t=new r("foo.peggy",{offset:12,line:15,column:8});a(String(t)).to.equal("foo.peggy"),o.source=t,s.source=t,i.diagnostics.push({message:"Column not offset",location:{source:t,start:{offset:11,line:2,column:1},end:{offset:15,line:2,column:5}}}),a(i.format([{source:t,text:e.text}])).to.equal("error: message\n --\x3e foo.peggy:15:8\n   |\n15 | some error\n   | ^^^^\nnote: Subinfo\n --\x3e foo.peggy:15:13\n   |\n15 | some error\n   |      ^^^^^\nnote: Column not offset\n --\x3e foo.peggy:16:1\n   |\n16 | that\n   | ^^^^\n\nwarning: Warning message\n --\x3e foo.peggy:15:13\n   |\n15 | some error\n   |      ^^^^^\nnote: Warning Subinfo\n --\x3e foo.peggy:15:13\n   |\n15 | some error\n   |      ^^^^^"),o.source="foo.peggy",s.source="foo.peggy",i.diagnostics.pop()})),it("without source",(()=>{a(i.format([])).to.equal("error: message\n at foo.peggy:1:1\n at foo.peggy:1:6: Subinfo\n\nwarning: Warning message\n at foo.peggy:1:6\n at foo.peggy:1:6: Warning Subinfo")}))})),describe("without main location",(()=>{const r=new t("message",null,n);r.problems.push(["warning","Warning message",null,[{message:"Warning Subinfo",location:s}]]),r.problems.push(["info","Info message",null,[]]),it("with source",(()=>{a(r.format([e])).to.equal("error: message\nnote: Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^\n\nwarning: Warning message\nnote: Warning Subinfo\n --\x3e foo.peggy:1:6\n  |\n1 | some error\n  |      ^^^^^")})),it("without source",(()=>{a(r.format([])).to.equal("error: message\n at foo.peggy:1:6: Subinfo\n\nwarning: Warning message\n at foo.peggy:1:6: Warning Subinfo")}))}))}))}))})),grammarError_spec}requireGrammarError_spec();var parser_spec={},hasRequiredParser_spec;function requireParser_spec(){if(hasRequiredParser_spec)return parser_spec;hasRequiredParser_spec=1;const e=require$$0,t=requireParser(),{RESERVED_WORDS:r}=requirePeg(),a=e.expect;return describe("Peggy grammar parser",(()=>{const o={type:"literal",value:"abcd",ignoreCase:!1},s={type:"literal",value:"efgh",ignoreCase:!1},n={type:"literal",value:"ijkl",ignoreCase:!1},i={type:"literal",value:"mnop",ignoreCase:!1},c={type:"semantic_and",code:" code "},l={type:"semantic_not",code:" code "},u={type:"optional",expression:o},p={type:"zero_or_more",expression:o},d={type:"one_or_more",expression:o},m={type:"text",expression:u},h={type:"simple_not",expression:o},f={type:"simple_and",expression:u},g={type:"simple_not",expression:u},b={type:"labeled",label:"a",expression:o},y={type:"labeled",label:"b",expression:s},A={type:"labeled",label:"a",expression:h},x={type:"sequence",elements:[o,s,n]},v={type:"sequence",elements:[b,y]},S={type:"sequence",elements:[b,y,{type:"labeled",label:"c",expression:n},{type:"labeled",label:"d",expression:i}]},_={type:"group",expression:b},R={type:"group",expression:x},T={type:"action",expression:o,code:" code "},P={type:"action",expression:s,code:" code "},w={type:"action",expression:x,code:" code "},E={type:"choice",alternatives:[o,s,n]},C={type:"choice",alternatives:[T,P]},q={type:"choice",alternatives:[T,P,{type:"action",expression:n,code:" code "},{type:"action",expression:i,code:" code "}]},$={type:"named",name:"start rule",expression:o},L={type:"rule",name:"a",expression:o},I={type:"rule",name:"b",expression:s},k={type:"rule",name:"c",expression:n},M={type:"rule",name:"start",expression:o},O={type:"top_level_initializer",code:" top level code "},F={type:"initializer",code:" code "};function U(e){return{type:"grammar",imports:[],topLevelInitializer:null,initializer:null,rules:[{type:"rule",name:"start",expression:e}]}}function j(e){return U({type:"action",expression:o,code:e})}function N(e,t){return U({type:"literal",value:e,ignoreCase:t})}function D(e,t,r,a=!1){return U({type:"class",parts:e,inverted:t,ignoreCase:r,unicode:a})}function B(e){return U({type:"any"})}function G(e){return U({type:"rule_ref",name:e})}function z(e,t,r="variable",a=null){return U({type:"repeated",min:{type:"string"==typeof e?r:"constant",value:e},max:{type:"string"==typeof t?r:"constant",value:t},expression:o,delimiter:a})}function H(e,t){return z(e,t,"function")}function V(e,t){return z(e,t,"variable",s)}function W(e,t){return z(e,t,"function",s)}const J=N("abcd",!1),Y={type:"grammar",imports:[],topLevelInitializer:null,initializer:null,rules:[L,I]},Z=function(){function e(e){delete e.location,delete e.codeLocation,delete e.nameLocation,delete e.labelLocation}function t(e){delete e.location,delete e.codeLocation,delete e.nameLocation,delete e.labelLocation,a(e.expression)}function r(e){return function(t){delete t.location,delete t.codeLocation,delete t.nameLocation,delete t.labelLocation,t[e].forEach(a)}}const a=(o={grammar(e){delete e.location,delete e.codeLocation,delete e.nameLocation,delete e.labelLocation,e.topLevelInitializer&&a(e.topLevelInitializer),e.initializer&&a(e.initializer),e.rules.forEach(a)},top_level_initializer:e,initializer:e,rule:t,named:t,choice:r("alternatives"),action:t,sequence:r("elements"),labeled:t,text:t,simple_and:t,simple_not:t,optional:t,zero_or_more:t,one_or_more:t,repeated(e){e.min&&(delete e.min.location,delete e.min.codeLocation),delete e.max.location,delete e.max.codeLocation,delete e.location,a(e.expression),e.delimiter&&(delete e.delimiter.location,a(e.delimiter))},group:t,semantic_and:e,semantic_not:e,rule_ref:e,library_ref:e,literal:e,class(t){e(t);for(const r of t.parts)"object"==typeof r&&e(r)},any:e},function(e,...t){return o[e.type](e,...t)});var o;return a}();function K(e,r){const a=e.Assertion;a.addMethod("parseAs",(function(e){const a=t.parse(r.flag(this,"object"));Z(a),this.assert(r.eql(a,e),"expected #{this} to parse as #{exp} but got #{act}","expected #{this} to not parse as #{exp}",e,a,!r.flag(this,"negate"))})),a.addMethod("failToParse",(function(e){let o,s=!1;try{o=t.parse(r.flag(this,"object")),s=!0}catch(e){o=e}s&&Z(o),this.assert(!s,"expected #{this} to fail to parse but got #{act}","expected #{this} to not fail to parse but it failed with #{act}",null,o),s||void 0===e||Object.keys(e).forEach((t=>{new a(o).to.have.property(t).that.is.deep.equal(e[t])}))}))}beforeEach((()=>{e.use(K)})),it("parses Grammar",(()=>{a("\na = 'abcd';\n").to.parseAs({type:"grammar",imports:[],topLevelInitializer:null,initializer:null,rules:[L]}),a("\na = 'abcd'; /* comment */; // comment\n;\nb = 'efgh';\nc = 'ijkl';\n").to.parseAs({type:"grammar",imports:[],topLevelInitializer:null,initializer:null,rules:[L,I,k]}),a("\n{ code };\na = 'abcd';\n").to.parseAs({type:"grammar",imports:[],topLevelInitializer:null,initializer:F,rules:[L]}),a("\n{{ top level code }};\na = 'abcd';\n").to.parseAs({type:"grammar",imports:[],topLevelInitializer:O,initializer:null,rules:[L]}),a("\n{{ top level code }};\n{ code };\na = 'abcd';\n").to.parseAs({type:"grammar",imports:[],topLevelInitializer:O,initializer:F,rules:[L]}),a("").to.failToParse(),a("{{ ").to.failToParse(),a("{ ").to.failToParse(),a("{{}").to.failToParse(),a("{{}}\0").to.failToParse()})),it("parses Top-Level Initializer",(()=>{a("{{ top level code }};start = 'abcd'").to.parseAs({type:"grammar",imports:[],topLevelInitializer:O,initializer:null,rules:[M]})})),it("parses Initializer",(()=>{a("{ code };start = 'abcd'").to.parseAs({type:"grammar",imports:[],topLevelInitializer:null,initializer:F,rules:[M]})})),it("parses Rule",(()=>{a("start\n=\n'abcd';").to.parseAs(U(o)),a("start\n'start rule'\n=\n'abcd';").to.parseAs(U($))})),it("parses Expression",(()=>{a("start = 'abcd' / 'efgh' / 'ijkl'").to.parseAs(U(E))})),it("parses ChoiceExpression",(()=>{a("start = 'abcd' { code }").to.parseAs(U(T)),a("start = 'abcd' { code }\n/\n'efgh' { code }").to.parseAs(U(C)),a("start = 'abcd' { code }\n/\n'efgh' { code }\n/\n'ijkl' { code }\n/\n'mnop' { code }").to.parseAs(U(q)),a("start = 'a' / 'b' /").to.failToParse()})),it("parses ActionExpression",(()=>{a("start = 'abcd' 'efgh' 'ijkl'").to.parseAs(U(x)),a("start = 'abcd' 'efgh' 'ijkl'\n{ code }").to.parseAs(U(w))})),it("parses SequenceExpression",(()=>{a("start = a:'abcd'").to.parseAs(U(b)),a("start = a:'abcd'\nb:'efgh'").to.parseAs(U(v)),a("start = a: 'abcd'\nb :'efgh'").to.parseAs(U(v)),a("start = a:'abcd'\nb:'efgh'\nc:'ijkl'\nd:'mnop'").to.parseAs(U(S)),a("start = a:'foo").to.failToParse()})),it("parses `@` (value plucking)",(()=>{function e(...e){return U({type:"sequence",elements:e})}function t(e,t){return{type:"labeled",pick:!0,label:e,expression:t}}a("start = @'abcd'").to.parseAs(e(t(null,o))),a("start = @a:'abcd'").to.parseAs(e(t("a",o))),a("start = @a: 'abcd'").to.parseAs(e(t("a",o))),a("start = @a :'abcd'").to.parseAs(e(t("a",o))),a("start = @a : 'abcd'").to.parseAs(e(t("a",o))),a("start = 'abcd' @'efgh'").to.parseAs(e(o,t(null,s))),a("start = a:'abcd' @b:'efgh'").to.parseAs(e(b,t("b",s))),a("start = @'abcd' b:'efgh'").to.parseAs(e(t(null,o),y)),a("start = a:'abcd' @'efgh' 'ijkl' @d:'mnop'").to.parseAs(e(b,t(null,s),n,t("d",i)))})),it("parses LabeledExpression",(()=>{a("start = a\n:\n!'abcd'").to.parseAs(U(A)),a("start = !'abcd'").to.parseAs(U(h))})),it("parses PrefixedExpression",(()=>{a("start = !\n'abcd'?").to.parseAs(U(g)),a("start = 'abcd'?").to.parseAs(U(u))})),it("parses PrefixedOperator",(()=>{a("start = $'abcd'?").to.parseAs(U(m)),a("start = &'abcd'?").to.parseAs(U(f)),a("start = !'abcd'?").to.parseAs(U(g))})),it("parses SuffixedExpression",(()=>{a("start = 'abcd'\n?").to.parseAs(U(u)),a("start = 'abcd'").to.parseAs(U(o))})),it("parses SuffixedOperator",(()=>{a("start = 'abcd'?").to.parseAs(U(u)),a("start = 'abcd'*").to.parseAs(U(p)),a("start = 'abcd'+").to.parseAs(U(d))})),it("parses PrimaryExpression",(()=>{a("start = 'abcd'").to.parseAs(J),a("start = [a-d]").to.parseAs(D([["a","d"]],!1,!1)),a("start = .").to.parseAs(B()),a("start = a").to.parseAs(G("a")),a("start = &{ code }").to.parseAs(U(c)),a("start = (\na:'abcd'\n)").to.parseAs(U(_)),a("start = (\n'abcd' 'efgh' 'ijkl'\n)").to.parseAs(U(R)),a("start = (\n'abcd'\n)").to.parseAs(J),a("start = ('foo'").to.failToParse(),a("start = ('foo").to.failToParse()})),describe("parses RepeatedExpression",(()=>{describe("without delimiter",(()=>{it("with constant boundaries",(()=>{let e=z(2,3);a("start = 'abcd'|2..3|  ").to.parseAs(e),a("start = 'abcd'\n|2..3|").to.parseAs(e),a("start = 'abcd'|\n2..3|").to.parseAs(e),a("start = 'abcd'|2\n..3|").to.parseAs(e),a("start = 'abcd'|2..\n3|").to.parseAs(e),a("start = 'abcd'|2..3\n|").to.parseAs(e),e=U({type:"repeated",min:null,max:{type:"constant",value:3},expression:o,delimiter:null}),a("start = 'abcd'\n|3|").to.parseAs(e),a("start = 'abcd'|\n3|").to.parseAs(e),a("start = 'abcd'|3\n|").to.parseAs(e)})),it("with variable boundaries",(()=>{let e=z("min","max");a("start = 'abcd'|min..max|  ").to.parseAs(e),a("start = 'abcd'\n|min..max|").to.parseAs(e),a("start = 'abcd'|\nmin..max|").to.parseAs(e),a("start = 'abcd'|min\n..max|").to.parseAs(e),a("start = 'abcd'|min..\nmax|").to.parseAs(e),a("start = 'abcd'|min..max\n|").to.parseAs(e),e=U({type:"repeated",min:null,max:{type:"variable",value:"exact"},expression:o,delimiter:null}),a("start = 'abcd'\n|exact|").to.parseAs(e),a("start = 'abcd'|\nexact|").to.parseAs(e),a("start = 'abcd'|exact\n|").to.parseAs(e)})),it("with function boundaries",(()=>{let e=H("min","max");a("start = 'abcd'|{min}..{max}|  ").to.parseAs(e),a("start = 'abcd'\n|{min}..{max}|").to.parseAs(e),a("start = 'abcd'|\n{min}..{max}|").to.parseAs(e),a("start = 'abcd'|{min}\n..{max}|").to.parseAs(e),a("start = 'abcd'|{min}..\n{max}|").to.parseAs(e),a("start = 'abcd'|{min}..{max}\n|").to.parseAs(e),e=U({type:"repeated",min:null,max:{type:"function",value:"exact"},expression:o,delimiter:null}),a("start = 'abcd'\n|{exact}|").to.parseAs(e),a("start = 'abcd'|\n{exact}|").to.parseAs(e),a("start = 'abcd'|{exact}\n|").to.parseAs(e)})),it("with mixed boundaries",(()=>{let e=z(2,"max");a("start = 'abcd'|2..max|  ").to.parseAs(e),a("start = 'abcd'\n|2..max|").to.parseAs(e),a("start = 'abcd'|\n2..max|").to.parseAs(e),a("start = 'abcd'|2\n..max|").to.parseAs(e),a("start = 'abcd'|2..\nmax|").to.parseAs(e),a("start = 'abcd'|2..max\n|").to.parseAs(e),e=z("min",3),a("start = 'abcd'|min..3|  ").to.parseAs(e),a("start = 'abcd'\n|min..3|").to.parseAs(e),a("start = 'abcd'|\nmin..3|").to.parseAs(e),a("start = 'abcd'|min\n..3|").to.parseAs(e),a("start = 'abcd'|min..\n3|").to.parseAs(e),a("start = 'abcd'|min..3\n|").to.parseAs(e)}))})),describe("with delimiter",(()=>{it("with constant boundaries",(()=>{let e=V(2,3);a("start = 'abcd'|2..3,'efgh'|  ").to.parseAs(e),a("start = 'abcd'\n|2..3,'efgh'|").to.parseAs(e),a("start = 'abcd'|\n2..3,'efgh'|").to.parseAs(e),a("start = 'abcd'|2\n..3,'efgh'|").to.parseAs(e),a("start = 'abcd'|2..\n3,'efgh'|").to.parseAs(e),a("start = 'abcd'|2..3\n,'efgh'|").to.parseAs(e),a("start = 'abcd'|2..3,\n'efgh'|").to.parseAs(e),a("start = 'abcd'|2..3,'efgh'\n|").to.parseAs(e),a("start = 'abcd'|2..3,'efgh").to.failToParse(),e=U({type:"repeated",min:null,max:{type:"constant",value:3},expression:o,delimiter:s}),a("start = 'abcd'\n|3,'efgh'|").to.parseAs(e),a("start = 'abcd'|\n3,'efgh'|").to.parseAs(e),a("start = 'abcd'|3\n,'efgh'|").to.parseAs(e),a("start = 'abcd'|3,\n'efgh'|").to.parseAs(e),a("start = 'abcd'|3,'efgh'\n|").to.parseAs(e),a("start = 'abcd'|3, 'efgh'?|").to.parseAs(U({type:"repeated",min:null,max:{type:"constant",value:3},expression:o,delimiter:{type:"optional",expression:s}}))})),it("with variable boundaries",(()=>{let e=V("min","max");a("start = 'abcd'|min..max,'efgh'|  ").to.parseAs(e),a("start = 'abcd'\n|min..max,'efgh'|").to.parseAs(e),a("start = 'abcd'|\nmin..max,'efgh'|").to.parseAs(e),a("start = 'abcd'|min\n..max,'efgh'|").to.parseAs(e),a("start = 'abcd'|min..\nmax,'efgh'|").to.parseAs(e),a("start = 'abcd'|min..max\n,'efgh'|").to.parseAs(e),a("start = 'abcd'|min..max,\n'efgh'|").to.parseAs(e),a("start = 'abcd'|min..max,'efgh'\n|").to.parseAs(e),e=U({type:"repeated",min:null,max:{type:"variable",value:"exact"},expression:o,delimiter:s}),a("start = 'abcd'\n|exact,'efgh'|").to.parseAs(e),a("start = 'abcd'|\nexact,'efgh'|").to.parseAs(e),a("start = 'abcd'|exact\n,'efgh'|").to.parseAs(e),a("start = 'abcd'|exact,\n'efgh'|").to.parseAs(e),a("start = 'abcd'|exact,'efgh'\n|").to.parseAs(e),a("start = 'abcd'|exact, 'efgh'?|").to.parseAs(U({type:"repeated",min:null,max:{type:"variable",value:"exact"},expression:o,delimiter:{type:"optional",expression:s}}))})),it("with function boundaries",(()=>{let e=W("min","max");a("start = 'abcd'|{min}..{max},'efgh'|  ").to.parseAs(e),a("start = 'abcd'\n|{min}..{max},'efgh'|").to.parseAs(e),a("start = 'abcd'|\n{min}..{max},'efgh'|").to.parseAs(e),a("start = 'abcd'|{min}\n..{max},'efgh'|").to.parseAs(e),a("start = 'abcd'|{min}..\n{max},'efgh'|").to.parseAs(e),a("start = 'abcd'|{min}..{max}\n,'efgh'|").to.parseAs(e),a("start = 'abcd'|{min}..{max},\n'efgh'|").to.parseAs(e),a("start = 'abcd'|{min}..{max},'efgh'\n|").to.parseAs(e),e=U({type:"repeated",min:null,max:{type:"function",value:"exact"},expression:o,delimiter:s}),a("start = 'abcd'\n|{exact},'efgh'|").to.parseAs(e),a("start = 'abcd'|\n{exact},'efgh'|").to.parseAs(e),a("start = 'abcd'|{exact}\n,'efgh'|").to.parseAs(e),a("start = 'abcd'|{exact},\n'efgh'|").to.parseAs(e),a("start = 'abcd'|{exact},'efgh'\n|").to.parseAs(e),a("start = 'abcd'|{exact}, 'efgh'?|").to.parseAs(U({type:"repeated",min:null,max:{type:"function",value:"exact"},expression:o,delimiter:{type:"optional",expression:s}}))})),it("with mixed boundaries",(()=>{let e=V(2,"max");a("start = 'abcd'|2..max,'efgh'|  ").to.parseAs(e),a("start = 'abcd'\n|2..max,'efgh'|").to.parseAs(e),a("start = 'abcd'|\n2..max,'efgh'|").to.parseAs(e),a("start = 'abcd'|2\n..max,'efgh'|").to.parseAs(e),a("start = 'abcd'|2..\nmax,'efgh'|").to.parseAs(e),a("start = 'abcd'|2..max\n,'efgh'|").to.parseAs(e),a("start = 'abcd'|2..max,\n'efgh'|").to.parseAs(e),a("start = 'abcd'|2..max,'efgh'\n|").to.parseAs(e),e=V("min",3),a("start = 'abcd'|min..3,'efgh'|  ").to.parseAs(e),a("start = 'abcd'\n|min..3,'efgh'|").to.parseAs(e),a("start = 'abcd'|\nmin..3,'efgh'|").to.parseAs(e),a("start = 'abcd'|min\n..3,'efgh'|").to.parseAs(e),a("start = 'abcd'|min..\n3,'efgh'|").to.parseAs(e),a("start = 'abcd'|min..3\n,'efgh'|").to.parseAs(e),a("start = 'abcd'|min..3,\n'efgh'|").to.parseAs(e),a("start = 'abcd'|min..3,'efgh'\n|").to.parseAs(e),e=W(2,"max"),a("start = 'abcd'|2..{max},'efgh'|  ").to.parseAs(e),a("start = 'abcd'\n|2..{max},'efgh'|").to.parseAs(e),a("start = 'abcd'|\n2..{max},'efgh'|").to.parseAs(e),a("start = 'abcd'|2\n..{max},'efgh'|").to.parseAs(e),a("start = 'abcd'|2..\n{max},'efgh'|").to.parseAs(e),a("start = 'abcd'|2..{max}\n,'efgh'|").to.parseAs(e),a("start = 'abcd'|2..{max},\n'efgh'|").to.parseAs(e),a("start = 'abcd'|2..{max},'efgh'\n|").to.parseAs(e),e=W("min",3),a("start = 'abcd'|{min}..3,'efgh'|  ").to.parseAs(e),a("start = 'abcd'\n|{min}..3,'efgh'|").to.parseAs(e),a("start = 'abcd'|\n{min}..3,'efgh'|").to.parseAs(e),a("start = 'abcd'|{min}\n..3,'efgh'|").to.parseAs(e),a("start = 'abcd'|{min}..\n3,'efgh'|").to.parseAs(e),a("start = 'abcd'|{min}..3\n,'efgh'|").to.parseAs(e),a("start = 'abcd'|{min}..3,\n'efgh'|").to.parseAs(e),a("start = 'abcd'|{min}..3,'efgh'\n|").to.parseAs(e)}))}))})),describe("parses RepeatedOperator",(()=>{describe("without delimiter",(()=>{it("with constant boundaries",(()=>{a("start = 'abcd'| .. |").to.parseAs(z(0,null)),a("start = 'abcd'|0.. |").to.parseAs(z(0,null)),a("start = 'abcd'|1.. |").to.parseAs(z(1,null)),a("start = 'abcd'|2.. |").to.parseAs(z(2,null)),a("start = 'abcd'| ..1|").to.parseAs(z(0,1)),a("start = 'abcd'| ..2|").to.parseAs(z(0,2)),a("start = 'abcd'|2..2|").to.parseAs(z(2,2)),a("start = 'abcd'|2..3|").to.parseAs(z(2,3)),a("start = 'abcd'|3|   ").to.parseAs(U({type:"repeated",min:null,max:{type:"constant",value:3},expression:o,delimiter:null})),a("start = 'abcd'| ..0|").to.failToParse(),a("start = 'abcd'|0..0|").to.failToParse(),a("start = 'abcd'|0|   ").to.failToParse()})),it("with variable boundaries",(()=>{a("start = 'abcd'|min..   |").to.parseAs(z("min",null)),a("start = 'abcd'|   ..max|").to.parseAs(z(0,"max")),a("start = 'abcd'|min..max|").to.parseAs(z("min","max")),a("start = 'abcd'|exact|   ").to.parseAs(U({type:"repeated",min:null,max:{type:"variable",value:"exact"},expression:o,delimiter:null}))})),it("with function boundaries",(()=>{a("start = 'abcd'|{min}..     |").to.parseAs(H("min",null)),a("start = 'abcd'|     ..{max}|").to.parseAs(H(0,"max")),a("start = 'abcd'|{min}..{max}|").to.parseAs(H("min","max")),a("start = 'abcd'|{exact}|     ").to.parseAs(U({type:"repeated",min:null,max:{type:"function",value:"exact"},expression:o,delimiter:null}))})),it("with mixed boundaries",(()=>{a("start = 'abcd'|2..max|").to.parseAs(z(2,"max")),a("start = 'abcd'|min..3|").to.parseAs(z("min",3)),a("start = 'abcd'|2..{max}|").to.parseAs(H(2,"max")),a("start = 'abcd'|{min}..3|").to.parseAs(H("min",3))}))})),describe("with delimiter",(()=>{it("with constant boundaries",(()=>{a("start = 'abcd'| .. , 'efgh'|").to.parseAs(V(0,null)),a("start = 'abcd'|0.. , 'efgh'|").to.parseAs(V(0,null)),a("start = 'abcd'|1.. , 'efgh'|").to.parseAs(V(1,null)),a("start = 'abcd'|2.. , 'efgh'|").to.parseAs(V(2,null)),a("start = 'abcd'| ..1, 'efgh'|").to.parseAs(V(0,1)),a("start = 'abcd'| ..2, 'efgh'|").to.parseAs(V(0,2)),a("start = 'abcd'|2..2, 'efgh'|").to.parseAs(V(2,2)),a("start = 'abcd'|2..3, 'efgh'|").to.parseAs(V(2,3)),a("start = 'abcd'|3   , 'efgh'|").to.parseAs(U({type:"repeated",min:null,max:{type:"constant",value:3},expression:o,delimiter:s})),a("start = 'abcd'| ..0, 'efgh'|").to.failToParse(),a("start = 'abcd'|0..0, 'efgh'|").to.failToParse(),a("start = 'abcd'|0   , 'efgh'|").to.failToParse()})),it("with variable boundaries",(()=>{a("start = 'abcd'|min..   , 'efgh'|").to.parseAs(V("min",null)),a("start = 'abcd'|   ..max, 'efgh'|").to.parseAs(V(0,"max")),a("start = 'abcd'|min..max, 'efgh'|").to.parseAs(V("min","max")),a("start = 'abcd'|exact, 'efgh'|   ").to.parseAs(U({type:"repeated",min:null,max:{type:"variable",value:"exact"},expression:o,delimiter:s}))})),it("with function boundaries",(()=>{a("start = 'abcd'|{min}..     , 'efgh'|").to.parseAs(W("min",null)),a("start = 'abcd'|     ..{max}, 'efgh'|").to.parseAs(W(0,"max")),a("start = 'abcd'|{min}..{max}, 'efgh'|").to.parseAs(W("min","max")),a("start = 'abcd'|{exact},      'efgh'|").to.parseAs(U({type:"repeated",min:null,max:{type:"function",value:"exact"},expression:o,delimiter:s}))})),it("with mixed boundaries",(()=>{a("start = 'abcd'|2..max, 'efgh'|").to.parseAs(V(2,"max")),a("start = 'abcd'|min..3, 'efgh'|").to.parseAs(V("min",3)),a("start = 'abcd'|2..{max}, 'efgh'|").to.parseAs(W(2,"max")),a("start = 'abcd'|{min}..3, 'efgh'|").to.parseAs(W("min",3))}))}))})),it("parses RuleReferenceExpression",(()=>{a("start = a").to.parseAs(G("a")),a("start = a\n=").to.failToParse(),a("start = a\n'abcd'\n=").to.failToParse(),a("start = a.\0").to.failToParse()})),it("parses SemanticPredicateExpression",(()=>{a("start = !\n{ code }").to.parseAs(U(l)),a("start = !{").to.failToParse(),a("start = &{").to.failToParse(),a("start = &{ ").to.failToParse(),a("start = &{  ").to.failToParse(),a("start = &{{").to.failToParse(),a("start = &{{ ").to.failToParse(),a("start = &{{  ").to.failToParse(),a("start = &{{   ").to.failToParse(),a("start = &{{}").to.failToParse(),a("start = &{{} ").to.failToParse(),a("start = &{{}  ").to.failToParse(),a("start = &{{}{}").to.failToParse(),a("start = &{{}{} ").to.failToParse(),a("start = &{{}{}  ").to.failToParse(),a("start = &{{}{}{").to.failToParse(),a("start = &{{}{}{ ").to.failToParse(),a("start = &{{}{}{  ").to.failToParse()})),it("parses SemanticPredicateOperator",(()=>{a("start = &{ code }").to.parseAs(U(c)),a("start = !{ code }").to.parseAs(U(l))})),it("parses SourceCharacter",(()=>{a("start = '💩' // 💩").to.parseAs(N("💩",!1)),a('start = "💩" // 💩').to.parseAs(N("💩",!1)),a("start = '\ud83d' // \ud83d").to.parseAs(N("\ud83d",!1)),a("start = '\udca9' // \udca9").to.parseAs(N("\udca9",!1)),a("start = '\udca9\ud83d' // \udca9\ud83d").to.parseAs(N("\udca9\ud83d",!1))})),it("parses WhiteSpace",(()=>{a("start =\t'abcd'").to.parseAs(J),a("start =\v'abcd'").to.parseAs(J),a("start =\f'abcd'").to.parseAs(J),a("start = 'abcd'").to.parseAs(J),a("start = 'abcd'").to.parseAs(J),a("start =\ufeff'abcd'").to.parseAs(J),a("start = 'abcd'").to.parseAs(J)})),it("parses LineTerminator",(()=>{a("start = '\n'").to.failToParse(),a("start = '\r'").to.failToParse(),a("start = '\u2028'").to.failToParse(),a("start = '\u2029'").to.failToParse()})),it("parses LineTerminatorSequence",(()=>{a("start =\n'abcd'").to.parseAs(J),a("start =\r\n'abcd'").to.parseAs(J),a("start =\r'abcd'").to.parseAs(J),a("start =\u2028'abcd'").to.parseAs(J),a("start =\u2029'abcd'").to.parseAs(J)})),it("parses Comment",(()=>{a("start =// comment\n'abcd'").to.parseAs(J),a("start =/* comment */'abcd'").to.parseAs(J)})),it("parses MultiLineComment",(()=>{a("start =/**/'abcd'").to.parseAs(J),a("start =/*a*/'abcd'").to.parseAs(J),a("start =/*abc*/'abcd'").to.parseAs(J),a("start =/**/*/'abcd'").to.failToParse(),a("start = /*").to.failToParse(),a("start = /* ").to.failToParse(),a("start = /*  ").to.failToParse(),a("start = 'foo'/*").to.failToParse(),a("start = 'foo'/* ").to.failToParse(),a("start = 'foo'/*  ").to.failToParse()})),it("parses MultiLineCommentNoLineTerminator",(()=>{a("a = 'abcd'/**/\r\nb = 'efgh'").to.parseAs(Y),a("a = 'abcd'/*a*/\r\nb = 'efgh'").to.parseAs(Y),a("a = 'abcd'/*abc*/\r\nb = 'efgh'").to.parseAs(Y),a("a = 'abcd'/**/*/\r\nb = 'efgh'").to.failToParse(),a("a = 'abcd'/*\n*/\r\nb = 'efgh'").to.failToParse()})),it("parses SingleLineComment",(()=>{a("start =//\n'abcd'").to.parseAs(J),a("start =//a\n'abcd'").to.parseAs(J),a("start =//abc\n'abcd'").to.parseAs(J),a("//").to.failToParse(),a("// ").to.failToParse(),a("//  ").to.failToParse(),a("start =//\n@\n'abcd'").to.failToParse()})),it("parses Identifier",(()=>{a("start = a:'abcd'").to.parseAs(U(b))})),it("parses IdentifierName",(()=>{a("start = a").to.parseAs(G("a")),a("start = ab").to.parseAs(G("ab")),a("start = abcd").to.parseAs(G("abcd"))})),it("parses IdentifierStart",(()=>{a("start = a").to.parseAs(G("a")),a("start = $").to.failToParse(),a("$start = a").to.failToParse(),a("start = a$b").to.parseAs(G("a$b")),a("start = _").to.parseAs(G("_")),a("start = \\u0061").to.parseAs(G("a")),a("start = \\").to.failToParse()})),it("parses IdentifierPart",(()=>{a("start = aa").to.parseAs(G("aa")),a("start = à").to.parseAs(G("à")),a("start = a0").to.parseAs(G("a0")),a("start = a‿").to.parseAs(G("a‿")),a("start = a‌").to.parseAs(G("a‌")),a("start = a‍").to.parseAs(G("a‍"))})),it("parses LiteralMatcher",(()=>{a("start = 'abcd'").to.parseAs(N("abcd",!1)),a("start = 'abcd'i").to.parseAs(N("abcd",!0))})),it("parses StringLiteral",(()=>{a('start = ""').to.parseAs(N("",!1)),a('start = "a"').to.parseAs(N("a",!1)),a('start = "abc"').to.parseAs(N("abc",!1)),a("start = ''").to.parseAs(N("",!1)),a("start = 'a'").to.parseAs(N("a",!1)),a("start = 'abc'").to.parseAs(N("abc",!1))})),it("parses DoubleStringCharacter",(()=>{a('start = "a"').to.parseAs(N("a",!1)),a('start = "\\n"').to.parseAs(N("\n",!1)),a('start = "\\\n"').to.parseAs(N("",!1)),a('start = """').to.failToParse(),a('start = "\\"').to.failToParse(),a('start = "\n"').to.failToParse()})),it("parses SingleStringCharacter",(()=>{a("start = 'a'").to.parseAs(N("a",!1)),a("start = '\\n'").to.parseAs(N("\n",!1)),a("start = '\\\n'").to.parseAs(N("",!1)),a("start = '''").to.failToParse(),a("start = '\\'").to.failToParse(),a("start = '\n'").to.failToParse()})),it("parses CharacterClassMatcher",(()=>{a("start = []").to.parseAs(D([],!1,!1)),a("start = [a-d]").to.parseAs(D([["a","d"]],!1,!1)),a("start = [a]").to.parseAs(D(["a"],!1,!1)),a("start = [a-de-hi-l]").to.parseAs(D([["a","d"],["e","h"],["i","l"]],!1,!1)),a("start = [^a-d]").to.parseAs(D([["a","d"]],!0,!1)),a("start = [a-d]i").to.parseAs(D([["a","d"]],!1,!0)),a("start = [\\\n]").to.parseAs(D([],!1,!1)),a("start = [💩]").to.parseAs(D(["💩"],!1,!1,!0)),a("start = [\\u{1F4A9}]").to.parseAs(D(["💩"],!1,!1,!0)),a("start = [💩-💰]").to.parseAs(D([["💩","💰"]],!1,!1,!0)),a("start = [\\u{1F4A9}-\\u{1F4B0}]").to.parseAs(D([["💩","💰"]],!1,!1,!0)),a("start = [\\u{g}]").to.failToParse(),a("start = [\\u{1g}]").to.failToParse(),a("start = [\\u{12g}]").to.failToParse(),a("start = [\\u{123g}]").to.failToParse(),a("start = [\\xgg]").to.failToParse(),a("start = [a]uu").to.failToParse(),a("start = [a]ii").to.failToParse(),a("start = [a]iui").to.failToParse(),a("start = [a]uiu").to.failToParse(),a("start = [^a]u").to.parseAs(D(["a"],!0,!1,!0)),a("start = [^a]ui").to.parseAs(D(["a"],!0,!0,!0)),a("start = [^a]iu").to.parseAs(D(["a"],!0,!0,!0)),a("start = [^]u").to.parseAs(D([["\ud800","\udfff"]],!0,!1,!0)),a("start = [\\p{ASCII}]").to.parseAs(D([{type:"classEscape",value:"p{ASCII}",unicode:!0}],!1,!1,!0)),a("start = [\\P{ASCII}]").to.parseAs(D([{type:"classEscape",value:"P{ASCII}",unicode:!0}],!1,!1,!0)),a("start = [\\p{gc=Nd}]").to.parseAs(D([{type:"classEscape",value:"p{gc=Nd}",unicode:!0}],!1,!1,!0)),a("start = [\\p{Script=New_Tai_Lue}]").to.parseAs(D([{type:"classEscape",value:"p{Script=New_Tai_Lue}",unicode:!0}],!1,!1,!0)),a("start = [\\p]").to.failToParse(),a("start = [\\p{]").to.failToParse(),a("start = [\\p{a]").to.failToParse(),a("start = [\\p{a=]").to.failToParse(),a("start = [\\p{a=b]").to.failToParse(),a("start = [\\p{١}]").to.failToParse()})),it("parses ClassCharacterRange",(()=>{a("start = [a-d]").to.parseAs(D([["a","d"]],!1,!1)),a("start = [a-a]").to.parseAs(D([["a","a"]],!1,!1)),a("start = [b-a]").to.failToParse({message:"Invalid character range: b-a."}),a("start = [b-").to.failToParse()})),it("parses ClassCharacter",(()=>{a("start = [a]").to.parseAs(D(["a"],!1,!1)),a("start = [\\n]").to.parseAs(D(["\n"],!1,!1)),a("start = [\\\n]").to.parseAs(D([],!1,!1)),a("start = []]").to.failToParse(),a("start = [\\]").to.failToParse(),a("start = [\n]").to.failToParse()})),it("parses LineContinuation",(()=>{a("start = '\\\r\n'").to.parseAs(N("",!1))})),it("parses EscapeSequence",(()=>{a("start = '\\n'").to.parseAs(N("\n",!1)),a("start = '\\0'").to.parseAs(N("\0",!1)),a("start = '\\xFF'").to.parseAs(N("ÿ",!1)),a("start = '\\uFFFF'").to.parseAs(N("￿",!1)),a("start = '\\c'").to.parseAs(N("c",!1)),a("start = '\\09'").to.failToParse(),a("start = '\\").to.failToParse()})),it("parses CharacterEscapeSequence",(()=>{a("start = '\\n'").to.parseAs(N("\n",!1)),a("start = '\\a'").to.parseAs(N("a",!1))})),it("parses SingleEscapeCharacter",(()=>{a("start = '\\''").to.parseAs(N("'",!1)),a("start = '\\\"'").to.parseAs(N('"',!1)),a("start = '\\\\'").to.parseAs(N("\\",!1)),a("start = '\\b'").to.parseAs(N("\b",!1)),a("start = '\\f'").to.parseAs(N("\f",!1)),a("start = '\\n'").to.parseAs(N("\n",!1)),a("start = '\\r'").to.parseAs(N("\r",!1)),a("start = '\\t'").to.parseAs(N("\t",!1)),a("start = '\\v'").to.parseAs(N("\v",!1))})),it("parses NonEscapeCharacter",(()=>{a("start = '\\a'").to.parseAs(N("a",!1))})),it("parses HexEscapeSequence",(()=>{a("start = '\\xFF'").to.parseAs(N("ÿ",!1)),a("start = '\\x").to.failToParse(),a("start = '\\xF").to.failToParse()})),it("parses UnicodeEscapeSequence",(()=>{a("start = '\\uFFFF'").to.parseAs(N("￿",!1)),a("start = '\\u").to.failToParse(),a("start = '\\uF").to.failToParse(),a("start = '\\uFF").to.failToParse(),a("start = '\\uFFF").to.failToParse()})),it("parses AnyMatcher",(()=>{a("start = .").to.parseAs(B())})),it("parses CodeBlock",(()=>{a("start = 'abcd' { code }").to.parseAs(j(" code "))})),it("parses Code",(()=>{a("start = 'abcd' {a}").to.parseAs(j("a")),a("start = 'abcd' {abc}").to.parseAs(j("abc")),a("start = 'abcd' {{a}}").to.parseAs(j("{a}")),a("start = 'abcd' {{a}{b}{c}}").to.parseAs(j("{a}{b}{c}")),a("start = 'abcd' {{}").to.failToParse(),a("start = 'abcd' {}}").to.failToParse()})),it("parses __",(()=>{a("start ='abcd'").to.parseAs(J),a("start = 'abcd'").to.parseAs(J),a("start =\r\n'abcd'").to.parseAs(J),a("start =/* comment */'abcd'").to.parseAs(J),a("start =   'abcd'").to.parseAs(J)})),it("parses _",(()=>{a("a = 'abcd'\r\nb = 'efgh'").to.parseAs(Y),a("a = 'abcd' \r\nb = 'efgh'").to.parseAs(Y),a("a = 'abcd'/* comment */\r\nb = 'efgh'").to.parseAs(Y),a("a = 'abcd'   \r\nb = 'efgh'").to.parseAs(Y)})),it("parses EOS",(()=>{a("a = 'abcd'\n;b = 'efgh'").to.parseAs(Y),a("a = 'abcd' \r\nb = 'efgh'").to.parseAs(Y),a("a = 'abcd' // comment\r\nb = 'efgh'").to.parseAs(Y),a("a = 'abcd'\nb = 'efgh'").to.parseAs(Y)})),it("parses EOF",(()=>{a("start = 'abcd'\n").to.parseAs(J)})),it("generates codeLocation / nameLocation / labelLocation",(()=>{const e=t.parse("\n{{\n  const foo = 12;\n}}\n{\n  const bar = 13;\n}\na = label:'abcd' &{ return true; } !{ return false; } { return 'so true'; }\nb = @LABEL:'efgh'\nc = @'ijkl'\n");a(e).to.eql({type:"grammar",imports:[],topLevelInitializer:{type:"top_level_initializer",code:"\n  const foo = 12;\n",codeLocation:{source:void 0,start:{offset:3,line:2,column:3},end:{offset:22,line:4,column:1}},location:{source:void 0,start:{offset:1,line:2,column:1},end:{offset:25,line:5,column:1}}},initializer:{type:"initializer",code:"\n  const bar = 13;\n",codeLocation:{source:void 0,start:{offset:26,line:5,column:2},end:{offset:45,line:7,column:1}},location:{source:void 0,start:{offset:25,line:5,column:1},end:{offset:47,line:8,column:1}}},rules:[{type:"rule",name:"a",nameLocation:{source:void 0,start:{offset:47,line:8,column:1},end:{offset:48,line:8,column:2}},expression:{type:"action",expression:{type:"sequence",elements:[{type:"labeled",label:"label",labelLocation:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:56,line:8,column:10}},expression:{type:"literal",value:"abcd",ignoreCase:!1,location:{source:void 0,start:{offset:57,line:8,column:11},end:{offset:63,line:8,column:17}}},location:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:63,line:8,column:17}}},{type:"semantic_and",code:" return true; ",codeLocation:{source:void 0,start:{offset:66,line:8,column:20},end:{offset:80,line:8,column:34}},location:{source:void 0,start:{offset:64,line:8,column:18},end:{offset:81,line:8,column:35}}},{type:"semantic_not",code:" return false; ",codeLocation:{source:void 0,start:{offset:84,line:8,column:38},end:{offset:99,line:8,column:53}},location:{source:void 0,start:{offset:82,line:8,column:36},end:{offset:100,line:8,column:54}}}],location:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:100,line:8,column:54}}},code:" return 'so true'; ",codeLocation:{source:void 0,start:{offset:102,line:8,column:56},end:{offset:121,line:8,column:75}},location:{source:void 0,start:{offset:51,line:8,column:5},end:{offset:122,line:8,column:76}}},location:{source:void 0,start:{offset:47,line:8,column:1},end:{offset:123,line:9,column:1}}},{type:"rule",name:"b",nameLocation:{source:void 0,start:{offset:123,line:9,column:1},end:{offset:124,line:9,column:2}},expression:{type:"sequence",elements:[{type:"labeled",label:"LABEL",labelLocation:{source:void 0,start:{offset:128,line:9,column:6},end:{offset:133,line:9,column:11}},pick:!0,expression:{type:"literal",value:"efgh",ignoreCase:!1,location:{source:void 0,start:{offset:134,line:9,column:12},end:{offset:140,line:9,column:18}}},location:{source:void 0,start:{offset:127,line:9,column:5},end:{offset:140,line:9,column:18}}}],location:{source:void 0,start:{offset:127,line:9,column:5},end:{offset:140,line:9,column:18}}},location:{source:void 0,start:{offset:123,line:9,column:1},end:{offset:141,line:10,column:1}}},{type:"rule",name:"c",nameLocation:{source:void 0,start:{offset:141,line:10,column:1},end:{offset:142,line:10,column:2}},expression:{type:"sequence",elements:[{type:"labeled",label:null,labelLocation:{source:void 0,start:{offset:145,line:10,column:5},end:{offset:146,line:10,column:6}},pick:!0,expression:{type:"literal",value:"ijkl",ignoreCase:!1,location:{source:void 0,start:{offset:146,line:10,column:6},end:{offset:152,line:10,column:12}}},location:{source:void 0,start:{offset:145,line:10,column:5},end:{offset:152,line:10,column:12}}}],location:{source:void 0,start:{offset:145,line:10,column:5},end:{offset:152,line:10,column:12}}},location:{source:void 0,start:{offset:141,line:10,column:1},end:{offset:153,line:11,column:1}}}],location:{source:void 0,start:{offset:0,line:1,column:1},end:{offset:153,line:11,column:1}}})})),it("handles ImportsAndSource",(()=>{const e={startRule:"ImportsAndSource",reservedWords:r};for(const r of["","import foo","import 'foo';","import bar, baz from 'foo';","import * boo","import * as ","import * as ;","import {foo","import {foo,","import {foo, bar","import {foo, bar,","import {;","import from;","import * from;","import {foo} from;","import {foo as}"])a((()=>t.parse(r,e))).to.not.throw();for(const r of["import while from 'bar'"])a((()=>t.parse(r,e))).to.throw()})),it("handles peg$library",(()=>{const e=t.parse("foo",{peg$library:!0});a(typeof e.peg$throw).to.eql("function"),delete e.peg$throw,a(e).to.eql({peg$result:{},peg$currPos:0,peg$FAILED:{},peg$maxFailExpected:[{type:"other",description:"whitespace"},{type:"other",description:"end of line"},{type:"other",description:"comment"},{type:"other",description:"string"},{type:"literal",text:"=",ignoreCase:!1}],peg$maxFailPos:3,peg$success:!1})}))})),parser_spec}requireParser_spec()},"object"==typeof exports&&"undefined"!=typeof module?factory(require("chai"),require("whatwg-url")):"function"==typeof define&&define.amd?define(["chai","whatwg-url"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).chai,global.whatwgURL);